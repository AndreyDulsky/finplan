!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.finplan=t():e.finplan=t()}(window,(function(){return function(e){var t={};function i(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(o,a,function(t){return e[t]}.bind(null,a));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/codebase/",i(i.s=141)}([function(e,t,i){"use strict";function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}i.d(t,"c",(function(){return B})),i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return d}));var a=function(){},r=function(){function e(e){this.webixJet=!0,this.webix=e,this._events=[],this._subs={},this._data={}}var t=e.prototype;return t.getRoot=function(){return this._root},t.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.setParam=function(e,t,i){if(this._data[e]!==t&&(this._data[e]=t,this._segment.update(e,t,0),i))return this.show(null)},t.getParam=function(e,t){var i=this._data[e];if(void 0!==i||!t)return i;var o=this.getParentView();return o?o.getParam(e,t):void 0},t.getUrl=function(){return this._segment.suburl()},t.getUrlString=function(){return this._segment.toString()},t.getParentView=function(){return this._parent},t.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView((function(i){return(i.config.id===e||i.config.localId===e)&&i.$scope===t.$scope}),"self")}return e},t.on=function(e,t,i){var o=e.attachEvent(t,i);return this._events.push({obj:e,id:o}),o},t.contains=function(e){for(var t in this._subs){var i=this._subs[t].view;if(i===e||i.contains(e))return!0}return!1},t.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},t.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:"_top"===e?(this._subs[e]={url:"",id:null,popup:!0},this.getSubViewInfo(e)):this._parent?this._parent.getSubViewInfo(e):null},t._detachEvents=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id)},t._destroySubs=function(){for(var e in this._subs){var t=this._subs[e].view;t&&t.destructor()}this._subs={}},t._init_url_data=function(){var e=this._segment.current();this._data={},this.webix.extend(this._data,e.params,!0)},t._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var e in this._subs){var t=this._subs[e];if(!t.branch&&t.view&&"_top"!==e){var i=t.view._getDefaultSub();if(i)return i}}},t._routed_view=function(){var e=this.getParentView();if(!e)return!0;var t=e._getDefaultSub();return!(!t&&t!==this)&&e._routed_view()},e}();function n(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),i=[],o=0;o<t.length;o++){var a=t[o],r={},n=a.indexOf(":");if(-1===n&&(n=a.indexOf("?")),-1!==n){var l=a.substr(n+1).split(/[\:\?\&]/g),s=Array.isArray(l),c=0;for(l=s?l:l[Symbol.iterator]();;){var d;if(s){if(c>=l.length)break;d=l[c++]}else{if((c=l.next()).done)break;d=c.value}var u=d.split("=");r[u[0]]=decodeURIComponent(u[1])}}i[o]={page:n>-1?a.substr(0,n):a,params:r,isNew:!0}}return i}function l(e){var t=[],i=e,o=Array.isArray(i),a=0;for(i=o?i:i[Symbol.iterator]();;){var r;if(o){if(a>=i.length)break;r=i[a++]}else{if((a=i.next()).done)break;r=a.value}var n=r;t.push("/"+n.page);var l=s(n.params);l&&t.push("?"+l)}return t.join("")}function s(e){var t=[];for(var i in e)t.length&&t.push("&"),t.push(i+"="+encodeURIComponent(e[i]));return t.join("")}var c=function(){function e(e,t){this._next=1,this.route="string"==typeof e?{url:n(e),path:e}:e,this.index=t}var t=e.prototype;return t.current=function(){return this.route.url[this.index]},t.next=function(){return this.route.url[this.index+this._next]},t.suburl=function(){return this.route.url.slice(this.index)},t.shift=function(){return new e(this.route,this.index+this._next)},t.refresh=function(){for(var e=this.route.url,t=this.index+1;t<e.length;t++)e[t].isNew=!0},t.toString=function(){var e=l(this.suburl());return e?e.substr(1):""},t._join=function(e,t){var i=this.route.url;if(null===e)return i;var o=this.route.url;if(i=o.slice(0,this.index+(t?this._next:0)),e){i=i.concat(n(e));for(var a=0;a<i.length;a++)o[a]&&(i[a].view=o[a].view),o[a]&&i[a].page===o[a].page&&(i[a].isNew=!1)}return i},t.append=function(e){var t=this._join(e,!0);return this.route.path=l(t),this.route.url=t,this.route.path},t.show=function(e,t,i){var o=this,r=this._join(e,i);return new Promise((function(e,i){var n=l(r),s={url:r,redirect:n,confirm:Promise.resolve()},c=t?t.app:null;if(c&&!c.callEvent("app:guard",[s.redirect,t,s]))return void i(new a);s.confirm.catch((function(e){return i(e)})).then((function(){if(null!==s.redirect){if(s.redirect!==n)return c.show(s.redirect),void i(new a);o.route.path=n,o.route.url=r,e()}else i(new a)}))}))},t.size=function(e){this._next=e},t.split=function(){var t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=l(t.url)),new e(t,0)},t.update=function(e,t,i){var o=this.route.url[this.index+(i||0)];if(!o)return this.route.url.push({page:"",params:{}}),this.update(e,t,i);""===e?o.page=t:o.params[e]=t,this.route.path=l(this.route.url)},e}(),d=function(e){function t(t,i){var o;return(o=e.call(this,t.webix)||this).app=t,o._children=[],o}o(t,e);var i=t.prototype;return i.ui=function(e,t){var i=(t=t||{}).container||e.container,o=this.app.createView(e);return this._children.push(o),o.render(i,this._segment,this),"object"!=typeof e||e instanceof r?o:o.getRoot()},i.show=function(e,t){if(t=t||{},"object"==typeof e){for(var i in e)this.setParam(i,e[i]);e=null}else{if("/"===e.substr(0,1))return this.app.show(e);if(0===e.indexOf("./")&&(e=e.substr(2)),0===e.indexOf("../")){var o=this.getParentView();return o?o.show(e.substr(3),t):this.app.show("/"+e.substr(3))}var a=this.getSubViewInfo(t.target);if(a){if(a.parent!==this)return a.parent.show(e,t);if(t.target&&"default"!==t.target)return this._renderFrameLock(t.target,a.subview,e)}else if(e)return this.app.show("/"+e)}return this._show(this._segment,e,this)},i._show=function(e,t,i){var o=this;return e.show(t,i,!0).then((function(){return o._init_url_data(),o._urlChange()})).then((function(){e.route.linkRouter&&(o.app.getRouter().set(e.route.path,{silent:!0}),o.app.callEvent("app:route",[e.route.path]))}))},i.init=function(e,t){},i.ready=function(e,t){},i.config=function(){this.app.webix.message("View:Config is not implemented")},i.urlChange=function(e,t){},i.destroy=function(){},i.destructor=function(){this.destroy(),this._destroyKids(),this._root.destructor(),e.prototype.destructor.call(this)},i.use=function(e,t){e(this.app,this,t)},i.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},i.render=function(e,t,i){var o=this;"string"==typeof t&&(t=new c(t,0)),this._segment=t,this._parent=i,this._init_url_data();var a="string"==typeof(e=e||document.body)?this.webix.toNode(e):e;return this._container!==a?(this._container=a,this._render(t)):this._urlChange().then((function(){return o.getRoot()}))},i._render=function(e){var t=this,i=this.config();return i.then?i.then((function(i){return t._render_final(i,e)})):this._render_final(i,e)},i._render_final=function(e,t){var i,o=this,a=null,r=null,n=!1;if(this._container.tagName?r=this._container:(a=this._container).popup?(r=document.body,n=!0):r=this.webix.$$(a.id),!this.app||!r)return Promise.reject(null);var l=this._segment.current(),s={ui:{}};this.app.copyConfig(e,s.ui,this._subs),this.app.callEvent("app:render",[this,t,s]),s.ui.$scope=this,!a&&l.isNew&&l.view&&l.view.destructor();try{if(a&&!n){var c=r,d=c.getParentView();d&&"multiview"===d.name&&!s.ui.id&&(s.ui.id=c.config.id)}this._root=this.app.webix.ui(s.ui,r);var u=this._root;n&&u.setPosition&&!u.isVisible()&&u.show(),a&&(a.view&&a.view!==this&&a.view!==this.app&&a.view.destructor(),a.id=this._root.config.id,this.getParentView()||!this.app.app?a.view=this:a.view=this.app),l.isNew&&(l.view=this,l.isNew=!1),i=Promise.resolve(this._init(this._root,t)).then((function(){return o._urlChange().then((function(){return o._initUrl=null,o.ready(o._root,t.suburl())}))}))}catch(e){i=Promise.reject(e)}return i.catch((function(e){return o._initError(o,e)}))},i._init=function(e,t){return this.init(e,t.suburl())},i._urlChange=function(){var e=this;this.app.callEvent("app:urlchange",[this,this._segment]);var t=[];for(var i in this._subs){var o=this._subs[i],a=this._renderFrameLock(i,o,null);a&&t.push(a)}return Promise.all(t).then((function(){return e.urlChange(e._root,e._segment.suburl())}))},i._renderFrameLock=function(e,t,i){if(!t.lock){var o=this._renderFrame(e,t,i);o&&(t.lock=o.then((function(){return t.lock=null}),(function(){return t.lock=null})))}return t.lock},i._renderFrame=function(e,t,i){var o=this;if("default"===e){if(this._segment.next())return this._createSubView(t,this._segment.shift());t.view&&t.popup&&(t.view.destructor(),t.view=null)}if(null!==i&&(t.url=i),t.route){if(null!==i)return t.route.show(i,t.view).then((function(){return o._createSubView(t,t.route)}));if(t.branch)return}var a=t.view;if(!a&&t.url){if("string"==typeof t.url)return t.route=new c(t.url,0),this._createSubView(t,t.route);"function"!=typeof t.url||a instanceof t.url||(a=new t.url(this.app,"")),a||(a=t.url)}if(a)return a.render(t,t.route||this._segment,this)},i._initError=function(e,t){return this.app&&this.app.error("app:error:initview",[t,e]),!0},i._createSubView=function(e,t){var i=this;return this.app.createFromURL(t.current()).then((function(o){return o.render(e,t,i)}))},i._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(r),u=function(e){function t(t,i){var o;return(o=e.call(this,t,i)||this)._ui=i.ui,o}return o(t,e),t.prototype.config=function(){return this._ui},t}(d),h=function(){function e(e,t,i){this.path="",this.app=i}var t=e.prototype;return t.set=function(e,t){this.path=e;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.get=function(){return this.path},e}(),p=!0,m=function(e){function t(t){var i,o=(t||{}).webix||window.webix;return(i=e.call(this,o)||this).config=i.webix.extend({name:"App",version:"1.0",start:"/home"},t,!0),i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),i.webix.EventSystem),i}o(t,e);var i=t.prototype;return i.getUrl=function(){return this._subSegment.suburl()},i.getUrlString=function(){return this._subSegment.toString()},i.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},i.setService=function(e,t){this._services[e]=t},i.destructor=function(){this.getSubView().destructor(),e.prototype.destructor.call(this)},i.copyConfig=function(e,t,i){if((e instanceof r||"function"==typeof e&&e.prototype instanceof r)&&(e={$subview:e}),void 0!==e.$subview)return this.addSubView(e,t,i);for(var o in t=t||(e instanceof Array?[]:{}),e){var a=e[o];if("function"==typeof a&&a.prototype instanceof r&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp)t[o]=a;else if(a instanceof Date)t[o]=new Date(a);else{var n=this.copyConfig(a,a instanceof Array?[]:{},i);null!==n&&(t[o]=n)}}return t},i.getRouter=function(){return this.$router},i.clickHandler=function(e,t){if(e&&(t=t||e.target||e.srcElement)&&t.getAttribute){var i=t.getAttribute("trigger");if(i)return this._forView(t,(function(e){return e.app.trigger(i)})),e.cancelBubble=!0,e.preventDefault();var o=t.getAttribute("route");if(o)return this._forView(t,(function(e){return e.show(o)})),e.cancelBubble=!0,e.preventDefault()}var a=t.parentNode;a&&this.clickHandler(e,a)},i.getRoot=function(){return this.getSubView().getRoot()},i.refresh=function(){var e=this;return this._subSegment?this.getSubView().refresh().then((function(t){return e.callEvent("app:route",[e.getUrl()]),t})):Promise.resolve(null)},i.loadView=function(e){var t=this,i=this.config.views,o=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(o="function"==typeof i?i(e):i[e])&&(e=o,o=null),o||(o="_blank"===e?{}:this._loadViewDynamic(e))}catch(t){o=this._loadError(e,t)}return o.then||(o=Promise.resolve(o)),o=o.then((function(e){return e.__esModule?e.default:e})).catch((function(i){return t._loadError(e,i)}))},i._forView=function(e,t){var i=this.webix.$$(e);i&&t(i.$scope)},i._loadViewDynamic=function(e){return null},i.createFromURL=function(e){var t=this;return e.isNew||!e.view?this.loadView(e.page).then((function(e){return t.createView(e,name)})):Promise.resolve(e.view)},i.createView=function(e,i){if("function"==typeof e){if(e.prototype instanceof t)return new e({app:this,name:i,router:h});if(e.prototype instanceof r)return new e(this,{name:i});e=e(this)}return e instanceof r?e:new u(this,{name:i,ui:e})},i.show=function(e){return this.render(this._container,e||this.config.start)},i.trigger=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];this.apply(e,i)},i.apply=function(e,t){this.callEvent(e,t)},i.action=function(e){return this.webix.bind((function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];this.apply(e,i)}),this)},i.on=function(e,t){this.attachEvent(e,t)},i.use=function(e,t){e(this,null,t)},i.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var i=0;i<t.length;i++)if(console.error(t[i]),t[i]instanceof Error){var o=t[i].message;0===o.indexOf("Module build failed")?(o=o.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+o+"</pre>"):(o+="<br><br>Check console for more details",this.webix.message({type:"error",text:o,expire:-1}))}},i.render=function(e,t,i){var o=this;this._container="string"==typeof e?this.webix.toNode(e):e||document.body;var a=null;!this.$router?(p&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(e){return o.clickHandler(e)})),p=!1),"string"==typeof t&&(t=new c(t,0)),this._subSegment=this._first_start(t),this._subSegment.route.linkRouter=!0):a="string"==typeof t?t:this.app?t.split().route.path||this.config.start:t.toString();var r=this.getSubView(),n=this._subSegment,l=n.show(a,r).then((function(){return o.createFromURL(n.current())})).then((function(t){return t.render(e,n)})).then((function(e){return o.$router.set(n.route.path,{silent:!0}),o.callEvent("app:route",[o.getUrl()]),e}));return this.ready=this.ready.then((function(){return l})),l},i.getSubView=function(){if(this._subSegment){var e=this._subSegment.current().view;if(e)return e}return new d(this,{})},i._first_start=function(e){var t=this;this._segment=e;if(this.$router=new this.config.router((function(e){return setTimeout((function(){t.show(e).catch((function(e){if(!(e instanceof a))throw e}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){t.webix.html.removeCss(i,"webixappstart"),t.webix.html.addCss(i,"webixapp")}),10)}if(e)this.app&&(e.current().view=this,e.next()?(e.refresh(),e=e.split()):e=new c(this.config.start,0));else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),e=new c(o,0)}return e},i._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},i.addSubView=function(e,t,i){var o=!0!==e.$subview?e.$subview:null,a=e.name||(o?this.webix.uid():"default");return t.id=e.id||"s"+this.webix.uid(),(i[a]={id:t.id,url:o,branch:e.branch,popup:e.popup}).popup?null:t},t}(r),g=function(){function e(e,t){var i=this;this.config=t||{},this._detectPrefix(),this.cb=e,window.onpopstate=function(){return i.cb(i.get())}}var t=e.prototype;return t.set=function(e,t){var i=this;if(this.config.routes){var o=e.split("?",2);for(var a in this.config.routes)if(this.config.routes[a]===o[0]){e=a+(o.length>1?"?"+o[1]:"");break}}this.get()!==e&&window.history.pushState(null,null,this.prefix+this.sufix+e),t&&t.silent||setTimeout((function(){return i.cb(e)}),1)},t.get=function(){var e=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(e="/"!==e&&"#"!==e?e:"",this.config.routes){var t=e.split("?",2),i=this.config.routes[t[0]];i&&(e=i+(t.length>1?"?"+t[1]:""))}return e},t._detectPrefix=function(){var e=this.config.routerPrefix;this.sufix="#"+(void 0===e?"!":e),this.prefix=document.location.href.split("#",2)[0]},t._getRaw=function(){return document.location.href},e}(),f=!1;function w(e){if(!f&&e){f=!0;var t=window;t.Promise||(t.Promise=e.promise);var i=e.version.split(".");10*i[0]+1*i[1]<53&&(e.ui.freeze=function(t){var i=t();return i&&i.then?i.then((function(t){return e.ui.$freeze=!1,e.ui.resize(),t})):(e.ui.$freeze=!1,e.ui.resize()),i});var o=e.ui.baselayout.prototype.addView,a=e.ui.baselayout.prototype.removeView,r={addView:function(e,t){var i=this;if(!this.$scope||!this.$scope.webixJet||e.queryView)return o.apply(this,arguments);var a=function(){var a=i.$scope,r={};e=a.app.copyConfig(e,{},r),o.apply(i,[e,t]);var n=function(e){a._renderFrame(e,r[e],null).then((function(){a._subs[e]=r[e]}))};for(var l in r)n(l);return{v:e.id}}();return"object"==typeof a?a.v:void 0},removeView:function(){if(a.apply(this,arguments),this.$scope&&this.$scope.webixJet){var t=this.$scope._subs;for(var i in t){var o=t[i];e.$$(o.id)||(o.view.destructor(),delete t[i])}}}};e.extend(e.ui.layout.prototype,r,!0),e.extend(e.ui.baselayout.prototype,r,!0),e.protoUI({name:"jetapp",$init:function(t){this.$app=new this.app(t);var i=e.uid().toString();for(var o in t.body={id:i},this.$ready.push((function(){this.$app.render({id:i})})),this.$app){var a=this.$app[o];"function"!=typeof a||this[o]||(this[o]=a.bind(this.$app))}}},e.ui.proxy)}}var b=function(e){function t(t){var i;return t.router=t.router||g,w((i=e.call(this,t)||this).webix),i}return o(t,e),t.prototype._loadViewDynamic=function(e){return e=e.replace(/\./g,"/"),i(121)("./"+e)},t}(m);function _(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function v(e,t,i){for(var o in e)_(e,o)&&t.call(i||e,e[o],o,e)}function x(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}var y=String.prototype.replace,C=String.prototype.split,$=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},k={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:$,chinese:function(){return 0},croatian:$,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:$,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},S={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function I(e){var t,i=(t={},v(S,(function(e,i){v(e,(function(e){t[e]=i}))})),t);return i[e]||i[C.call(e,/-/,1)[0]]||i.en}function F(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var D=/\$/g,E=/%\{(.*?)\}/g;function T(e,t,i,o){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var a=e,r=o||E,n="number"==typeof t?{smart_count:t}:t;if(null!=n.smart_count&&a){var l=C.call(a,"||||");a=(l[function(e,t){return k[I(e)](t)}(i||"en",n.smart_count)]||l[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return a=y.call(a,r,(function(e,t){return _(n,t)&&null!=n[t]?y.call(n[t],D,"$$"):e}))}function A(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var i=t.allowMissing?T:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:i,this.warn=t.warn||x,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",i=e&&e.suffix||"}";if("||||"===t||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(F(t)+"(.*?)"+F(i),"g")}(t.interpolation)}A.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},A.prototype.extend=function(e,t){v(e,(function(e,i){var o=t?t+"."+i:i;"object"==typeof e?this.extend(e,o):this.phrases[o]=e}),this)},A.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:v(e,(function(e,i){var o=t?t+"."+i:i;"object"==typeof e?this.unset(e,o):delete this.phrases[o]}),this)},A.prototype.clear=function(){this.phrases={}},A.prototype.replace=function(e){this.clear(),this.extend(e)},A.prototype.t=function(e,t){var i,o,a=null==t?{}:t;if("string"==typeof this.phrases[e])i=this.phrases[e];else if("string"==typeof a._)i=a._;else if(this.onMissingKey){o=(0,this.onMissingKey)(e,a,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),o=e;return"string"==typeof i&&(o=T(i,a,this.currentLocale,this.tokenRegex)),o},A.prototype.has=function(e){return _(this.phrases,e)},A.transformPhrase=function(e,t,i){return T(e,t,i)};var V=A;function O(e,t,i){if(t.urls)i=t.urls[i]||i;else if(t.param){var o;(o={})[t.param]=i,i=o}e.show(i)}var P={good:"check",error:"warning",saving:"refresh fa-spin"},j={good:"Ok",error:"Error",saving:"Connecting..."};function U(e,t,i){for(var o=0;o<i.length;o++)e[i[o]]=t[o+1]?t[o+1].page:""}var R=window.webix;R&&w(R);var B={UnloadGuard:function(e,t,i){t.on(e,"app:guard",(function(e,o,r){if(o===t||o.contains(t)){var n=i();r.confirm=!1===n?Promise.reject(new a):r.confirm.then((function(){return n}))}}))},Locale:function(e,t,o){var a=(o=o||{}).storage,r=a?a.get("lang")||"en":o.lang||"en";function n(t,i,n){i.__esModule&&(i=i.default);var l={phrases:i};o.polyglot&&e.webix.extend(l,o.polyglot);var c=s.polyglot=new V(l);if(c.locale(t),s._=e.webix.bind(c.t,c),r=t,a&&a.put("lang",r),o.webix){var d=o.webix[t];d&&e.webix.i18n.setLocale(d)}return n?Promise.resolve():e.refresh()}function l(e,t){if(!1!==o.path){var a=(o.path?o.path+"/":"")+e;n(e,i(139)("./"+a),t)}}var s={getLang:function(){return r},setLang:l,setLangData:n,_:null,polyglot:null};e.setService("locale",s),l(r,!0)},Menu:function(e,t,i){var o=t.getSubViewInfo().parent,a=t.$$(i.id||i),r=!1;a.attachEvent("onchange",(function(){r||O(o,i,this.getValue())})),a.attachEvent("onafterselect",(function(){if(!r){var e=null;a.setValue?e=this.getValue():a.getSelectedId&&(e=a.getSelectedId()),O(o,i,e)}})),t.on(e,"app:route",(function(){var e="";if(i.param)e=t.getParam(i.param,!0);else{var n=o.getUrl()[1];n&&(e=n.page)}e&&(r=!0,a.setValue&&a.getValue()!==e?a.setValue(e):a.select&&a.exists(e)&&a.getSelectedId()!==e&&a.select(e),r=!1)}))},Theme:function(e,t,i){var o=(i=i||{}).storage,a=o?o.get("theme")||"flat-default":i.theme||"flat-default",r={getTheme:function(){return a},setTheme:function(t,i){for(var r=t.split("-"),n=document.getElementsByTagName("link"),l=0;l<n.length;l++){var s=n[l].getAttribute("title");s&&(s===t||s===r[0]?n[l].disabled=!1:n[l].disabled=!0)}e.webix.skin.set(r[0]),e.webix.html.removeCss(document.body,"theme-"+a),e.webix.html.addCss(document.body,"theme-"+t),a=t,o&&o.put("theme",t),i||e.refresh()}};e.setService("theme",r),r.setTheme(a,!0)},User:function(e,t,i){var o=(i=i||{}).login||"/login",a=i.logout||"/logout",r=i.afterLogin||e.config.start,n=i.afterLogout||"/login",l=i.ping||3e5,s=i.model,c=i.user,d={getUser:function(){return c},getStatus:function(e){return e?s.status().catch((function(){return null})).then((function(e){c=e})):null!==c},login:function(t,i){return s.login(t,i).then((function(t){if(c=t,!t)throw new Error("Access denied");e.callEvent("app:user:login",[c]),e.show(r)}))},logout:function(){return c=null,s.logout().then((function(t){return e.callEvent("app:user:logout",[]),t}))}};function u(e,t){e===a?(d.logout(),t.redirect=n):e===o||d.getStatus()||(t.redirect=o)}e.setService("user",d),e.attachEvent("app:guard",(function(e,t,o){return!(!i.public||!i.public(e))||(void 0===c&&(o.confirm=d.getStatus(!0).then((function(){return u(e,o)}))),u(e,o))})),l&&setInterval((function(){return d.getStatus(!0)}),l)},Status:function(e,t,i){var o="good",a=0,r=!1,n=i.expire;n||!1===n||(n=2e3);var l=i.texts||j,s=i.icons||P;function c(e){var a=t.$$(i.target);a&&(e||(e="<div class='status_"+o+"'><span class='webix_icon fa-"+s[o]+"'></span> "+l[o]+"</div>"),a.setHTML(e))}function d(){a--,m("good")}function u(e){a--,m("error",e)}function h(e){a++,m("saving"),e&&e.then&&e.then(d,u)}function p(){0===a&&c(" ")}function m(t,i){a<0&&(a=0),"saving"===t?(o="saving",c()):(r="error"===t,0===a&&(o=r?"error":"good",r?e.error("app:error:server",[i.responseText||i]):n&&setTimeout(p,n),c()))}function g(i){var o=e.webix.dp(i);o&&(t.on(o,"onAfterDataSend",h),t.on(o,"onAfterSaveError",(function(e,t,i){return u(i)})),t.on(o,"onAfterSave",d))}"string"==typeof i&&(i={target:i}),e.setService("status",{getStatus:function(){return o},setStatus:m,track:g}),i.remote&&t.on(e.webix,"onRemoteCall",h),i.ajax&&t.on(e.webix,"onBeforeAjax",(function(e,t,i,o,a,r,n){h(n)})),i.data&&g(i.data)},UrlParam:function(e,t,i){var o=i.route||i,a={};t.on(e,"app:urlchange",(function(e,i){t===e&&(U(a,i.suburl(),o),i.size(o.length+1))}));var r=t.setParam,n=t.getParam;t.setParam=function(e,i,n){var l=o.indexOf(e);return l>=0?(a[e]=i,this._segment.update("",i,l+1),n?t.show(null):void 0):r.call(this,e,i,n)},t.getParam=function(e,t){var i=a[e];return void 0!==i?i:n.call(this,e,t)},U(a,t.getUrl(),o)}},L=window;L.Promise||(L.Promise=L.webix.promise)},function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var o=i(0),a=i(7);window.procent=function(e,t){var i=$$("table_part").getItem(e),o=$$(t).getValue();return Math.round(100*i.value*100/o)/100};var r=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=44,e.top=34,e.width=e.maxWidth/3,e.height=e.maxHeight-38},head:"Редактирование",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"auto",elements:this.state.formConfig}}},r.init=function(e,t){this.attachClickEvents()},r.showForm=function(e){var t=this,i=this.state,o=this.apiRest,a=e.getSelectedItem(),r=a;i.tableId=e.config.urlEdit;var n="accounting/";e.config.urlEditFull&&(n=""),i.tableUrl=e.config.urlEditLong,i.table=e,i.tableRecord=a,i.isUpdate=r,i.formEdit=this.$$("formEdit"),i.formUrl=n+i.tableId+"/form",i.win=this.$$("winEdit"),i.formEdit.clearValidation(),o.get(i.formUrl).then((function(e){t.showWindow(e,t)}))},r.showWindow=function(e,t){var i=t.state,o=Object.keys(i.formEdit.elements).length,a=e.json();i.formData=a,t.renderForm(o),i.formEdit.clear(),webix.extend(i.formEdit,webix.ProgressBar),i.formEdit.disable(),i.formEdit.showProgress({type:"icon",hide:!1}),t.bindCollection(a),i.win.show()},r.getRecord=function(){var e=this.state;return e.isUpdate?e.tableRecord:{}},r.renderForm=function(e){var t=this.state;0===e&&(t.formConfig=t.formData.data.configForm,webix.ui(t.formConfig,t.formEdit),this.attachFormEvents())},r.bindCollection=function(e){var t=this.state,i=this,o=this.apiRest,a=0,r=e.data.dataCollections,n=Object.keys(r).length,l={"per-page":-1},s=function(e){var s=$$(e).getPopup().getList(),c=r[e].field?r[e].field:"name",d=o.getCollection(r[e].url,l,c);d.waitData.then((function(){a++,s.sync(d),a===n&&(t.formEdit.setValues(i.getRecord()),t.formEdit.enable(),t.formEdit.hideProgress())}))};for(var c in r)s(c);0==n&&(t.formEdit.setValues(i.getRecord()),t.formEdit.enable(),t.formEdit.hideProgress())},r.bindColumnCollection=function(e){var t=this.apiRest,i={"per-page":-1},o=e.data.columnCollections;for(var a in o){var r=o[a];for(var n in r)this.$$(a).getColumnConfig(n).options=t.getCollection(r[n].url,i);this.$$(a).refreshColumns()}},r.attachFormEvents=function(){var e=this,t=(this.state,this.$$("btn_save")),i=this.$$("btn_copy");t.attachEvent("onItemClick",(function(t){e.doClickSave()})),i.attachEvent("onItemClick",(function(t){e.doClickSave(!0)}))},r.attachClickEvents=function(){webix.attachEvent("onClick",(function(e,t,i){}))},r.doClickSave=function(e){void 0===e&&(e=!1);var t=this.state;if(t.formEdit.validate()){var i=t.formEdit.getValues();e&&(t.isUpdate=!1,i.id=""),"undefined"!=i["action-edit"]&&delete i["action-edit"],"undefined"!=i["action-view"]&&delete i["action-view"],"undefined"!=i["action-delete"]&&delete i["action-delete"],this.state.table.$scope.getParam("id")&&(i.list_id=this.state.table.$scope.getParam("id")),this.state.table.listId&&(i.list_id=this.state.table.listId),webix.dp(t.table).save(t.isUpdate?i.id:webix.uid(),t.isUpdate?"update":"insert",i).then((function(e){webix.dp(t.table).ignore((function(){t.isUpdate?t.table.updateItem(i.id,e):t.table.add(e,0),t.table.select(e.id),t.isUpdate||t.table.scrollTo(0,0)})),t.table.refresh(),t.win.hide()}),(function(){webix.message("Ошибка! Данные не сохранены!")}))}},o}(o.b)},function(e,t,i){"use strict";i(0);webix.protoUI({name:"combo-close",$cssName:"search custom",$init:function(){this.attachEvent("onTimedKeyPress",this.toggleDeleteIcon),this.attachEvent("onChange",this.toggleDeleteIcon),this.attachEvent("onItemClick",this.onItemClick),this.$ready.push(this.toggleDeleteIcon)},$renderIcon:function(){for(var e=this.config,t=["menu-down","close"],i=e.aheight-2*e.inputPadding,o=(i-18)/2-1,a="",r=2,n=0;n<t.length;n++)a+="<span style='right:"+r+"px;height:"+(i-o)+"px;padding-top:"+o+"px;' class='webix_input_icon wxi-"+t[n]+"'></span>",r+=18;return a},onItemClick:function(e,t){"close"==t.target.className.substr(t.target.className.indexOf("wxi-")+4)&&(this.setValue(""),this.getPopup().hide(this.getInputNode()))},toggleDeleteIcon:function(){this.getValue()?webix.html.removeCss(this.$view,"no-delete"):webix.html.addCss(this.$view,"no-delete",!0)},on_click:{webix_input_icon:function(e,t,i){i.className.substr(i.className.indexOf("wxi-")+4);this.getInputNode().focus()}}},webix.ui.combo)},function(e,t){webix.protoUI({name:"search-close",$cssName:"search custom",$init:function(){this.attachEvent("onTimedKeyPress",this.toggleDeleteIcon),this.attachEvent("onChange",this.toggleDeleteIcon),this.$ready.push(this.toggleDeleteIcon)},$renderIcon:function(){for(var e=this.config,t=["search","close"],i=e.aheight-2*e.inputPadding,o=(i-18)/2-1,a="",r=2,n=0;n<t.length;n++)a+="<span style='right:"+r+"px;height:"+(i-o)+"px;padding-top:"+o+"px;' class='webix_input_icon wxi-"+t[n]+"'></span>",r+=18;return a},toggleDeleteIcon:function(){this.getValue()?webix.html.removeCss(this.$view,"no-delete"):webix.html.addCss(this.$view,"no-delete",!0)},on_click:{webix_input_icon:function(e,t,i){var o=i.className.substr(i.className.indexOf("wxi-")+4);"close"==o&&this.setValue(""),this.callEvent("on"+o+"IconClick",[e]),this.getInputNode().focus()}}},webix.ui.search)},function(e,t,i){"use strict";i(0);webix.protoUI({name:"datepicker-close",$cssName:"search custom",$init:function(){this.attachEvent("onTimedKeyPress",this.toggleDeleteIcon),this.attachEvent("onChange",this.toggleDeleteIcon),this.attachEvent("onItemClick",this.onItemClick),this.$ready.push(this.toggleDeleteIcon)},$renderIcon:function(){for(var e=this.config,t=["calendar","close"],i=e.aheight-2*e.inputPadding,o=(i-18)/2-1,a="",r=2,n=0;n<t.length;n++)a+="<span style='right:"+r+"px;height:"+(i-o)+"px;padding-top:"+o+"px;' class='webix_input_icon wxi-"+t[n]+"'></span>",r+=18;return a},onItemClick:function(e,t){"close"==t.target.className.substr(t.target.className.indexOf("wxi-")+4)&&(this.setValue(""),this.getPopup().hide(this.getInputNode()))},toggleDeleteIcon:function(){this.getValue()?webix.html.removeCss(this.$view,"no-delete"):webix.html.addCss(this.$view,"no-delete",!0)},on_click:{webix_input_icon:function(e,t,i){var o=i.className.substr(i.className.indexOf("wxi-")+4);"close"==o&&this.setValue(""),this.callEvent("on"+o+"IconClick",[e]),this.getInputNode().focus()}}},webix.ui.datepicker)},function(e,t,i){"use strict";t.a={}},function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var o=function(){function e(){"localhost:8080"==location.host?(this.urlBase="http://admin.startsellshop.local/api",this.urlDomain="http://greensofa.startsellshop.local"):(this.urlBase="http://admin.startsell.biz/api",this.urlDomain="http://greensofa.net"),this.authKeyName="auth_token",this.dataCollection={}}var t=e.prototype;return t.setAuthKey=function(e){this.authKey=e},t.getAuthKey=function(){var e=webix.storage.local.get("wjet_user");return this.authKey=e?e.token:"",this.authKey},t.getUrl=function(e,t,i,o){void 0===i&&(i={}),void 0===o&&(o="");var a=this.urlBase+"/"+t;this.authKeyName,this.authKey;i[this.authKeyName]=this.getAuthKey();var r=[];for(var n in i)i.hasOwnProperty(n)&&r.push(n+"="+encodeURIComponent(i[n]));return{get:a+"?"+(i=r.join("&")),create:a+"?"+i,put:a+"/"+o+"?"+i,delete:a+"/"+o+"?"+i}[e]},t.get=function(e,t){var i=this.getUrl("get",e,t);return this.getData(i,e)},t.post=function(e,t){return this.getUrl("create",e,t)},t.put=function(e,t){if(!t.id)return alert("You need fill params[id]");var i=this.getUrl("put",e,t,t.id);return webix.ajax().put(i,t,{error:function(e,t,i){}})},t.delete=function(e,t){if(!t.id)return alert("You need fill params[id]");var i=this.getUrl("delete",e,t,t.id);return webix.ajax().del(i,t,{error:function(e,t,i){}})},t.getData=function(e,t,i){return this.dataCollection[t]||(this.dataCollection[t]=webix.ajax(e,i)),this.dataCollection[t]},t.getLoad=function(e,t,i){return webix.ajax(e,t,{error:function(e,t,i){}})},t.getCollection=function(e,t,i){void 0===i&&(i="name");var o=this.getUrl("get",e,t);return this.dataCollection[e]||(this.dataCollection[e]=new webix.DataCollection({url:o,scheme:{$init:function(e){e.value=e[i]}}})),this.dataCollection[e]},e}()},function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i(91);var o=function(){function e(e){this.$scope=e,this.tableId=null,this.isUpdate=null,this.formEdit=null,this.formUrl=null,this.formConfig={},this.formData={}}var t=e.prototype;return t.actionUpdate=function(e){},t.actionCreate=function(e){},t.actionSave=function(e){},e}()},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(7);function r(){$$("upl1").send()}webix.type(webix.ui.list,{name:"myUploader",template:function(e,t){var i="<div class='overall'>";return i+="<div class='name' ><a href='"+e.domain+e.folder+"/"+e.filename+"' target='_blank'><img id='"+e.name+"' src='"+e.domain+e.folder+"/"+e.filename+"' height='100' /></a></div>",i+="<div class='remove_file'><span style='color:#AAA' class='cancel_icon'></span></div>",i+="<div class='status'>",i+="<div class='progress "+e.status+"' style='width:"+("transfer"==e.status||"server"==e.status?e.percent+"%":"0px")+"'></div>",i+="<div class='message "+e.status+"'>"+t.status(e)+"</div>",i+="</div>",i+="<div class='size'>"+e.sizetext+"</div></div>"},status:function(e){return{server:"Ok",error:"Ошибка",client:"",transfer:e.percent+"%"}[e.status]},on_click:{remove_file:function(e,t){$$(this.config.uploader).files.remove(t)}},height:100});var n=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=44,e.top=34,e.width=e.maxWidth/2,e.height=e.maxHeight-38},head:"Производственные процессы",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"auto",elements:[]}}},n.init=function(e,t){},n.showWindow=function(e,t){var i=this,o=this.state,a=t.getSelectedItem(),n=a;o.isUpdate=n,o.table=t,o.formEdit=this.$$("formEdit"),o.win=this.$$("winEdit"),o.formConfig=[],o.formProcessConfig=[];var l="";o.works=t.$scope.app.config.apiRest.getCollection("accounting/works",{"per-page":-1,sort:"department_id",expand:"department"}),o.works.waitData.then((function(){0!=o.works.data.count()&&(l=o.works.data.getItem(o.works.data.getFirstId()).department.name);var e=[],t=[],n=0;o.works.data.each((function(i){n++,i.department.name!=l&&n!=o.works.data.count()&&(l=i.department.name,e=[]),e.push({view:"checkbox",label:i.name,name:"work["+i.id+"].name",labelWidth:250,value:0}),t.push({id:i.id,value:i.name})})),o.formConfig.push({view:"dbllist",list:{autoheight:!0},labelLeft:"Рабочие процессы",labelRight:"Выбранные",name:"works",value:[1,6],data:t}),o.formProcessConfig.push({view:"datatable",css:"webix_header_border webix_data_border",editable:!0,editaction:"dblclick",resizeColumn:{headerOnly:!0},columns:[{id:"sort_order",header:"№ пор.",width:50,editor:"text"},{id:"name",header:"Наименование",width:150},{id:"department_id",header:"Подразделение",width:100,collection:o.table.$scope.app.config.apiRest.getCollection("accounting/departments",{"per-page":-1})},{id:"employee_name",header:"Исполнитель",width:100,editor:"text"},{id:"status",header:"Статус",width:50,editor:"text"},{id:"date_fact_start",header:"Дата.факт.старт",width:120},{id:"date_fact_end",header:"Дата.факт.оконч.",width:120},{id:"time_work",header:"Время",width:80},{id:"description",header:"Описание",width:80,editor:"text"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"}],url:o.table.$scope.app.config.apiRest.getUrl("get","accounting/order-works",{filter:'{"order_id":"'+a.id+'"}',expand:"department",sort:"sort_order"}),save:"api->accounting/order-works",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}),o.formConfigBase=[{view:"tabview",tabbar:{options:["Описание","Фото","Работы","Процессы"]},animate:!1,paddingX:20,paddingY:0,cells:[{id:"Описание",paddingY:30,labelWidth:250,rows:[{template:"Параметры товара",type:"section"},{view:"text",label:"№",name:"A",labelWidth:150},{view:"text",label:"Клиент",name:"F",labelWidth:150},{view:"text",label:"Тип",name:"E",labelWidth:150},{view:"text",label:"Наименование",name:"I",labelWidth:150},{view:"text",label:"Ткань",name:"L",labelWidth:150},{view:"text",label:"Ножки",name:"N",labelWidth:150},{view:"text",label:"Размер мет.рамы",name:"J",labelWidth:150},{view:"text",label:"Пуговицы",name:"O",labelWidth:150},{view:"text",label:"Отстрочка",name:"P",labelWidth:150},{template:"Коэффициенты",type:"section"},{view:"text",label:"Коэф.обивки",name:"AA",labelWidth:150},{view:"text",label:"Коэф.столярки",name:"AG",labelWidth:150},{view:"text",label:"Коэф.пошив",name:"CH",labelWidth:150},{view:"text",label:"Коэф.крой",name:"CI",labelWidth:150},{template:"Примечания",type:"section"},{view:"textarea",name:"T",labelWidth:150,label:"Примечание продажи",height:60},{view:"textarea",name:"desc_sawcut",label:"Примечание распил",labelWidth:150,height:60},{view:"textarea",name:"desc_carpenter",label:"Примечание столярка",labelWidth:150,height:60},{view:"textarea",name:"desc_cut",label:"Примечание крой",labelWidth:150,height:60},{view:"textarea",name:"desc_sewing",label:"Примечание пошив",labelWidth:150,height:60},{view:"textarea",name:"desc_upholstery",label:"Примечание обивка",labelWidth:150,height:60},{view:"textarea",name:"desc_packaging",label:"Примечание упаковка",labelWidth:150,height:60},{view:"textarea",name:"desc_shipment",label:"Примечание отгрузка",labelWidth:150,height:60},{}]},{id:"Фото",paddingY:30,rows:[{padding:5,view:"form",type:"line",rows:[{view:"uploader",id:"upl1",height:37,align:"center",type:"iconButton",icon:"plus-circle",label:"Добавить файл",datatype:null,autosend:!1,inputName:"uploader",link:"mylist",upload:i.app.config.apiRest.getUrl("get","accounting/images",{type:"image",model:"order",mode:"insert-save",id:a.id}),on:{onAfterFileAdd:function(e){var t=e.file,i=new FileReader;return i.onload=function(e){document.getElementById(t.name).src=e.target.result},i.readAsDataURL(t),!0},onBeforeRender:function(e,t){return!0}}},{borderless:!0,view:"list",id:"mylist",type:"myUploader",autoheight:!0},{id:"uploadButtons",cols:[{view:"button",label:"Загрузить",type:"iconButton",icon:"upload",click:r,align:"center"},{width:5},{view:"button",label:"Отмена",type:"iconButton",icon:"cancel-circle",align:"center"}]}]}]},{id:"Работы",paddingY:30,rows:o.formConfig},{id:"Процессы",paddingY:30,rows:o.formProcessConfig}]},{margin:10,padding:20,cols:[{view:"template",template:" ",role:"placeholder",borderless:!0},{view:"button",localId:"btn_save",css:"webix_primary",label:"Сохранить",align:"right",width:120}]}],webix.ui(o.formConfigBase,o.formEdit),o.formEdit.setValues(a);var s=[],c=a.images;if(c)for(var d in c)s.push({id:c[d].id,name:c[d].name,sizetext:c[d].size,status:"server",folder:c[d].folder,filename:c[d].file,domain:i.app.config.apiRest.urlBase});$$("upl1").files.clearAll(),$$("upl1").files.parse(s),$$("upl1").files.attachEvent("onBeforeDelete",(function(e){var t=$$("upl1").files.getItem(e),o=e;t.newId&&(o=t.newId),i.app.config.apiRest.delete("accounting/images",{id:o}).then((function(){for(var e in a.images){if(a.images[e].id==o){a.images.splice(e,1);break}0}}))})),$$("upl1").attachEvent("onFileUpload",(function(e,t,o){e.folder=t.data.folder,e.filename=t.data.file,e.domain=i.app.config.apiRest.urlBase,a.images.push(t.data)})),i.attachFormEvents(),o.win.show()}))},n.attachFormEvents=function(){var e=this,t=(this.state,this.$$("btn_save"));this.$$("btn_copy");t.attachEvent("onItemClick",(function(t){e.doClickSave()}))},n.doClickSave=function(e){void 0===e&&(e=!1);var t=this.state;if(t.formEdit.validate()){var i=t.formEdit.getValues();e&&(t.isUpdate=!1,i.id=""),webix.dp(t.table).save(t.isUpdate?i.id:webix.uid(),t.isUpdate?"update":"insert",i).then((function(e){webix.dp(t.table).ignore((function(){t.isUpdate?t.table.updateItem(i.id,e):t.table.add(e,0),t.table.select(e.id),t.isUpdate||t.table.scrollTo(0,0)})),t.table.refresh(),t.win.hide()}),(function(){webix.message("Ошибка! Данные не сохранены!")}))}},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=webix.storage.local.get("wjet_user"),n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{view:"window",position:function(e){e.left=44,e.top=34,e.width=e.maxWidth/3+70,e.height=e.maxHeight-42},head:"Комментарии",close:!0,modal:!0,body:{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Комментарии",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"comments",localId:"comments",currentUser:r.user_id,url:this.app.config.apiRest.getUrl("get","accounting/comments",{sort:"-time_comment",fields:"id,text,date,user_id, order_no"}),users:this.app.config.apiRest.getUrl("get","accounting/users",{sort:"id","per-page":-1,fields:"value,id,username"}),save:"api->accounting/comments",mentions:!0,sendAction:"enter",width:600,listItem:{templateMenu:function(t,i){var o="<span class = 'webix_comments_icons'>";return e.$$("comments").config.currentUser==t.user_id&&(o+="<span class='webix_comments_menu mdi mdi-chevron-down'></span>"),o+="</span>"},templateText:function(e,t){var i="";return e.order_no&&(i="#"+e.order_no+": "),"<div class = 'comment'>"+i+t.templateLinks(e)+"</div>"}},scheme:{$init:function(e){e.date&&(e.date=webix.i18n.parseFormatDate(e.date))}},on:{onUserMentioned:function(e,t){var i=this.getUsers().getItem(e).value;webix.message(i+" был отмечен получателем комментария "+t)}}}]}]}}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("comments"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/comments"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("comment-table").unselect(),this.cashEdit.showForm(this.$$("comment-table"))},n.showForm=function(e,t){t&&this.$$("form-search").setValue(t.toString());this.getRoot().show()},o}(o.b)},function(e,t,i){"use strict";t.__esModule=!0,t.extend=l,t.indexOf=function(e,t){for(var i=0,o=e.length;i<o;i++)if(e[i]===t)return i;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}if(!r.test(e))return e;return e.replace(a,n)},t.isEmpty=function(e){return!e&&0!==e||!(!d(e)||0!==e.length)},t.createFrame=function(e){var t=l({},e);return t._parent=e,t},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},a=/[&<>"'`=]/g,r=/[&<>"'`=]/;function n(e){return o[e]}function l(e){for(var t=1;t<arguments.length;t++)for(var i in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],i)&&(e[i]=arguments[t][i]);return e}var s=Object.prototype.toString;t.toString=s;var c=function(e){return"function"==typeof e};c(/x/)&&(t.isFunction=c=function(e){return"function"==typeof e&&"[object Function]"===s.call(e)}),t.isFunction=c;var d=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===s.call(e)};t.isArray=d},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);webix.UIManager.addHotKey("enter",(function(e){var t=e.getSelectedId();e.edit(t)}),$$("cloth-table"));var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Ткани",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("cloth-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"cloth-table",urlEdit:"cloth",css:"webix_header_border webix_data_border",select:"cell",resizeColumn:{headerOnly:!0},editable:!0,editaction:"dblclick",clipboard:"selection",multiselect:!0,math:!0,sort:"multi",columns:[{id:"index",header:"#",sort:"int",width:50},{id:"id",header:"ID",width:50,sort:"int"},{id:"image",header:"",width:60,template:function(e){return e.image?'<img src="'+t.app.config.apiRest.urlBase+"/"+e.image.folder+"/"+e.image.file+'" width="35" height="35" />':""}},{id:"provider",header:["Поставщик",{content:"selectFilter"}],width:120,edit:"text",sort:"text"},{id:"full_name",header:["Полн. наимен.",{content:"textFilter"}],width:380,sort:"text"},{id:"name",header:["Название",{content:"textFilter"}],width:120,edit:"text",sort:"text"},{id:"color",header:["Цвет",{content:"textFilter"}],width:120,edit:"text",sort:"text"},{id:"price",header:["Цена",{content:"numberFilter"}],width:120,edit:"text",sort:"int"},{id:"category",header:["Категория",{content:"selectFilter"}],width:120,edit:"text",sort:"int"},{id:"qty",header:["К-во",{content:"numberFilter",format:webix.i18n.numberFormat}],width:120,edit:"text",editor:"text",sort:"int"},{id:"sum",header:["Сумма",{content:"summColumn",css:{"text-align":"right","font-weight":300}}],format:webix.i18n.numberFormat,css:{"text-align":"right","font-weight":300},sort:"int",width:120,edit:"text",math:"[$r,price] * [$r,qty]"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/cloths",{sort:"provider+name+color","per-page":"-1",expand:"image"}),save:"api->accounting/cloths",ready:function(){this.sort([{by:"provider",dir:"asc"},{by:"name",dir:"asc"},{by:"color",dir:"asc"}]),this.markSorting("provider","asc"),this.markSorting("name","asc",!0),this.markSorting("color","asc",!0)},on:{"data->onStoreUpdated":function(){this.data.each((function(e,t){e.index=t+1}))},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){return webix.dp(o).ignore((function(){o.remove(e.row)})),!0}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-edit"==e.column&&this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("cloth-table"),o=this;this.win=this.ui({view:"window",id:"tmpWin",position:"center",head:"Preview",close:!0,move:!0,body:{id:"tmp",view:"template",template:"<img src='#src#' style='width: 500px;' class='fit_parent'></img>",width:500,autoheight:!0}}),t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()},sort:"color"};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/cloths",{sort:"provider+name+color","per-page":"-1"}),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a),this.cashEdit.attachFormEvents=function(e){var t=this,i=(this.state,this.$$("btn_save")),o=this.$$("btn_copy"),a=this.$$("uploader");i.attachEvent("onItemClick",(function(e){t.doClickSave()})),o.attachEvent("onItemClick",(function(e){t.doClickSave(!0)})),this.$$("formEdit").elements.id.attachEvent("onChange",(function(e,i,o){var r=[],n=t.state.tableRecord.image;n&&r.push({id:n.id,name:n.name,sizetext:n.size,status:"server"}),a.files.clearAll(),a.files.parse(r);var l="insert-save",s=t.state.tableRecord.id;a.files.count()>0&&(l="update",s=n.id);var c=t.app.config.apiRest.getUrl("get","accounting/images",{type:"image",model:"cloth",mode:l,id:s});a.define({upload:c})})),a.files.attachEvent("onBeforeDelete",(function(e){var i=a.files.getItem(e),o=e;i.newId&&(o=i.newId),t.app.config.apiRest.delete("accounting/images",{id:o}).then((function(){for(var e in t.state.tableRecord.images){if(t.state.tableRecord.images[e].id==o){t.state.tableRecord.image="";break}0}}))})),a.attachEvent("onBeforeFileAdd",(function(e,t,i){})),a.attachEvent("onFileUpload",(function(e,i,o){e.newId=i.data.id,t.state.tableRecord.image=i.data}))}},r.doAddClick=function(){this.$$("cloth-table").unselect(),this.cashEdit.showForm(this.$$("cloth-table"))},o}(o.b)},function(e,t,i){"use strict";var o=(new(i(6).a)).getUrl("get","accounting/product-bed-types",{sort:"name","per-page":-1});new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";t.__esModule=!0;var o=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function a(e,t){var i=t&&t.loc,r=void 0,n=void 0,l=void 0,s=void 0;i&&(r=i.start.line,n=i.end.line,l=i.start.column,s=i.end.column,e+=" - "+r+":"+l);for(var c=Error.prototype.constructor.call(this,e),d=0;d<o.length;d++)this[o[d]]=c[o[d]];Error.captureStackTrace&&Error.captureStackTrace(this,a);try{i&&(this.lineNumber=r,this.endLineNumber=n,Object.defineProperty?(Object.defineProperty(this,"column",{value:l,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:s,enumerable:!0})):(this.column=l,this.endColumn=s))}catch(e){}}a.prototype=new Error,t.default=a,e.exports=t.default},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Ставки по выработке",width:150},{},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"work-salary-table",urlEdit:"product-work-salary",css:"webix_header_border webix_data_border",leftSplit:2,select:"cell",multiselect:!0,resizeColumn:{headerOnly:!0},editable:!0,editaction:"custom",clipboard:"selection",columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наиименование",width:380,sort:"string"},{id:"product_id",header:"product_id",width:180,sort:"string",editor:"text"},{id:"size",header:"Размер",width:80,sort:"string",editor:"text"},{id:"net_cost",header:"Себ-ть база",width:120,sort:"string",editor:"text"},{id:"expense_cloth",header:"Расход ткани",width:120,sort:"string",editor:"text"},{id:"coef_time_cut",header:"Коэф. крой",width:100,editor:"text"},{id:"coef_time_sewing",header:"Коэф. пош.",editor:"text"},{id:"coef_time_carpenter",header:"Коэф. стол.",editor:"text"},{id:"coef_time_upholstery",header:"Коэф. обив.",editor:"text"},{id:"cost_cut",header:"Цена. крой",width:100,editor:"text"},{id:"cost_sewing",header:"Цена. пош.",width:100,editor:"text"},{id:"cost_ot",header:"Цена. отст.",width:100,editor:"text"},{id:"cost_carcass",header:"Цена ст. цар.",width:110,editor:"text"},{id:"cost_headboard",header:"Цена ст. изг.",width:110,editor:"text"},{id:"cost_grinding",header:"Цена ст.  шлиф.",width:115,editor:"text"},{id:"cost_rubber_carcass",header:"Цена пор. цар.",width:111,editor:"text"},{id:"cost_rubber_headboard",header:"Цена пор. изг.",width:110,editor:"text"},{id:"cost_upholstery_carcass",header:"Цена об. цар.",width:110,editor:"text"},{id:"cost_upholstery_headboard",header:"Цена об. изг.",width:110,editor:"text"},{id:"cost_buttons",header:"Цена пуг.",width:100,editor:"text"},{id:"cost_matras",header:"Цена мат.",width:100,editor:"text"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/product-work-salaries"),save:"api->accounting/product-work-salaries",ready:function(){},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-edit"==e.column&&this.$scope.cashEdit.showForm(this)},onItemDblClick:function(){this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){webix.extend(this,webix.ProgressBar),this.disable(),this.showProgress({delay:2e3,hide:!1})},onAfterLoad:function(){this.count()?this.enable():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("work-salary-table"),o=this;t.attachEvent("onChange",(function(e){var a,r=t.getValue(),n=r.split(":"),l={search:r},s={};n.length>1&&(a=n[0],r=n[1],s[a]=r,l=s);var c={filter:l};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/product-work-salaries"),c).then((function(e){i.parse(e)}))})),i.attachEvent("onPaste",(function(e){var t=this;this.getSelectedId(!0).forEach((function(o){t.getItem(o.row)[o.column]=e,t.refresh(o.row),i.updateItem(o.row,t.getItem(o.row))}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("work-salary-table").unselect(),this.cashEdit.showForm(this.$$("work-salary-table"))},r.doClickToExcel=function(){var e=this.$$("work-salary-table");webix.toExcel(e)},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=function(e){var t,i;function o(t,i,o){var a;return(a=e.call(this,t,i)||this).grid_config=o,a.name=i,a}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return{view:"treetable",localId:this.name+"-table",css:"webix_header_border webix_data_border",leftSplit:2,rightSplit:3,select:!0,resizeColumn:{headerOnly:!0},columns:this.grid_config.columns,url:this.grid_config.url,save:this.grid_config.save,scheme:this.grid_config.scheme,editable:!0,editaction:"dblclick",math:!0,hover:"myhover",on:{"data->onStoreUpdated":function(){this.data.each((function(e,t,i,o){}))},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-refresh"==e.column&&this.$scope.clickActionRefresh(e,t,i)},onAfterEditStop:function(e,t,i){var o=this;e.value!=e.old&&(o.addCellCss(t.row,t.column,"highlight"),setTimeout((function(){o.removeCellCss(t.row,t.column,"highlight")}),3e3))},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}},a.clickActionRefresh=function(){},o}(i(0).b),a=(i(2),i(4),i(3),i(16));webix.ui.datafilter.countColumn=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||o++})),t.innerHTML=o}},webix.ui.datafilter.summColumn);var r=function(e){var t,i;function o(t,i,o){var r={color:"green","text-align":"right","font-weight":100},n={"text-align":"right"},l=o?+o.id:0;return e.call(this,t,i,{url:t.config.apiRest.getUrl("get","accounting/document-salary-accruals",{filter:'{"list_id":'+l+"}","per-page":"-1"}),columns:[{id:"employee_name",header:["Сотрудник",{content:"countColumn"}],width:240,sort:"string",template:function(e,t){return e.$group?t.treetable(e,t)+e.department_name:t.treetable(e,t)+e.employee_name}},{id:"employee_id",header:["ID",""],width:30,sort:"string",hidden:!0},{id:"is_approved",header:["Утв.",""],width:40,sort:"string",template:function(e,t,i,o,a){return e.$group?"":t.checkbox(e,t,i,o)}},{id:"is_piecework",header:["Тип",""],width:70,sort:"string",type:"select",collection:a.a},{id:"rate",header:["Ставка",""],width:80,sort:"string",editor:"text",format:webix.Number.format,css:r},{id:"rate_day",header:["Ставка за день",""],width:120,sort:"string",format:webix.Number.format,css:n,editor:"text"},{id:"all_time_days",header:["Рабочих дней",{content:"summColumn"}],width:110,sort:"string",format:webix.Number.format,css:n,editor:"text"},{id:"work_time_days",header:["Дни посещения",{content:"summColumn"}],width:120,sort:"string",format:webix.Number.format,css:n},{id:"work_time_hours",header:["Дни по часам",{content:"summColumn"}],width:110,sort:"string",format:webix.Number.format,css:n,editor:"text"},{id:"salary_rate",header:["ЗП по ставке",{content:"summColumn"}],width:100,sort:"string",math:"[$r,work_time_hours]*[$r,rate_day]",format:webix.Number.format,css:n},{id:"salary_piecework",header:["ЗП по сдельно",{content:"summColumn"}],width:110,sort:"string",editor:"text",format:webix.Number.format,css:r},{id:"award",header:["Премия",{content:"summColumn"}],width:100,sort:"string",editor:"text",format:webix.Number.format,css:r},{id:"surcharges",header:["Доп./Выч.",{content:"summColumn"}],width:120,sort:"string",editor:"text",format:webix.Number.format,css:r},{fillspace:!0},{id:"salary",width:100,sort:"string",math:"[$r,salary_rate] + [$r,award]+ [$r,surcharges] +[$r,salary_piecework]",format:webix.Number.format,css:n,header:["К выплате",{content:"summColumn"}]},{id:"action-delete",header:"",width:50,template:function(e,t){return e.$group?"":t.trashIcon()}},{id:"action-refresh",header:"",width:50,template:function(e){return e.$group?"":"<i class='mdi mdi-refresh' style='font-size: 18px'></i>"}}],scheme:{$group:{by:function(e){return e.department_name},map:{department_name:["department_name"],employee_name:["employee_name"],index:["index"],salary:["salary","sum"]}},$sort:[{by:"department_name",dir:"asc",as:"string"},{by:"employee_name",dir:"asc",as:"string"}]}})||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.clickActionRefresh=function(e,t){var i=this.getRoot().getItem(e.row);this.getParentView().getParentView().doClickFillAll(i.employee_id)},o}(o)},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(6).a)).getUrl("get","accounting/employee-salary-types",{sort:"name","per-page":-1}),a=new webix.DataCollection({url:o,data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var o=i(0),a=i(7);i(138),i(93);var r=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){return this.apiRest=this.app.config.apiRest,this.win={},{localId:"windowDirectory",view:"window",position:function(e){e.top=76,e.width=e.maxWidth/1.5,e.height=e.maxHeight/1.2,e.left=88},resize:!0,move:!0,scroll:!0,head:"Справочник",close:!0,modal:!0,body:{localId:"windowBody"}}},r.init=function(e,t){},r.showWindow=function(e,t,i,o,a){var r=this.state,n=t.getSelectedItem();r.isUpdate=n,r.table=t,r.editor=i,r.windowBody=this.$$("windowBody"),r.win=this.$$("windowDirectory");var l={view:"table-dynamic",localId:"windowBody",state:{scope:this,params:{mode:r.editor.config.options_url_edit,id:this.getParam("id"),account_id:this.getParam("account_id")},apiRest:this.app.config.apiRest,urlTableUserLists:this.app.config.apiRest.getUrl("get","accounting/schema-table-user-lists",{"per-page":-1,sort:"sort_order"}),urlTableSettingUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-setting-users",{"per-page":-1,sort:'[{"property":"type_property","direction":"ASC"},{"property":"property_title","direction":"ASC"}]'}),urlTableUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-users",{"per-page":-1,sort:'[{"property":"sort_order","direction":"ASC"},{"property":"column_id","direction":"ASC"}]'}),urlTableUsersSave:"api->accounting/schema-table-users",urlTableSettingUsersSave:"api->accounting/schema-table-setting-users",urlTableUserListsPut:"accounting/schema-table-user-lists",formEdit:o.formEdit,formView:o.formView,formComment:o.formComment,windowDirectory:o.windowDirectory,type:a},stateCache:webix.storage.local.get(r.editor.config.options_url_edit+"_"+a+"_filter_state")};r.editor.config.filter&&(l.state.params.id=r.editor.config.filter.filterInput),r.win.getHead().getChildViews()[0].setHTML(r.editor.config.header[0].text),r.win.show(),webix.ui(l,r.windowBody)},r.selectRecord=function(e){var t=this.state,i=t.table.getSelectedItem();i[t.editor.column]=e.id,t.table.updateItem(i.id,i)},r.hideWindow=function(){this.state.win.hide()},r.attachFormEvents=function(){this.state},r.doClickSave=function(e){void 0===e&&(e=!1);var t=this.state;if(t.formEdit.validate()){var i=t.formEdit.getValues();e&&(t.isUpdate=!1,i.id=""),webix.dp(t.table).save(t.isUpdate?i.id:webix.uid(),t.isUpdate?"update":"insert",i).then((function(e){webix.dp(t.table).ignore((function(){t.isUpdate?t.table.updateItem(i.id,e):t.table.add(e,0),t.table.select(e.id),t.isUpdate||t.table.scrollTo(0,0)})),t.table.refresh(),t.win.hide()}),(function(){webix.message("Ошибка! Данные не сохранены!")}))}},o}(o.b)},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(6).a)).getUrl("get","accounting/accounts",{sort:"name","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(6).a)).getUrl("get","accounting/contragents",{sort:"name","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(6).a)).getUrl("get","accounting/projects",{sort:"name","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(6).a)).getUrl("get","accounting/categories",{sort:"name","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(12),i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Счета",width:150},{},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"treetable",localId:"account-table",urlEdit:"account",css:"webix_header_border webix_data_border",leftSplit:2,select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"name",header:"Наиименование",width:280,sort:"string"},{id:"id",header:"#",width:50,sort:"int",template:function(e,t){return e.$group?"":e.id}},{id:"account",header:"1с ID",width:180,sort:"string",edit:"text"},{id:"currency_id",header:"Валюта",width:180,sort:"string",edit:"text"},{id:"initial_balance",header:"Начальный остаток",width:180,sort:"string",edit:"text"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/accounts",{sort:"name","per-page":-1}),save:"api->accounting/accounts",scheme:{},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-edit"==e.column&&this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("account-table"),i=this.$$("form-search"),o=this;webix.extend(t,webix.ProgressBar),i.attachEvent("onChange",(function(e){o.getData()})),this.cashEdit=this.ui(a.a)},r.getData=function(){var e=this.$$("account-table"),t={filter:{search:this.$$("form-search").getValue()}};webix.extend(e,webix.ProgressBar),e.clearAll(!0),e.showProgress({delay:2e3,hide:!1}),webix.ajax().get(this.app.config.apiRest.getUrl("get","accounting/accounts",{sort:"name","per-page":-1}),t).then((function(t){e.parse(t),e.enable(),e.openAll()}))},r.doAddClick=function(){this.$$("account-table").unselect(),this.cashEdit.showForm(this.$$("account-table"))},r.doClickOpenAll=function(){var e=this.$$("account-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},r.doRefresh=function(){var e=this.$$("account-table");e.disable(),e.showProgress({type:"icon",hide:!1}),this.getData()()},o}(o.b)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return AdminView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),components_comboClose__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_4__);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)1==t[o].$level&&(isNaN(e(t[o]))||(i+=1*e(t[o])));return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCountEmpty=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.toolsContent=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var formatDate=webix.Date.dateToStr("%d.%m.%y"),formatDateHour=webix.Date.dateToStr("%d.%m.%y %H:00"),formatDateShort=webix.Date.dateToStr("%d.%m"),formatDateTime=webix.Date.dateToStr("%d.%m.%y %H:%i"),parserDate=webix.Date.strToDate("%Y-%m-%d"),parserDateTime=webix.Date.strToDate("%Y-%m-%d %H:%i");function custom_checkbox(e,t,i){return i?"<div class='webix_table_checkbox checked'> YES </div>":"<div class='webix_table_checkbox notchecked'> NO </div>"}function columnGroupTemplate(e,t,i){return e.$group?t.treetable(e,t)+e.property_value:i}var AdminView=function(_JetView){function AdminView(){return _JetView.apply(this,arguments)||this}_inheritsLoose(AdminView,_JetView);var _proto=AdminView.prototype;return _proto.config=function(){var e=this,t=document.location.hash.split("/"),i=t[t.length-1],o=webix.storage.local.get(i+"_filter_state"),a=this;return{localId:"layout",rows:[{padding:10,cols:[{type:"header",localId:"table-title",template:"Таблица",width:300,borderless:!0},{localId:"show-filter-date-range",hidden:!0,cols:[{localId:"filter-date-range-field",cols:[{localId:"filter-date-range-field-label",label:"",view:"label",width:20},{view:"datepicker",localId:"dateFrom",inputWidth:120,width:130,value:o?o.dateFrom:webix.Date.monthStart(new Date)},{label:"по",view:"label",width:27},{view:"datepicker",localId:"dateTo",inputWidth:120,width:120,value:o?o.dateTo:webix.Date.monthEnd(new Date)}]},{view:"icon",icon:"mdi mdi-filter",localId:"show-icon-setting",width:30,css:"small",click:function(){a.showFilterSetting()}},{view:"icon",icon:"mdi mdi-sort",localId:"show-icon-sort-setting",width:30,css:"small",click:function(){a.showSortSetting()}}]},{localId:"show-filter",hidden:!0,cols:[{cols:[{width:25},{label:"Отбор по",view:"label",width:60,localId:"filter-field-label"},{view:"select",labelWidth:100,value:o?o.dateFrom:"",options:[],hidden:!1,localId:"filter-field"},{localId:"filter-layout",cols:[]}]}]},{},{view:"richselect",value:4,labelWidth:100,options:[],width:200,hidden:!1,localId:"select-type"},{view:"icon",icon:"mdi mdi-tools",localId:"show-icon-setting",width:30,click:function(){a.showSetting()}}]},{view:"toolbar",localId:"show-toolbar",height:30,cols:[{view:"icon",icon:"mdi mdi-plus",localId:"show-add-button",tooltip:"Добавить",width:30,click:function(){return e.doAddClick()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.showExportToExcelSetting()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,hidden:!1,click:function(){a.doClickOpenAll()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){a.doRefresh()}},{},{view:"icon",icon:"mdi mdi-undo",autowidth:!0,value:!0,click:function(){a.doUndo()}}]},{localId:"body-layout",cols:[]}]}},_proto.init=function(e){this.use(webix_jet__WEBPACK_IMPORTED_MODULE_0__.c.UrlParam,["mode"]);var t=this.getParam("mode");this.mode=t,this.model=this.capitalizeFirstLetter(this.mode),this.state={},this.stateFilter=webix.storage.local.get(this.mode+"_filter_state"),this.state.urlTableUserLists=this.app.config.apiRest.getUrl("get","accounting/schema-table-user-lists",{"per-page":-1,sort:"sort_order"});this.$$("icon-setting");this.setSelectType(),this.schemaTableSetting=this.getSchemaTableSetting(),this.setTableSetting(),this.setFilterSetting(),this.getTable(),this.getDataTable(),this.attachToolBarEvents(),this.formEdit=this.ui(core_updateFormView__WEBPACK_IMPORTED_MODULE_1__.a)},_proto.getTable=function(){var e=this.$$("body-layout"),t={view:"treetable",urlEdit:this.mode,css:"webix_header_border webix_data_border",leftSplit:this.schemaTableSetting.datatable.leftSplit.value?this.schemaTableSetting.datatable.leftSplit.value:0,rightSplit:this.schemaTableSetting.datatable.rightSplit.value?this.schemaTableSetting.datatable.rightSplit.value:0,select:"multiselect",resizeColumn:{headerOnly:!0},localId:"order-table",multiselect:!0,scroll:!0,clipboard:"selection",tooltip:!0,editable:!0,editaction:"dblclick",sort:"multi",drag:"order",dragColumn:!0,save:"api->accounting/"+this.getModelName(this.mode),scheme:{$init:function(e){e.index=this.count()+1,4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green"),6==e.B&&(e.$css="highlight-green");var t=parserDate(e.date_obivka),i=webix.Date.add(new Date,-1,"day");webix.filters.date.greater(i,t)&&"1"==e.B&&(e.$css="highlight-red")}},ready:function(){},on:{onAfterColumnDrop:function(){},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-edit"==e.column&&this.$scope.formEdit.showForm(this)},onBeforeLoad:function(){},onAfterLoad:function(){this.count()},onSelectChange:function(e,t,i){var o=this.getSelectedId(!0);!this.rowSelect&&o.length>0&&o[0]&&"index"==o[0].column||(this.rowSelect=!1,this.config.select="cell")}}},i=webix.ui(t);this.table=i,e.addView(i)},_proto.getDataTable=function getDataTable(){var scope=this;scope.columns=[];var params={"per-page":2e3,"schema-table-user-id":scope.selectTypeValue},paramsSort=this.getSortParams();paramsSort.length>0&&(params.sort=paramsSort),scope.tableUrl=this.app.config.apiRest.getUrl("get","accounting/"+this.getModelName(this.mode),params),webix.extend(this.table,webix.ProgressBar),this.table.disable(),this.table.showProgress({type:"icon",hide:!1}),scope.filter=scope.getFilterParams(),webix.ajax().get(scope.tableUrl,scope.filter).then((function(data){scope.table.clearAll();var items=data.json(),dataItem=items.data?items.data:items.items;scope.dataItem=dataItem,items.config.columns=scope.dataDriverJsonToObject(items.config.columns),scope.table.config.columns=items.config.columns,scope.columns=items.config.columns,scope.table.refreshColumns(),scope.table.parse(dataItem),scope.table.enable(),scope.table.hideProgress();var resultType="";if(scope.schemaTableSetting.group["group-by"].type)resultType=scope.schemaTableSetting.group["group-by"].type+"(obj."+scope.schemaTableSetting.group["group-by"].value+")";else{var configColumn=scope.table.getColumnConfig(scope.schemaTableSetting.group["group-by"].value);resultType="obj."+scope.schemaTableSetting.group["group-by"].value}scope.table.group({by:function by(obj){return eval(resultType)},map:{property_value:[function(obj){var per=eval(resultType),configColumn=scope.table.getColumnConfig(scope.schemaTableSetting.group["group-by"].value);return configColumn.collection?configColumn.collection.getItem(per).value:eval(resultType)}],property_title:["A"],index:["","string"],I:["","string"],G:["G","sum"],value_sum:["value_sum","median"],L:["","string"],N:["","string"],O:["","string"],P:["","string"]}}),scope.table.openAll()}))},_proto.getSortParams=function(){var e="";if(this.filterDateRangeField&&(e='[{"property":"'+this.filterDateRangeField+'","direction":"ASC"}]'),this.schemaSortUserList&&this.schemaSortUserList.length>2){var t=JSON.parse(this.schemaSortUserList);for(var i in e=[],t)e.push({property:t[i].field,direction:t[i].direction});e=JSON.stringify(e)}return e},_proto.getFilterParams=function(){this.format=webix.Date.dateToStr("%Y-%m-%d"),this.dateFrom=this.$$("dateFrom"),this.dateTo=this.$$("dateTo"),this.filterField=this.$$("filter-field"),this.showFilterDateRange=this.$$("show-filter-date-range"),this.filterInput=this.$$("filter-input"),this.dateFromValue=this.format(this.dateFrom.getValue()),this.dateToValue=this.format(this.dateTo.getValue()),this.filterFieldValue=this.filterField.getValue(),this.filterInputValue=this.filterInput.getValue();var e={filter:{or:[]}},t={},i={};if(this.showFilterDateRange.isVisible()&&this.filterDateRangeField&&(i[this.filterDateRangeField]={">=":this.dateFromValue,"<=":this.dateToValue},e.filter.or=[i]),this.schemaFilterUserList&&this.schemaFilterUserList.length>2){var o=JSON.parse(this.schemaFilterUserList),a={},r={or:[]};for(var n in o)"dateFrom"==o[n].value&&(o[n].value=this.dateFromValue),"dateTo"==o[n].value&&(o[n].value=this.dateToValue),"in"==o[n].comparison&&(o[n].value=o[n].value.split(",")),"or"==o[n].operator&&(r.or.push(a),a={}),a[o[n].field]||(a[o[n].field]={}),a[o[n].field][o[n].comparison]=o[n].value;r.or.push(a),e.filter=r}return this.filterField.isVisible()&&""!=this.filterInputValue&&(t[this.filterFieldValue]=this.filterInputValue,e.filter.or=[t]),console.log(e),e},_proto.setTableSetting=function(){var e=this.schemaTableSetting;for(var t in e.show)null!==this.$$(t)&&"1"===e.show[t].value&&this.$$(t).show();for(var i in e.template)null!==this.$$(i)&&(this.$$(i).define({template:e.template[i].value}),this.$$(i).refresh());for(var o in e.filter)null!==this.$$(o)&&("filter-field"==o&&(this.$$(o+"-label").define({label:e.filter[o].value}),this.$$(o+"-label").refresh()),"filter-date-range-field"==o&&(this.filterDateRangeField=e.filter[o].value))},_proto.setFilterSetting=function(){var e=this;e.$$("filter-field").data.options=[],e.$$("filter-field").refresh(),this.schemaTableUserFilter.forEach((function(t,i){e.$$("filter-field").data.options.push({id:t.column_id,value:t.header}),0!=i||e.$$("filter-input")||e.$$("filter-layout").addView({view:"search-close",name:"text",value:e.stateFilter?e.stateFilter.filterInput:"",localId:"filter-input"})})),e.$$("filter-field").refresh(),e.stateFilter&&e.$$("filter-field").setValue(e.stateFilter.filterField)},_proto.getSchemaTableSetting=function(){var e=this.app.config.apiRest.getUrl("get","accounting/schema-table-setting-users",{"per-page":-1,sort:'[{"property":"type_property","direction":"ASC"},{"property":"property_title","direction":"ASC"}]'}),t=webix.ajax().sync().get(e,{filter:{model:this.model,list_id:this.selectTypeValue}}),i=JSON.parse(t.responseText),o={};return this.schemaTableSettingColumns=i.config.columns,this.schemaTableSettingItems=i.data,this.schemaTableSettingData=i,i.data.forEach((function(e){o[e.type_property]||(o[e.type_property]={}),o[e.type_property][e.property]=e})),o},_proto.setSelectType=function(){var e=this;this.selectType=this.$$("select-type");var t=webix.ajax().sync().get(this.state.urlTableUserLists,{filter:{model:this.model},expand:"schemaTableUserFilter"}),i=JSON.parse(t.responseText);if(i.errors){for(var o in i.errors)webix.message({text:o+":"+i.errors[o],type:"error",expire:-1});throw webix.alert({title:"Ошибка",ok:"Ок",text:"Обратитесь к администратору системы"}),new Error}this.dataSelectType=i;var a,r=i.data.length,n="";if(e.schemaTableUserFilter=[],this.getSelectTypeState()&&(a=this.getSelectTypeState(),i.data.forEach((function(t){t.id==a&&(n=t.id,e.schemaTableUserFilter=t.schemaTableUserFilter,e.schemaFilterUserList=t.filter_setting,e.schemaSortUserList=t.sort_setting)})),""==n&&webix.storage.local.remove(this.mode+"_select_type_state")),i.data.forEach((function(t){""==n&&1==t.is_default&&(n=t.id,e.schemaTableUserFilter=t.schemaTableUserFilter,e.schemaFilterUserList=t.filter_setting,e.schemaSortUserList=t.sort_setting)})),r<=1)return this.selectType.hide(),void(this.selectTypeValue=n);this.selectType.show(),this.selectType.define("options",{body:{data:i.data,on:{onItemClick:function(t){var i=this.getItem(t);e.selectTypeValue=t,e.schemaTableSetting=e.getSchemaTableSetting(),e.schemaTableUserFilter=i.schemaTableUserFilter,e.schemaFilterUserList=i.filter_setting,e.schemaSortUserList=i.sort_setting,e.setTableSetting(),e.setFilterSetting(),e.getDataTable(),e.putSelectTypeState(t)}}}}),this.selectType.refresh(),this.selectType.setValue(n),this.selectTypeValue=n},_proto.attachToolBarEvents=function(){var e=this;e.dateFrom.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.dateTo.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.filterField.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.filterInput.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.table.attachEvent("onColumnResize",(function(t,i,o,a){e.eventSetColumnUserSize(t,i,o,a)})),e.table.attachEvent("onAfterColumnDrop",(function(t,i,o){e.eventSetColumnUserSort(t,i,o)}))},_proto.eventSetColumnUserSize=function(e,t,i,o){var a=this;this.app.config.apiRest.getUrl("get","accounting/schema-table-users");if(o){var r=this.table.getColumnConfig(e),n=this.app.config.apiRest.getUrl("get","accounting/schema-table-users/"+r.rowId);webix.ajax().put(n,{width:t,adjust:"",id:r.rowId},(function(e,t,i){a.showMessageResult(t.json(),i,!1)}))}},_proto.eventSetColumnUserSort=function(e,t,i){var o=this.table.getColumnConfig(e),a=this.table.getColumnConfig(t),r=1;a.sort_order<o.sort_order&&(r=-1),o.sort_order=a.sort_order+1*r;var n=this.app.config.apiRest.getUrl("get","accounting/schema-table-users/"+o.rowId);webix.ajax().put(n,{sort_order:a.sort_order+1*r,id:o.rowId},(function(e,t,i){scope.showMessageResult(t.json(),i,!1)}))},_proto.showMessageResult=function(e,t,i){if(e.errors)for(var o in e.errors)webix.message({text:o+":"+e.errors[o],type:"error",expire:-1});200==t.status&&!e.errors&&i&&webix.message({text:"Данные cохранены",type:"info",expire:1e3}),204==t.status&&webix.message({text:"Ошибка! Данные не сохранены",type:"error",expire:-1})},_proto.showSetting=function(){if(!this.win){var e=this;this.state={model:this.capitalizeFirstLetter(this.mode),urlTableUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-users",{"per-page":-1,sort:'[{"property":"sort_order","direction":"ASC"}]'}),urlTableUserLists:this.app.config.apiRest.getUrl("get","accounting/schema-table-user-lists",{"per-page":-1,sort:"sort_order"}),urlTableSettingUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-setting-users",{"per-page":-1,sort:"type-property"}),dataList:"",urlTableUsersSave:"api->accounting/schema-table-users",urlTableSettingUsersSave:"api->accounting/schema-table-setting-users",listId:"",tableSetiingConfigColumn:[],tableSettingItems:[]},this.state.dataList=this.dataSelectType.data,this.state.listId=this.selectTypeValue;var t=webix.ajax().sync().get(e.state.urlTableUsers,{filter:{model:e.state.model,list_id:e.state.listId}}),i=JSON.parse(t.responseText);this.state.tableConfigColumn=i.config.columns,this.state.tableItems=i.data?i.data:i.items,this.state.tableSetiingConfigColumn=this.schemaTableSettingColumns,this.state.tableSettingItems=this.schemaTableSettingItems,this.state.tableSetiingData=this.schemaTableSettingData,this.win={};var o={view:"window",head:{cols:[{width:4},{type:"header",template:"Настройки таблицы",borderless:!0},{view:"icon",icon:"mdi mdi-close",align:"right",click:function(){this.getTopParentView().hide()}}]},width:950,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!1,body:{localId:"body-setting-layout",css:"webix_primary",type:"space",cols:[{view:"menu",layout:"y",width:200,select:!0,localId:"menu-list",onContext:{},data:this.state.dataList,ready:function(){this.select(e.state.listId)},on:{onItemClick:function(t){var i=webix.ajax().sync().get(e.state.urlTableUsers,{filter:{model:e.state.model,list_id:t}}),o=JSON.parse(i.responseText);e.state.tableConfigColumn=o.config.columns,e.state.tableItems=o.data?o.data:o.items,e.state.listId=t,$$("showColumnsTab").define("rows",e.getHeaderShowColumns()),$$("showColumnsTab").reconstruct(),$$("settingColumnsTab").define("rows",e.getHeaderSettingColumns()),$$("settingColumnsTab").reconstruct();var a=webix.ajax().sync().get(e.state.urlTableSettingUsers,{filter:{model:e.state.model,list_id:t}}),r=JSON.parse(a.responseText);e.state.tableSetiingData=r,e.state.tableSetiingConfigColumn=r.config.columns,e.state.tableSettingItems=r.data?r.data:r.items,$$("tablePropertyTab").define("rows",e.getHeaderTableProperty()),$$("tablePropertyTab").reconstruct()}}},{rows:[{view:"tabbar",value:"showColumnsTab",options:[{id:"showColumnsTab",value:"Видимые колонки"},{id:"settingColumnsTab",value:"Свойства колонок"},{id:"tablePropertyTab",value:"Настройки таблицы"}],on:{onItemClick:function(e,t){$$(this.getValue()).show()}}},{animate:!1,width:660,cells:[{id:"showColumnsTab",type:"space",rows:this.getHeaderShowColumns()},{id:"settingColumnsTab",type:"space",rows:this.getHeaderSettingColumns()},{id:"tablePropertyTab",type:"space",rows:this.getHeaderTableProperty()}]}]}]}};this.win=webix.ui(o),this.contentMenu=this.ui(this.getContentMenu(),e),this.contentMenu.attachTo(this.win.queryView({localId:"menu-list"}))}this.win.show()},_proto.getHeaderShowColumns=function(){var e=this,t=this;return[{cols:[{view:"dataview",borderless:!1,select:!0,xCount:3,scroll:!0,type:{width:210,markCheckbox:function(e,t){return"<span class='metadata_config_check webix_icon wxi-checkbox-"+(e.hidden?"blank":"marked")+" +square-o'></span>"}},onClick:{metadata_config_check:function(e,i){var o=this.getItem(i);(o.hidden=o.hidden?0:1,this.updateItem(i,o),1==o.hidden)?t.table.hideColumn(o.column_id):-1!=t.table.getColumnIndex(o.column_id)?t.table.showColumn(o.column_id):(t.table.config.columns.splice(o.id,0,{id:o.column_id,header:o.header,adjust:"header",hidden:0}),t.table.refreshColumns())}},on:{onBeforeSelect:function(e){return!this.getItem(e).hidden}},scheme:{$init:function(e){e.hidden&&(e.$css="metadata_list_item_disabled")}},template:"{common.markCheckbox()}<div style='margin-top:5px;'>#header#</div>",data:t.state.tableItems,datatype:"json",save:t.state.urlTableUsersSave}]},{type:"space",borderless:!0,cols:[{view:"button",label:"Копировать в базовые настройки",localId:"save-setting",css:"webix_primary",click:function(){return e.doSaveBaseSettingClick()}},{}]}]},_proto.getHeaderSettingColumns=function(){var e=[],t=[],i=[],o=[],a=[];return this.state.tableItems.forEach((function(e){0==e.hidden&&a.push(e)})),this.state.tableConfigColumn.forEach((function(a){"header_filter_type"==a.id&&(e=a.options),"header_total_type"==a.id&&(t=a.options),"format"==a.id&&(i=a.options),"sort_type"==a.id&&(o=a.options)})),[{view:"datatable",css:"webix_header_border webix_data_border",select:"cell",editable:!0,editaction:"click",tooltip:!0,borderless:!1,columns:[{id:"index",header:"#",hidden:!1,width:40,css:{"background-color":"#F4F5F9"}},{id:"id",header:"ID",hidden:!0},{id:"column_id",header:"Колонка",hidden:!0},{id:"header",header:"Колонка",adjust:"all",css:{"background-color":"#F4F5F9"},tooltip:"#column_id#"},{id:"sort_order",header:"Порядок",editor:"text",adjust:"all"},{id:"header_filter_type",header:"Тип фильтра",editor:"select",options:e,adjust:"all"},{id:"header_total_type",header:"Тип итого",editor:"select",options:t,adjust:"all"},{id:"format",header:"Формат колонки",editor:"select",options:i,adjust:"all"},{id:"css_format",header:"Css Формат",editor:"popup",adjust:"all"},{id:"sort_type",header:"Тип сорт.",editor:"select",options:o,adjust:"all"},{id:"width",header:"Ширина",editor:"text",adjust:"all"},{id:"adjust",header:"Рег.ширины",editor:"text",adjust:"all"},{id:"template",header:"Шаблон",editor:"text",adjust:"all"},{id:"options",header:"Список",editor:"popup",adjust:"all"},{id:"use_filter",header:"Исп. в фильтре",editor:"text",adjust:"all"},{id:"",header:"",fillspace:!0}],data:a,datatype:"json",save:this.state.urlTableUsersSave,scheme:{$init:function(e){e.index=this.count()-1+1}}}]},_proto.getHeaderTableProperty=function(){return this.state.tableSetiingData.config.columns=this.dataDriverJsonToObject(this.state.tableSetiingData.config.columns),[{view:"treetable",css:"webix_header_border webix_data_border",select:"cell",editable:!0,editaction:"click",tooltip:!0,data:this.state.tableSetiingData,save:this.state.urlTableSettingUsersSave,scheme:{$init:function(e){e.index=this.count()-1+1},$group:{by:"type_property",map:{property_value:["type_property"],property_title:["property_title"],value:["","string"]}}},ready:function(){this.openAll()}}]},_proto.doSaveBaseSettingClick=function(){var e=this.app.config.apiRest.getUrl("get","accounting/schema-table-user-list/save-to-base-setting"),t=webix.ajax().sync().get(e,{listId:this.state.listId,model:this.state.model}),i=JSON.parse(t.responseText);this.showMessageError(i)},_proto.getContentMenu=function(){var e=this;return{view:"contextmenu",id:"cmenu",editable:!0,editor:"text",data:[{id:"add",value:"Копировать"},{id:"rename",value:"Переименовать"},{id:"is_default",value:"По умолчанию"},{id:"copy_user",value:"Для пользователя"},{$template:"Separator"},{id:"delete",value:"Удалить"}],on:{onItemClick:function(t){var i=this.getContext();i.obj,i.id;"delete"==t&&e.doDeleteMenuClick(i.id,i.obj),"add"==t&&e.doSaveSettingClick(),"rename"==t&&e.doRenameClick(i.id,i),"is_default"==t&&e.doDefaultMenuClick(i.id,i),"copy_user"==t&&e.doCopyUsertMenuClick(i.id,i)}}}},_proto.doSaveSettingClick=function(){var e=this.app.config.apiRest.getUrl("get","accounting/schema-table-user/save-setting"),t=webix.ajax().sync().get(e,{listId:this.state.listId,model:this.state.model}),i=JSON.parse(t.responseText),o=this.win.queryView({localId:"menu-list"});o.add(i.data),o.select(i.data.id),o.callEvent("onItemClick",[i.data.id])},_proto.doDeleteMenuClick=function(e,t){var i=this.app.config.apiRest.getUrl("delete","accounting/schema-table-user-lists",{},e);204==webix.ajax().sync().del(i).status?(t.remove(e),t.select(t.getFirstId()),this.state.listId=t.getFirstId()):webix.message("Ошибка! Данные не удалены!")},_proto.doDefaultMenuClick=function(e,t){var i=this.app.config.apiRest.getUrl("get","accounting/schema-table-user-list/set-default",{id:e}),o=webix.ajax().sync().get(i),a=JSON.parse(o.responseText);1==a.success?(t.obj.data.each((function(e){e.id==t.id?(e.icon="mdi mdi-flip-to-front",e.is_default=1,e.editor="text"):(e.icon="mdi mdi-flip-to-back",e.is_default=0)})),t.obj.refresh()):webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))},_proto.doRenameClick=function(e,t){var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},e);webix.prompt({text:"Изменить название",ok:"Сохранить",cancel:"Отмена",input:{required:!0,value:t.obj.getItem(e).value,placeholder:"Введите название"},width:350}).then((function(e){var o=webix.ajax().sync().put(i,{name:e}),a=JSON.parse(o.responseText);if(200==o.status){var r=t.obj.getItem(t.id);r.name=e,r.value=e,t.obj.refresh()}else webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))})).fail((function(){}))},_proto.doCopyUsertMenuClick=function(e,t){var i=this;this.app.config.apiRest.getUrl("get","accounting/users");webix.ui({view:"window",width:500,height:400,head:"Копировать настройи для пользователя",modal:!0,position:"center",close:!0,body:{type:"space",cols:[{type:"form",rows:[{view:"combo-close",localId:"combo-user",options:this.app.config.apiRest.getCollection("accounting/users",{"per-page":-1},"email"),label:"Выберите пользователя",labelWidth:180,required:!0,placeholder:"Выберите пользователя"},{cols:[{view:"button",label:"Сохранить",click:function(){var e=this.getTopParentView().queryView({localId:"combo-user"}).getValue(),o=i.app.config.apiRest.getUrl("get","accounting/schema-table-user/save-setting-for-user"),a=webix.ajax().sync().get(o,{listId:t.id,model:i.state.model,userId:e}),r=JSON.parse(a.responseText);this.getTopParentView().hide(),i.showMessageError(r)}},{},{}]}]}]}}).show()},_proto.putFilterState=function(){webix.storage.local.put(this.mode+"_filter_state",{dateFrom:this.dateFrom.getValue(),dateTo:this.dateTo.getValue(),filterField:this.filterField.getValue(),filterInput:this.filterInput.getValue()})},_proto.getSelectTypeState=function(){var e=webix.storage.local.get(this.mode+"_select_type_state");return!!e&&e.selectType},_proto.putSelectTypeState=function(e){webix.storage.local.put(this.mode+"_select_type_state",{selectType:e})},_proto.showMessageError=function(e){if(e.errors)for(var t in e.errors)webix.message({text:t+":"+e.errors[t],type:"error",expire:-1});e.success&&webix.message({text:"Данные успешно сохранены!",type:"info",expire:2e3})},_proto.doRefresh=function(){this.getDataTable()},_proto.getModelName=function(e){return"y"==e[e.length-1]?e.replace("y","ies"):e+"s"},_proto.doClickOpenAll=function(){var e=this.table;e.getOpenItems().length>0?e.closeAll():e.openAll()},_proto.capitalizeFirstLetter=function(e){var t=e.split("-"),i=[];return t.forEach((function(e){i.push(e.charAt(0).toUpperCase()+e.slice(1))})),i.join("")},_proto.dataDriverJsonToObject=function dataDriverJsonToObject(configColumns){return configColumns.forEach((function(item,key){var myObj={func:{}};item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDate")&&(eval(" myObj.func = (obj) => { try {formatDate(obj.trim())} catch (e) { debugger; } return  formatDate(obj.trim()); }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateHour")&&(eval(" myObj.func = (obj) => { return formatDateHour(obj.trim()); }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateShort")&&(eval(" myObj.func = (obj) => { debugger; return formatDateShort(obj.trim()); }"),configColumns[key].format=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("(obj,common,value)")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("custom_checkbox")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("columnGroupTemplate")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func)})),configColumns},_proto.doAddClick=function(){this.table.unselect(),this.formEdit.showForm(this.table)},_proto.showExportToExcelSetting=function(){var e={view:"window",head:"Настройки экспорта в Excel",width:950,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-print-layout",css:"webix_primary",type:"space",cols:[{view:"menu",layout:"y",width:250,select:!0,localId:"menu-list-print",onContext:{},url:this.app.config.apiRest.getUrl("get","accounting/schema-print-user-lists",{"per-page":-1,filter:'{"list_id":"'+this.selectTypeValue+'"}'}),hidden:!0,on:{onAfterLoad:function(){this.data.count()>0&&this.show(),this.select(this.data.getFirstId()),this.callEvent("onItemClick",[this.data.getFirstId()])},onItemClick:function(e){var t=this.getTopParentView().queryView({localId:"print-column-select"});JSON.parse(this.getItem(e).setting).forEach((function(e){t.data.each((function(t){t.id==e.id&&(t.hidden=e.hidden)}))})),t.refresh()}}},{type:"form",rows:[{header:"Показывать",rows:this.getHeaderPrintColumns()}]}]}};this.winPrint=webix.ui(e),this.contentMenuPrint=this.ui(this.getContentMenuPrint(),this),this.contentMenuPrint.attachTo(this.winPrint.queryView({localId:"menu-list-print"})),this.winPrint.show()},_proto.getHeaderPrintColumns=function(){var e=this;return[{view:"dataview",localId:"print-column-select",select:!0,type:{width:250,markCheckbox:function(e,t){return"<span class='metadata_config_check webix_icon wxi-checkbox-"+(e.hidden?"blank":"marked")+" +square-o'></span>"}},onClick:{metadata_config_check:function(e,t){var i=this.getItem(t);i.hidden=i.hidden?0:1,this.updateItem(t,i)}},on:{onBeforeSelect:function(e){return!this.getItem(e).hidden}},scheme:{$init:function(e){e.hidden&&(e.$css="metadata_list_item_disabled")}},template:function(e,t){return t.markCheckbox(e,t)+"<div style='margin-top:5px;'>"+e.header[0].text+"</div>"},data:e.table.config.columns,datatype:"json"},{cols:[{},{},{view:"button",label:"Сохранить настройки",localId:"save-setting",css:"webix_primary",click:function(){var t=this.getTopParentView().queryView({localId:"print-column-select"}).data.serialize();e.doSavePrintSettingClick(t)}},{view:"button",label:"Печать",localId:"print-button",css:"webix_primary",click:function(){var t=this.getTopParentView().queryView({localId:"print-column-select"}).data.serialize();e.doClickToExcel(t),this.getTopParentView().close()}}]}]},_proto.doSavePrintSettingClick=function(e){var t=this,i=this.app.config.apiRest.getUrl("get","accounting/schema-print-user-lists"),o=[];e.forEach((function(e){o.push({id:e.id,hidden:e.hidden?e.hidden:0})})),webix.ajax().post(i,{model:this.model,setting:JSON.stringify(o),name:"Печать",list_id:this.selectTypeValue},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})},_proto.doClickToExcel=function(e){var t=this.table,i="";this.filter.filter.or.forEach((function(e){for(var t in e)if(i=i+"_"+t,"object"==typeof e[t])for(var o in e[t])i=i+"_"+e[t][o];else i=i+"_"+e[t]}));var o=[];e.forEach((function(e){e.hidden||o.push(e)})),webix.toExcel(t,{filename:this.mode+i,styles:!1,ignore:{"action-edit":!0},columns:o})},_proto.getContentMenuPrint=function(){var e=this;return{view:"contextmenu",localId:"cmenu-print",editable:!0,editor:"text",data:[{id:"rename",value:"Переименовать"},{id:"is_default",value:"По умолчанию"},{$template:"Separator"},{id:"delete",value:"Удалить"}],on:{onItemClick:function(t){var i=this.getContext();i.obj,i.id;"delete"==t&&e.doDeleteMenuPrintClick(i.id,i.obj),"rename"==t&&e.doRenamePrintClick(i.id,i),"is_default"==t&&e.doDefaultMenuPrintClick(i.id,i)}}}},_proto.doDeleteMenuPrintClick=function(e,t){var i=this.app.config.apiRest.getUrl("delete","accounting/schema-print-user-lists",{},e);204==webix.ajax().sync().del(i).status?(t.remove(e),t.select(t.getFirstId()),t.callEvent("onItemClick",[t.getFirstId()])):webix.message("Ошибка! Данные не удалены!")},_proto.doRenamePrintClick=function(e,t){var i=this.app.config.apiRest.getUrl("put","accounting/schema-print-user-lists",{},e);webix.prompt({text:"Изменить название",ok:"Сохранить",cancel:"Отмена",input:{required:!0,value:t.obj.getItem(e).value,placeholder:"Введите название"},width:350}).then((function(e){var o=webix.ajax().sync().put(i,{name:e}),a=JSON.parse(o.responseText);if(200==o.status){var r=t.obj.getItem(t.id);r.name=e,r.value=e,t.obj.refresh()}else webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))})).fail((function(){}))},_proto.doDefaultMenuPrintClick=function(e,t){var i=this.app.config.apiRest.getUrl("get","accounting/schema-print-user-list/set-default",{id:e}),o=webix.ajax().sync().get(i),a=JSON.parse(o.responseText);1==a.success?(t.obj.data.each((function(e){e.id==t.id?(e.icon="mdi mdi-flip-to-front",e.is_default=1,e.editor="text"):(e.icon="mdi mdi-flip-to-back",e.is_default=0)})),t.obj.refresh()):webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))},_proto.showFilterSetting=function(){var e={view:"window",head:"Настройки фильтра",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-filter-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderFilterSetting()}]}]}};this.winFilter=webix.ui(e),this.setElementFilterForm(),this.winFilter.show()},_proto.setElementFilterForm=function(){if(this.schemaFilterUserList&&this.schemaFilterUserList.length>2){var e=JSON.parse(this.schemaFilterUserList),t=this.winFilter.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementFilterForm(i));this.winFilter.queryView("form").setValues(e)}},_proto.getElementFilterForm=function(e){var t=this;return{localId:"element-filter-"+e,rows:[{cols:[{view:"combo",name:e+".operator",labelWidth:150,labelPosition:"top",label:"Оператор",value:"",disabled:0==e,options:["","and","or"]},{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"date_shipment",options:this.table.config.columns},{view:"combo",name:e+".comparison",labelWidth:150,labelPosition:"top",label:"Тип сравнения",value:"=",options:["=",">=","<=","in"]},{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Значение",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementFilterForm("element-filter-"+e)}}]},{height:20}]}},_proto.deleteElementFilterForm=function(e){var t=this.winFilter.queryView({localId:"form-row-layout"}),i=this.winFilter.queryView({localId:e});t.removeView(i)},_proto.getHeaderFilterSetting=function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-filter-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementFilterForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-setting",css:"webix_primary",click:function(){e.doSaveFilterSettingClick(this.getTopParentView().queryView("form").getValues()),e.winFilter.close()}}]}]}]},_proto.doSaveFilterSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaFilterUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{filter_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},_proto.showSortSetting=function(){var e={view:"window",head:"Настройки сортировки",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-sort-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderSortSetting()}]}]}};this.winSort=webix.ui(e),this.setElementSortForm(),this.winSort.show()},_proto.setElementSortForm=function(){if(this.schemaSortUserList&&this.schemaSortUserList.length>2){var e=JSON.parse(this.schemaSortUserList),t=this.winSort.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementSortForm(i));this.winSort.queryView("form").setValues(e)}},_proto.getElementSortForm=function(e){var t=this;return{localId:"element-sort-"+e,rows:[{cols:[{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"date_shipment",options:this.table.config.columns},{view:"combo",name:e+".direction",labelWidth:150,labelPosition:"top",label:"Тип сортировки",value:"ASC",options:[{id:"ASC",value:"по возрастанию"},{id:"DESC",value:"по убыванию"}]},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementSortForm("element-sort-"+e)}}]},{height:20}]}},_proto.deleteElementSortForm=function(e){var t=this.winSort.queryView({localId:"form-row-layout"}),i=this.winSort.queryView({localId:e});t.removeView(i)},_proto.getHeaderSortSetting=function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-sort-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementSortForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-setting",css:"webix_primary",click:function(){e.doSaveSortSettingClick(this.getTopParentView().queryView("form").getValues()),e.winSort.close()}}]}]}]},_proto.doSaveSortSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaSortUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{sort_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},AdminView}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);i(1),i(12),i(11),i(2),i(4),i(3);webix.Date.dateToStr("%d.%m.%y");var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return{localId:"layout",rows:[{view:"toolbar",cols:[{view:"label",height:40,css:{"font-size":"17px",padding:"5px 0px 10px 15px","font-weight":"normal"},template:"<div>Управление таблицами</div>",borderless:!0,width:250}]},{cols:[{view:"datatable",width:200,select:!0,localId:"table-model",columns:[{id:"name",header:"Модели",width:400}],url:this.app.config.apiRest.getUrl("get","accounting/user/get-tables")},{rows:[{view:"datatable",css:"webix_header_border webix_data_border my_style",editable:!0,editaction:"dblclick",select:!0,resizeColumn:{headerOnly:!0},localId:"table-schema"},{view:"toolbar",cols:[{},{view:"button",localId:"btn-save",label:"Сохранить",width:200}]}]}]}]}},a.init=function(e){var t=this,i=this.$$("table-model"),o=this.$$("table-schema"),a=this.$$("btn-save");i.attachEvent("onSelectChange",(function(){var e=i.getSelectedItem().name,a=t.app.config.apiRest.getUrl("get","accounting/user/get-schema-table",{name:e});webix.ajax().get(a).then((function(e){o.clearAll(),o.parse(e.json())}))})),a.attachEvent("onItemClick",(function(){var e=[],a=i.getSelectedItem().name;o.data.each((function(t){e.push(t)}));var r=t.app.config.apiRest.getUrl("get","accounting/user/set-schema-table",{name:a});webix.ajax().post(r,{data:e}).then((function(e){}))}))},o}(o.b)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return ProductsBedView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),models_product_product_type__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(12),views_cloth_directory_index__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(11),components_comboClose__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_6__);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var formatDate=webix.Date.dateToStr("%d.%m.%y"),ProductsBedView=function(_JetView){function ProductsBedView(){return _JetView.apply(this,arguments)||this}_inheritsLoose(ProductsBedView,_JetView);var _proto=ProductsBedView.prototype;return _proto.config=function(){return{localId:"layout",rows:[]}},_proto.init=function init(view){var scope=this,layout=this.$$("layout"),format=webix.Date.dateToStr("%d.%m.%y");webix.extend(layout,webix.ProgressBar);var tableUrl=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'}),url=this.app.config.apiRest.getUrl("get","accounting/order/client-order",{"per-page":-1});webix.ajax(url,(function(text){var text1=eval(text),win=scope.ui({view:"client-order"});layout.addView(win);var table=win.queryView("treetable"),dateFrom=win.queryView({localId:"dateFrom"}),dateTo=win.queryView({localId:"dateTo"}),dateFromValue=format(dateFrom.getValue()),dateToValue=format(dateTo.getValue()),filter={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":dateFromValue,"<=":dateToValue},B:4}]}};dateFrom.attachEvent("onChange",(function(e){dateFromValue=format(dateFrom.getValue()),dateToValue=format(dateTo.getValue());var t;t={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":dateFromValue,"<=":dateToValue},B:4}]}};var i=scope.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});webix.ajax().get(i,t).then((function(e){table.clearAll(),table.parse(e.json().items)}))})),dateTo.attachEvent("onChange",(function(e){dateFromValue=format(dateFrom.getValue()),dateToValue=format(dateTo.getValue()),filter={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":dateFromValue,"<=":dateToValue},B:4}]}};var t=scope.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});webix.ajax().get(t,filter).then((function(e){table.clearAll(),table.parse(e.json().items)}))})),webix.ajax().get(tableUrl,filter).then((function(e){table.clearAll(),table.parse(e.json().items)}))}))},ProductsBedView}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return ContragentProductsBedView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),models_product_product_type__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(12),views_cloth_directory_index__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(11),components_comboClose__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_6__);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var ContragentProductsBedView=function(_JetView){function ContragentProductsBedView(){return _JetView.apply(this,arguments)||this}_inheritsLoose(ContragentProductsBedView,_JetView);var _proto=ContragentProductsBedView.prototype;return _proto.config=function config(){var _this=this,scope=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Продукция клиента",width:150},{},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){scope.doRefresh()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){scope.doClickOpenAll()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return _this.doAddClick()}}]},{view:"treetable",localId:"product-bed-table",urlEdit:"contragent-product-bed",css:"webix_header_border webix_data_border",leftSplit:2,select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"product_id",header:"Модель",width:280,sort:"string",collection:scope.app.config.apiRest.getCollection("accounting/product-beds",{"per-page":-1})},{id:"client_id",header:"Клиент",width:120},{id:"price",header:"Кат. 0",width:100},{id:"price_1",header:"Кат. 1"},{id:"price_2",header:"Кат. 2."},{id:"price_3",header:"Кат. 3."},{id:"price_4",header:"Кат. 4",width:100},{id:"price_5",header:"Кат. 5",width:100},{id:"price_6",header:"Кат. 6",width:100},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/contragent-product-beds",{sort:"name","per-page":-1,expand:"images"}),save:"api->accounting/contragent-product-beds",scheme:{$group:{by:function(e){return e.type_id},map:{value:["type_id"]}}},on:{onItemClick:function onItemClick(id,e,trg){if("action-delete"==id.column){var table=this;webix.confirm("Удалить запись?").then((function(e){webix.dp(table).save(id.row,"delete").then((function(e){webix.dp(table).ignore((function(){table.remove(id.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-edit"==id.column&&this.$scope.cashEdit.showForm(this),"action-image"==id.column){var url=scope.app.config.apiRest.getUrl("get","accounting/image-param/form-image-list",{"per-page":-1,product_id:id.row});webix.ajax(url,(function(text){var text1=eval(text),win=scope.ui({view:"form-image-param-list"},scope.$$("layout"));win.show()}))}if("action-image-table"==id.column){var _url=scope.app.config.apiRest.getUrl("get","accounting/image-param/form-image-table",{"per-page":-1,product_id:id.row});webix.ajax(_url,(function(text){var text1=eval(text),win=scope.ui({view:"form-image-param-table"},scope.$$("layout"));win.show()}))}},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},_proto.init=function(e){var t=this.$$("product-bed-table"),i=this.$$("form-search"),o=this;webix.extend(t,webix.ProgressBar),i.attachEvent("onChange",(function(e){o.getData()})),this.cashEdit=this.ui(core_updateFormView__WEBPACK_IMPORTED_MODULE_1__.a),this.uploader=webix.ui({localId:"uploadAPI",name:"uploader",inputName:"uploader",view:"uploader",datatype:null,apiOnly:!0}),this.cashEdit.attachFormEvents=function(e){var t=this,i=(this.state,this.$$("btn_save")),o=this.$$("btn_copy"),a=this.$$("uploader");i.attachEvent("onItemClick",(function(e){t.doClickSave()})),o.attachEvent("onItemClick",(function(e){t.doClickSave(!0)})),this.$$("formEdit").elements.id.attachEvent("onChange",(function(e,i,o){var r=[],n=t.state.tableRecord.images;if(n)for(var l in n)r.push({id:n[l].id,name:n[l].name,sizetext:n[l].size,status:"server"});a.files.clearAll(),a.files.parse(r);var s=t.state.tableRecord.id,c=t.app.config.apiRest.getUrl("get","accounting/images",{type:"image",model:"product-bed",mode:"insert-save",id:s});a.define({upload:c})})),a.files.attachEvent("onBeforeDelete",(function(e){var i=a.files.getItem(e),o=e;i.newId&&(o=i.newId),t.app.config.apiRest.delete("accounting/images",{id:o}).then((function(){for(var e in t.state.tableRecord.images){if(t.state.tableRecord.images[e].id==o){t.state.tableRecord.images="";break}0}}))})),a.attachEvent("onBeforeFileAdd",(function(e,t,i){})),a.attachEvent("onFileUpload",(function(e,i,o){e.newId=i.data.id,a.files.add({id:upload.data.id,name:upload.data.name,sizetext:upload.data.size,status:"server"}),t.state.tableRecord.images.push(i.data)}))};var a={localId:"winTable",view:"window",scope:this,head:"Список",position:"center",width:800,height:600,close:!0,modal:!0,move:!0,body:views_cloth_directory_index__WEBPACK_IMPORTED_MODULE_3__.default};this.winTable=this.ui(a)},_proto.getData=function(){var e=this.$$("product-bed-table"),t={filter:{search:this.$$("form-search").getValue()}};webix.extend(e,webix.ProgressBar),e.clearAll(!0),e.showProgress({delay:2e3,hide:!1}),webix.ajax().get(this.app.config.apiRest.getUrl("get","accounting/contragent-product-beds",{sort:"name","per-page":-1}),t).then((function(t){e.parse(t),e.enable(),e.openAll()}))},_proto.doAddClick=function(){this.$$("product-bed-table").unselect(),this.cashEdit.showForm(this.$$("product-bed-table"))},_proto.doClickOpenAll=function(){var e=this.$$("product-bed-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},_proto.doRefresh=function(){var e=this.$$("product-bed-table");e.disable(),e.showProgress({type:"icon",hide:!1}),this.getData()()},ContragentProductsBedView}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Контрагенты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("contragent-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"contragent-table",urlEdit:"contragent",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наиименование",width:380,sort:"string"},{id:"account",header:"Счет",width:100},{id:"external_id",header:"Экспорт ID"},{id:"category_in_id",header:"Родитель"},{id:"bank",header:"Банк"},{id:"mfo",header:"МФО"},{id:"okpo",header:"ОКПО"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"},{id:"action-view",header:"",width:50,template:"<i class='mdi mdi-eye'></i>"}],url:this.app.config.apiRest.getUrl("get","accounting/contragents"),save:"api->accounting/contragents",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-edit"==e.column&&this.$scope.cashEdit.showForm(this),"action-view"==e.column){var a=this.getItem(e.row);this.$scope.app.show("/top/contragent-product-bed?id="+a.id+"&name="+a.name)}},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("contragent-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/contragents"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("contragent-table").unselect(),this.cashEdit.showForm(this.$$("contragent-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Отделы",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("department-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"department-table",urlEdit:"department",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наиименование",width:280,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/departments",{sort:"name"}),save:"api->accounting/departments",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("department-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/departments"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("department-table").unselect(),this.cashEdit.showForm(this.$$("department-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return this.apiRest=this.app.config.apiRest,{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("directory-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"directory-table",urlEdit:"directory",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:["Наименование",{content:"textFilter"}],width:150},{id:"type_id",header:["Тип справочника",{content:"selectFilter"}],width:150,options:t.apiRest.getCollection("accounting/directory-types")},{id:"sort_order",header:["Сорт.",{content:"textFilter"}],width:70},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/directories",{sort:"type_id"}),save:"api->accounting/directories",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("directory-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/directories",{sort:"type_id"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("directory-table").unselect(),this.cashEdit.showForm(this.$$("directory-table"))},r.doClickOpenAll=function(){var e=this.$$("directory-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("directory-type-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"directory-type-table",urlEdit:"directory-type",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/directory-types",{sort:"name"}),save:"api->accounting/directory-types",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("directory-type-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/directory-types",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("directory-type-table").unselect(),this.cashEdit.showForm(this.$$("directory-type-table"))},r.doClickOpenAll=function(){var e=this.$$("directory-type-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(81);i(16),i(2),i(4),i(3);var r=webix.Date.dateToStr("%M %y"),n=(webix.Date.dateToStr("%D"),webix.Date.dateToStr("%d.%m"),function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.urlChange=function(e,t){},n.config=function(){var e,t=this,i=this,o={color:"green","text-align":"right","font-weight":100},a={"text-align":"right"};return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"icon",icon:"mdi mdi-keyboard-backspace",width:30,click:function(){i.app.show("/top/employee-salary")}},{view:"label",label:i.getParam("name"),width:250},{},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return t.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return t.doClickToExcel()}},{view:"icon",icon:"mdi mdi-save",autowidth:!0,click:function(){return t.doClickToSave()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("card-employee-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){i.doClickOpenAll()}}]},(e={view:"treetable",localId:"card-employee-table",urlEdit:"employee",css:"webix_header_border webix_data_border",select:!0,editable:!0,editaction:"dblclick",resizeColumn:{headerOnly:!0},columns:[{id:"date_salary",header:["Месяц"],width:70,sort:"date",format:r},{id:"employee_id",header:["ID"],width:30,sort:"string",hidden:!0},{id:"rate",header:["Ставка"],width:80,sort:"string",editor:"text",format:webix.Number.format,css:o},{id:"rate_day",header:["Ставка за день"],width:115,sort:"string",format:webix.Number.format,css:a},{id:"work_time_days",header:["Дни посещ."],width:95,sort:"string",format:webix.Number.format,css:a},{id:"work_time_hours",header:["Дни по часам"],width:110,sort:"string",format:webix.Number.format,css:a},{id:"salary_rate",header:["ЗП по ставке"],width:100,sort:"string",math:"[$r,work_time_hours]*[$r,rate_day]",format:webix.Number.format,css:o},{id:"salary_piecework",header:["ЗП по сдельно"],width:110,sort:"string",format:webix.Number.format,css:o},{id:"award",header:["Премия"],width:80,sort:"string",format:webix.Number.format,css:o},{id:"surcharges",header:["Доп./Выч."],width:90,sort:"string",format:webix.Number.format,css:o},{id:"salary",width:90,sort:"string",math:"[$r,salary_rate] + [$r,award]+ [$r,surcharges] +[$r,salary_piecework]",cssFormat:function(){return{"font-weight":500}},format:webix.Number.format,css:a,header:["К выплате"]},{id:"dept_start_month",header:"Долг с прош. месяца",width:100,sort:"string",css:a},{id:"transaction_sum",header:"Выпл.",width:80,sort:"string",css:{color:"red","text-align":"right","font-weight":100},format:webix.Number.format},{id:"remainder",header:"Остаток",width:80,sort:"string",css:a,cssFormat:function(){return{"font-weight":500}},format:webix.Number.format},{id:"action-edit",header:"",width:50,template:"<i class='mdi mdi-eye hover'></i>",fillspace:!0}],url:this.app.config.apiRest.getUrl("get","accounting/employee-salaries",{filter:'{"employee_id":"'+i.getParam("id")+'"}',sort:"date_salary","per-page":"-1",expand:"documentSalaryAccrual, employee,transactionPart"}),save:"api->accounting/employees",on:{onresize:webix.once((function(){this.adjustRowHeight(null,!0)}))},scheme:{},ready:function(){}},e.on={onItemClick:function(e,t,i){"action-edit"==e.column&&this.$scope.showInfoMonthHours.showWindow(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}},e)]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("card-employee-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/employees",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.showInfoMonthHours=this.ui(a.default)},n.doAddClick=function(){this.$$("card-employee-table").unselect(),this.cashEdit.showForm(this.$$("card-employee-table"))},n.doClickOpenAll=function(){var e=this.$$("card-employee-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},n.doClickPrint=function(){var e=this.$$("card-employee-table");webix.print(e,{fit:"data"})},n.doClickToExcel=function(){var e=this.$$("card-employee-table");webix.toExcel(e,{filename:"months_"+this.getParam("name"),styles:!1,ignore:{"action-edit":!0},filter:function(e){return 0!=e.transaction_sum}})},n.doClickToSave=function(){var e=this.$$("card-employee-table");webix.toPNG(e,{download:!1}).then((function(e){webix.html.download(e,"myfile.pdf")}))},o}(o.b))},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Сотрудники",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("employee-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"employee-table",urlEdit:"employee",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"department_name",header:"Сотрудники",width:280,template:function(e,t){return e.$group?t.treetable(e,t)+e.department_name:t.treetable(e,t)+e.name}},{id:"status",header:"Статус",width:150,sort:"string",collection:[{id:"0",value:"Уволен"},{id:"1",value:"Работает"}]},{id:"init_sum",header:"Начальная сумма",width:80,sort:"string"},{id:"category_id",header:"ID статьи выплат",width:120,sort:"string",edit:"text"},{id:"phone",header:"Телефон",width:120,sort:"string",edit:"text"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/employees",{sort:"name","per-page":-1}),save:"api->accounting/employees",scheme:{$group:{by:"department_name",map:{department_name:["department_name"],name:["name"],department_id:["department_id"]}},$sort:{by:"department_id",dir:"asc",as:"int"}},ready:function(){},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("employee-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/employees",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("employee-table").unselect(),this.cashEdit.showForm(this.$$("employee-table"))},r.doClickOpenAll=function(){var e=this.$$("employee-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));var o=i(0),a=i(1);i(2),i(4),i(3);webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn);webix.Number.numToStr({groupDelimiter:"",groupSize:3,decimalDelimiter:".",decimalSize:0});var r={"text-align":"right"},n={"text-align":"right",color:"green"},l={"text-align":"right",color:"red"};webix.Date.monthEnd=function(e){return e=webix.Date.add(e,1,"month"),e=webix.Date.add(e,-1,"minute")};var s=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s=o.prototype;return s.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Зарплата по сотрудникам",width:190},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(webix.Date.monthStart(new Date))},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"employee-table",urlEdit:"employee",css:"webix_header_border webix_data_border",leftSplit:1,select:!0,resizeColumn:{headerOnly:!0},math:!0,editable:!0,editaction:"dblclick",columns:[{id:"department_name",header:"Сотрудник",width:240,template:function(e,t){return e.$group?t.treetable(e,t)+e.department_name:t.treetable(e,t)+e.employee_name}},{id:"status",header:"Статус",width:70,sort:"string",collection:[{id:"0",value:"Уволен"},{id:"1",value:"Работает"}]},{id:"action-view",header:"",width:50,template:"<i class='mdi mdi-eye'></i>"},{id:"dept_start_month",header:["Долг",{content:"totalColumn"}],width:75,sort:"string",css:r},{id:"rate",header:["Ставка",""],width:70,sort:"string",css:r},{id:"rate_day",header:["За день",""],width:70,sort:"string",css:r,numberFormat:"1111.00"},{id:"all_time_days",header:["Дней.раб.",{content:"totalColumn"}],width:70,sort:"string",css:r},{id:"work_time_days",header:["Дни",{content:"totalColumn"}],width:70,sort:"string",css:r},{id:"work_time_hours",header:["Дни.по.ч.",{content:"totalColumn"}],width:70,sort:"string",css:r,numberFormat:"1111.00"},{id:"salary_rate",header:["ЗП.врем.",{content:"totalColumn"}],width:70,sort:"string",css:r},{id:"salary_piecework",header:["ЗП.Выраб.",{content:"totalColumn"}],width:70,sort:"string",css:r},{id:"award",header:["Премия",{content:"totalColumn"}],width:70,sort:"string",css:r},{id:"surcharges",header:["Доп/Выч.",{content:"totalColumn"}],width:70,sort:"string",css:r},{id:"salary",header:["Итого",{content:"totalColumn"}],width:75,sort:"string",css:n},{id:"transaction_sum",header:["Оплаты",{content:"totalColumn"}],width:75,sort:"string",css:l},{id:"remainder",header:["Остаток",{content:"totalColumn"}],width:75,sort:"string",css:r},{id:"pay_plan_1",header:["План 1",{content:"totalColumn"}],width:75,sort:"string",css:r,editor:"text"},{id:"pay_plan_2",header:["План 2",{content:"totalColumn"}],width:75,sort:"string",css:r,editor:"text"},{id:"pay_plan_3",header:["План 3",{content:"totalColumn"}],width:75,sort:"string",css:r,editor:"text"},{id:"pay_plan_4",header:["План карта",{content:"totalColumn"}],width:75,sort:"string",css:r,editor:"text"}],save:"api->accounting/employee-salaries",scheme:{$group:{by:"department_name",map:{department_name:["department_name"],employee_name:["employee_name"],department_id:["department_id"],remainder:["remainder","sum"],pay_plan_1:["pay_plan_1","sum"],pay_plan_2:["pay_plan_2","sum"],pay_plan_3:["pay_plan_3","sum"],pay_plan_4:["pay_plan_4","sum"],salary:["salary","sum"],transaction_sum:["transaction_sum","sum"],dept_start_month:["dept_start_month","sum"],surcharges:["surcharges","sum"],award:["award","sum"],salary_piecework:["salary_piecework","sum"],salary_rate:["salary_rate","sum"],work_time_hours:["work_time_hours","sum"],work_time_days:["work_time_days","sum"],all_time_days:["all_time_days","sum"]}},$sort:{by:"department_id",dir:"asc",as:"int"}},ready:function(){},on:{onItemClick:function(e,i,o){if("action-delete"==e.column){var a=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(a).save(e.row,"delete").then((function(t){webix.dp(a).ignore((function(){a.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-view"==e.column){var r=this.getItem(e.row);t.app.show("/top/employee-details?id="+r.employee_id+"&name="+r.employee_name)}},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},s.init=function(e){var t=this.$$("form-search"),i=this.$$("employee-table"),o=this;webix.extend(i,webix.ProgressBar),o.doRefresh(),t.attachEvent("onChange",(function(e){t.getValue();i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),o.doRefresh()})),this.$$("dateFrom").attachEvent("onChange",(function(e){i.showProgress({delay:2e3,hide:!1}),o.doRefresh()})),this.$$("dateTo").attachEvent("onChange",(function(e){i.showProgress({delay:2e3,hide:!1}),o.doRefresh()})),this.cashEdit=this.ui(a.a)},s.doRefresh=function(){var e=this.$$("employee-table"),t=this.$$("form-search"),i=webix.Date.dateToStr("%Y-%m-%d"),o=i(this.$$("dateFrom").getValue()),a=i(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;var r={};r={sort:"employee_name","per-page":-1,expand:"employee,documentSalaryAccrual,transactionPart",filter:{date_salary:{">=":o,"<=":a}}},""!=t.getValue()&&(r.filter.employee_name=t.getValue());var n=this.restApi.getUrl("get","accounting/employee-salaries");e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(n,r).then((function(t){e.clearAll(),e.parse(t.json()),e.enable()}))},s.doAddClick=function(){this.$$("employee-table").unselect(),this.cashEdit.showForm(this.$$("employee-table"))},s.doClickOpenAll=function(){var e=this.$$("employee-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},s.doClickToExcel=function(){var e=this.$$("employee-table"),t=webix.Date.dateToStr("%Y-%m-%d")(this.$$("dateFrom").getValue());webix.toExcel(e,{filename:"salary_"+t,styles:!1})},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));var o=i(0),a=i(1),r=i(88),n=i(16);i(2),i(4),i(3);var l=webix.Date.dateToStr("%Y %F"),s=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s=o.prototype;return s.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Ставка сотрудников по месяцам",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("employee-salary-table"))}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.yearStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.add(webix.Date.yearStart(new Date),11,"month")},{view:"combo-close",localId:"employee-combo",inputWidth:250,label:"по",labelWidth:30,width:280,suggest:{body:{data:r.a,template:webix.template("#value#")}}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){e.doClickOpenAll()}}]},{view:"treetable",localId:"employee-salary-table",urlEdit:"employee-salary",css:"webix_header_border webix_data_border",leftSplit:1,select:"cell",multiselect:!0,blockselect:!0,clipboard:"block",editable:!0,editaction:"dblclick",resizeColumn:{headerOnly:!0},hover:"myhover",columns:[{id:"employee_id",header:"Сотрудник",width:240,css:{"text-align":"left"},template:function(e,t){return e.$group?t.treetable(e,t)+e.employee_name:t.treetable(e,t)+l(e.date_salary)}},{id:"is_piecework",header:"Тип зарплаты",width:100,css:{"text-align":"left"},collection:n.a},{id:"is_taskmaster",header:"Бриг.",width:50,css:{"text-align":"right"},collection:[{id:"0",value:"Нет"},{id:"1",value:"Да"}]},{id:"rate",header:"Ставка",width:100,css:{"text-align":"right"}},{id:"award_const",header:"Премия пост.",width:110,css:{"text-align":"right"}},{id:"status",header:"Статус",width:100,css:{"text-align":"right"},collection:[{id:"0",value:"Уволен"},{id:"1",value:"Работает"}]},{id:"action-delete",header:"",width:50,template:function(e,t){return e.$group?"":t.trashIcon()}},{id:"action-edit",header:"",width:50,template:function(e,t){return e.$group?"":t.editIcon()}}],save:"api->accounting/employee-salaries",scheme:{$group:{by:"employee_id",map:{department_id:["department_id"],department_name:["department_name"],employee_id:["employee_id"],employee_name:["employee_name"],value:["index"]}}},ready:function(){this.openAll()},on:{"data->onStoreUpdated":function(){},onAfterEditStop:function(e,t,i){e.value!=e.old&&this.$scope.afterEditStop(e,t,i)},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},s.init=function(e){this.$$("form-search");var t=this.$$("employee-salary-table"),i=this.$$("employee-combo"),o=(i.getValue(),webix.Date.dateToStr("%Y-%m-%d")),r=this.$$("dateFrom"),n=this.$$("dateTo"),l=o(this.$$("dateFrom").getValue()),s=o(this.$$("dateTo").getValue()),c=this.app.config.apiRest.getUrl("get","accounting/employee-salaries",{"per-page":-1,sort:'[{"property":"employee_name","direction":"ASC"}, {"property":"date_salary","direction":"ASC"}]',filter:'{"date_salary":{">=":"'+l+'","<=":"'+s+'"}}'}),d=this;t.load(c),t.attachEvent("onPaste",(function(e){var t=this;this.getSelectedId(!0).forEach((function(e){d.updateRowPaste(e.column,t.getItem(e.row))}))})),i.attachEvent("onChange",(function(e){d.getDataTable()})),r.attachEvent("onChange",(function(e){d.getDataTable()})),n.attachEvent("onChange",(function(e){d.getDataTable()})),this.cashEdit=this.ui(a.a)},s.getDataTable=function(){this.$$("form-search");var e=this.$$("employee-salary-table"),t=this.$$("employee-combo").getValue(),i=webix.Date.dateToStr("%Y-%m-%d"),o=(this.$$("dateFrom"),this.$$("dateTo"),{date_salary:{">=":i(this.$$("dateFrom").getValue()),"<=":i(this.$$("dateTo").getValue())}});t&&(o.employee_id=t);var a={filter:o,"per-page":"-1",sort:[{property:"employee_name",direction:"ASC"},{property:"date_salary",direction:"ASC"}]},r=this.app.config.apiRest.getUrl("get","accounting/employee-salaries");webix.ajax().get(r,a).then((function(t){e.clearAll(),e.parse(t),e.openAll()}))},s.updateRowPaste=function(e,t){var i=this,o=e.replace("-start","").replace("-end",""),a=(t.employee_id,0),r=t[o+"-id"];-1!=e.indexOf("-start")&&(a=1);var n={id:r};n[a?"int_start":"int_end"]=t[e];var l=i.app.config.apiRest.getUrl("put","accounting/employee-time-works",{},n.id);webix.ajax().put(l,n,{error:function(o,a,r){i.$$("employee-salary-table").addCellCss(t.id,e,"webix_invalid_cell")},success:function(o,a,r){i.$$("employee-salary-table").addCellCss(t.id,e,"webix_editing_cell")}})},s.resetColumns=function(){this.$$("employee-salary-table").config.columns=[{id:"employee_name",header:"Сотрудник",width:240,sort:"string",template:function(e,t){return e.$group?t.treetable(e,t)+e.department_name:t.treetable(e,t)+e.index+". "+e.employee_name}}]},s.changeColumns=function(e,t){var i=function(e,t){for(var i=[],o=new Date(e);o<=t;o.setDate(o.getDate()+1))i.push(new Date(o));return i}(e.getValue(),t.getValue());i.reverse();var o=webix.Date.dateToStr("%D %d"),a=webix.Date.dateToStr("%Y-%m-%d");for(var r in this.resetColumns(),i)this.addColumn(a(i[r]),o(i[r]));this.$$("employee-salary-table").refreshColumns()},s.addColumn=function(e,t){var i=this.$$("employee-salary-table").config.columns,o=[{text:t,colspan:2},"н."];i.splice(1,0,{id:e+"-end",header:[{text:"",colspan:2},"к."],width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-end"]&&0!=t[e+"-end"]?t[e+"-end"]:""}}),i.splice(1,0,{id:e+"-start",header:o,width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-start"]&&0!=t[e+"-start"]?t[e+"-start"]:""}})},s.afterEditStop=function(e,t,i){var o=this.$$("employee-salary-table").getItem(t.row),a=t.column,r=e.value?e.value:0;this.updateRow(a,o,r)},s.updateRow=function(e,t,i){var o=this,a=e.replace("-start","").replace("-end",""),r=(t.employee_id,0),n=t[a+"-id"];-1!=e.indexOf("-start")&&(r=1);var l={id:n};l[r?"int_start":"int_end"]=i;var s=o.app.config.apiRest.getUrl("put","accounting/employee-time-works",{},l.id);webix.ajax().put(s,l,{error:function(i,a,r){o.$$("employee-salary-table").addCellCss(t.id,e,"webix_invalid_cell")},success:function(i,a,r){o.$$("employee-salary-table").addCellCss(t.id,e,"webix_editing_cell")}})},s.doClickOpenAll=function(){var e=this.$$("employee-salary-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Типы зарплат",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("salary-type-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"salary-type-table",urlEdit:"employee-salary-type",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наиименование",width:280,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/employee-salary-types",{sort:"name"}),save:"api->accounting/employee-salary-types",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("salary-type-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/employee-salary-types"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("salary-type-table").unselect(),this.cashEdit.showForm(this.$$("salary-type-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return{localId:"firebase-table",view:"treetable",autoConfig:!0,select:"row",editable:!0,editaction:"dblclick",url:"firebase->transaction",save:"firebase->transaction/data"}},a.init=function(e){this.$$("firebase-table")},o}(i(0).b)},function(e,t,i){"use strict";var o=i(0),a=i(82);o.b},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(83),r=i(5);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",id:"list-salary-accrual-view",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Журнал начисления зарплаты",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("time-work-table")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"list-salary-accrual-table",urlEdit:"list-salary-accrual",css:"webix_header_border webix_data_border",select:!0,hover:"myhover",resizeColumn:{headerOnly:!0},columns:[{id:"index",header:"#",sort:"int",width:50},{id:"date_document",header:"Дата",width:130,sort:"string",format:webix.i18n.fullDateFormatStr},{id:"id",header:"ID",width:30,sort:"string"},{id:"date_created",header:"Время создания",width:130,sort:"string",format:webix.i18n.fullDateFormatStr},{id:"type_document_name",header:"Тип",width:180,sort:"string",template:"Начисление зарплаты"},{id:"sum",header:"Сумма",width:80,sort:"string",fillspace:!0,format:webix.i18n.numberFormat}],url:this.app.config.apiRest.getUrl("get","accounting/list-salary-accruals",{sort:"name"}),save:"api->accounting/list-salary-accruals",on:{"data->onStoreUpdated":function(){this.data.each((function(e,t){e.index=t+1}))},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){this.$$("form-search");var t=this.$$("list-salary-accrual-table"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),n=this.$$("dateTo"),l=i(this.$$("dateFrom").getValue()),s=i(this.$$("dateTo").getValue()),c=this.app.config.apiRest.getUrl("get","accounting/list-salary-accruals",{dateFrom:l,dateTo:s}),d=this;t.load(c),o.attachEvent("onChange",(function(e){l=i(o.getValue()),s=i(n.getValue()),d.changeColumns(o,n);var a=d.app.config.apiRest.getUrl("get","accounting/list-salary-accruals",{dateFrom:l,dateTo:s});t.clearAll(),t.load(a)})),n.attachEvent("onChange",(function(e){l=i(o.getValue()),s=i(n.getValue()),d.changeColumns(o,n);var a=d.app.config.apiRest.getUrl("get","accounting/list-salary-accruals",{dateFrom:l,dateTo:s});t.clearAll(),t.load(a)})),this.cashEdit=this.ui(a.default),r.a["list-salary-accrual-view"]=this,$$("top:menu").getItem("list-salary-accrual-view")&&$$("top:menu").remove("list-salary-accrual-view"),$$("top:menu").add({id:"list-salary-accrual-view",value:"Журнал начисления зарплаты",icon:"mdi mdi-view-dashboard"},null,"info")},n.doAddClick=function(){this.$$("list-salary-accrual-table").unselect(),this.cashEdit.showForm(this.$$("list-salary-accrual-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));var o=i(0),a=(i(3),i(89)),r=(i(2),i(4),i(8));webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)1==t[o].$level&&(isNaN(e(t[o]))||(i+=1*e(t[o])));return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCountEmpty=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.toolsContent=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var n=webix.Date.dateToStr("%d.%m.%y"),l=webix.Date.strToDate("%Y-%m-%d"),s=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s=o.prototype;return s.config=function(){var e=this,t=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"Заказы",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:220,label:"Дата отгрузки",labelWidth:100,width:230,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-undo",autowidth:!0,value:!0,click:function(){t.doUndo()}},{view:"icon",icon:"mdi mdi-plus",autowidth:!0,value:!0,click:function(){t.doAdd()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return e.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,hidden:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:4,labelWidth:100,options:[{id:4,value:"Отгруженные"},{id:3,value:"На складе"},{id:1,value:"В заказах"},{id:6,value:"В обработке"}],width:200,hidden:!0,localId:"select-type"},{view:"select",value:2,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,hidden:!0,on:{onChange:function(e){t.showBatch(e)}}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"treetable",urlEdit:"order",css:"webix_header_border webix_data_border",leftSplit:3,select:"cell",resizeColumn:{headerOnly:!0},localId:"order-table",multiselect:!0,editable:!0,visibleBatch:2,scroll:!0,save:"api->accounting/orders",editaction:"dblclick",clipboard:"selection",blockselect:!0,tooltip:!0,headermenu:!0,sort:"multi",columns:[{id:"index",header:[{content:"toolsContent"},"",""],width:40,template:function(e){return e.images.length>0?e.index+"<i class='mdi mdi-attachment'></i>":e.index},cssFormat:function(){return{"background-color":"#F4F5F9"}}},{id:"A",header:["# заказа",{content:"textFilter"},{content:"totalColumnCount"}],hidden:!1,css:{color:"black","text-align":"right","font-weight":500},sort:"int",tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",cssFormat:function(e,t){return t.product_id&&t.client_id&&t.cloth_id&&t.type_product&&t.size_id&&t.carcass_type_id&&t.leg_id&&t.bottom_id?{color:"green"}:{}}},{id:"action-view",header:["","",""],width:50,template:function(e,t){return e.$group?"":t.editIcon()}},{id:"date_obivka",header:["Дата гот.",{content:"selectFilter"},""],width:100,css:{color:"black","text-align":"right","font-weight":100},sort:"date",format:webix.Date.dateToStr("%d.%m.%y")},{id:"date_shipment",header:["Дата отгр.",{content:"selectFilter"},""],width:100,css:{color:"black","text-align":"right","font-weight":500},sort:"date",editor:"date",format:webix.Date.dateToStr("%d.%m.%y")},{id:"B",header:["Статус",{content:"numberFilter"},""],width:80,batch:2,sort:"int",editor:"text"},{id:"date_shipment_plan",header:["Дата.план.отгр.",{content:"textFilter"},""],sort:"date",width:110,editor:"date",template:function(e){return n(l(e.date_shipment_plan))}},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,sort:"date"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,sort:"date"},{id:"H",header:["Дата кл.",{content:"textFilter"},""],width:90,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,sort:"string",editor:"text"},{id:"storage",header:["Склад",{content:"selectFilter"},""],width:120,sort:"string",editor:"text"},{id:"city",header:["Город",{content:"selectFilter"},""],width:150,editor:"text"},{id:"F",header:["Клиент",{content:"textFilter"},""],width:200,batch:2,sort:"string",editor:"text"},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},sort:"int",editor:"text"},{id:"I",header:["Изделие",{content:"textFilter"},{content:"totalColumnCount"}],width:200,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},{content:"totalColumnCountEmpty"}],width:70,batch:2,editor:"text"},{id:"K",header:["Дата ткани",{content:"textFilter"},""],width:90,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,batch:2,editor:"text"},{id:"N",header:["Ножки",{content:"selectFilter"},""],width:100,batch:2,editor:"text"},{id:"O",header:["Пуг.",{content:"selectFilter"},""],width:100,batch:2,editor:"text"},{id:"P",header:["Отстр.",{content:"selectFilter"},""],width:100,batch:2,editor:"text"},{id:"S",header:["# клиента",{content:"textFilter"},""],width:90,batch:2,editor:"text",sort:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:300,disable:!0,batch:2,editor:"popup"},{id:"discount",header:["Скидка",{content:"selectFilter"},""],css:{color:"black","text-align":"right","font-weight":300},width:70,batch:2,editor:"text"},{id:"sum_full",header:["Сумма.прайс",{content:"numberFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":300},width:100,batch:2,editor:"text"},{id:"deal_id",header:["Номер.сделки",{content:"textFilter"},""],width:100,editor:"text",batch:2,template:function(e){return e.deal_id?"<a href='https://greensofa.bitrix24.ua/crm/deal/details/"+e.deal_id+"/' target='_blank'>"+e.deal_id+"</a>":""}},{id:"AF",header:["Комментарий работников",{content:"textFilter"},""],width:250,editor:"popup",batch:4}],scheme:{$sort:{by:"B",dir:"desc",as:"int"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green"),6==e.B&&(e.$css="highlight-green");var t=l(e.date_obivka),i=webix.Date.add(new Date,-1,"day");webix.filters.date.greater(i,t)&&"1"==e.B&&(e.$css="highlight-red"),e.index=this.count()+1}},ready:function(){webix.ui({view:"contextmenu",data:["Редактировать"],on:{onItemClick:function(e){var i=this.getContext();if(t.$$("order-table").unselect(),t.$$("order-table").select(i.id.row,i.id.column,!0),"Редактировать"==e&&t.formEdit.showForm(t.$$("order-table")),"Копировать"==e)t.$$("order-table")}}}).attachTo(this),this.openAll()},on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,t){},onSelectChange:function(e,t,i){var o=this.getSelectedId(!0);if(!this.rowSelect&&o.length>0&&"index"==o[0].column){var a=this.getSelectedId(!0).join().split(","),r=a[0],n=a[a.length-1];this.rowSelect=!0,this.selectRange(r,"A",n,"T")}else this.rowSelect=!1},onDataUpdate:function(e,t,i){},onItemClick:function(e,t,i){if("action-view"==e.column&&this.$scope.formCheckEdit.showWindow({},this),"index"==e.column){this.rowSelect=!1}}}}]}},s.init=function(e){var t=this.$$("order-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),n=this.$$("dateTo"),l=this.$$("select-type"),s=i(this.$$("dateFrom").getValue()),c=i(this.$$("dateTo").getValue()),d=l.getValue(),u=this.$$("form-search"),h={filter:{B:{in:[d]}}};4==d&&(h={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":s,"<=":c},B:4}]}});var p=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",expand:"images",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'}),m=this;webix.ajax().get(p,h).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){s=i(o.getValue()),c=i(n.getValue());var a={filter:{B:{in:[d=l.getValue()]}}};4==d&&(a={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":s,"<=":c},B:4}]}});var r=m.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",expand:"images",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});webix.ajax().get(r,a).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),n.attachEvent("onChange",(function(e){s=i(o.getValue()),c=i(n.getValue()),4==(d=l.getValue())&&(h={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":s,"<=":c},B:4}]}});var a=m.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",expand:"images",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});webix.ajax().get(a,h).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),l.attachEvent("onChange",(function(e){s=i(o.getValue()),c=i(n.getValue());var a={filter:{B:{in:[d=l.getValue()]}}};4==d&&(a={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":s,"<=":c},B:4}]}});var r=m.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",expand:"images",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"index","direction":"ASC"}]'});webix.ajax().get(r,a).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),u.attachEvent("onChange",(function(e){4==d&&(h={or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":s,"<=":c},B:4}]});var i=m.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",expand:"images",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});""!=u.getValue()&&(h={A:u.getValue()});var o={filter:h};webix.extend(t,webix.ProgressBar),t.clearAll(!0),t.showProgress({delay:2e3,hide:!1}),webix.ajax().get(i,o).then((function(e){t.parse(e.json().items)}))})),t.attachEvent("onPaste",(function(e){var i=this,o=this.getSelectedId(!0),a={};o.forEach((function(o){i.getItem(o.row)[o.column]=e,i.refresh(o.row),a[o.column]=e,a.id=o.row,t.updateItem(o.row,a)}))})),this.formEdit=this.ui(a.a),this.formCheckEdit=this.ui(r.default)},s.doRefresh=function(){var e=this.$$("order-table"),t=webix.Date.dateToStr("%d.%m.%y"),i=this.$$("select-type"),o=t(this.$$("dateFrom").getValue()),a=t(this.$$("dateTo").getValue()),r=i.getValue(),n={filter:{B:{in:[r]}}};4==r&&(n={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":o,"<=":a},B:4}]}}),this.restApi=this.app.config.apiRest;var l=this.restApi.getUrl("get","accounting/orders",{"per-page":"1200",expand:"images",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});webix.extend(e,webix.ProgressBar),e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(l,n).then((function(t){e.clearAll(),e.parse(t.json().items),e.enable()}))},s.doClickOpenAll=function(){var e=this.$$("order-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},s.showBatch=function(e){this.$$("order-table").showColumnBatch(e)},s.doAdd=function(){var e=this.$$("order-table");e.unselect(),this.formEdit.showForm(e)},s.doClickPrint=function(){var e=this.$$("order-table");webix.print(e,{fit:"data"})},s.doClickToExcel=function(){var e=this.$$("order-table");webix.toExcel(e)},s.doUndo=function(){var e=this.$$("order-table"),t=this;this.restApi=this.app.config.apiRest;var i=this.restApi.getUrl("get","accounting/user/order-back",{});this.restApi.getLoad(i,{}).then((function(i){var o={updated:!1,index:!1,AE:!1,date_obivka:!1},a=i.json().data[0],r=a.change_params,n=JSON.parse(a.old_record),l=e.getItem(a.model_id),s={id:a.model_id};for(var c in r)isNaN(o[c])&&(l[c]=n[c],s[c]=n[c],e.refresh());console.log(s),t.restApi.put("accounting/orders",s).then((function(t){l.updated=t.updated;var i=function(t){e.addCellCss(a.model_id,t,"webix_editing_cell_green highlight"),setInterval((function(){e.removeCellCss(a.model_id,t,"webix_editing_cell_green highlight")}),5e4)};for(var o in s)i(o);e.showItem(a.model_id)}))}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Справочники калькулятора",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("calculation-directory-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"calculation-directory-table",urlEdit:"calculation-directory",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"type_model",header:"Модель",width:150},{id:"connection_field",header:"Ключевое поле",width:150},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/calculation-directories",{sort:"name"}),save:"api->accounting/calculation-directories",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("calculation-directory-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/calculation-directories",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("calculation-directory-table").unselect(),this.cashEdit.showForm(this.$$("calculation-directory-table"))},r.doClickOpenAll=function(){var e=this.$$("calculation-directory-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Поля/Тип калькулятора",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("calculation-field-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"calculation-field-table",urlEdit:"calculation-field",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"field_name",header:"Свойство",width:150},{id:"type_model",header:"Модель",width:150},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/calculation-fields",{sort:"name"}),save:"api->accounting/calculation-fields",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("calculation-field-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/calculation-fields",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("calculation-field-table").unselect(),this.cashEdit.showForm(this.$$("calculation-field-table"))},r.doClickOpenAll=function(){var e=this.$$("calculation-field-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(84);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return this.api=this.app.config.apiRest,{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Правила калькулятора стандарт",width:250},{},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("order-calculation-rule-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"datatable",localId:"order-calculation-rule-table",urlEdit:"order-calculation-rule",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"process_id",header:"Процесс",width:100,options:[{id:"1",value:"Прайс"},{id:"2",value:"Скидка клиента"}]},{id:"index_order",header:"Порядок выполнения",width:150},{id:"order_field",header:"Свойство",width:100,sort:"string",options:t.api.getCollection("accounting/calculation-fields",{"per-page":-1})},{id:"type",header:"Тип свойства",width:120,css:{"text-align":"center"},options:[{id:"value",value:"Значение"},{id:"dir",value:"Справочник"}]},{id:"directory_id",header:"Справочник",width:120,css:{"text-align":"center"},options:t.api.getCollection("accounting/calculation-directories",{"per-page":-1})},{id:"rule",header:"Условие",width:100,css:{"text-align":"center"}},{id:"value",header:"Значение условия",width:100,css:{"text-align":"right"}},{id:"result_type",header:"Тип результата",width:150,collection:[{id:"value",value:"Значение"},{id:"dir",value:"Справочник"}]},{id:"result_value_operation",header:"Операция со значением",width:150},{id:"result_value",header:"Значение",width:150},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/order-calculation-rules",{sort:"index_order","per-page":-1}),save:"api->accounting/order-calculation-rules",scheme:{$group:{by:"department_name",map:{department_name:["department_name"],name:["name"],department_id:["department_id"]}},$sort:{by:"department_id",dir:"asc",as:"int"}},ready:function(){},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){this.cashEdit=this.ui(a.default)},r.doRefresh=function(){var e=this.$$("order-calculation-rule-table");this.restApi=this.app.config.apiRest;var t=this.restApi.getUrl("get","accounting/order-calculation-rules",{"per-page":"-1",sort:'[{"property":"index_order","direction":"ASC"}]'});webix.extend(e,webix.ProgressBar),e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(t).then((function(t){e.clearAll(),e.parse(t.json().data),e.enable()}))},r.doAddClick=function(){this.$$("order-calculation-rule-table").unselect(),this.cashEdit.showForm(this.$$("order-calculation-rule-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),r=webix.Date.strToDate("%Y-%m-%d"),n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e,t=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"План Столярка",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(e){t.showBatch(e)}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"sewing-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.date_carpenter):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"B",header:["Статус",{content:"selectFilter"},""],width:70,batch:2,editor:"select",options:[{id:1,value:"1"},{id:3,value:"3"},{id:4,value:"4"},{id:5,value:"5"},{id:6,value:"6"}]},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",batch:2},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",batch:2},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",batch:2},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"coefMoney",header:["Коэф. ден. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1,template:function(e){var t=parseFloat(e.G.replace(",",""));return e.$group?webix.Number.format(t/7860,{decimalDelimiter:".",decimalSize:2}):webix.Number.format(parseFloat(e.G/7860))}},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,template:function(e){return a(r(e.date_obivka))}},{id:"AA",header:["Коэф. об. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1},{id:"AG",header:["Коэф. ст. план",{content:"textFilter"},{content:"totalColumn"}],width:125,css:{"text-align":"right","font-weight":500},batch:1},{id:"date_carpenter",header:["Дата Ст.",{content:"selectFilter"},""],width:100,editor:"date",batch:1,hidden:!1,template:function(e){return a(r(e.date_carpenter))}},{id:"BA",header:["Статус ст.",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check"></i>':null===e.BA?"":e.BA}},{id:"coef_carpenter",header:["Коэф. Ст. гот.",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"K",header:["Дата клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},(e={id:"W",header:["Статус Об.",{content:"selectFilter"},""],width:90,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500}},e.batch=2,e.template=function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-check"></i>':null===e.W?"":e.W},e),{id:"date_sewing",header:["Дата Пош.",{content:"selectFilter"},""],width:90,editor:"date",batch:1,hidden:!1,template:function(e){return a(r(e.date_sewing))}},{id:"BP",header:["Статус Пош.",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check"></i>':null===e.BP?"":e.BP}},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text",batch:2},{id:"AK",header:"Обивка царги",width:110,batch:3,editor:"text"},{id:"AL",header:"Статус",width:60,batch:3,editor:"text"},{id:"AM",header:"Дата",width:90,batch:3,editor:"text"},{id:"AP",header:"Паралон изг.",width:110,batch:3,editor:"text"},{id:"AQ",header:"Статус",width:60,batch:3,editor:"text"},{id:"AR",header:"Дата",width:90,batch:3,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:["Столярка",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},{id:"BO",header:"Пошив",width:115,batch:1,editor:"text"},{id:"BV",header:"Крой",width:115,batch:1,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:"date_carpenter",map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CI:["CI","median"],coef_carpenter:["coef_carpenter","median"],missing:!1}},$sort:{by:"date_carpenter",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)}}}]}},n.init=function(e){var t=this.$$("sewing-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_carpenter","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_carpenter":{">=":"'+r+'","<=":"'+n+'"}}'}),s=this;webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=s.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_carpenter","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_carpenter":{">=":"'+r+'","<=":"'+n+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=s.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_carpenter","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_carpenter":{">=":"'+r+'","<=":"'+n+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},n.doClickOpenAll=function(){var e=this.$$("sewing-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},n.showBatch=function(e){this.$$("sewing-table").showColumnBatch(e)},n.beforeDropChangeData=function(e,t){var i={date_carpenter:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_carpenter=t,webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(12),i(2),i(4),i(3);webix.editors.$popup.text={view:"popup",body:{view:"property",width:300,elements:[{label:"Layout",type:"label"},{label:"Data url",type:"text",id:"url"},{label:"Data type",type:"select",options:["json","xml","csv"],id:"type"},{label:"Use JSONP",type:"checkbox",id:"jsonp"}],scheme:{$init:function(e){}}}};var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Счета",width:150},{},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{cols:[{view:"treetable",localId:"order-change-log-table",urlEdit:"order-change-log",css:"webix_header_border webix_data_border",leftSplit:2,select:!0,editable:!0,editaction:"dblclick",resizeColumn:{headerOnly:!0},columns:[{id:"date_created",header:["Дата создания"],width:140,sort:"date"},{id:"model_id",header:["#Модели"],width:70,sort:"string"},{id:"order_id",header:["#Заказа"],width:70,sort:"string",editor:"text"},{id:"user_code",header:["#Пользователь"],width:70,sort:"string"},{id:"change_params",header:["Новые значения"],width:380,sort:"string",editor:"popup",template:function(e){return JSON.stringify(e.change_params)}},{id:"old_change_params",header:["Старые значения"],width:380,sort:"string",editor:"popup",template:function(e){return JSON.stringify(e.old_change_params)}},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/order-change-logs",{sort:"-id","per-page":100,fields:"id,model_id,order_id,date_created, change_params, old_change_params,user_code,old_record, new_record"}),save:"api->accounting/order-change-logs",scheme:{},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-edit"==e.column&&this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}},{view:"datatable",localId:"sets",width:500,columns:[{id:"name",header:"Наименование"},{id:"new",header:"Новое",width:150},{id:"old",header:"Старое",width:150}]}]}]}]}},r.init=function(e){var t=this.$$("order-change-log-table"),i=this.$$("form-search"),o=this.$$("sets"),r=this;webix.extend(t,webix.ProgressBar),i.attachEvent("onChange",(function(e){r.getData()})),t.attachEvent("onAfterSelect",(function(e,i){var a=t.getItem(e.id),r=a.change_params,n=[];for(var l in r)n.push({name:l,old:a.old_change_params[l],id:l,new:r[l]});o.clearAll(),o.parse(n)})),this.cashEdit=this.ui(a.a)},r.getData=function(){var e=this.$$("order-change-log-table"),t={filter:{search:this.$$("form-search").getValue()}};webix.extend(e,webix.ProgressBar),e.clearAll(!0),e.showProgress({delay:2e3,hide:!1}),webix.ajax().get(this.app.config.apiRest.getUrl("get","accounting/order-change-logs",{sort:"-id","per-page":100,fields:"id,model_id,order_id,date_created, change_params,old_change_params,user_code"}),t).then((function(t){e.parse(t),e.enable(),e.openAll()}))},r.doAddClick=function(){this.$$("order-change-log-table").unselect(),this.cashEdit.showForm(this.$$("order-change-log-table"))},r.doClickOpenAll=function(){var e=this.$$("order-change-log-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},r.doRefresh=function(){var e=this.$$("order-change-log-table");e.disable(),e.showProgress({type:"icon",hide:!1}),this.getData()()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),r=webix.Date.strToDate("%Y-%m-%d"),n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e,t=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"План Крой",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(e){t.showBatch(e)}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"sewing-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.date_cut):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"B",header:["Статус",{content:"selectFilter"},""],width:70,batch:2,editor:"select",options:[{id:1,value:"1"},{id:3,value:"3"},{id:4,value:"4"},{id:5,value:"5"},{id:6,value:"6"}]},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",batch:2},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",batch:2},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",batch:2},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"coefMoney",header:["Коэф. ден. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1,template:function(e){var t=parseFloat(e.G.replace(",",""));return e.$group?webix.Number.format(t/7860,{decimalDelimiter:".",decimalSize:2}):webix.Number.format(parseFloat(e.G/7860))}},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,template:function(e){return a(r(e.date_obivka))}},{id:"AA",header:["Коэф. об. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1},{id:"CI",header:["Коэф. крой. план",{content:"textFilter"},{content:"totalColumn"}],width:125,css:{"text-align":"right","font-weight":500},batch:1},{id:"date_cut",header:["Дата Крой",{content:"selectFilter"},""],width:100,editor:"date",batch:1,hidden:!1,template:function(e){return a(r(e.date_cut))}},{id:"BW",header:["Статус крой",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BW?'<i class="mdi mdi-check"></i>':null===e.BW?"":e.BW}},{id:"coef_cut",header:["Коэф. Крой гот.",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"K",header:["Дата клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},(e={id:"W",header:["Статус Об.",{content:"selectFilter"},""],width:90,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500}},e.batch=2,e.template=function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-check"></i>':null===e.W?"":e.W},e),{id:"date_sewing",header:["Дата Пош.",{content:"selectFilter"},""],width:90,editor:"date",batch:1,hidden:!1,template:function(e){return a(r(e.date_sewing))}},{id:"BP",header:["Статус Пош.",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check"></i>':null===e.BP?"":e.BP}},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check"></i>':null===e.BA?"":e.BA}},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text",batch:2},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"AK",header:"Обивка царги",width:110,batch:3,editor:"text"},{id:"AL",header:"Статус",width:60,batch:3,editor:"text"},{id:"AM",header:"Дата",width:90,batch:3,editor:"text"},{id:"AP",header:"Паралон изг.",width:110,batch:3,editor:"text"},{id:"AQ",header:"Статус",width:60,batch:3,editor:"text"},{id:"AR",header:"Дата",width:90,batch:3,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:"Столярка",width:115,batch:3,editor:"text"},{id:"BB",header:"Дата",width:90,batch:3,editor:"text"},{id:"BO",header:"Пошив",width:115,batch:1,editor:"text"},{id:"BV",header:["ФИО крой",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:"date_cut",map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CI:["CI","median"],coef_cut:["coef_cut","median"],missing:!1}},$sort:{by:"date_cut",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)}}}]}},n.init=function(e){var t=this.$$("sewing-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_cut","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_cut":{">=":"'+r+'","<=":"'+n+'"}}'}),s=this;webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=s.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_cut","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_cut":{">=":"'+r+'","<=":"'+n+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=s.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_cut","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_cut":{">=":"'+r+'","<=":"'+n+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},n.doClickOpenAll=function(){var e=this.$$("sewing-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},n.showBatch=function(e){this.$$("sewing-table").showColumnBatch(e)},n.beforeDropChangeData=function(e,t){var i={AE:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_cut=t,webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return f}));var o=i(0);i(2);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countSame=function(e,t){if(!t.length)return 0;for(var i={},o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&null!=a&&(i[a]=a)}return webix.i18n.numberFormat(Object.keys(i).length,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:250,height:100}}},webix.Date.oneDayEnd=function(e){return e=webix.Date.add(e,1,"day"),e=webix.Date.add(e,-1,"minute")},webix.ui.datafilter.mySummColumn=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.rank&&(o+=e.fee)})),t.innerHTML=o}},webix.ui.datafilter.summColumn);var a=webix.Date.dateToStr("%d-%m-%Y %H:%i"),r=webix.Date.dateToStr("%d-%m-%Y"),n=webix.Date.dateToStr("%d-%m-%Y"),l=webix.Date.strToDate("%d.%m.%y"),s=webix.Date.dateToStr("%d.%m.%y"),c=webix.Date.dateToStr("%d.%m.%y %H:%i"),d=webix.Date.dateToStr("%Y-%m-%d %H:%i"),u=webix.Date.strToDate("%Y-%m-%d"),h=webix.Date.strToDate("%Y-%m-%d %H:%i"),p=webix.Date.strToDate("%Y-%m-%d %H"),m=(webix.Date.strToDate("%d-%m-%Y %H:%i"),webix.Date.dateToStr("%d.%m.%y %H")),g=webix.Date.dateToStr("%H:%i"),f=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var f=o.prototype;return f.config=function(){var e=this,t=this;return this.apiRest=this.app.config.apiRest,{rows:[{cols:[{view:"label",width:200,height:30,template:"Диаграмма Ганта",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:new Date},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.oneDayEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-eye",autowidth:!0,value:!0,click:function(){gantt.config.show_grid=!gantt.config.show_grid,gantt.render()}},{view:"icon",icon:"mdi mdi-minus",autowidth:!0,value:!0,click:function(){gantt.ext.zoom.zoomIn()}},{view:"icon",icon:"mdi mdi-plus",autowidth:!0,value:!0,click:function(){gantt.ext.zoom.zoomOut()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return e.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"combo-close",localId:"batch-plan",hidden:!0,labelWidth:100,options:[{id:1,value:"Швейка"},{id:8,value:"Крой"},{id:4,value:"Обивка"},{id:10,value:"Столярка"}],width:150,on:{onChange:function(e){t.showBatch(e)}}},{view:"checkbox",label:"Обивка",value:1,localId:"check-upholstery",labelPosition:"top"},{view:"checkbox",label:"Швейка",value:1,localId:"check-sewing",labelPosition:"top"},{view:"checkbox",label:"Крой",value:1,localId:"check-cut",labelPosition:"top"},{view:"checkbox",label:"Столярка",value:1,localId:"check-carpenter",labelPosition:"top"},{view:"combo-close",localId:"employee",width:150,options:{data:t.apiRest.getCollection("accounting/employees")}},{view:"select",localId:"toggle-plan",hidden:!1,value:4,labelWidth:100,options:[{id:1,value:"По дате шв.факт"},{id:2,value:"По дате шв.план"},{id:4,value:"По дате обивки факт"},{id:5,value:"По дате обивки план"},{id:8,value:"По дате крой факт"},{id:9,value:"По дате крой план"},{id:10,value:"По дате столярка факт"},{id:11,value:"По дате столярка план"}],width:150,on:{onChange:function(e){var i=t.$$("batch-plan");1!=e&&2!=e&&3!=e||i.setValue(1),4!=e&&5!=e||i.setValue(4),6!=e&&7!=e||i.setValue(6),8!=e&&9!=e||i.setValue(8),t.doPlanToggle(e)}}}]},{view:"treetable",css:"webix_header_border webix_data_border my_style",leftSplit:2,select:"row",resizeColumn:{headerOnly:!0},localId:"gant-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",tooltip:!0,clipboard:"selection",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:180,tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+m(e.value)+":00":e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"date",header:["# заказа",{content:"textFilter"},""],width:250,batch:10,template:function(e,t){return 1==e.$level?t.folder(e,t)+'<div style="font-weight:700;" >'+g(e.value)+"</div>":e.A+"- "+e.I},css:{color:"black","text-align":"left"}},{id:"fact",header:"Факт н.",width:120,batch:10,editor:"text"},{id:"fact1",header:"Факт к.",width:120,batch:10,editor:"text"},{id:"comment",header:"Коментарий",width:350,batch:10,editor:"text"},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,editor:"text"},{id:"H",header:["Дата кл.",{content:"textFilter"},""],width:70,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",batch:2},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",batch:2},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",template:function(e){return s(u(e.date_obivka))}},{id:"AA",header:["К.об.план",{content:"textFilter"},{content:"totalColumn"}],width:80,css:{"text-align":"right","font-weight":500}},{id:"CH",header:["К.шв.план",{content:"textFilter"},{content:"totalColumn"}],width:80,editor:"text",css:{"text-align":"right","font-weight":500},batch:1},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",batch:4},{id:"CI",header:["К.кр.план",{content:"textFilter"},{content:"totalColumn"}],width:80,editor:"text",css:{"text-align":"right","font-weight":500},batch:8},{id:"W",header:["Об.",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-marker-check"></i>':null===e.W?"":e.W}},{id:"BP",header:["Шв.",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":300},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check-circle"></i>':null===e.BP?"":e.BP}},{id:"BW",header:["Крой",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":300},template:function(e){return e.$group?"":1==e.BW?'<i class="mdi mdi-check-circle"></i>':null===e.BW?"":e.BW}},{id:"date_cut_plan_end",header:["Дата кр.план оконч.",{content:"selectFilter"},""],width:145,editor:"date",hidden:!1,css:{"text-align":"center"},template:function(e){return e.$group?"":c(h(e.date_cut_plan_end))}},{id:"time_upholstery_plan",header:["Вр.об.план",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{"text-align":"right","font-weight":500},batch:4},{id:"time_upholstery_fact",header:["Вр.об.факт",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{"text-align":"right",color:"green","font-weight":500},batch:4},{id:"date_upholstery_plan",header:["Дата об.план старт",{content:"selectFilter"},""],width:140,editor:"date",batch:4,hidden:!1,css:{"text-align":"center"},template:function(e){return c(h(e.date_upholstery_plan))}},{id:"time_upholstery_start",header:["Дата об.факт старт",{content:"selectFilter"},""],width:140,editor:"date",batch:4,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return c(h(e.time_upholstery_start))}},{id:"date_upholstery_plan_end",header:["Дата об.план оконч.",{content:"selectFilter"},""],width:140,editor:"date",batch:4,css:{"text-align":"center","font-weight":500},hidden:!1,template:function(e){return c(h(e.date_upholstery_plan_end))}},{id:"time_upholstery_end",header:["Дата об.факт окон.",{content:"selectFilter"},""],width:140,editor:"date",batch:4,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return c(h(e.time_upholstery_end))}},{id:"time_sewing",header:["Вр.шв.план,ч",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{"text-align":"center","font-weight":500},batch:1},{id:"time_sewing_fact",header:["Вр.шв.факт,ч",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{color:"green","text-align":"center","font-weight":500},batch:1},{id:"date_sewing_plan",header:["Дата Шв.план старт",{content:"selectFilter"},""],width:140,editor:"date",batch:1,hidden:!1,css:{"text-align":"center"},template:function(e){return c(h(e.date_sewing_plan))}},{id:"date_sewing_plan_end",header:["Дата Шв.план оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:1,hidden:!1,css:{"text-align":"center"},template:function(e){return e.$group?"":c(h(e.date_sewing_plan_end))}},{id:"BT",header:["Дата Шв.факт старт",{content:"selectFilter"},""],width:140,editor:"date",batch:1,hidden:!1,css:{color:"green","text-align":"center","font-weight":500},template:function(e){return c(h(e.BT))}},{id:"date_sewing",header:["Дата Шв.факт оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:1,hidden:!1,css:{color:"green","text-align":"center","font-weight":500},template:function(e){return c(h(e.date_sewing))}},{id:"BO",header:["ФИО шв.",{content:"selectFilter"},{content:"mySummColumn"}],width:115,batch:1,editor:"text"},{id:"coef_sewing",header:["Коэф.шв.факт",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"time_cut_plan",header:["Время.кр.план,ч",{content:"textFilter"},{content:"totalColumn"}],width:125,editor:"text",css:{"text-align":"right","font-weight":500},batch:8},{id:"time_cut_fact",header:["Время.кр.факт,ч",{content:"textFilter"},{content:"totalColumn"}],width:125,editor:"text",css:{"text-align":"right",color:"green","font-weight":500},batch:8},{id:"date_cut_plan",header:["Дата кр.план старт",{content:"selectFilter"},""],width:140,editor:"date",batch:8,hidden:!1,css:{"text-align":"center"},template:function(e){return c(h(e.date_cut_plan))}},{id:"BZ",header:["Дата кр.факт старт",{content:"selectFilter"},""],width:140,editor:"date",batch:8,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return c(h(e.BZ))}},{id:"date_cut",header:["Дата кр.факт оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:8,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return c(h(e.date_cut))}},{id:"BV",header:["ФИО крой.",{content:"selectFilter"},{content:"mySummColumn"}],width:115,batch:8,editor:"text"},{id:"desc_cut",header:["Причина",{content:"selectFilter"},""],width:150,editor:"popup",batch:8},{id:"loss_cut",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:8,editor:"text"},{id:"time_loss_cut",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:8,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"K",header:["Дата ткани",{content:"textFilter"},""],width:90,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"CA",header:["Время Крой",{content:"selectFilter"},""],width:110,editor:"date",template:function(e){return c(h(e.CA))}},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check-circle"></i>':null===e.BA?"":e.BA}},{id:"desc_sewing",header:["Причина",{content:"selectFilter"},""],width:150,editor:"popup",batch:1},{id:"loss_sewing",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"time_loss_sewing",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text"},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},""],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"date_carpenter",header:["Дата стол.",{content:"selectFilter"},""],width:120,batch:6,editor:"date",template:function(e){return c(h(e.date_carpenter))}},{id:"date_carpenter_plan",header:["Дата стол.план",{content:"selectFilter"},""],width:120,batch:6,editor:"date",template:function(e){return c(h(e.date_carpenter_plan))}},{id:"date_sawcut",header:["Дата расп.факт",{content:"selectFilter"},""],width:120,batch:6,editor:"date",template:function(e){return c(h(e.date_sawcut))}},{id:"date_sawcut_plan",header:["Дата расп.план",{content:"selectFilter"},""],width:120,batch:6,editor:"date",template:function(e){return c(h(e.date_sawcut_plan))}},{id:"status_sawcut",header:["Расп.",{content:"selectFilter"},""],width:60,batch:6,editor:"text",css:{color:"green","text-align":"center","font-weight":600},template:function(e){return e.$group?"":1==e.status_sawcut?'<i class="mdi mdi-check-circle"></i>':null===e.status_sawcut?"":e.status_sawcut}},{id:"time_sawcut_start",header:["Время нач.",{content:"selectFilter"},""],width:120,batch:6,editor:"text",template:function(e){return c(h(e.time_sawcut_start))}},{id:"time_sawcut_end",header:["Время оконч.",{content:"selectFilter"},""],width:120,batch:6,editor:"text",template:function(e){return c(h(e.time_sawcut_end))}},{id:"desc_sawcut",header:["Причина",{content:"selectFilter"},""],width:150,editor:"popup",batch:6},{id:"loss_sawcut",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:6,editor:"text"},{id:"time_loss_sawcut",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:6,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:"Столярка",width:115,batch:3,editor:"text"},{id:"BB",header:"Дата",width:90,batch:3,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)}}},{type:"space",rows:[{id:"dhx-gantt",template:function(){return'<div id="dhx-gantt" style="height:100%;"></div>'}}]}]}},f.addGanttChart=function(e){var t,i=gantt.date.date_to_str("%H"),o={levels:[[{unit:"day",format:"%d %M",step:1},{unit:"hour",format:(t=3,function(e){var o=new Date(gantt.date.add(e,t,"hour")-1);return i(e)+"-"+i(o)}),step:3}],[{unit:"day",format:"%d %M",step:1},{unit:"hour",format:"%H",step:1}]]};gantt.config.duration_unit="minute",gantt.config.round_dnd_dates=!0,gantt.setWorkTime({hours:["8:00-12:00","13:00-17:00"]}),gantt.config.start_date=new Date,gantt.config.work_time=!0,gantt.config.skip_off_time=!0,gantt.config.row_height=30,gantt.ignore_time=function(e){if(!gantt.isWorkTime(e))return!0},gantt.templates.scale_cell_class=function(e){return 0==e.getDay()||6==e.getDay()?"weekend":gantt.isWorkTime(e)?void 0:"weekend"},gantt.templates.timeline_cell_class=function(e,t){return 0==t.getDay()||6==t.getDay()?"weekend":gantt.isWorkTime(t)?void 0:"weekend"};var a=gantt.ext.formatters.durationFormatter({enter:"day",store:"minute",format:"day",hoursPerDay:8,hoursPerWeek:40,daysPerMonth:30});gantt.config.columns=[{name:"text",tree:!0,width:320,resize:!0},{name:"start_date",width:100,align:"center",resize:!0,template:function(e){return c(e.start_date)}},{name:"duration",label:"Duration",resize:!0,align:"center",template:function(e){return a.format(e.duration)},width:70}],gantt.config.lightbox.sections=[{name:"description",height:38,map_to:"text",type:"textarea",focus:!0},{name:"time",type:"duration",map_to:"auto",time_format:["%d","%m","%Y","%H:%i"]}],gantt.templates.time_picker=function(e){return gantt.date.date_to_str(gantt.config.time_picker)(e)},gantt.clearAll(),gantt.ext.zoom.init(o),gantt.init("dhx-gantt"),gantt.parse(e)},f.getDataGantt=function(e){var t=this.$$("check-upholstery").getValue(),i=this.$$("check-sewing").getValue(),o=this.$$("check-cut").getValue(),c=this.$$("check-carpenter").getValue(),d={data:[],links:[]},u=this.getSortFieldByTypeGroup(),h=this,p="",m="",g="",f="",w=this.getFieldsTime(u);return e.forEach((function(e,b,_){if(null!=e[u]){r(e[u]),e.BO;m=s(e[u]);var v=r(e[u])+" 08:00";f=a(e[u]),"AE"==u&&(m=s(l(e[u])),f=n(l(e[u]))+" 8:00",v=n(l(e[u]))+" 08:00"),g=e.A,m=w.fio+"_"+e[w.fio],m,d.data.push(h.getItemGroup(u,e,v,480,b,0,"#625E93")),p=g,d.data.push(h.getItemModel(u,e,f,480,b,m,"#625E93")),"date_upholstery_plan"!=u&&"date_sewing_plan"!=u&&"date_carpenter_plan"!=u&&"date_cut_plan"!=u||(t&&d.data.push(h.getItem("date_upholstery_plan",e,b,p,"#d33daf")),i&&d.data.push(h.getItem("date_sewing_plan",e,b,p,"#65c16f")),o&&d.data.push(h.getItem("date_cut_plan",e,b,p,"#3db9d3")),c&&d.data.push(h.getItem("date_carpenter_plan",e,b,p,"yellow"))),"AE"!=u&&"date_sewing"!=u&&"date_carpenter"!=u&&"date_cut"!=u||(t&&d.data.push(h.getItem("AE",e,b,p,"#d33daf")),i&&d.data.push(h.getItem("date_sewing",e,b,p,"#65c16f")),o&&d.data.push(h.getItem("date_cut",e,b,p,"#3db9d3")),c&&d.data.push(h.getItem("date_carpenter",e,b,p,"yellow")))}})),d},f.getId=function(e){return e.A+"-"+e.id+"-"},f.getFieldsTime=function(e){return{date_carpenter:{start:"BC",end:"BD",time:"time_carpenter_fact",name:"Столярка факт",fio:"AZ",plan:"date_carpenter_plan",status:"BA"},date_carpenter_plan:{start:"date_carpenter_plan",end:"date_carpenter_plan_end",time:"time_carpenter_plan",name:"Столярка план",fio:"AZ",fact:"date_carpenter",status:"BA"},date_sewing:{start:"BT",end:"BU",time:"time_sewing_fact",name:"Швека факт",fio:"BO",plan:"date_sewing_plan",status:"BP"},date_sewing_plan:{start:"date_sewing_plan",end:"date_sewing_plan_end",time:"time_sewing",name:"Швека план",fio:"BO",fact:"date_sewing",status:"BP"},date_cut:{start:"BZ",end:"CA",time:"time_cut_fact",name:"Крой факт",fio:"BV",plan:"date_cut_plan",status:"BW"},date_cut_plan:{start:"date_cut_plan",end:"date_cut_plan_end",time:"time_cut_plan",name:"Крой план",fio:"BV",fact:"date_cut",status:"BW"},date_upholstery_plan:{start:"date_upholstery_plan",end:"date_upholstery_plan_end",time:"time_upholstery_plan",name:"Обивка план",fio:"Z",fact:"AE",status:"W"},AE:{start:"time_upholstery_start",end:"time_upholstery_end",time:"time_upholstery_fact",name:"Обивка факт",fio:"Z",plan:"date_upholstery_plan",status:"W"},date_obivka:{start:"date_obivka",end:"date_upholstery_plan_end",time:"time_upholstery_plan",name:"Обивка Excel",fio:"Z",plan:"date_upholstery_plan",status:"W"},date_cloth:{start:"C",end:"K",time:"",name:"Заказ ткани",fio:""}}[e]},f.getItemDay=function(e,t,i,o){return{id:e,text:e,start_date:t,duration:i,order:10,progress:0,open:!0}},f.getItemGroup=function(e,t,i,o,a,r,n){var l=this.getFieldsTime(e);return{id:l.fio+"_"+t[l.fio],text:t[l.fio],start_date:i,order:10,duration:o,progress:0,open:!0,color:n}},f.getItemModel=function(e,t,i,o,r,n,l){var s=this.getFieldsTime(e);i=a(t[s.start]);var c=a(t[s.end]);return{id:t.A,text:t.A+" "+t.I+"("+t[s.status]+")",start_date:i,end_date:c,order:10,progress:0,open:!0,color:l,parent:n,render:"split"}},f.getItem=function(e,t,i,o,r){var s=this.getFieldsTime(e),c=null,d=a(t[s.start]),u=a(t[s.end]),h=0,p=s.name;if(t.A,void 0!==s.plan&&null!==s.plan){var m=this.getFieldsTime(s.plan);d?h=.3:(d=a(t[e]),"AE"==e&&(d=n(l(t[e]))+" 8:00")),u||(c=Math.round(60*parseFloat(t[m.time].replace(",","."))))}if(1==t[s.status]&&(h=1),void 0!==s.fact&&null!==s.fact){var g=this.getFieldsTime(s.fact),f=a(t[g.start]),w=a(t[g.end]);p=g.name,f&&(d=f,w?(u=w,h=1):(c=Math.round(60*parseFloat(t[s.time].replace(",","."))),h=.3))}var b={id:this.getId(t)+e,text:p+"("+t[s.status]+") ("+t[s.fio]+")",start_date:d,order:10,progress:h,parent:o,color:r,db_id:t.id};return c?b.duration=c:b.end_date=u,b},f.getItemCloth=function(e,t,i,o,r){var n=this.getFieldsTime(e),s=1440;"есть на складе"==t.M&&(s=480);var c=a(l(t.C));return{id:this.getId(t)+e,text:t.M+": Дата:"+n.K,start_date:c,duration:s,order:10,progress:0,parent:o,color:r}},f.init=function(e){var t=this.$$("gant-table"),i=this.$$("batch-plan"),o=this.$$("employee");this.batchIndex=0,t.hide(),gantt.attachEvent("onLightboxSave",(function(e,t){var i=e.split("-"),o={};if("date_sewing"!=i[2]&&"date_cut"!=i[2]&&"AE"!=i[2]&&"date_obivka"!=i[2]&&"date_carpenter"!=i[2]){o[i[2]]=d(t.start_date);var a=g.app.config.apiRest.getUrl("put","accounting/orders",{},t.db_id);return webix.ajax().put(a,o).then((function(e){webix.message("Данные сохранены!")})),!0}})),gantt.attachEvent("onAfterTaskDrag",(function(e,t,i){var o={};if(t==gantt.config.drag_mode.move){var a=gantt.getTask(e),r=e.split("-");if("date_sewing"==r[2]||"date_cut"==r[2]||"AE"==r[2]||"date_obivka"==r[2]||"date_carpenter"==r[2])return;o[r[2]]=d(a.start_date);var n=g.app.config.apiRest.getUrl("put","accounting/orders",{},a.db_id);webix.ajax().put(n,o).then((function(e){webix.message("Данные сохранены!")}))}}));var a=webix.Date.dateToStr("%d.%m.%y"),r=(webix.Date.dateToStr("%d.%m.%y %H:%i"),this.$$("dateFrom")),n=this.$$("dateTo"),l=a(this.$$("dateFrom").getValue()),c=a(this.$$("dateTo").getValue()),u=o.getText();webix.extend(t,webix.ProgressBar);var h=this.getFilterFieldByTypeGroup(),p=this.getSortFieldByTypeGroup(),m=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"'+p+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+h+'":{">=":"'+l+'","<=":"'+c+'"}}'}),g=this;webix.ajax().get(m).then((function(e){t.clearAll(),t.parse(e.json().items),g.doTableGroup();var i=g.getDataGantt(e.json().items);g.addGanttChart(i)})),i.attachEvent("onChange",(function(e,i){webix.ajax().get(m).then((function(i){t.clearAll(),t.parse(i.json().items),g.doTableGroup(),g.batchIndex=e;var o=g.getDataGantt(i.json().items);g.addGanttChart(o)}))})),t.attachEvent("onPaste",(function(e){var i=this;this.getSelectedId(!0).forEach((function(o){i.getItem(o.row)[o.column]=e,i.refresh(o.row),t.updateItem(o.row,i.getItem(o.row))}))})),t.attachEvent("onBeforeEditStop",(function(e,i,o){"date_sewing_plan"===i.column&&(t.getItem(i.row).date_sewing=e.value,t.refresh(i.row)),"date_sawcut_plan"===i.column&&(t.getItem(i.row).date_sawcut=e.value,t.refresh(i.row))})),r.attachEvent("onChange",(function(e){l=a(r.getValue()),c=a(n.getValue());var i=g.getFilterFieldByTypeGroup(),o=g.getSortFieldByTypeGroup(),s=g.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"'+o+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+i+'":{">=":"'+l+'","<=":"'+c+'"}}'});webix.ajax().get(s).then((function(e){t.clearAll(),t.parse(e.json().items),g.doTableGroup()}))})),n.attachEvent("onChange",(function(e){l=a(r.getValue()),c=s(n.getValue());var i=g.getFilterFieldByTypeGroup(),o=g.getSortFieldByTypeGroup(),d=g.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"'+o+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+i+'":{">=":"'+l+'","<=":"'+c+'"}}'});webix.ajax().get(d).then((function(e){t.clearAll(),t.parse(e.json().items),g.doTableGroup();var i=g.getDataGantt(e.json().items);g.addGanttChart(i)}))})),o.attachEvent("onChange",(function(e){l=a(r.getValue()),c=s(n.getValue());var i=(u=o.getText()).split(" ");u=i[0];var d=g.getFilterFieldByTypeGroup(),h=g.getSortFieldByTypeGroup(),p={filter:{}};p.filter[d]={">=":l,"<=":c};var m="Z";if(""!=u){var f=o.getPopup().getList().getItem(o.getValue());1==f.department_id&&(m="Z"),2==f.department_id&&(m="AZ"),3==f.department_id&&(m="BO"),p.filter[m]=u}var w=g.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"'+h+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]'});webix.ajax().get(w,p).then((function(e){t.clearAll(),t.parse(e.json().items),g.doTableGroup();var i=g.getDataGantt(e.json().items);g.addGanttChart(i)}))}))},f.doClickOpenAll=function(){var e=this.$$("gant-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},f.showBatch=function(e){this.$$("gant-table").showColumnBatch(e)},f.beforeDropChangeData=function(e,t){var i=this.$$("gant-table"),o=this.getSortFieldByTypeGroup();i.getSelectedId(!0).forEach((function(e){i.getItem(e.row)[o]=d(t),i.refresh(e.row),webix.message("Данные сохранены!"),i.updateItem(e.row,i.getItem(e.row))}))},f.doRefresh=function(){var e=this.$$("gant-table"),t=webix.Date.dateToStr("%d.%m.%y"),i=t(this.$$("dateFrom").getValue()),o=t(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;var a=this.getFilterFieldByTypeGroup(),r=this.getSortFieldByTypeGroup(),n=this.restApi.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"'+r+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+a+'":{">=":"'+i+'","<=":"'+o+'"}}'}),l=this;e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(n).then((function(t){e.clearAll(),l.doTableGroup();var i=l.getDataGantt(t.json().items);l.addGanttChart(i),e.enable()}))},f.doPlanToggle=function(e){var t=this.$$("gant-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=(this.$$("dateFrom"),this.$$("dateTo"),i(this.$$("dateFrom").getValue())),a=i(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;var r=this;t.disable(),t.showProgress({type:"icon",hide:!1});var n=this.getFilterFieldByTypeGroup(),l=this.getSortFieldByTypeGroup(),s=this.restApi.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"'+l+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+n+'":{">=":"'+o+'","<=":"'+a+'"}}'});this.restApi.getLoad(s).then((function(e){t.clearAll(),t.parse(e.json().items),r.doTableGroup();var i=r.getDataGantt(e.json().items);r.addGanttChart(i),t.enable()}))},f.getFilterFieldByTypeGroup=function(){var e=this.$$("toggle-plan"),t="AE";return 1==e.getValue()&&(t="date_sewing"),2==e.getValue()&&(t="date_sewing_plan"),3==e.getValue()&&(t="date_sewing_plan"),4==e.getValue()&&(t="AE"),5==e.getValue()&&(t="date_upholstery_plan"),6==e.getValue()&&(t="date_sawcut"),7==e.getValue()&&(t="date_sawcut_plan"),8==e.getValue()&&(t="date_cut"),9==e.getValue()&&(t="date_cut_plan"),10==e.getValue()&&(t="date_carpenter"),11==e.getValue()&&(t="date_carpenter_plan"),t},f.getSortFieldByTypeGroup=function(){var e=this.$$("toggle-plan"),t="date_sewing";return 1==e.getValue()&&(t="date_sewing"),2==e.getValue()&&(t="date_sewing_plan"),3==e.getValue()&&(t="date_sewing_plan"),4==e.getValue()&&(t="AE"),5==e.getValue()&&(t="date_upholstery_plan"),6==e.getValue()&&(t="date_sawcut"),7==e.getValue()&&(t="date_sawcut_plan"),8==e.getValue()&&(t="date_cut"),9==e.getValue()&&(t="date_cut_plan"),10==e.getValue()&&(t="date_carpenter"),11==e.getValue()&&(t="date_carpenter_plan"),t},f.doTableGroup=function(){var e=this.$$("toggle-plan"),t=this.$$("gant-table"),i={},o={G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CH:["CH","median"],CI:["CI","median"],time_cut_plan:["time_cut_plan","median"],coef_sewing:["coef_sewing","median"],time_sewing:["time_sewing","median"],date_sewing_plan_end:["date_sewing_plan_end","median"],time_sewing_fact:["time_sewing_fact","median"],BO:["BO","countSame"],missing:!1};this.showBatch(1),1==e.getValue()&&(i=function(e){return p(e.date_sewing)},o.value=[function(e){return p(e.date_sewing)}],t.group({by:i,map:o})),2==e.getValue()&&(i=function(e){return p(e.date_sewing_plan)},o.value=[function(e){return p(e.date_sewing_plan)}],t.group({by:i,map:o})),3==e.getValue()&&(i=function(e){return webix.Date.add(p(e.date_sewing_plan_end),1,"hour",!0)},o.value=[function(e){return webix.Date.add(p(e.date_sewing_plan_end),1,"hour",!0)}],t.group({by:i,map:o}),t.sort("value","asc","date")),4==e.getValue()&&(this.showBatch(4),i=function(e){return e.date_obivka},o.value=[function(e){return e.date_obivka}],t.group({by:i,map:o})),5==e.getValue()&&(this.showBatch(4),i=function(e){return p(e.date_upholstery_plan)},o.value=[function(e){return p(e.date_upholstery_plan)}],t.group({by:i,map:o})),6==e.getValue()&&(this.showBatch(6),i=function(e){return p(e.date_sawcut)},o.value=[function(e){return p(e.date_sawcut)}],t.group({by:i,map:o})),7==e.getValue()&&(this.showBatch(6),i=function(e){return p(e.date_sawcut_plan)},o.value=[function(e){return p(e.date_sawcut_plan)}],t.group({by:i,map:o})),8==e.getValue()&&(this.showBatch(8),i=function(e){return p(e.date_cut)},o.value=[function(e){return p(e.date_cut)}],t.group({by:i,map:o})),9==e.getValue()&&(this.showBatch(8),i=function(e){return p(e.date_cut_plan)},o.value=[function(e){return p(e.date_cut_plan)}],t.group({by:i,map:o})),10==e.getValue()&&(this.showBatch(8),i=function(e){return p(e.date_carpenter)},o.value=[function(e){return p(e.date_carpenter)}],t.group({by:i,map:o})),11==e.getValue()&&(this.showBatch(8),i=function(e){return p(e.date_carpenter_plan)},o.value=[function(e){return p(e.date_carpenter_plan)}],t.group({by:i,map:o}))},f.doClickPrint=function(){var e=this.$$("gant-table");e.showColumnBatch(10),e.hideColumn("A"),webix.print(e,{fit:"data"}),e.showColumnBatch(1),e.showColumn("A")},f.toggleColumn=function(e,t){e.hideColumn(t)},f.doClickToExcel=function(){var e=this.$$("gant-table");e.showColumnBatch(10),e.hideColumn("A"),webix.toExcel(e),e.showColumnBatch(1),e.showColumn("A")},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return g}));var o=i(0);i(2);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countSame=function(e,t){if(!t.length)return 0;for(var i={},o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&null!=a&&(i[a]=a)}return webix.i18n.numberFormat(Object.keys(i).length,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:250,height:100}}},webix.Date.oneDayEnd=function(e){return e=webix.Date.add(e,1,"day"),e=webix.Date.add(e,-1,"minute")},webix.ui.datafilter.mySummColumn=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.rank&&(o+=e.fee)})),t.innerHTML=o}},webix.ui.datafilter.summColumn);var a=webix.Date.dateToStr("%d-%m-%Y %H:%i"),r=webix.Date.dateToStr("%d-%m-%Y"),n=(webix.Date.dateToStr("%d-%m-%Y"),webix.Date.strToDate("%d.%m.%y")),l=webix.Date.dateToStr("%d.%m.%y"),s=webix.Date.dateToStr("%d.%m.%y %H:%i"),c=webix.Date.dateToStr("%Y-%m-%d %H:%i"),d=webix.Date.strToDate("%Y-%m-%d"),u=webix.Date.strToDate("%Y-%m-%d %H:%i"),h=webix.Date.strToDate("%Y-%m-%d %H"),p=(webix.Date.strToDate("%d-%m-%Y %H:%i"),webix.Date.dateToStr("%d.%m.%y %H")),m=webix.Date.dateToStr("%H:%i"),g=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var g=o.prototype;return g.config=function(){var e=this,t=this;return this.apiRest=this.app.config.apiRest,{rows:[{cols:[{view:"label",width:200,height:30,template:"Диаграмма Ганта",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:new Date},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.oneDayEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-eye",autowidth:!0,value:!0,click:function(){gantt.config.show_grid=!gantt.config.show_grid,gantt.render()}},{view:"icon",icon:"mdi mdi-minus",autowidth:!0,value:!0,click:function(){gantt.ext.zoom.zoomIn()}},{view:"icon",icon:"mdi mdi-plus",autowidth:!0,value:!0,click:function(){gantt.ext.zoom.zoomOut()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"icon",icon:"mdi mdi-delete",autowidth:!0,click:function(){return e.doClickClearPlan()}},{view:"icon",icon:"mdi mdi-calculator",autowidth:!0,click:function(){return e.doClickCalculator()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return e.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"combo-close",localId:"batch-plan",hidden:!0,labelWidth:100,options:[{id:1,value:"Швейка"},{id:8,value:"Крой"},{id:4,value:"Обивка"},{id:10,value:"Столярка"}],width:150,on:{onChange:function(e){t.showBatch(e)}}},{view:"checkbox",label:"Обивка",value:1,localId:"check-upholstery",labelPosition:"top"},{view:"checkbox",label:"Швейка",value:1,localId:"check-sewing",labelPosition:"top"},{view:"checkbox",label:"Крой",value:1,localId:"check-cut",labelPosition:"top"},{view:"checkbox",label:"Столярка",value:1,localId:"check-carpenter",labelPosition:"top"},{view:"combo-close",localId:"employee",width:150,options:{data:t.apiRest.getCollection("accounting/employees")}},{view:"select",localId:"toggle-plan",hidden:!1,value:4,labelWidth:100,options:[{id:1,value:"По дате шв.план"},{id:4,value:"По дате обивки план"},{id:8,value:"По дате крой план"},{id:10,value:"По дате столярка план"}],width:150,on:{onChange:function(e){t.$$("batch-plan");t.doPlanToggle(e)}}}]},{view:"treetable",css:"webix_header_border webix_data_border my_style",leftSplit:2,select:"row",resizeColumn:{headerOnly:!0},localId:"gant-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",tooltip:!0,clipboard:"selection",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:180,tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+p(e.value)+":00":e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"date",header:["# заказа",{content:"textFilter"},""],width:250,batch:10,template:function(e,t){return 1==e.$level?t.folder(e,t)+'<div style="font-weight:700;" >'+m(e.value)+"</div>":e.A+"- "+e.I},css:{color:"black","text-align":"left"}},{id:"fact",header:"Факт н.",width:120,batch:10,editor:"text"},{id:"fact1",header:"Факт к.",width:120,batch:10,editor:"text"},{id:"comment",header:"Коментарий",width:350,batch:10,editor:"text"},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,editor:"text"},{id:"H",header:["Дата кл.",{content:"textFilter"},""],width:70,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",batch:2},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",batch:2},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",template:function(e){return l(d(e.date_obivka))}},{id:"AA",header:["К.об.план",{content:"textFilter"},{content:"totalColumn"}],width:80,css:{"text-align":"right","font-weight":500}},{id:"CH",header:["К.шв.план",{content:"textFilter"},{content:"totalColumn"}],width:80,editor:"text",css:{"text-align":"right","font-weight":500},batch:1},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",batch:4},{id:"CI",header:["К.кр.план",{content:"textFilter"},{content:"totalColumn"}],width:80,editor:"text",css:{"text-align":"right","font-weight":500},batch:8},{id:"W",header:["Об.",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-marker-check"></i>':null===e.W?"":e.W}},{id:"BP",header:["Шв.",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":300},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check-circle"></i>':null===e.BP?"":e.BP}},{id:"BW",header:["Крой",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":300},template:function(e){return e.$group?"":1==e.BW?'<i class="mdi mdi-check-circle"></i>':null===e.BW?"":e.BW}},{id:"date_cut_plan_end",header:["Дата кр.план оконч.",{content:"selectFilter"},""],width:145,editor:"date",hidden:!1,css:{"text-align":"center"},template:function(e){return e.$group?"":s(u(e.date_cut_plan_end))}},{id:"time_upholstery_plan",header:["Вр.об.план",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{"text-align":"right","font-weight":500},batch:4},{id:"time_upholstery_fact",header:["Вр.об.факт",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{"text-align":"right",color:"green","font-weight":500},batch:4},{id:"date_upholstery_plan",header:["Дата об.план старт",{content:"selectFilter"},""],width:140,editor:"date",batch:4,hidden:!1,css:{"text-align":"center"},template:function(e){return s(u(e.date_upholstery_plan))}},{id:"time_upholstery_start",header:["Дата об.факт старт",{content:"selectFilter"},""],width:140,editor:"date",batch:4,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return s(u(e.time_upholstery_start))}},{id:"date_upholstery_plan_end",header:["Дата об.план оконч.",{content:"selectFilter"},""],width:140,editor:"date",batch:4,css:{"text-align":"center","font-weight":500},hidden:!1,template:function(e){return s(u(e.date_upholstery_plan_end))}},{id:"time_upholstery_end",header:["Дата об.факт окон.",{content:"selectFilter"},""],width:140,editor:"date",batch:4,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return s(u(e.time_upholstery_end))}},{id:"time_sewing",header:["Вр.шв.план,ч",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{"text-align":"center","font-weight":500},batch:1},{id:"time_sewing_fact",header:["Вр.шв.факт,ч",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{color:"green","text-align":"center","font-weight":500},batch:1},{id:"date_sewing_plan",header:["Дата Шв.план старт",{content:"selectFilter"},""],width:140,editor:"date",batch:1,hidden:!1,css:{"text-align":"center"},template:function(e){return s(u(e.date_sewing_plan))}},{id:"date_sewing_plan_end",header:["Дата Шв.план оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:1,hidden:!1,css:{"text-align":"center"},template:function(e){return e.$group?"":s(u(e.date_sewing_plan_end))}},{id:"BT",header:["Дата Шв.факт старт",{content:"selectFilter"},""],width:140,editor:"date",batch:1,hidden:!1,css:{color:"green","text-align":"center","font-weight":500},template:function(e){return s(u(e.BT))}},{id:"date_sewing",header:["Дата Шв.факт оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:1,hidden:!1,css:{color:"green","text-align":"center","font-weight":500},template:function(e){return s(u(e.date_sewing))}},{id:"BO",header:["ФИО шв.",{content:"selectFilter"},{content:"mySummColumn"}],width:115,batch:1,editor:"text"},{id:"coef_sewing",header:["Коэф.шв.факт",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"time_cut_plan",header:["Время.кр.план,ч",{content:"textFilter"},{content:"totalColumn"}],width:125,editor:"text",css:{"text-align":"right","font-weight":500},batch:8},{id:"time_cut_fact",header:["Время.кр.факт,ч",{content:"textFilter"},{content:"totalColumn"}],width:125,editor:"text",css:{"text-align":"right",color:"green","font-weight":500},batch:8},{id:"date_cut_plan",header:["Дата кр.план старт",{content:"selectFilter"},""],width:140,editor:"date",batch:8,hidden:!1,css:{"text-align":"center"},template:function(e){return s(u(e.date_cut_plan))}},{id:"BZ",header:["Дата кр.факт старт",{content:"selectFilter"},""],width:140,editor:"date",batch:8,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return s(u(e.BZ))}},{id:"date_cut",header:["Дата кр.факт оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:8,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return s(u(e.date_cut))}},{id:"BV",header:["ФИО крой.",{content:"selectFilter"},{content:"mySummColumn"}],width:115,batch:8,editor:"text"},{id:"desc_cut",header:["Причина",{content:"selectFilter"},""],width:150,editor:"popup",batch:8},{id:"loss_cut",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:8,editor:"text"},{id:"time_loss_cut",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:8,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"K",header:["Дата ткани",{content:"textFilter"},""],width:90,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"CA",header:["Время Крой",{content:"selectFilter"},""],width:110,editor:"date",template:function(e){return s(u(e.CA))}},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check-circle"></i>':null===e.BA?"":e.BA}},{id:"desc_sewing",header:["Причина",{content:"selectFilter"},""],width:150,editor:"popup",batch:1},{id:"loss_sewing",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"time_loss_sewing",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text"},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},""],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"date_carpenter",header:["Дата стол.",{content:"selectFilter"},""],width:120,batch:6,editor:"date",template:function(e){return s(u(e.date_carpenter))}},{id:"date_carpenter_plan",header:["Дата стол.план",{content:"selectFilter"},""],width:120,batch:6,editor:"date",template:function(e){return s(u(e.date_carpenter_plan))}},{id:"date_sawcut",header:["Дата расп.факт",{content:"selectFilter"},""],width:120,batch:6,editor:"date",template:function(e){return s(u(e.date_sawcut))}},{id:"date_sawcut_plan",header:["Дата расп.план",{content:"selectFilter"},""],width:120,batch:6,editor:"date",template:function(e){return s(u(e.date_sawcut_plan))}},{id:"status_sawcut",header:["Расп.",{content:"selectFilter"},""],width:60,batch:6,editor:"text",css:{color:"green","text-align":"center","font-weight":600},template:function(e){return e.$group?"":1==e.status_sawcut?'<i class="mdi mdi-check-circle"></i>':null===e.status_sawcut?"":e.status_sawcut}},{id:"time_sawcut_start",header:["Время нач.",{content:"selectFilter"},""],width:120,batch:6,editor:"text",template:function(e){return s(u(e.time_sawcut_start))}},{id:"time_sawcut_end",header:["Время оконч.",{content:"selectFilter"},""],width:120,batch:6,editor:"text",template:function(e){return s(u(e.time_sawcut_end))}},{id:"desc_sawcut",header:["Причина",{content:"selectFilter"},""],width:150,editor:"popup",batch:6},{id:"loss_sawcut",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:6,editor:"text"},{id:"time_loss_sawcut",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:6,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:"Столярка",width:115,batch:3,editor:"text"},{id:"BB",header:"Дата",width:90,batch:3,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)}}},{type:"space",rows:[{id:"dhx-gantt",template:function(){return'<div id="dhx-gantt" style="height:100%;"></div>'}}]}]}},g.addGanttChart=function(e){var t,i=gantt.date.date_to_str("%H"),o={levels:[[{unit:"day",format:"%d %M",step:1},{unit:"hour",format:(t=3,function(e){var o=new Date(gantt.date.add(e,t,"hour")-1);return i(e)+"-"+i(o)}),step:3}],[{unit:"day",format:"%d %M",step:1},{unit:"hour",format:"%H",step:1}]]};gantt.config.duration_unit="minute",gantt.config.round_dnd_dates=!0,gantt.setWorkTime({hours:["8:00-12:00","13:00-17:00"]}),gantt.config.start_date=new Date,gantt.config.work_time=!0,gantt.config.skip_off_time=!0,gantt.config.row_height=30,gantt.ignore_time=function(e){if(!gantt.isWorkTime(e))return!0},gantt.templates.scale_cell_class=function(e){return 0==e.getDay()||6==e.getDay()?"weekend":gantt.isWorkTime(e)?void 0:"weekend"},gantt.templates.timeline_cell_class=function(e,t){return 0==t.getDay()||6==t.getDay()?"weekend":gantt.isWorkTime(t)?void 0:"weekend"};gantt.ext.formatters.durationFormatter({enter:"day",store:"minute",format:"day",hoursPerDay:8,hoursPerWeek:40,daysPerMonth:30});gantt.config.columns=[{name:"text",tree:!0,width:320,resize:!0}],gantt.config.lightbox.sections=[{name:"description",height:38,map_to:"text",type:"textarea",focus:!0},{name:"time",type:"duration",map_to:"auto",time_format:["%d","%m","%Y","%H:%i"]}],gantt.templates.time_picker=function(e){return gantt.date.date_to_str(gantt.config.time_picker)(e)},gantt.clearAll(),gantt.ext.zoom.init(o),gantt.init("dhx-gantt"),gantt.parse(e)},g.getDataGantt=function(e){var t=this.$$("check-upholstery").getValue(),i=this.$$("check-sewing").getValue(),o=this.$$("check-cut").getValue(),n=this.$$("check-carpenter").getValue(),s={data:[],links:[]},c=this.getSortFieldByTypeGroup(),d=this,u="",h="",p="",m="",g=this.getFieldsTime(c);return e.forEach((function(e,f,w){if(null!=e[c]){r(e[c]),e.BO;h=l(e[c]);var b=r(e[c])+" 08:00";m=a(e[c]),p=e.product_order_id,h=g.fio+"_"+e[g.fio],h,s.data.push(d.getItemGroup(c,e,b,480,f,0,"#625E93")),u=p,s.data.push(d.getItemModel(c,e,m,480,f,h,"#625E93")),t&&s.data.push(d.getItem("date_upholstery",e,f,u,"#d33daf")),i&&s.data.push(d.getItem("date_sewing",e,f,u,"#65c16f")),o&&s.data.push(d.getItem("date_cut",e,f,u,"#3db9d3")),n&&s.data.push(d.getItem("date_carpenter",e,f,u,"yellow"))}})),s},g.getId=function(e){return e.product_order_id+"-"+e.id+"-"},g.getFieldsTime=function(e){return{date_carpenter:{start:"date_carpenter",end:"BD",time:"time_carpenter",name:"Столярка план",fio:"carpenter_employee",plan:"date_carpenter_plan",status:"status_carpenter"},date_sewing:{start:"date_sewing",end:"BU",time:"time_sewing",name:"Швека план",fio:"sewing_employee",status:"status_sewing"},date_cut:{start:"date_cut",end:"CA",time:"time_cut",name:"Крой план",fio:"cut_employee",plan:"date_cut_plan",status:"status_cut"},date_upholstery:{start:"date_upholstery",end:"date_upholstery_plan_end",time:"time_upholstery",name:"Обивка план",fio:"upholstery_employee",status:"status_upholstery"},date_first_plan:{start:"date_first_plan",end:"date_upholstery_plan_end",time:"time_upholstery",name:"Обивка excel",fio:"upholstery_employee",status:"status_upholstery"}}[e]},g.getItemDay=function(e,t,i,o){return{id:e,text:e,start_date:t,duration:i,order:10,progress:0,open:!0}},g.getItemGroup=function(e,t,i,o,a,n,l){var s=this.getFieldsTime(e);return i=r(t[s.start])+" 08:00",{id:s.fio+"_"+t[s.fio],text:t[s.fio],start_date:i,order:10,duration:o,progress:0,open:!0,color:l}},g.getItemModel=function(e,t,i,o,r,n,l){var s=this.getFieldsTime(e);return i=a(t[s.start]),o=60*parseFloat(t[s.time].replace(",",".")),{id:t.product_order_id,text:t.product_order_id+" "+t.name+"("+t[s.status]+")",start_date:i,order:10,progress:0,open:!0,color:l,parent:n,duration:o}},g.getItem=function(e,t,i,o,r){var n=this.getFieldsTime(e),l=Math.round(60*parseFloat(t[n.time].replace(",","."))),s=a(t[n.start]),c=0,d="Ст:"+t.status_carpenter+" Кр:"+t.status_cut+" Шв:"+t.status_sewing+" Об:"+t.status_upholstery,u=n.name;1==t[n.status]&&(c=1);a(t[n.start]);u=n.name+" ("+d+")";var h={id:this.getId(t)+e,text:u+"("+t[n.status]+") ("+t[n.fio]+")",start_date:s,order:10,progress:c,parent:o,color:r,db_id:t.id};return l&&(h.duration=l),h},g.getItemCloth=function(e,t,i,o,r){var l=this.getFieldsTime(e),s=1440;"есть на складе"==t.M&&(s=480);var c=a(n(t.C));return{id:this.getId(t)+e,text:t.M+": Дата:"+l.K,start_date:c,duration:s,order:10,progress:0,parent:o,color:r}},g.getData=function(){this.$$("batch-plan");var e=this.$$("employee"),t=webix.Date.dateToStr("%Y-%m-%d"),i=(webix.Date.dateToStr("%d.%m.%y %H:%i"),this.$$("dateFrom"),this.$$("dateTo"),t(this.$$("dateFrom").getValue())),o=t(this.$$("dateTo").getValue()),a=(e.getText(),this.getFilterFieldByTypeGroup()),r=this.getSortFieldByTypeGroup(),n=this.app.config.apiRest.getUrl("get","accounting/produce-plans",{"per-page":"500",sort:'[{"property":"'+r+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+a+'":{">=":"'+i+'","<=":"'+o+'"}}'}),l=this;webix.ajax().get(n).then((function(e){l.doTableGroup();var t=l.getDataGantt(e.json().data);l.addGanttChart(t)}))},g.init=function(e){var t=this.$$("gant-table"),i=this.$$("batch-plan"),o=this.$$("employee");this.batchIndex=0,t.hide(),gantt.attachEvent("onLightboxSave",(function(e,t){var i=e.split("-"),o={};if("date_sewing"!=i[2]&&"date_cut"!=i[2]&&"AE"!=i[2]&&"date_obivka"!=i[2]&&"date_carpenter"!=i[2]){o[i[2]]=c(t.start_date);var a=h.app.config.apiRest.getUrl("put","accounting/orders",{},t.db_id);return webix.ajax().put(a,o).then((function(e){webix.message("Данные сохранены!")})),!0}})),gantt.attachEvent("onAfterTaskDrag",(function(e,t,i){var o={};if(t==gantt.config.drag_mode.move){var a=gantt.getTask(e);o[e.split("-")[2]]=c(a.start_date);var r=h.app.config.apiRest.getUrl("put","accounting/produce-plans",{},a.db_id);webix.ajax().put(r,o).then((function(e){webix.message("Данные сохранены!")}))}}));var a=webix.Date.dateToStr("%d.%m.%y"),r=(webix.Date.dateToStr("%d.%m.%y %H:%i"),this.$$("dateFrom")),n=this.$$("dateTo"),s=a(this.$$("dateFrom").getValue()),d=a(this.$$("dateTo").getValue()),u=o.getText();webix.extend(t,webix.ProgressBar);this.getFilterFieldByTypeGroup(),this.getSortFieldByTypeGroup();var h=this;this.getData(),i.attachEvent("onChange",(function(e,i){webix.ajax().get(tableUrl).then((function(i){t.clearAll(),t.parse(i.json().items),h.doTableGroup(),h.batchIndex=e;var o=h.getDataGantt(i.json().items);h.addGanttChart(o)}))})),t.attachEvent("onPaste",(function(e){var i=this;this.getSelectedId(!0).forEach((function(o){i.getItem(o.row)[o.column]=e,i.refresh(o.row),t.updateItem(o.row,i.getItem(o.row))}))})),t.attachEvent("onBeforeEditStop",(function(e,i,o){"date_sewing_plan"===i.column&&(t.getItem(i.row).date_sewing=e.value,t.refresh(i.row)),"date_sawcut_plan"===i.column&&(t.getItem(i.row).date_sawcut=e.value,t.refresh(i.row))})),r.attachEvent("onChange",(function(e){h.getData()})),n.attachEvent("onChange",(function(e){h.getData()})),o.attachEvent("onChange",(function(e){s=a(r.getValue()),d=l(n.getValue());var i=(u=o.getText()).split(" ");u=i[0];var c=h.getFilterFieldByTypeGroup(),p=h.getSortFieldByTypeGroup(),m={filter:{}};m.filter[c]={">=":s,"<=":d};var g="Z";if(""!=u){var f=o.getPopup().getList().getItem(o.getValue());1==f.department_id&&(g="Z"),2==f.department_id&&(g="AZ"),3==f.department_id&&(g="BO"),m.filter[g]=u}var w=h.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"'+p+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]'});webix.ajax().get(w,m).then((function(e){t.clearAll(),t.parse(e.json().items),h.doTableGroup();var i=h.getDataGantt(e.json().items);h.addGanttChart(i)}))}))},g.doClickOpenAll=function(){},g.showBatch=function(e){},g.beforeDropChangeData=function(e,t){var i=this.$$("gant-table"),o=this.getSortFieldByTypeGroup();i.getSelectedId(!0).forEach((function(e){i.getItem(e.row)[o]=c(t),i.refresh(e.row),webix.message("Данные сохранены!"),i.updateItem(e.row,i.getItem(e.row))}))},g.doRefresh=function(){this.getData()},g.doPlanToggle=function(e){this.getData()},g.getFilterFieldByTypeGroup=function(){var e=this.$$("toggle-plan"),t="AE";return 1==e.getValue()&&(t="date_sewing"),4==e.getValue()&&(t="date_upholstery"),5==e.getValue()&&(t="date_first_plan"),8==e.getValue()&&(t="date_cut"),10==e.getValue()&&(t="date_carpenter"),t},g.getSortFieldByTypeGroup=function(){var e=this.$$("toggle-plan"),t="date_sewing";return 1==e.getValue()&&(t="date_sewing"),4==e.getValue()&&(t="date_upholstery"),5==e.getValue()&&(t="date_ufirst_plan"),8==e.getValue()&&(t="date_cut"),10==e.getValue()&&(t="date_carpenter"),t},g.doTableGroup=function(){var e=this.$$("toggle-plan"),t=this.$$("gant-table"),i={},o={time_cut:["time_cut_plan","median"],time_sewing:["time_sewing","median"],missing:!1};this.showBatch(1),1==e.getValue()&&(i=function(e){return h(e.date_sewing)},o.value=[function(e){return h(e.date_sewing)}],t.group({by:i,map:o})),4==e.getValue()&&(this.showBatch(4),i=function(e){return e.date_upholstery},o.value=[function(e){return e.date_upholstery}],t.group({by:i,map:o})),5==e.getValue()&&(this.showBatch(4),i=function(e){return e.date_first_plan},o.value=[function(e){return e.date_first_plan}],t.group({by:i,map:o})),8==e.getValue()&&(this.showBatch(8),i=function(e){return h(e.date_cut)},o.value=[function(e){return h(e.date_cut)}],t.group({by:i,map:o})),10==e.getValue()&&(this.showBatch(8),i=function(e){return h(e.date_carpenter)},o.value=[function(e){return h(e.date_carpenter)}],t.group({by:i,map:o}))},g.doClickPrint=function(){var e=this.$$("gant-table");e.showColumnBatch(10),e.hideColumn("A"),webix.print(e,{fit:"data"}),e.showColumnBatch(1),e.showColumn("A")},g.toggleColumn=function(e,t){e.hideColumn(t)},g.doClickToExcel=function(){var e=this.$$("gant-table");e.showColumnBatch(10),e.hideColumn("A"),webix.toExcel(e),e.showColumnBatch(1),e.showColumn("A")},g.doClickCalculator=function(){this.$$("sewing-table");var e=webix.Date.dateToStr("%Y-%m-%d"),t=e(this.$$("dateFrom").getValue()),i=e(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;this.getFilterFieldByTypeGroup(),this.getSortFieldByTypeGroup();var o=this.restApi.getUrl("get","accounting/order/get-plan",{"per-page":"500",dateFrom:t,dateTo:i});this.restApi.getLoad(o).then((function(e){}))},g.doClickClearPlan=function(){this.$$("sewing-table");var e=webix.Date.dateToStr("%Y-%m-%d"),t=e(this.$$("dateFrom").getValue()),i=e(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;var o=this.restApi.getUrl("get","accounting/order/clear-plan",{dateFrom:t,dateTo:i});this.restApi.getLoad(o).then((function(e){}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0);i(2),i(4),i(3);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--){if(1==t[o].$level)""!=e(t[o])&&(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:250,height:100}}},webix.GroupMethods.mysum=function(e,t){for(var i=0,o=t.length-1;o>=0;o--)i=1*(t[o].G-t[o].pay_predict-t[o].pay_remainder),isNaN(i)||i;return 1},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),r=(webix.Date.dateToStr("%d.%m.%y %H:%i"),webix.Date.strToDate("%Y-%m-%d")),n=(webix.Date.strToDate("%Y-%m-%d %H:%i"),function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"01.12.20"}}'});return{rows:[{cols:[{view:"label",width:200,height:30,template:"План оплат",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return e.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{view:"icon",icon:"mdi mdi-update",autowidth:!0,value:!0,click:function(){location.reload(!0)}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],hidden:!0,width:200,on:{onChange:function(e){t.showBatch(e)}}},{view:"icon",icon:"mdi mdi-tools",autowidth:!0,popup:{view:"contextmenu",scroll:"y",width:200,height:550,autoheight:!1,localId:"columns-setting",data:[{value:"Profile",href:"#profile"},{value:"Settings",href:"#settings"},{value:"Dummy"},{id:"logout",value:"Logout"}],$init:function(){t.loadColumnsSetting(this,null)},on:{onMenuItemClick:function(e){t.columnSettingClick(this,e)}}}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:2,select:"row",resizeColumn:{headerOnly:!0},localId:"order-payment-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",dragColumn:!0,sort:"multi",headermenu:!0,tooltip:!0,clipboard:"selection",math:!0,columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:140,tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.value):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"date_shipment",header:["Дата.отгр.",{content:"selectFilter"},""],width:80,editor:"date",hidden:!1,template:function(e){return a(r(e.date_shipment))}},{id:"B",header:["Статус",{content:"selectFilter"},""],width:70,editor:"text",css:{color:"green","text-align":"center"},template:function(e){return e.$group?"":4==e.B?'<i class="mdi mdi-check-circle"></i>':null===e.B?"":e.B}},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text"},{id:"G",width:100,header:["Сумма план",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text"},{id:"I",header:["Изделие",{content:"textFilter"},{content:"totalColumnCount"}],width:200,editor:"text"},{id:"pay_type",header:["Тип.опл",{content:"selectFilter"},""],width:50,editor:"text"},{id:"date_predict_plan",header:["Дата.аван.план",{content:"textFilter"},""],width:90,editor:"date",format:a},{id:"pay_predict_plan",header:["План.aванс",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{color:"black","text-align":"right"}},{id:"date_predict",header:["Дата.аван.факт",{content:"textFilter"},""],width:90,editor:"date",format:a,css:{color:"green","text-align":"center"}},{id:"pay_predict",header:["Факт.аванс",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{color:"green","text-align":"right"}},{id:"date_remainder_plan",header:["Дата.ост.план",{content:"textFilter"},""],width:90,editor:"date",format:a},{id:"pay_remainder_plan",header:["План.ост.",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{color:"black","text-align":"right"}},{id:"date_remainder",header:["Дата.ост.факт",{content:"textFilter"},""],width:90,editor:"date",format:a,css:{color:"green","text-align":"center"}},{id:"pay_remainder",header:["Факт.ост",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{color:"green","text-align":"right"}},{id:"total_pay_remainder",header:["Остаток",{content:"numberFilter"},{content:"totalColumn"}],width:90,css:{color:"green","text-align":"right"},math:"[$r,G]-[$r,pay_predict]-[$r,pay_remainder]",template:function(e){return e.$group?"":e.G-e.pay_predict-e.pay_remainder}},{id:"desc_pay",header:["Примечание",{content:"textFilter"},""],width:150,editor:"text"},{id:"C",header:["Принят",{content:"textFilter"},""],width:80,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,editor:"text"},{id:"H",header:["Дата кл.",{content:"textFilter"},""],width:80,editor:"text"},{id:"S",header:["# кл.",{content:"textFilter"},""],width:70,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:function(e){return a(e.date_shipment_plan)},map:{G:["G","median"],value:["date_shipment_plan"],A:["A"],pay_predict_plan:["pay_predict_plan","sum"],pay_predict:["pay_predict","sum"],pay_remainder_plan:["pay_remainder_plan","sum"],pay_remainder:["pay_remainder","sum"]}},$sort:{by:"date_shipment_plan",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){t.configColumns=JSON.parse(JSON.stringify(this.config.columns));var e=webix.storage.local.get("order-payment-table");e&&this.setState(e)},scroll:!0,on:{onColumnResize:function(){webix.storage.local.put("order-payment-table",this.getState())},onAfterColumnDrop:function(){webix.storage.local.put("order-payment-table",this.getState())},onAfterColumnShow:function(){},onresize:webix.once((function(){})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.order-payment),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)}}}]}},n.init=function(e){var t=this.$$("order-payment-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this.$$("form-search");this.restApi=this.app.config.apiRest,webix.extend(t,webix.ProgressBar);var s=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_shipment_plan":{">=":"'+r+'","<=":"'+n+'"}}'}),c=this;this.restApi.getLoad(s).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=c.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_shipment_plan":{">=":"'+r+'","<=":"'+n+'"}}'});c.restApi.getLoad(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=c.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_shipment_plan":{">=":"'+r+'","<=":"'+n+'"}}'});c.restApi.getLoad(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),l.attachEvent("onChange",(function(e){var i;i={or:[{date_shipment_plan:{">=":r,"<=":n}}]},""!=l.getValue()&&(i={A:l.getValue()});var o={filter:i};webix.extend(t,webix.ProgressBar),t.clearAll(!0),t.showProgress({delay:2e3,hide:!1});var a=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]'});webix.ajax().get(a,o).then((function(e){t.parse(e.json().items)}))}))},n.doRefresh=function(){var e=this.$$("order-payment-table"),t=webix.Date.dateToStr("%d.%m.%y"),i=t(this.$$("dateFrom").getValue()),o=t(this.$$("dateTo").getValue()),a=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_shipment_plan":{">=":"'+i+'","<=":"'+o+'"}}'});e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(a).then((function(t){e.clearAll(),e.parse(t.json().items),e.enable()}))},n.doClickOpenAll=function(){var e=this.$$("order-payment-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},n.showBatch=function(e){this.$$("order-payment-table").showColumnBatch(e)},n.beforeDropChangeData=function(e,t){var i={AE:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_obivka=t,e.AE=a(t),webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},n.loadColumnsSetting=function(e,t){var i,o=this,a=[];this.configColumns.forEach((function(r,n){i="wxi-eye-slash",o.$$("order-payment-table").isColumnVisible(r.id)&&(i="wxi-eye"),r.id==t&&(e.data[n].icon="webix_icon webix_list_icon "+i,e.updatItem(t)),a.push({value:r.header[0].text,id:r.id,icon:"webix_icon webix_list_icon "+i})})),e.data=a},n.columnSettingClick=function(e,t){var i="webix_icon webix_list_icon wxi-eye",o=i,a=this.$$("order-payment-table");a.isColumnVisible(t)?a.hideColumn(t,{spans:!1}):a.showColumn(t,{spans:!1}),e.getItem(t).icon==i&&(o="webix_icon webix_list_icon wxi-eye-slash"),e.getItem(t).icon=o,e.updateItem(t),webix.storage.local.put("order-payment-table",a.getState())},n.doClickPrint=function(){var e=this.$$("order-payment-table");webix.print(e,{fit:"data"})},n.doClickToExcel=function(){var e=this.$$("order-payment-table");webix.toExcel(e)},o}(o.b))},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));var o=i(0),a=i(94),r=i(90);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.middleCoefMat=function(e,t){if(!t.length)return 0;for(var i=0,o=0,a=0,r=t.length-1;r>=0;r--)if(1==t[r].$level){var n=t[r].expense_mat,l=t[r].V;""!=n&&(null!==n&&(n=n.replace(".",",")),n=webix.Number.parse(n,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(n)||isNaN(l)||(i+=1*n,o+=1*l))}return 0!=o&&(a=i/o),webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.ui.datafilter.totalColumnCoefMat=webix.extend({refresh:function(e,t,i){var o,a,r=0,n=0,l=0;e.data.each((function(e){e.$group||(o=e.expense_mat,a=e.V,null!==o&&"0"!=a&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),o=parseFloat(o),isNaN(o)||(r+=1*o),n+=1*a))})),0!=n&&(l=r/n),r=webix.i18n.numberFormat(l,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(r=i.format(r)),i.template&&(r=i.template({value:r})),t.innerHTML=r}},webix.ui.datafilter.summColumn),webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var n=webix.Date.dateToStr("%d.%m.%y"),l=webix.Date.strToDate("%Y-%m-%d");var s=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s=o.prototype;return s.config=function(){var e=this;this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"01.12.20"}}'});return{rows:[{cols:[{view:"label",width:200,height:30,template:"План результата",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){e.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(t){e.showBatch(t)}}},{view:"icon",icon:"mdi mdi-tools",autowidth:!0,popup:{view:"contextmenu",scroll:"y",width:200,height:550,autoheight:!1,localId:"columns-setting",data:[{value:"Profile",href:"#profile"},{value:"Settings",href:"#settings"},{value:"Dummy"},{id:"logout",value:"Logout"}],$init:function(){e.loadColumnsSetting(this,null)},on:{onMenuItemClick:function(t){e.columnSettingClick(this,t)}}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:5,select:"cell",resizeColumn:{headerOnly:!0},localId:"order-result-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",dragColumn:!0,sort:"multi",headermenu:!0,tooltip:!0,clipboard:"selection",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,sort:"date",tooltip:"#F# <br>#C#-#D# Дата клиента: #H# <br>#E#<br> #I#<br> #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+n(e.value):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",hidden:!1},{id:"I",header:["Изделие",{content:"textFilter"},""],width:180,editor:"text",hidden:!1},{id:"product_id",header:["Изделие",{content:"textFilter"},""],width:200,editor:"combo",options:r.a},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text",sort:"string",hidden:!1},{id:"cloth_id",header:["Ткань",{content:"textFilter"},""],width:200,editor:"combo",options:a.a,sort:"string"},{id:"width",header:["Ширина",{content:"selectFilter"},""],width:70,css:{"text-align":"center"},batch:1,editor:"text"},{id:"length",header:["Длина",{content:"selectFilter"},""],width:70,css:{"text-align":"center"},batch:1,editor:"text"},{id:"size",header:["Размер",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,css:{"text-align":"center"},batch:1,editor:"text"},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",hidden:!0},{id:"G",width:90,header:["Сумма план",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",hidden:!0},{id:"V",header:["Сумма факт",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500}},{id:"J",header:["Каркас",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,hidden:!0,css:{"text-align":"center"},batch:1,editor:"text"},{id:"date_shipment",header:["Дата отгр.",{content:"selectFilter"},""],width:100,editor:"date",hidden:!0,template:function(e){return n(l(e.date_shipment))}},{id:"B",header:["Отг.",{content:"selectFilter"},""],width:50,editor:"text",hidden:!0,css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":4==e.B?'<i class="mdi mdi-check-circle"></i>':null===e.B?"":e.B}},{id:"profit",header:["Profit",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"green","text-align":"right","font-weight":600}},{id:"coef_mat",header:["Коэф. мат.",{content:"selectFilter"},{content:"totalColumnCoefMat"}],width:110,css:{color:"green","text-align":"right","font-weight":600}},{id:"expense",header:["Затраты",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"black","text-align":"right","font-weight":600}},{id:"net_cost",header:["Сумма база",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"black","text-align":"right","font-weight":600},template:function(e){return 2==e.$level&&0==e.net_cost&&(e.$cellCss={net_cost:{color:"red"}}),e.net_cost}},{id:"cloth_sum",header:["Сумма тк.",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"black","text-align":"right","font-weight":600},template:function(e){return 2==e.$level&&0==e.cloth_sum&&(e.$cellCss={cloth_sum:{color:"red"}}),e.cloth_sum}},{id:"expense_cloth",header:["Расх. тк.",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"black","text-align":"right","font-weight":200}},{id:"cloth_price",header:["Цена тк.",{content:"selectFilter"},""],width:110,css:{color:"black","text-align":"right","font-weight":200},template:function(e){return e.cloth?e.cloth.price:0}},{id:"cost_work",header:["Стоим. работ",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"green","text-align":"right","font-weight":600}},{id:"cost_cut",header:["Раб. крой",{content:"selectFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right"}},{id:"cost_sewing",header:["Раб. пошив",{content:"selectFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right"}},{id:"cost_ot",header:["Раб. отстр.",{content:"selectFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right"}},{id:"cost_carcass",header:["Раб. ст. цар.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_carcass?e.productWorkSalary.cost_carcass:""}},{id:"cost_headboard",header:["Раб. ст. изг.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_headboard?e.productWorkSalary.cost_headboard:""}},{id:"cost_grinding",header:["Раб. ст. шлиф.",{content:"selectFilter"},""],width:110,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_grinding?e.productWorkSalary.cost_grinding:""}},{id:"cost_rubber_carcass",header:["Раб. пор. цар.",{content:"selectFilter"},""],width:110,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_rubber_carcass?e.productWorkSalary.cost_rubber_carcass:""}},{id:"cost_rubber_headboard",header:["Раб. пор. изг.",{content:"selectFilter"},""],width:110,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_rubber_headboard?e.productWorkSalary.cost_rubber_headboard:""}},{id:"cost_upholstery_carcass",header:["Раб. об. цар.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_upholstery_carcass?e.productWorkSalary.cost_upholstery_carcass:""}},{id:"cost_upholstery_headboard",header:["Раб. об. изг.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_upholstery_headboard?e.productWorkSalary.cost_upholstery_headboard:""}},{id:"cost_buttons",header:["Раб. об. пуг.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_buttons?e.productWorkSalary.cost_buttons:""}},{id:"cost_matras",header:["Раб. об. мат.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_matras?e.productWorkSalary.cost_matras:""}},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text"},{id:"AZ",header:["Столярка ФИО",{content:"selectFilter"},""],width:115,editor:"text"},{id:"BO",header:["Пошив ФИО",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},{id:"BV",header:["Крой ФИО",{content:"selectFilter"},""],width:115,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:function(e){return e.date_obivka},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],value:["date_obivka"],A:["A"],profit:["profit","sum"],expense:["expense","sum"],net_cost:["net_cost","sum"],cost_work:["cost_work","sum"],cloth_sum:["cloth_sum","sum"],expense_cloth:["expense_cloth","sum"],coef_mat:["coef_mat","middleCoefMat"],cost_cut:["cost_cut","sum"],cost_sewing:["cost_sewing","sum"]}},$sort:{by:"AE",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){e.configColumns=this.config.columns;var t=webix.storage.local.get("order-result-table");t&&this.setState(t)},scroll:!0,on:{onColumnResize:function(){webix.storage.local.put("order-result-table",this.getState())},onAfterColumnDrop:function(){webix.storage.local.put("order-result-table",this.getState())},onAfterColumnShow:function(){},onresize:webix.once((function(){})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(t,i){var o=this.getItem(t.start),a=this.getItem(t.parent);e.beforeDropChangeData(o,a.value)}}}]}},s.init=function(e){var t=this.$$("order-result-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+r+'","<=":"'+n+'"}}'}),s=this;webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=s.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+r+'","<=":"'+n+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=s.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+r+'","<=":"'+n+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},s.doClickOpenAll=function(){var e=this.$$("order-result-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},s.showBatch=function(e){this.$$("order-result-table").showColumnBatch(e)},s.beforeDropChangeData=function(e,t){var i={AE:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_obivka=t,e.AE=n(t),webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},s.loadColumnsSetting=function(e,t){var i,o=this,a=[];this.configColumns.forEach((function(r,n){i="wxi-eye-slash",o.$$("order-result-table").isColumnVisible(r.id)&&(i="wxi-eye"),r.id==t&&(e.data[n].icon="webix_icon webix_list_icon "+i,e.updatItem(t)),a.push({value:r.header[0].text,id:r.id,icon:"webix_icon webix_list_icon "+i})})),e.data=a},s.columnSettingClick=function(e,t){var i="webix_icon webix_list_icon wxi-eye",o=i,a=this.$$("order-result-table");a.isColumnVisible(t)?a.hideColumn(t,{spans:!1}):a.showColumn(t,{spans:!1}),e.getItem(t).icon==i&&(o="webix_icon webix_list_icon wxi-eye-slash"),e.getItem(t).icon=o,e.updateItem(t),webix.storage.local.put("order-result-table",a.getState())},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return w}));var o=i(0),a=i(1),r=i(14),n=i(85),l=i(8),s=i(89);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countSame=function(e,t){if(!t.length)return 0;for(var i={},o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&null!=a&&(i[a]=a)}return webix.i18n.numberFormat(Object.keys(i).length,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:250,height:100}}},webix.Date.oneDayEnd=function(e){return e=webix.Date.add(e,1,"day"),e=webix.Date.add(e,-1,"minute")},webix.ui.datafilter.mySummColumn=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.rank&&(o+=e.fee)})),t.innerHTML=o}},webix.ui.datafilter.summColumn);webix.Date.dateToStr("%d-%m-%Y");var c=webix.Date.dateToStr("%d.%m.%y"),d=webix.Date.dateToStr("%d.%m.%y %H:%i"),u=webix.Date.dateToStr("%Y-%m-%d %H:%i"),h=webix.Date.strToDate("%Y-%m-%d"),p=webix.Date.strToDate("%Y-%m-%d %H:%i"),m=webix.Date.strToDate("%Y-%m-%d %H"),g=(webix.Date.strToDate("%d.%m.%y"),webix.Date.strToDate("%d-%m-%Y %H:%i"),webix.Date.dateToStr("%d.%m.%y %H")),f=webix.Date.dateToStr("%H:%i");webix.editors.buttonEditor=webix.extend({render:function(e,t,i){return webix.html.create("div",{class:"webix_dt_editor"},"<input type='text'><button class='editor-button' style='position: absolute;margin: 1px; right:0; height:25px;'>...</button>")}},webix.editors.text);var w=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var w=o.prototype;return w.config=function(){var e=this,t=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"План производства",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:new Date},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.oneDayEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"icon",icon:"mdi mdi-power-plug",autowidth:!0,click:function(){return e.doClickGetPower()}},{view:"icon",icon:"mdi mdi-account-reactivate",autowidth:!0,click:function(){return e.doClickSetSewingPlan()}},{view:"icon",icon:"mdi mdi-account-supervisor-circle-outline",autowidth:!0,click:function(){return e.doClickSetUpholsteryPlan()}},{view:"icon",icon:"mdi mdi-calculator",autowidth:!0,click:function(){return e.doClickCalculator()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return e.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"select",localId:"batch-plan",value:4,labelWidth:100,options:[{id:8,value:"Крой"},{id:1,value:"Швейка"},{id:4,value:"Обивка"},{id:6,value:"Распил."},{id:"10",value:"Столярка"},{id:12,value:"Упаковка"}],width:250,on:{onChange:function(e){t.showBatch(e)}}},{view:"select",localId:"toggle-plan",value:4,labelWidth:100,options:[{id:4,value:"По дням готовности план"},{id:9,value:"По часам крой план"},{id:2,value:"По часам шв.план"},{id:5,value:"По часам обивки план"},{id:7,value:"По часам распил.план"},{id:11,value:"По часам столярка план"},{id:12,value:"По часам упаковка план"}],width:250,on:{onChange:function(e){var i=t.$$("batch-plan");1!=e&&2!=e&&3!=e||i.setValue(1),4!=e&&5!=e||i.setValue(4),6!=e&&7!=e||i.setValue(6),8!=e&&9!=e||i.setValue(8),"10"!=e&&11!=e||i.setValue(10),12==e&&i.setValue(12),t.doPlanToggle(e)}}},{label:"",view:"search-close",width:150,align:"right",localId:"form-search"}]},{view:"treetable",css:"webix_header_border webix_data_border my_style",urlEdit:"order",leftSplit:12,select:"row",resizeColumn:{headerOnly:!0},localId:"sewing-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",tooltip:!0,clipboard:"selection",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:180,tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+g(e.value)+":00":e.A},cssFormat:function(e,t){return t.product_id&&t.client_id&&t.cloth_id&&t.type_product&&t.size_id&&t.carcass_type_id&&t.leg_id&&t.bottom_id?{color:"green"}:{}},css:{color:"black","text-align":"right","font-weight":500}},{id:"action-view",header:"",width:50,template:function(e,t){return e.$group?"":t.editIcon()}},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,editor:"text"},{id:"H",header:["Дата клиента",{content:"textFilter"},""],width:70,editor:"text"},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"buttonEditor"},{id:"date_obivka",header:["Дата Гот.",{content:"selectFilter"},""],width:80,editor:"date",template:function(e){return c(h(e.date_obivka))}},{id:"CF",header:["Уп.",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":500},cssFormat:function(e,i){if(12==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#C4F5F9"}},template:function(e){return e.$group?"":1==e.CF?'<i class="mdi mdi-gift"></i>':null===e.CF?"":e.CF}},{id:"W",header:["Об.",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":500},cssFormat:function(e,i){if(4==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#ddFFdd"}},template:function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-marker-check"></i>':null===e.W?"":e.W}},{id:"BP",header:["Шв.",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":300},cssFormat:function(e,i){if(1==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#C4F5F9"}},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check-circle"></i>':null===e.BP?"":e.BP}},{id:"BW",header:["Крой",{content:"selectFilter"},""],width:40,editor:"text",css:{color:"green","text-align":"center","font-weight":300},cssFormat:function(e,i){if(8==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#fff5e6"}},template:function(e){return e.$group?"":1==e.BW?'<i class="mdi mdi-check-circle"></i>':null===e.BW?"":e.BW}},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,editor:"text",css:{color:"green","text-align":"center","font-weight":300},cssFormat:function(e,i){if(10==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#ffe4dd"}},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check-circle"></i>':null===e.BA?"":e.BA}},{id:"status_sawcut",header:["Расп.",{content:"selectFilter"},""],width:50,editor:"text",css:{color:"green","text-align":"center","font-weight":300},cssFormat:function(e,i){if(6==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#C4F5F9"}},template:function(e){return e.$group?"":1==e.status_sawcut?'<i class="mdi mdi-check-circle"></i>':null===e.status_sawcut?"":e.status_sawcut}},{id:"date",header:["# заказа",{content:"textFilter"},""],width:180,batch:2,template:function(e,t){return 1==e.$level?t.folder(e,t)+'<div style="font-weight:700;" >'+f(e.value)+"</div>":e.A+"- "+e.I},css:{color:"black","text-align":"left"}},{id:"fact",header:"Факт н.",width:100,batch:2,editor:"text"},{id:"fact1",header:"Факт к.",width:100,batch:2,editor:"text"},{id:"comment",header:"Комментарий",width:250,batch:2,editor:"text"},{id:"AA",header:["К.об.план",{content:"textFilter"},{content:"totalColumn"}],width:80,css:{"text-align":"right","font-weight":500}},{id:"CH",header:["К.шв.план",{content:"textFilter"},{content:"totalColumn"}],width:80,editor:"text",css:{"text-align":"right","font-weight":500},batch:1},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",batch:4},{id:"CI",header:["К.кр.план",{content:"textFilter"},{content:"totalColumn"}],width:80,editor:"text",css:{"text-align":"right","font-weight":500},batch:8},{id:"date_cut_plan",header:["Дата кр.план старт",{content:"selectFilter"},""],width:140,editor:"date",hidden:!1,css:{"text-align":"center"},cssFormat:function(e,i){if(8==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#fff5e6"}},template:function(e){return d(p(e.date_cut_plan))}},{id:"date_cut_plan_end",header:["Дата кр.план оконч.",{content:"selectFilter"},""],width:145,editor:"date",hidden:!1,css:{"text-align":"center"},template:function(e){return e.$group?"":d(p(e.date_cut_plan_end))}},{id:"date_sewing_plan",header:["Дата Шв.план старт",{content:"selectFilter"},""],width:140,editor:"date",hidden:!1,css:{"text-align":"center"},cssFormat:function(e,i){if(1==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#C4F5F9"}},template:function(e){return d(p(e.date_sewing_plan))}},{id:"date_sewing_plan_end",header:["Дата Шв.план оконч.",{content:"selectFilter"},""],width:145,editor:"date",hidden:!1,css:{"text-align":"center"},template:function(e){return e.$group?"":d(p(e.date_sewing_plan_end))}},{id:"date_carpenter_plan",header:["Дата ст.план старт",{content:"selectFilter"},""],width:140,editor:"date",hidden:!1,css:{"text-align":"center"},cssFormat:function(e,i){if(10==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#ffe4dd"}},template:function(e){return d(p(e.date_carpenter_plan))}},{id:"date_carpenter_plan_end",header:["Дата ст.план оконч.",{content:"selectFilter"},""],width:145,editor:"date",hidden:!1,css:{"text-align":"center"},template:function(e){return e.$group?"":d(p(e.date_carpenter_plan_end))}},{id:"date_sawcut_plan",header:["Дата расп.план старт",{content:"selectFilter"},""],width:150,editor:"date",cssFormat:function(e,i){if(6==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#C4F5F9"}},template:function(e){return d(p(e.date_sawcut_plan))}},{id:"date_sawcut_plan_end",header:["Дата расп.план оконч.",{content:"selectFilter"},""],width:160,editor:"date",template:function(e){return d(p(e.date_sawcut_plan_end))}},{id:"time_upholstery_plan",header:["Вр.об.план",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{"text-align":"right","font-weight":500},batch:4},{id:"time_upholstery_fact",header:["Вр.об.факт",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{"text-align":"right",color:"green","font-weight":500},batch:4},{id:"date_upholstery_plan",header:["Дата об.план старт",{content:"selectFilter"},""],width:140,editor:"date",batch:4,hidden:!1,css:{"text-align":"center"},cssFormat:function(e,i){if(4==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#ddFFdd"}},template:function(e){return d(p(e.date_upholstery_plan))}},{id:"date_upholstery_plan_end",header:["Дата об.план оконч.",{content:"selectFilter"},""],width:140,editor:"date",batch:4,css:{"text-align":"center","font-weight":500},hidden:!1,template:function(e){return d(p(e.date_upholstery_plan_end))}},{id:"time_upholstery_start",header:["Дата об.факт старт.",{content:"selectFilter"},""],width:140,editor:"date",batch:4,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return d(p(e.time_upholstery_start))}},{id:"time_upholstery_end",header:["Дата об.факт окон.",{content:"selectFilter"},""],width:140,editor:"date",batch:4,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return d(p(e.time_upholstery_end))}},{id:"desc_upholstery",header:["Комментарий обивка",{content:"selectFilter"},""],width:250,editor:"popup",batch:4},{id:"time_sewing",header:["Вр.шв.план,ч",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{"text-align":"center","font-weight":500},batch:1},{id:"time_sewing_fact",header:["Вр.шв.факт,ч",{content:"textFilter"},{content:"totalColumn"}],width:90,editor:"text",css:{color:"green","text-align":"center","font-weight":500},batch:1},{id:"BT",header:["Дата Шв.факт старт",{content:"selectFilter"},""],width:140,editor:"date",batch:1,hidden:!1,css:{color:"green","text-align":"center","font-weight":500},template:function(e){return d(p(e.BT))}},{id:"BU",header:["Дата Шв.факт оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:1,hidden:!1,css:{color:"green","text-align":"center","font-weight":500},template:function(e){return d(p(e.BU))}},{id:"BO",header:["ФИО шв.",{content:"selectFilter"},{content:"mySummColumn"}],width:115,batch:1,editor:"text"},{id:"coef_sewing",header:["Коэф.шв.факт",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"time_cut_plan",header:["Время.кр.план,ч",{content:"textFilter"},{content:"totalColumn"}],width:125,editor:"text",css:{"text-align":"right","font-weight":500},batch:8},{id:"time_cut_fact",header:["Время.кр.факт,ч",{content:"textFilter"},{content:"totalColumn"}],width:125,editor:"text",css:{"text-align":"right",color:"green","font-weight":500},batch:8},{id:"BZ",header:["Дата кр.факт старт",{content:"selectFilter"},""],width:140,editor:"date",batch:8,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return d(p(e.BZ))}},{id:"CA",header:["Дата кр.факт оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:8,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return d(p(e.CA))}},{id:"BV",header:["ФИО крой.",{content:"selectFilter"},{content:"mySummColumn"}],width:115,batch:8,editor:"text"},{id:"desc_cut",header:["Комментарий крой",{content:"selectFilter"},""],width:250,editor:"popup",batch:8},{id:"loss_cut",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:8,editor:"text"},{id:"time_loss_cut",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:8,editor:"text"},{id:"time_carpenter_plan",header:["Время.ст.план,ч",{content:"textFilter"},{content:"totalColumn"}],width:125,editor:"text",css:{"text-align":"right","font-weight":500},batch:10},{id:"time_carpenter_fact",header:["Время.ст.факт,ч",{content:"textFilter"},{content:"totalColumn"}],width:125,editor:"text",css:{"text-align":"right",color:"green","font-weight":500},batch:10},{id:"BC",header:["Дата ст.факт старт",{content:"selectFilter"},""],width:140,editor:"date",batch:10,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return d(p(e.BC))}},{id:"BD",header:["Дата ст.факт оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:10,css:{"text-align":"center",color:"green","font-weight":500},hidden:!1,template:function(e){return d(p(e.BD))}},{id:"AZ",header:["ФИО столярка",{content:"selectFilter"},{content:"mySummColumn"}],width:115,batch:10,editor:"text"},{id:"desc_carpenter",header:["Комментарий столярка",{content:"selectFilter"},""],width:250,editor:"popup",batch:10},{id:"loss_carpenter",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:10,editor:"text"},{id:"time_loss_carpenter",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:10,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"K",header:["Дата ткани",{content:"textFilter"},""],width:90,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"CA",header:["Время Крой",{content:"selectFilter"},""],width:110,editor:"date",template:function(e){return d(p(e.CA))}},{id:"desc_sewing",header:["Комментарий швейка",{content:"selectFilter"},""],width:250,editor:"popup",batch:1},{id:"loss_sewing",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"time_loss_sewing",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text"},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},""],width:100,css:{"text-align":"right","font-weight":500},batch:10},{id:"time_sawcut_start",header:["Дата расп.факт старт",{content:"selectFilter"},""],width:150,batch:6,editor:"text",css:{"text-align":"center",color:"green","font-weight":500},template:function(e){return d(p(e.time_sawcut_start))}},{id:"time_sawcut_end",header:["Дата расп.факт оконч.",{content:"selectFilter"},""],width:160,batch:6,editor:"text",css:{"text-align":"center",color:"green","font-weight":500},template:function(e){return d(p(e.time_sawcut_end))}},{id:"desc_sawcut",header:["Комментарий распил",{content:"selectFilter"},""],width:250,editor:"popup",batch:6},{id:"loss_sawcut",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:6,editor:"text"},{id:"time_loss_sawcut",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:6,editor:"text"},{id:"date_packaging_plan",header:["Дата уп.план старт",{content:"selectFilter"},""],width:140,editor:"date",batch:12,hidden:!1,css:{"text-align":"center"},cssFormat:function(e,i){if(12==t.$$("batch-plan").getValue())return{"text-align":"center","background-color":"#C4F5F9"}},template:function(e){return d(p(e.date_packaging_plan))}},{id:"date_packaging_plan_end",header:["Дата уп.план оконч.",{content:"selectFilter"},""],width:145,editor:"date",batch:12,hidden:!1,css:{"text-align":"center"},template:function(e){return e.$group?"":d(p(e.date_packaging_plan_end))}},{id:"desc_packaging",header:["Комментарий упак.",{content:"selectFilter"},""],width:250,editor:"popup",batch:12},{id:"loss_packaging",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:12,editor:"text"},{id:"time_loss_packaging",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:12,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"BB",header:"Дата",width:90,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:200,editor:"popup"},{id:"AF",header:["Комментарий работников",{content:"selectFilter"},""],width:250,editor:"popup",batch:4}],save:"api->accounting/orders",scheme:{$init:function(e){if("есть на складе"==e.M||"получено"==e.M);else if("заказано"==e.M){if(e.$css="highlight",e.K){var t=webix.Date.dateToStr("%y"),i=webix.Date.strToDate("%d.%m.%y");t(new Date);h(e.K)>i(e.AE)&&(e.$css="highlight-red")}}else e.$css="highlight-red";if(e.date_client){var o=webix.Date.dateToStr("%d"),a=webix.Date.dateToStr("%m"),r=webix.Date.strToDate("%d.%m.%y")(e.AE),n=o(e.date_client),l=o(r),s=a(e.date_client),c=a(r);n-l<3&&s==c&&(e.$css=e.$css+" highlight-bold")}}},ready:function(){webix.ui({view:"contextmenu",data:["Редактировать"],on:{onItemClick:function(e){var i=this.getContext();if(t.$$("sewing-table").unselect(),t.$$("sewing-table").select(i.id.row,i.id.column,!0),"Редактировать"==e&&t.formEdit.showForm(t.$$("sewing-table")),"Копировать"==e)t.$$("sewing-table")}}}).attachTo(this)},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value,e)},onItemClick:function(e,t,i){"action-view"==e.column&&this.$scope.formCheckEdit.showWindow({},this)}},onClick:{"editor-button":function(e,t,i){var o=this.getSelectedItem(),a=this.$scope,r=this.$scope.app.config.apiRest.getUrl("get","accounting/product-work-salaries",{"per-page":"1",filter:'{"name":"'+o.I+'"}'}),n=a.winTable.getBody().$scope.$$("work-salary-table");return webix.ajax().get(r).then((function(e){var t=e.json();n.clearAll(),n.parse(t),t.total_count>1?a.winTable.show():a.modelEdit.showForm(n)})),!1}}}]}},w.init=function(e){var t=this.$$("sewing-table"),i=this.$$("form-search"),o=webix.Date.dateToStr("%d.%m.%y"),n=(webix.Date.dateToStr("%d.%m.%y %H:%i"),this.$$("dateFrom")),d=this.$$("dateTo"),u=o(this.$$("dateFrom").getValue()),h=o(this.$$("dateTo").getValue());webix.extend(t,webix.ProgressBar);var p=this.getFilterFieldByTypeGroup(),m=this.getSortFieldByTypeGroup(),g=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"'+m+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+p+'":{">=":"'+u+'","<=":"'+h+'"}}',expand:"works"}),f=this;webix.ajax().get(g).then((function(e){t.clearAll(),t.parse(e.json().items),f.doTableGroup()})),t.attachEvent("onPaste",(function(e){var i=this;this.getSelectedId(!0).forEach((function(o){i.getItem(o.row)[o.column]=e,i.refresh(o.row),t.updateItem(o.row,i.getItem(o.row))}))})),t.attachEvent("onBeforeEditStop",(function(e,t,i){})),n.attachEvent("onChange",(function(e){u=o(n.getValue()),h=o(d.getValue());var i=f.getFilterFieldByTypeGroup(),a=f.getSortFieldByTypeGroup(),r=f.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"'+a+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+i+'":{">=":"'+u+'","<=":"'+h+'"}}'});webix.ajax().get(r).then((function(e){t.clearAll(),t.parse(e.json().items),f.doTableGroup(),t.openAll()}))})),d.attachEvent("onChange",(function(e){u=o(n.getValue()),h=c(d.getValue());var i=f.getFilterFieldByTypeGroup(),a=f.getSortFieldByTypeGroup(),r=f.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"'+a+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+i+'":{">=":"'+u+'","<=":"'+h+'"}}'});webix.ajax().get(r).then((function(e){t.clearAll(),t.parse(e.json().items),f.doTableGroup(),t.openAll()}))})),i.attachEvent("onChange",(function(e){f.doRefresh()})),this.modelEdit=this.ui(a.a);var w={localId:"winTable",view:"window",scope:this,head:"Список",close:!0,modal:!0,body:r.default};this.winTable=this.ui(w),this.formEdit=this.ui(s.a),this.formCheckEdit=this.ui(l.default)},w.doClickOpenAll=function(){var e=this.$$("sewing-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},w.showBatch=function(e){this.$$("sewing-table").showColumnBatch(e)},w.beforeDropChangeData=function(e,t,i){var o=this.$$("sewing-table"),a=this.getSortFieldByTypeGroup();o.getSelectedId(!0);i.source.forEach((function(e){o.getItem(e)[a]=u(t),o.refresh(e),o.updateItem(e,o.getItem(e))}))},w.doRefresh=function(){var e=this.$$("sewing-table"),t=this.$$("form-search"),i=webix.Date.dateToStr("%d.%m.%y"),o=i(this.$$("dateFrom").getValue()),a=i(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;var r=this.getFilterFieldByTypeGroup(),n=this.getSortFieldByTypeGroup(),l={};l[r]={">=":o,"<=":a},""!=t.getValue()&&(l={A:t.getValue()});var s={filter:l},c=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"'+n+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]'}),d=this;e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(c,s).then((function(t){e.clearAll(),e.parse(t.json().items),d.doTableGroup(),e.enable(),e.openAll()}))},w.doPlanToggle=function(e){var t=this.$$("sewing-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=(this.$$("dateFrom"),this.$$("dateTo"),i(this.$$("dateFrom").getValue())),a=i(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;var r=this;t.disable(),t.showProgress({type:"icon",hide:!1});var n=this.getFilterFieldByTypeGroup(),l=this.getSortFieldByTypeGroup(),s=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"'+l+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+n+'":{">=":"'+o+'","<=":"'+a+'"}}'});this.restApi.getLoad(s).then((function(e){t.clearAll(),t.parse(e.json().items),r.doTableGroup(),t.enable(),t.openAll()}))},w.getFilterFieldByTypeGroup=function(){var e=this.$$("toggle-plan"),t="AE";return 1==e.getValue()&&(t="AE"),2==e.getValue()&&(t="date_sewing_plan"),3==e.getValue()&&(t="date_sewing_plan"),4==e.getValue()&&(t="date_obivka"),5==e.getValue()&&(t="date_upholstery_plan"),6==e.getValue()&&(t="AE"),7==e.getValue()&&(t="date_sawcut_plan"),8==e.getValue()&&(t="AE"),9==e.getValue()&&(t="date_cut_plan"),10==e.getValue()&&(t="AE"),11==e.getValue()&&(t="date_carpenter_plan"),12==e.getValue()&&(t="date_packaging_plan"),t},w.getSortFieldByTypeGroup=function(){var e=this.$$("toggle-plan"),t="date_sewing";return 1==e.getValue()&&(t="date_sewing"),2==e.getValue()&&(t="date_sewing_plan"),3==e.getValue()&&(t="date_sewing_plan"),4==e.getValue()&&(t="date_obivka"),5==e.getValue()&&(t="date_upholstery_plan"),6==e.getValue()&&(t="date_sawcut"),7==e.getValue()&&(t="date_sawcut_plan"),8==e.getValue()&&(t="date_cut"),9==e.getValue()&&(t="date_cut_plan"),10==e.getValue()&&(t="date_carpenter"),11==e.getValue()&&(t="date_carpenter_plan"),12==e.getValue()&&(t="date_packaging_plan"),t},w.doTableGroup=function(){var e=this.$$("toggle-plan"),t=this.$$("sewing-table"),i={},o={G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CH:["CH","median"],CI:["CI","median"],time_cut_plan:["time_cut_plan","median"],coef_sewing:["coef_sewing","median"],time_sewing:["time_sewing","median"],date_sewing_plan_end:["date_sewing_plan_end","median"],time_sewing_fact:["time_sewing_fact","median"],time_upholstery_plan:["time_upholstery_plan","median"],time_upholstery_fact:["time_upholstery_fact","median"],BO:["BO","countSame"],Z:["Z","countSame"],missing:!1};this.showBatch(1),1==e.getValue()&&(i=function(e){return m(e.date_sewing)},o.value=[function(e){return m(e.date_sewing)}],t.group({by:i,map:o})),2==e.getValue()&&(i=function(e){return m(e.date_sewing_plan)},o.value=[function(e){return m(e.date_sewing_plan)}],t.group({by:i,map:o})),3==e.getValue()&&(i=function(e){return webix.Date.add(m(e.date_sewing_plan_end),1,"hour",!0)},o.value=[function(e){return webix.Date.add(m(e.date_sewing_plan_end),1,"hour",!0)}],t.group({by:i,map:o}),t.sort("value","asc","date")),4==e.getValue()&&(this.showBatch(4),i=function(e){return e.date_obivka},o.value=[function(e){return e.date_obivka}],t.group({by:i,map:o})),5==e.getValue()&&(this.showBatch(4),i=function(e){return m(e.date_upholstery_plan)},o.value=[function(e){return m(e.date_upholstery_plan)}],t.group({by:i,map:o})),6==e.getValue()&&(this.showBatch(6),i=function(e){return m(e.date_sawcut)},o.value=[function(e){return m(e.date_sawcut)}],t.group({by:i,map:o})),7==e.getValue()&&(this.showBatch(6),i=function(e){return m(e.date_sawcut_plan)},o.value=[function(e){return m(e.date_sawcut_plan)}],t.group({by:i,map:o})),8==e.getValue()&&(this.showBatch(8),i=function(e){return m(e.date_cut)},o.value=[function(e){return m(e.date_cut)}],t.group({by:i,map:o})),9==e.getValue()&&(this.showBatch(8),i=function(e){return m(e.date_cut_plan)},o.value=[function(e){return m(e.date_cut_plan)}],t.group({by:i,map:o})),10==e.getValue()&&(this.showBatch(10),i=function(e){return m(e.date_carpenter)},o.value=[function(e){return m(e.date_carpenter)}],t.group({by:i,map:o})),11==e.getValue()&&(this.showBatch(10),i=function(e){return m(e.date_carpenter_plan)},o.value=[function(e){return m(e.date_carpenter_plan)}],t.group({by:i,map:o})),12==e.getValue()&&(this.showBatch(12),i=function(e){return m(e.date_packaging_plan)},o.value=[function(e){return m(e.date_packaging_plan)}],t.group({by:i,map:o}))},w.doClickPrint=function(){var e=this.$$("sewing-table");e.showColumnBatch(2),e.hideColumn("A"),e.hideColumn("I"),webix.print(e,{fit:"data"}),e.showColumnBatch(1),e.showColumn("A"),e.showColumn("I")},w.toggleColumn=function(e,t){e.hideColumn(t)},w.doClickToExcel=function(){var e=this.$$("sewing-table");e.showColumn("fact"),e.showColumn("fact1"),e.showColumn("comment"),e.showColumn("date"),webix.toExcel(e),e.hideColumn("fact"),e.hideColumn("fact1"),e.hideColumn("comment"),e.hideColumn("date")},w.doClickCalculator=function(){var e=this.$$("sewing-table"),t=webix.Date.dateToStr("%Y-%m-%d"),i=t(this.$$("dateFrom").getValue()),o=t(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;this.getFilterFieldByTypeGroup(),this.getSortFieldByTypeGroup();var a=this.restApi.getUrl("get","accounting/order/get-plan",{"per-page":"500",dateFrom:i,dateTo:o});e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(a).then((function(t){e.enable(),e.hideProgress()}))},w.doClickClearPlan=function(){var e=this.$$("sewing-table"),t=webix.Date.dateToStr("%Y-%m-%d"),i=t(this.$$("dateFrom").getValue()),o=t(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;e.disable(),e.showProgress({type:"icon",hide:!1});var a=this.restApi.getUrl("get","accounting/order/clear-plan",{dateFrom:i,dateTo:o});this.restApi.getLoad(a).then((function(t){e.enable(),e.hideProgress()}))},w.doClickSetSewingPlan=function(){var e=this.$$("sewing-table"),t=webix.Date.dateToStr("%Y-%m-%d"),i=t(this.$$("dateFrom").getValue()),o=t(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;var a=this;e.disable(),e.showProgress({type:"icon",hide:!1});var r=this.restApi.getUrl("get","accounting/order/set-order-sewing-after-cut",{dateFrom:i,dateTo:o});this.restApi.getLoad(r).then((function(t){a.doRefresh(),e.enable(),e.hideProgress()}))},w.doClickSetUpholsteryPlan=function(){var e=this.$$("sewing-table"),t=webix.Date.dateToStr("%Y-%m-%d"),i=t(this.$$("dateFrom").getValue()),o=t(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;var a=this;e.disable(),e.showProgress({type:"icon",hide:!1});var r=this.restApi.getUrl("get","accounting/order/set-order-upholstery-after-sewing",{dateFrom:i,dateTo:o});this.restApi.getLoad(r).then((function(t){a.doRefresh(),e.enable(),e.hideProgress()}))},w.doClickGetPower=function(){var e=webix.Date.dateToStr("%Y-%m-%d")(this.$$("dateFrom").getValue());this.dateFrom=e,this.powerForm=this.ui(n.default),this.powerForm.showWindow()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),r=webix.Date.strToDate("%Y-%m-%d"),n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"План Пошив+Крой",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){e.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(t){e.showBatch(t)}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"sewing-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.date_sewing):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"B",header:["Статус",{content:"selectFilter"},""],width:70,batch:2,editor:"select",options:[{id:1,value:"1"},{id:3,value:"3"},{id:4,value:"4"},{id:5,value:"5"},{id:6,value:"6"}]},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text"},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text"},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text"},{id:"coefMoney",header:["Коэф. ден. план",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1,template:function(e){var t=parseFloat(e.G.replace(",",""));return e.$group?webix.Number.format(t/7860,{decimalDelimiter:".",decimalSize:2}):webix.Number.format(parseFloat(e.G/7860))}},{id:"AA",header:["Коэф. вр. план",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1},{id:"AJ",header:["Коэф. шв.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"K",header:["Дата клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,template:function(e){return a(r(e.date_obivka))}},{id:"W",header:["Об.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-check"></i>':null===e.W?"":e.W}},{id:"date_sewing",header:["Дата Шв.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,hidden:!1,template:function(e){return a(r(e.date_sewing))}},{id:"BP",header:["Шв.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check"></i>':null===e.BP?"":e.BP}},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check"></i>':null===e.BA?"":e.BA}},{id:"coef_sewing_cut",header:["Коэф. шв. гот.",{content:"textFilter"},{content:"totalColumn"}],width:110,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500}},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text",batch:2},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1},{id:"AK",header:"Обивка царги",width:110,batch:3,editor:"text"},{id:"AL",header:"Статус",width:60,batch:3,editor:"text"},{id:"AM",header:"Дата",width:90,batch:3,editor:"text"},{id:"AP",header:"Паралон изг.",width:110,batch:3,editor:"text"},{id:"AQ",header:"Статус",width:60,batch:3,editor:"text"},{id:"AR",header:"Дата",width:90,batch:3,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:"Столярка",width:115,batch:3,editor:"text"},{id:"BB",header:"Дата",width:90,batch:3,editor:"text"},{id:"BO",header:"Пошив",width:115,batch:1,editor:"text"},{id:"BQ",header:"Дата",width:90,batch:1,editor:"text"},{id:"BV",header:"Крой",width:115,batch:1,editor:"text"},{id:"BW",header:"Статус",width:60,batch:1,editor:"text"},{id:"BX",header:"Дата",width:90,batch:1,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:"date_sewing",map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],coef_sewing_cut:["coef_sewing_cut","median"],missing:!1}},$sort:{by:"date_sewing",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(t,i){var o=this.getItem(t.start),a=this.getItem(t.parent);e.beforeDropChangeData(o,a.value)}}}]}},n.init=function(e){var t=this.$$("sewing-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_sewing","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_sewing":{">=":"'+r+'","<=":"'+n+'"}}'}),s=this;webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=s.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_sewing","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_sewing":{">=":"'+r+'","<=":"'+n+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=s.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_sewing","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_sewing":{">=":"'+r+'","<=":"'+n+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},n.doClickOpenAll=function(){var e=this.$$("sewing-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},n.showBatch=function(e){this.$$("sewing-table").showColumnBatch(e)},n.beforeDropChangeData=function(e,t){var i={date_sewing:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_sewing=t,webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));var o=i(0);i(2),i(4),i(3);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--){if(1==t[o].$level)""!=e(t[o])&&(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,weekNumber:!0,width:220,height:200,icons:!0}}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),r=webix.Date.dateToStr("%d.%m.%y %H:%i"),n=webix.Date.strToDate("%Y-%m-%d"),l=webix.Date.strToDate("%Y-%m-%d %H:%i"),s=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s=o.prototype;return s.config=function(){var e=this,t=this;this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"01.12.20"}}'});return{rows:[{cols:[{view:"label",width:200,height:30,template:"План отгрузки",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:new Date},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return e.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{view:"icon",icon:"mdi mdi-update",autowidth:!0,value:!0,click:function(){location.reload(!0)}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],hidden:!0,width:200,on:{onChange:function(e){t.showBatch(e)}}},{view:"icon",icon:"mdi mdi-tools",autowidth:!0,popup:{view:"contextmenu",scroll:"y",width:200,height:550,autoheight:!1,localId:"columns-setting",data:[{value:"Profile",href:"#profile"},{value:"Settings",href:"#settings"},{value:"Dummy"},{id:"logout",value:"Logout"}],$init:function(){t.loadColumnsSetting(this,null)},on:{onMenuItemClick:function(e){t.columnSettingClick(this,e)}}}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:2,select:"row",resizeColumn:{headerOnly:!0},localId:"order-shipment-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",dragColumn:!0,sort:"multi",headermenu:!0,tooltip:!0,clipboard:"selection",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:180,tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+r(e.value):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"date_shipment_plan",header:["Дата план",{content:"textFilter"},""],width:110,editor:"date",template:function(e){return r(l(e.date_shipment_plan))}},{id:"CF",header:["Уп.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.CF?'<i class="mdi mdi-check-circle"></i>':null===e.CF?"":e.CF}},{id:"C",header:["Принят",{content:"textFilter"},""],width:80,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,editor:"text"},{id:"B",header:["Статус",{content:"selectFilter"},""],width:70,editor:"text",css:{color:"green","text-align":"center"},template:function(e){return e.$group?"":4==e.B?'<i class="mdi mdi-check-circle"></i>':null===e.B?"":e.B}},{id:"storage",header:["Склад",{content:"selectFilter"},""],width:120,sort:"string",editor:"text"},{id:"city",header:["Город",{content:"selectFilter"},""],width:150,editor:"text"},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text"},{id:"H",header:["Дата кл.",{content:"textFilter"},""],width:80,editor:"text"},{id:"S",header:["# кл.",{content:"textFilter"},""],width:70,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text"},{id:"I",header:["Изделие",{content:"textFilter"},{content:"totalColumnCount"}],width:200,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,css:{"text-align":"center"},batch:1,editor:"text"},{id:"G",width:100,header:["Сумма план",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text"},{id:"W",header:["Об.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-marker-check"></i>':null===e.W?"":e.W}},{id:"BP",header:["Шв.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check-circle"></i>':null===e.BP?"":e.BP}},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check-circle"></i>':null===e.BA?"":e.BA}},{id:"date_shipment",header:["Дата отгр.",{content:"selectFilter"},""],width:100,editor:"date",hidden:!1,template:function(e){return a(n(e.date_shipment))}},{id:"CG",header:["Дата Уп",{content:"selectFilter"},""],width:100,editor:"date",batch:1,hidden:!1}],save:"api->accounting/orders",scheme:{$group:{by:function(e){return e.date_shipment_plan},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],I:["I","countValue"],coef_sewing:["coef_sewing","median"],coef_cut:["coef_cut","median"],coef_carpenter:["coef_carpenter","median"],CH:["CH","median"],CI:["CI","median"],value:["date_shipment_plan"],A:["A"]}},$sort:{by:"date_shipment_plan",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){t.configColumns=JSON.parse(JSON.stringify(this.config.columns));var e=webix.storage.local.get("order-shipment-table");e&&this.setState(e)},scroll:!0,on:{onColumnResize:function(){webix.storage.local.put("order-shipment-table",this.getState())},onAfterColumnDrop:function(){webix.storage.local.put("order-shipment-table",this.getState())},onAfterColumnShow:function(){},onresize:webix.once((function(){})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.order-shipment),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)}}}]}},s.init=function(e){var t=this.$$("order-shipment-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this.$$("form-search");this.restApi=this.app.config.apiRest,webix.extend(t,webix.ProgressBar);var s=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_shipment_plan":{">=":"'+r+'","<=":"'+n+'"}}'}),c=this;this.restApi.getLoad(s).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=c.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_shipment_plan":{">=":"'+r+'","<=":"'+n+'"}}'});c.restApi.getLoad(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var l=c.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_shipment_plan":{">=":"'+r+'","<=":"'+n+'"}}'});c.restApi.getLoad(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),l.attachEvent("onChange",(function(e){var i;i={or:[{date_shipment_plan:{">=":r,"<=":n}}]},""!=l.getValue()&&(i={A:l.getValue()});var o={filter:i};webix.extend(t,webix.ProgressBar),t.clearAll(!0),t.showProgress({delay:2e3,hide:!1});var a=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]'});webix.ajax().get(a,o).then((function(e){t.parse(e.json().items)}))}))},s.doRefresh=function(){var e=this.$$("order-shipment-table"),t=webix.Date.dateToStr("%d.%m.%y"),i=t(this.$$("dateFrom").getValue()),o=t(this.$$("dateTo").getValue()),a=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"date_shipment_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_shipment_plan":{">=":"'+i+'","<=":"'+o+'"}}'});e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(a).then((function(t){e.clearAll(),e.parse(t.json().items),e.enable()}))},s.doClickOpenAll=function(){var e=this.$$("order-shipment-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},s.showBatch=function(e){this.$$("order-shipment-table").showColumnBatch(e)},s.beforeDropChangeData=function(e,t){var i={AE:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_obivka=t,e.AE=a(t),webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},s.loadColumnsSetting=function(e,t){var i,o=this,a=[];this.configColumns.forEach((function(r,n){i="wxi-eye-slash",o.$$("order-shipment-table").isColumnVisible(r.id)&&(i="wxi-eye"),r.id==t&&(e.data[n].icon="webix_icon webix_list_icon "+i,e.updatItem(t)),a.push({value:r.header[0].text,id:r.id,icon:"webix_icon webix_list_icon "+i})})),e.data=a},s.columnSettingClick=function(e,t){var i="webix_icon webix_list_icon wxi-eye",o=i,a=this.$$("order-shipment-table");a.isColumnVisible(t)?a.hideColumn(t,{spans:!1}):a.showColumn(t,{spans:!1}),e.getItem(t).icon==i&&(o="webix_icon webix_list_icon wxi-eye-slash"),e.getItem(t).icon=o,e.updateItem(t),webix.storage.local.put("order-shipment-table",a.getState())},s.doClickPrint=function(){var e=this.$$("order-shipment-table");webix.print(e,{fit:"data"})},s.doClickToExcel=function(){var e=this.$$("order-shipment-table");webix.toExcel(e)},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));var o=i(0);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countSame=function(e,t){if(!t.length)return 0;for(var i={},o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&null!=a&&(i[a]=a)}return webix.i18n.numberFormat(Object.keys(i).length,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0}},text:{view:"popup",body:{view:"textarea",width:250,height:100}}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")},webix.ui.datafilter.mySummColumn=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.rank&&(o+=e.fee)})),t.innerHTML=o}},webix.ui.datafilter.summColumn);webix.Date.dateToStr("%d-%m-%Y");var a=webix.Date.dateToStr("%d.%m.%y"),r=webix.Date.dateToStr("%d.%m.%y %H:%i"),n=(webix.Date.strToDate("%Y-%m-%d"),webix.Date.strToDate("%Y-%m-%d %H:%i")),l=webix.Date.dateToStr("%d.%m.%y %H"),s=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s=o.prototype;return s.config=function(){var e,t=this,i=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"План Обивка",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.add(new Date,-1,"day")},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){i.doRefresh()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return t.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return t.doClickToExcel()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){i.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"По дате факт"},{id:2,value:"По дате план"}],width:200,on:{onChange:function(e){i.doPlanToggle(e)}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:2,select:"row",resizeColumn:{headerOnly:!0},localId:"upholstery-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",tooltip:!0,columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:180,tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+e.value:e.A},css:{color:"black","text-align":"right","font-weight":500},sort:"date"},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",batch:2},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",batch:2},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",batch:1},{id:"AA",header:["Коэф. об. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1},{id:"time_upholstery",header:["Время.об.план,ч",{content:"textFilter"},{content:"totalColumn"}],width:125,editor:"text",css:{"text-align":"right","font-weight":500},batch:1},(e={id:"W",header:["Статус Об.",{content:"selectFilter"},""],width:90,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500}},e.batch=1,e.template=function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-marker-check"></i>':null===e.W?"":e.W},e),{id:"date_obivka",header:["Дата Об.факт",{content:"selectFilter"},""],width:110,editor:"date",batch:1,hidden:!1,template:function(e){return r(n(e.date_obivka))}},{id:"date_upholstery_plan",header:["Дата Об.план",{content:"selectFilter"},""],width:110,editor:"date",batch:1,hidden:!1,template:function(e){return r(n(e.date_upholstery_plan))}},{id:"BP",header:["Статус Пош.",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check-circle"></i>':null===e.BP?"":e.BP}},{id:"BA",header:["Статус Ст.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check-circle"></i>':null===e.BA?"":e.BA}},{id:"Z",header:["ФИО Об.",{content:"selectFilter"},""],width:100,editor:"text",batch:1},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"K",header:["Дата клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"K",header:["Дата ткани",{content:"textFilter"},""],width:90,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},""],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"BO",header:["ФИО пош.",{content:"selectFilter"},{content:"mySummColumn"}],width:115,batch:1,editor:"text"},{id:"BV",header:["Фио Крой",{content:"selectFilter"},{content:"mySummColumn"}],width:115,batch:1,editor:"text"},{id:"desc_upholstery",header:["Причина",{content:"selectFilter"},""],width:150,editor:"popup"},{id:"loss_upholstery",header:["Классификация потерь",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"time_loss_upholstery",header:["Время потерь, мин",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"AL",header:"Статус",width:60,batch:3,editor:"text"},{id:"AM",header:"Дата",width:90,batch:3,editor:"text"},{id:"AP",header:"Паралон изг.",width:110,batch:3,editor:"text"},{id:"AQ",header:"Статус",width:60,batch:3,editor:"text"},{id:"AR",header:"Дата",width:90,batch:3,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:"Столярка",width:115,batch:3,editor:"text"},{id:"BB",header:"Дата",width:90,batch:3,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:function(e){return l(e.date_obivka)},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CH:["CH","median"],BO:["BO","countSame"],missing:!1,value:[function(e){return l(e.date_obivka)}]}},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,t){var o=this.getItem(e.start),a=this.getItem(e.parent);i.beforeDropChangeData(o,a.value)}}}]}},s.init=function(e){var t=this.$$("upholstery-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=(webix.Date.dateToStr("%d.%m.%y %H:%i"),this.$$("dateFrom")),r=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),l=i(this.$$("dateTo").getValue());webix.extend(t,webix.ProgressBar);var s=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+l+'"}}'}),c=this;webix.ajax().get(s).then((function(e){t.clearAll(),t.parse(e.json().items)})),t.attachEvent("onAfterEditStop",(function(e,i,o){"date_upholstery_plan"===i.column&&(t.getItem(i.row).date_obivka=e.value,t.refresh(i.row))})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),l=i(r.getValue());var a=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+l+'"}}'});webix.ajax().get(a).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),r.attachEvent("onChange",(function(e){n=i(o.getValue()),l=a(r.getValue());var s=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+l+'"}}'});webix.ajax().get(s).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},s.doClickOpenAll=function(){var e=this.$$("upholstery-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},s.showBatch=function(e){this.$$("upholstery-table").showColumnBatch(e)},s.beforeDropChangeData=function(e,t){},s.doRefresh=function(){var e=this.$$("upholstery-table"),t=webix.Date.dateToStr("%d.%m.%y"),i=(this.$$("dateFrom"),this.$$("dateTo"),t(this.$$("dateFrom").getValue())),o=t(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;var a=this.restApi.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+i+'","<=":"'+o+'"}}'});e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(a).then((function(t){e.clearAll(),e.parse(t.json().items),e.enable()}))},s.doPlanToggle=function(e){this.$$("toggleTime");var t=this.$$("upholstery-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=(this.$$("dateFrom"),this.$$("dateTo"),i(this.$$("dateFrom").getValue())),a=i(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest;if(t.disable(),t.showProgress({type:"icon",hide:!1}),2==e){var n=this.restApi.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_upholstery_plan","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_upholstery_plan":{">=":"'+o+'","<=":"'+a+'"}}'});this.restApi.getLoad(n).then((function(e){t.clearAll(),t.parse(e.json().items),t.group({by:function(e){return r(e.date_upholstery_plan)},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CH:["CH","median"],BO:["BO","countSame"],missing:!1,value:[function(e){return r(e.date_upholstery_plan)}]}}),t.enable()}))}else{var s=this.restApi.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+o+'","<=":"'+a+'"}}'});this.restApi.getLoad(s).then((function(e){t.clearAll(),t.parse(e.json().items),t.group({by:function(e){return l(e.AE)},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CH:["CH","median"],BO:["BO","countSame"],missing:!1,value:[function(e){return l(e.AE)}]}}),t.enable()}))}},s.doClickPrint=function(){var e=this.$$("upholstery-table");webix.print(e,{fit:"data"})},s.doClickToExcel=function(){var e=this.$$("upholstery-table");webix.toExcel(e)},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(12),i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Счета",width:150},{},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"treetable",localId:"order-work-status-table",urlEdit:"order-work-status",css:"webix_header_border webix_data_border",leftSplit:2,select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50,sort:"int"},{id:"name",header:"Наиименование",width:280,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/order-work-statuses",{sort:"name","per-page":-1}),save:"api->accounting/order-work-statuses",scheme:{},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-edit"==e.column&&this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("order-work-status-table"),i=this.$$("form-search"),o=this;webix.extend(t,webix.ProgressBar),i.attachEvent("onChange",(function(e){o.getData()})),this.cashEdit=this.ui(a.a)},r.getData=function(){var e=this.$$("order-work-status-table"),t={filter:{search:this.$$("form-search").getValue()}};webix.extend(e,webix.ProgressBar),e.clearAll(!0),e.showProgress({delay:2e3,hide:!1}),webix.ajax().get(this.app.config.apiRest.getUrl("get","accounting/order-work-statuses",{sort:"name","per-page":-1}),t).then((function(t){e.parse(t),e.enable(),e.openAll()}))},r.doAddClick=function(){this.$$("order-work-status-table").unselect(),this.cashEdit.showForm(this.$$("order-work-status-table"))},r.doClickOpenAll=function(){var e=this.$$("order-work-status-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},r.doRefresh=function(){var e=this.$$("order-work-status-table");e.disable(),e.showProgress({type:"icon",hide:!1}),this.getData()()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("package-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"package-table",urlEdit:"package",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"key",header:"Ключ",width:200},{id:"price",header:"Цена",width:80,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/packages",{sort:"name"}),save:"api->accounting/packages",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("package-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/packages",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("package-table").unselect(),this.cashEdit.showForm(this.$$("package-table"))},r.doClickOpenAll=function(){var e=this.$$("package-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=webix.Date.dateToStr("%M %y"),n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Планы по месяцам",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("plan-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"plan-table",urlEdit:"plan",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"date_plan",header:"Дата",width:180,format:r,sort:"date"},{id:"produce_sum",header:"План производства, грн",width:180,sort:"string",format:webix.Number.format},{id:"produce_fact",header:"Факт производства, грн",width:180,sort:"string",format:webix.Number.format},{id:"sale_sum",header:"План продаж, грн",width:180,sort:"string",format:webix.Number.format},{id:"sale_fact",header:"Факт продаж, грн",width:180,sort:"string",format:webix.Number.format},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/plans",{sort:"-date_plan"}),save:"api->accounting/plans",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("plan-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/plans"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("plan-table").unselect(),this.cashEdit.showForm(this.$$("plan-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("product-bed-size-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"product-bed-size-table",urlEdit:"product-bed-size",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"sort_order",header:"Сорт.",width:70},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/product-bed-sizes",{sort:"name"}),save:"api->accounting/product-bed-sizes",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("product-bed-size-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/product-bed-sizes",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("product-bed-size-table").unselect(),this.cashEdit.showForm(this.$$("product-bed-size-table"))},r.doClickOpenAll=function(){var e=this.$$("product-bed-size-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("product-bed-type-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"product-bed-type-table",urlEdit:"product-bed-type",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:280},{id:"sort_order",header:"Сорт.",width:70},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/product-bed-types",{sort:"name"}),save:"api->accounting/product-bed-types",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("product-bed-type-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/product-bed-types",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("product-bed-type-table").unselect(),this.cashEdit.showForm(this.$$("product-bed-type-table"))},r.doClickOpenAll=function(){var e=this.$$("product-bed-type-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return ProductsBedView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),models_product_product_type__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(12),views_cloth_directory_index__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(11),components_comboClose__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_6__);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var ProductsBedView=function(_JetView){function ProductsBedView(){return _JetView.apply(this,arguments)||this}_inheritsLoose(ProductsBedView,_JetView);var _proto=ProductsBedView.prototype;return _proto.config=function config(){var _this=this,scope=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Продукция",width:150},{},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){scope.doRefresh()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){scope.doClickOpenAll()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return _this.doAddClick()}}]},{view:"treetable",localId:"product-bed-table",urlEdit:"product-bed",css:"webix_header_border webix_data_border",leftSplit:2,select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"name",header:"Наиименование",width:280,sort:"string",template:function(e,t){var i=scope.app.config.apiRest.getCollection("accounting/product-bed-types",{"per-page":-1});return 1==e.$level?t.treetable(e,t)+(e.value?i.getItem(e.value).name:e.name):t.icon(e)+t.folder(e)+" "+e.name}},{id:"id",header:"#",width:50,template:function(e,t){return e.$group?"":e.id}},{id:"type_id",header:"Тип",width:180,sort:"string",collection:scope.app.config.apiRest.getCollection("accounting/product-bed-types",{"per-page":-1})},{id:"price",header:"Кат. 0",width:100},{id:"price_1",header:"Кат. 1"},{id:"price_2",header:"Кат. 2."},{id:"price_3",header:"Кат. 3."},{id:"price_4",header:"Кат. 4",width:100},{id:"price_5",header:"Кат. 5",width:100},{id:"price_6",header:"Кат. 6",width:100},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"},{id:"action-image",header:"",width:50,template:"<i class='mdi mdi-image hover'></i>"},{id:"action-image-table",header:"",width:50,template:"<i class='mdi mdi-table hover'></i>"}],url:this.app.config.apiRest.getUrl("get","accounting/product-beds",{sort:"name","per-page":-1,expand:"images"}),save:"api->accounting/product-beds",scheme:{$group:{by:function(e){return e.type_id},map:{value:["type_id"]}}},on:{onItemClick:function onItemClick(id,e,trg){if("action-delete"==id.column){var table=this;webix.confirm("Удалить запись?").then((function(e){webix.dp(table).save(id.row,"delete").then((function(e){webix.dp(table).ignore((function(){table.remove(id.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-edit"==id.column&&this.$scope.cashEdit.showForm(this),"action-image"==id.column){var url=scope.app.config.apiRest.getUrl("get","accounting/image-param/form-image-list",{"per-page":-1,product_id:id.row});webix.ajax(url,(function(text){var text1=eval(text),win=scope.ui({view:"form-image-param-list"},scope.$$("layout"));win.show()}))}if("action-image-table"==id.column){var _url=scope.app.config.apiRest.getUrl("get","accounting/image-param/form-image-table",{"per-page":-1,product_id:id.row});webix.ajax(_url,(function(text){var text1=eval(text),win=scope.ui({view:"form-image-param-table"},scope.$$("layout"));win.show()}))}},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},_proto.init=function(e){var t=this.$$("product-bed-table"),i=this.$$("form-search"),o=this;webix.extend(t,webix.ProgressBar),i.attachEvent("onChange",(function(e){o.getData()})),this.cashEdit=this.ui(core_updateFormView__WEBPACK_IMPORTED_MODULE_1__.a),this.uploader=webix.ui({localId:"uploadAPI",name:"uploader",inputName:"uploader",view:"uploader",datatype:null,apiOnly:!0}),this.cashEdit.attachFormEvents=function(e){var t=this,i=(this.state,this.$$("btn_save")),o=this.$$("btn_copy"),a=this.$$("uploader");i.attachEvent("onItemClick",(function(e){t.doClickSave()})),o.attachEvent("onItemClick",(function(e){t.doClickSave(!0)})),this.$$("formEdit").elements.id.attachEvent("onChange",(function(e,i,o){var r=[],n=t.state.tableRecord.images;if(n)for(var l in n)r.push({id:n[l].id,name:n[l].name,sizetext:n[l].size,status:"server"});a.files.clearAll(),a.files.parse(r);var s=t.state.tableRecord.id,c=t.app.config.apiRest.getUrl("get","accounting/images",{type:"image",model:"product-bed",mode:"insert-save",id:s});a.define({upload:c})})),a.files.attachEvent("onBeforeDelete",(function(e){var i=a.files.getItem(e),o=e;i.newId&&(o=i.newId),t.app.config.apiRest.delete("accounting/images",{id:o}).then((function(){for(var e in t.state.tableRecord.images){if(t.state.tableRecord.images[e].id==o){t.state.tableRecord.images="";break}0}}))})),a.attachEvent("onBeforeFileAdd",(function(e,t,i){})),a.attachEvent("onFileUpload",(function(e,i,o){e.newId=i.data.id,a.files.add({id:upload.data.id,name:upload.data.name,sizetext:upload.data.size,status:"server"}),t.state.tableRecord.images.push(i.data)}))};var a={localId:"winTable",view:"window",scope:this,head:"Список",position:"center",width:800,height:600,close:!0,modal:!0,move:!0,body:views_cloth_directory_index__WEBPACK_IMPORTED_MODULE_3__.default};this.winTable=this.ui(a)},_proto.getData=function(){var e=this.$$("product-bed-table"),t={filter:{search:this.$$("form-search").getValue()}};webix.extend(e,webix.ProgressBar),e.clearAll(!0),e.showProgress({delay:2e3,hide:!1}),webix.ajax().get(this.app.config.apiRest.getUrl("get","accounting/product-beds",{sort:"name","per-page":-1}),t).then((function(t){e.parse(t),e.enable(),e.openAll()}))},_proto.doAddClick=function(){this.$$("product-bed-table").unselect(),this.cashEdit.showForm(this.$$("product-bed-table"))},_proto.doClickOpenAll=function(){var e=this.$$("product-bed-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},_proto.doRefresh=function(){var e=this.$$("product-bed-table");e.disable(),e.showProgress({type:"icon",hide:!1}),this.getData()()},ProductsBedView}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.config=function(){return{id:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Проводки",width:150},{view:"label",label:"c",align:"left",width:30},{view:"datepicker",name:"date_from",align:"left",width:120},{view:"label",label:"по",align:"left",width:30},{view:"datepicker",name:"date_to",align:"left",width:120},{},{label:"",view:"search",width:300,align:"right"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("table-register")}}]},{view:"datatable",id:"table-register",autoConfig:!0,css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"date_document",header:"Дата",width:90,format:webix.i18n.dateFormatStr},{id:"document_id",header:"Док.",width:50},{id:"account_debet",header:"Дебет"},{id:"subconto1_debet_name",header:"Субконто1"},{id:"subconto2_debet_name",header:"Субконто2"},{id:"account_credit",header:"Кредит"},{id:"subconto1_credit_name",header:"Субконто1"},{id:"subconto2_credit_name",header:"Субконто2"},{id:"sum",header:"Сумма",format:webix.Number.format,css:{"text-align":"right"}}],url:this.app.config.apiRest.getUrl("get","accounting/registers",{"per-page":"-1"})}]}]}},o}(i(0).b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return d}));var o=i(0),a=i(7),r=i(5);function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function s(e,t,i){return function(o){function d(e,t){var i;return(i=o.call(this,e,t)||this).state=new a.a(n(i)),i.state.app=e,i}l(d,o);var u=d.prototype;return u.config=function(){return e},u.init=function(e,t){var o=this.state;o.table=this.$$("table-register"+i),o.tableUrl=this.app.config.apiRest.getUrl("get","accounting/register/turnover-period"),this.attachTableEvents()},u.attachTableEvents=function(){var e=this.state;e.scope=this;var i={};e.table.attachEvent("onItemDblClick",(function(o){i=e.table.getSelectedItem(),webix.ajax().get(e.tableUrl,{dateFrom:t.state.dateFrom,dateTo:t.state.dateTo,subconto:i.account,account_type:i.account_type}).then((function(t){var o="report"+i.account;e.tableId=o,r.a[o]||(r.a[o]=s(c(t,e.tableId,e),e.scope,o),$$("views").addView({id:o,rows:[r.a[o]]}),$$("tabs").addOption(o,i.account,!0)),console.log(e.scope.$$("table-register"+e.tableId))}))}))},d}(o.b)}function c(e,t,i,o){return{type:"space",rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"datepicker",localId:"dateFrom",name:"date_from",align:"left",width:120,value:webix.Date.monthStart(new Date)},{view:"label",label:"по",align:"left",width:30},{view:"datepicker",localId:"dateTo",name:"date_to",align:"left",width:120,value:new Date},{},{label:"",view:"search",width:300,align:"right"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("table-register")}}]},{view:"datatable",localId:"table-register"+t,css:"webix_header_border webix_data_border",title:"Оборотно-сальдовая ведомость",footer:!0,scroll:"y",select:"cell",resizeColumn:{headerOnly:!0},columns:[{header:"",width:50},{id:"account",header:"Субконто",width:170,collection:"contragent"==o?i.app.config.apiRest.getCollection("accounting/contragents",{"per-page":-1}):""},{id:"sum_debet_start",header:[{text:"Сальдо на начало",colspan:2},"Дебет"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{id:"sum_credit_start",header:[{text:"",colspan:2},"Кредит"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{id:"sum_debet",header:[{text:"Оборот за период",colspan:2},"Дебет"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"},format:webix.Number.format},{id:"sum_credit",header:[{text:"",colspan:2},"Кредит"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"},format:webix.Number.format},{id:"sum_debet_end",header:[{text:"Сальдо на конец",colspan:2},"Дебет"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{id:"sum_credit_end",header:[{text:"",colspan:2},"Кредит"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{header:"",fillspace:!0}],data:e}]}}var d=function(e){function t(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(n(o)),o.state.app=t,o}l(t,e);var i=t.prototype;return i.config=function(){return{type:"wide",cols:[{rows:[{view:"tabbar",id:"tabs",multiview:!0,close:!0,options:[{id:"t1",value:"ОСВ",hidden:!1,close:!1}],optionWidth:180},{view:"multiview",id:"views",cells:[{id:"t1",rows:[c("","",this.state)]}]}]}]}},i.init=function(e,t){var i=this.state;i.scope=this,i.table=this.$$("table-register"),i.tabbar=this.$$("tabbar"),i.tableUrl=this.app.config.apiRest.getUrl("get","accounting/register/turnover-period");var o=webix.Date.dateToStr("%Y-%m-%d"),a=this.$$("dateFrom"),n=this.$$("dateTo"),l=o(a.getValue()),d=o(n.getValue()),u={dateFrom:l,dateTo:d};i.dateFrom=l,i.dateTo=d,webix.ajax().get(i.tableUrl,u).then((function(e){i.table.clearAll(),i.table.parse(e.json().data)})),r.a.t1=s(c("","",i),i.scope,"t1"),$$("top:menu").getItem("t1")&&$$("top:menu").remove("t1"),this.attachTableEvents()},i.attachTableEvents=function(){var e=this.state,t=webix.Date.dateToStr("%Y-%m-%d"),i=this.$$("dateFrom"),o=this.$$("dateTo"),a=t(i.getValue()),n=t(o.getValue());e.dateFrom=a,e.dateTo=n,e.scope=this;var l={};e.table.attachEvent("onItemDblClick",(function(t){l=e.table.getSelectedItem(),webix.ajax().get(e.tableUrl,{dateFrom:a,dateTo:n,account:l.account,account_type:l.account_type}).then((function(t){var i="report"+l.account_id+(l.account_type||0);e.tableId=i,r.a[i]||(r.a[i]=s(c(t,e.tableId,e,"contragent"),e.scope,i),$$("views").addView({id:i,rows:[r.a[i]]}),$$("tabs").addOption(i,l.account,!0)),console.log(e.scope.$$("table-register"+e.tableId))}))})),$$("tabs").attachEvent("onOptionRemove",(function(e,t){$$("views").removeView(e),delete r.a[e]}))},t}(o.b)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return ReportCashFlowView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),components_comboClose__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_4__);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var ReportCashFlowView=function(_JetView){function ReportCashFlowView(){return _JetView.apply(this,arguments)||this}_inheritsLoose(ReportCashFlowView,_JetView);var _proto=ReportCashFlowView.prototype;return _proto.config=function(){return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",paddingY:2,cols:[{view:"label",label:"Баланс",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("balance-table")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.yearStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"treetable",localId:"balance-table",autoConfig:!0,css:"webix_header_border webix_data_border",hover:"myhover",leftSplit:1,expand:!0,header:!0,footer:!1,select:!0,editable:!0,math:!0,editMath:!0,editaction:"dblclick",resizeColumn:{headerOnly:!0},columns:[],ready:function(){},scheme:{}}]}]}},_proto.init=function init(view){var table=this.$$("balance-table"),format=webix.Date.dateToStr("%Y-%m-%d"),dateFrom=this.$$("dateFrom"),dateTo=this.$$("dateTo"),dateFromValue=format(this.$$("dateFrom").getValue()),dateToValue=format(this.$$("dateTo").getValue()),tableUrl=this.app.config.apiRest.getUrl("get","accounting/category/balance",{dateFrom:dateFromValue,dateTo:dateToValue}),scope=this;scope.changeColumns(dateFrom,dateTo),table.clearAll(),table.load(tableUrl),dateFrom.attachEvent("onChange",(function(e){dateFromValue=format(dateFrom.getValue()),dateToValue=format(dateTo.getValue()),scope.changeColumns(dateFrom,dateTo);var t=scope.app.config.apiRest.getUrl("get","accounting/category/balance",{dateFrom:dateFromValue,dateTo:dateToValue});table.clearAll(),table.load(t)})),dateTo.attachEvent("onChange",(function(e){dateFromValue=format(dateFrom.getValue()),dateToValue=format(dateTo.getValue()),scope.changeColumns(dateFrom,dateTo);var t=scope.app.config.apiRest.getUrl("get","accounting/category/balance",{dateFrom:dateFromValue,dateTo:dateToValue});table.clearAll(),table.load(t)})),table.attachEvent("onBeforeEditStop",(function(state,editor,ignoreUpdate){var record={};record=table.getItem(editor.row);var recordEdit={value:eval(state.value.replace("=",""))},id=record.ids[editor.column];id?(tableUrl=scope.app.config.apiRest.getUrl("get","accounting/report-balances/"+id),webix.ajax().put(tableUrl,recordEdit).then((function(e){webix.message("Данные сохранены!")}))):(recordEdit={value:eval(state.value.replace("=","")),date_balance:editor.column,category_id:editor.row,type:"parent_balance_id"},tableUrl=scope.app.config.apiRest.getUrl("get","accounting/report-balances"),webix.ajax().post(tableUrl,recordEdit).then((function(e){webix.message("Данные сохранены!")})))}))},_proto.addColumn=function(e,t){this.$$("balance-table").config.columns.splice(1,0,{id:e,header:t,width:100,css:{"text-align":"right"},format:webix.Number.format,editor:"text"}),this.$$("balance-table").refreshColumns()},_proto.resetColumns=function(){this.$$("balance-table").config.columns=[{id:"name",header:"Наиименование",width:380,sort:"string",open:!0,template:"{common.treetable()} #name#"},{id:"transaction_category_type",header:"type",width:380,sort:"string"}],this.$$("balance-table").refreshColumns()},_proto.changeColumns=function(e,t){var i=function(e,t){for(var i=[],o=webix.Date.monthStart(e);o<=t;webix.Date.add(o,1,"month"))i.push(new Date(o));return i}(e.getValue(),t.getValue());i.reverse();var o=webix.Date.dateToStr("%M %y"),a=webix.Date.dateToStr("%Y-%m-%d");for(var r in this.resetColumns(),i)this.addColumn(a(i[r]),o(i[r]))},ReportCashFlowView}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);i(1),i(2),i(4),i(3);var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",paddingY:2,cols:[{view:"label",label:"Движение денежных средств",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("category-table")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"treetable",localId:"category-table",autoConfig:!0,css:"webix_header_border webix_data_border",hover:"myhover",leftSplit:1,expand:!0,header:!0,footer:!1,select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"name",header:"Наиименование",width:380,sort:"string",open:!0,template:"{common.treetable()} #name#"},{id:"value",header:"Итого",width:100,css:{"text-align":"right","font-weight":"500",color:"#222"},format:webix.Number.format,footer:{content:"summColumn",css:{"text-align":"right"}}}],ready:function(){}}]}]}},a.init=function(e){var t=this.$$("category-table"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/category/cashflow",{dateFrom:r,dateTo:n}),s=this;s.changeColumns(o,a),t.clearAll(),t.load(l),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue()),s.changeColumns(o,a);var l=s.app.config.apiRest.getUrl("get","accounting/category/cashflow",{dateFrom:r,dateTo:n});t.clearAll(),t.load(l)})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue()),s.changeColumns(o,a);var l=s.app.config.apiRest.getUrl("get","accounting/category/cashflow",{dateFrom:r,dateTo:n});t.clearAll(),t.load(l)}))},a.addColumn=function(e,t){this.$$("category-table").config.columns.splice(1,0,{id:e,header:t,width:100,css:{"text-align":"right"},format:webix.Number.format}),this.$$("category-table").refreshColumns()},a.resetColumns=function(){this.$$("category-table").config.columns=[{id:"name",header:"Наиименование",width:380,sort:"string",open:!0,template:"{common.treetable()} #name#"},{id:"value",header:"Итого",width:100,css:{"text-align":"right","font-weight":"500",color:"#222"},format:webix.Number.format,footer:{content:"summColumn",css:{"text-align":"right"}}}],this.$$("category-table").refreshColumns()},a.changeColumns=function(e,t){var i=function(e,t){for(var i=[],o=new Date(e);o<=t;o.setDate(o.getDate()+1))i.push(new Date(o));return i}(e.getValue(),t.getValue());i.reverse();var o=webix.Date.dateToStr("%d %M %y"),a=webix.Date.dateToStr("%Y-%m-%d");for(var r in this.resetColumns(),i)this.addColumn(a(i[r]),o(i[r]))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);i(2),i(4),i(3);var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return{id:"layout",type:"wide",cols:[{rows:[{view:"toolbar",paddingY:2,cols:[{view:"label",label:"Движение денежных средств",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("category-chart")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"chart",localId:"cashflow-chart",type:"bar",value:"#value#",barWidth:20,radius:2,alpha:.7,gradient:"rising",xAxis:{template:"'#day#"},yAxis:{start:0,step:5e4,end:5e5},legend:{values:[{text:"Поступления",color:"#4aa397"},{text:"Выплаты",color:"#69ba00"},{text:"Остаток",color:"#de619c",markerType:"item"}],valign:"middle",align:"right",width:90,layout:"y"},series:[{value:"#income#",color:"#4aa397",label:"#income#",tooltip:{template:"#income#"}},{value:"#outcome#",color:"#69ba00",label:"#outcome#",tooltip:{template:"#outcome#"}},{type:"spline",value:"#value#",color:"#36abee",label:"#value#",item:{borderColor:"#b7286c",color:"#de619c",type:"s"},line:{color:"#de619c",width:2},tooltip:{template:"#value#"}}]}]}]}},a.init=function(e){var t=this.$$("cashflow-chart"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this,s=this.app.config.apiRest.getUrl("get","accounting/account/balanceaccountbydatechart",{dateFrom:r,dateTo:n});t.load(s),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var s=l.app.config.apiRest.getUrl("get","accounting/account/balanceaccountbydatechart",{dateFrom:r,dateTo:n});t.load(s)})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var s=l.app.config.apiRest.getUrl("get","accounting/account/balanceaccountbydatechart",{dateFrom:r,dateTo:n});t.load(s)}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));var o=i(0),a=(i(94),i(90));i(2);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.middleCoefMat=function(e,t){if(!t.length)return 0;for(var i=0,o=0,a=0,r=t.length-1;r>=0;r--)if(1==t[r].$level){var n=t[r].expense_mat,l=t[r].V;""!=n&&(null!==n&&(n=n.replace(".",",")),n=webix.Number.parse(n,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(n)||isNaN(l)||(i+=1*n,o+=1*l))}return 0!=o&&(a=i/o),webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.ui.datafilter.totalColumnCoefMat=webix.extend({refresh:function(e,t,i){var o,a,r=0,n=0,l=0;e.data.each((function(e){e.$group||(o=e.expense_mat,a=e.V,null!==o&&"0"!=a&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),o=parseFloat(o),isNaN(o)||(r+=1*o),n+=1*a))})),0!=n&&(l=r/n),r=webix.i18n.numberFormat(l,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(r=i.format(r)),i.template&&(r=i.template({value:r})),t.innerHTML=r}},webix.ui.datafilter.summColumn),webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var r=webix.Date.dateToStr("%d.%m.%y"),n=webix.Date.strToDate("%Y-%m-%d");var l=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var l=o.prototype;return l.config=function(){var e,t=this,i=this;this.apiRest=this.app.config.apiRest;this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"01.12.20"}}'});return{rows:[{cols:[{view:"label",width:200,height:30,template:"Отчет ЗП",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){i.doRefresh()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return t.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return t.doClickToExcel()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){i.doClickOpenAll()}},{view:"combo-close",localId:"employees",width:250,options:{data:i.apiRest.getCollection("accounting/employees",{"per-page":-1})}},{view:"select",value:1,labelWidth:100,localId:"select-type",options:[{id:1,value:"Обивка"},{id:2,value:"Столярка"},{id:3,value:"Швейка"},{id:4,value:"Крой"}],width:200,on:{onChange:function(e){4==e&&(e=3),i.showBatch(e)}}},{view:"icon",icon:"mdi mdi-tools",autowidth:!0,popup:{view:"contextmenu",scroll:"y",width:200,height:550,autoheight:!1,localId:"columns-setting",data:[{value:"Profile",href:"#profile"},{value:"Settings",href:"#settings"},{value:"Dummy"},{id:"logout",value:"Logout"}],$init:function(){i.loadColumnsSetting(this,null)},on:{onMenuItemClick:function(e){i.columnSettingClick(this,e)}}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"report-salary-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",dragColumn:!0,sort:"multi",headermenu:!0,tooltip:!0,columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:70,sort:"date",tooltip:"#F# <br>#C#-#D# Дата клиента: #H# <br>#E#<br> #I#<br> #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){var o;return o=1!=i.$$("select-type").getValue()?r(n(e.value)):e.value,1==e.$level?o:e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"E",header:["Тип",{content:"selectFilter"},""],width:100,editor:"text",hidden:!1},{id:"I",header:["Изделие",{content:"textFilter"},""],width:230,editor:"text",hidden:!1},{id:"product_id",header:["Изделие",{content:"textFilter"},""],width:200,editor:"combo",options:a.a},{id:"size",header:["Размер",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,css:{"text-align":"center"},editor:"text"},{id:"date_cut",header:["Дата.крой.",{content:"textFilter"},""],width:80,editor:"date",hidden:!1,batch:3,format:r},{id:"date_sewing",header:["Дата.пош.",{content:"textFilter"},""],width:80,editor:"date",hidden:!1,batch:3,format:r},{id:"P",header:["Отстр.",{content:"selectFilter"},""],width:80,batch:3},{id:"cost_sewing_cut_total_employee",header:["Итого",{content:"selectFilter"},{content:"totalColumn"}],width:100,batch:3,css:{color:"green","text-align":"right"}},{id:"cost_cut_total_employee",header:["Итого крой",{content:"selectFilter"},{content:"totalColumn"}],width:100,batch:3,css:{color:"green","text-align":"right"}},{id:"cost_cut_employee",header:["Раб. крой",{content:"selectFilter"},""],width:100,batch:3,css:{color:"green","text-align":"right"}},{id:"cost_cut_coef_employee",header:["Коэф. крой",{content:"selectFilter"},""],width:100,batch:3,css:{color:"green","text-align":"right"}},{id:"BY",header:["Настил",{content:"selectFilter"},""],width:100,batch:3,css:{color:"green","text-align":"right"},template:function(e){if(e.$group)return"";var t=e.BY;return 0==e.BY&&(t=""),t}},{id:"cost_cut_additionally",header:["Доп.крой.",{content:"numberFilter"},""],width:80,editor:"text",batch:3},{id:"cost_sewing_total_employee",header:["Итого пошив",{content:"selectFilter"},{content:"totalColumn"}],width:100,batch:3,css:{color:"green","text-align":"right"}},{id:"cost_sewing_employee",header:["Раб. пошив",{content:"selectFilter"},{content:"totalColumn"}],width:100,batch:3,css:{color:"green","text-align":"right"}},{id:"cost_sewing_ot_employee",header:["Раб. отстр.",{content:"selectFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right"},batch:3},{id:"cost_sewing_additionally",header:["Доп.шв.",{content:"numberFilter"},""],width:80,editor:"text",batch:3},{id:"cost_work_carpenter_employee",header:["Итого ст.",{content:"numberFilter"},{content:"totalColumn"}],width:110,batch:2,css:{color:"green","text-align":"right"}},{id:"cost_carpenter_carcass_employee",header:["Ст.цар.",{content:"numberFilter"},""],width:100,batch:2,css:{color:"green","text-align":"right"}},{id:"cost_carpenter_headboard_employee",header:["Ст.изг.",{content:"numberFilter"},""],width:100,batch:2,css:{color:"green","text-align":"right"}},{id:"cost_carpenter_grinding_employee",header:["Ст.шлиф.",{content:"numberFilter"},""],width:110,batch:2,css:{color:"green","text-align":"right"}},{id:"cost_carpenter_not_standard_employee",header:["Ст.нест.",{content:"numberFilter"},""],width:110,batch:2,css:{color:"green","text-align":"right"}},{id:"cost_carpenter_additionally",header:["Доп.ст.",{content:"numberFilter"},""],width:115,editor:"text",batch:2,css:{"text-align":"right"}},{id:"O",header:["Пугов.",{content:"selectFilter"},""],width:80,batch:1},{id:"cost_work_upholstery_employee",header:["Итого об.",{content:"numberFilter"},{content:"totalColumn"}],width:100,batch:1,css:{color:"green","text-align":"right"}},{id:"cost_rubber_carcass_employee",header:["Пор.цар.",{content:"numberFilter"},""],width:40,batch:1,css:{color:"green","text-align":"right"}},{id:"cost_rubber_headboard_employee",header:["Пор.изг.",{content:"numberFilter"},""],width:40,batch:1,css:{color:"green","text-align":"right"}},{id:"cost_upholstery_carcass_employee",header:["Об.цар.",{content:"numberFilter"},""],width:40,batch:1,css:{color:"green","text-align":"right"}},{id:"cost_upholstery_headboard_employee",header:["Об.изг.",{content:"numberFilter"},""],width:40,batch:1,css:{color:"green","text-align":"right"}},{id:"cost_buttons_employee",header:["Об.пуг.",{content:"numberFilter"},""],width:40,batch:1,css:{color:"green","text-align":"right"}},{id:"cost_upholstery_additionally",header:["Доп.об.",{content:"numberFilter"},""],width:115,editor:"text",batch:1,css:{"text-align":"right"}},{id:"AU",header:["ФИО пор.царг",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"AV",header:["Статус пор.царг",{content:"selectFilter"},""],width:50,batch:1,editor:"text"},{id:"AW",header:["Дата пор.царг",{content:"selectFilter"},""],width:100,batch:1,editor:"text"},{id:"AP",header:["ФИО пор.изг",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"AQ",header:["Статус пор.изг",{content:"selectFilter"},""],width:50,batch:1,editor:"text"},{id:"AR",header:["Дата пор.изг",{content:"selectFilter"},""],width:100,batch:1,editor:"text"},{id:"AK",header:["ФИО об.царг",{content:"selectFilter"},""],width:110,batch:1,editor:"text"},{id:"AL",header:["Статус об.царг",{content:"selectFilter"},""],width:50,batch:1,editor:"text"},{id:"AM",header:["Дата об.царг",{content:"selectFilter"},""],width:100,batch:1,editor:"text"},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text",batch:1},{id:"AZ",header:["Столярка ФИО",{content:"selectFilter",compare:function(e,t,i){return function(e,t,i){return null===e&&"null"===t||(""===e&&"Empty"===t||(""===e||null===e&&"null/Empty"===t||t==e))}(e,t)}},""],width:115,editor:"text",batch:2},{id:"BV",header:["Крой ФИО",{content:"selectFilter"},""],width:115,editor:"text",batch:3},(e={id:"BO",header:["Пошив ФИО",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},e.batch=3,e)],showColumnBatch:function(e,t){var i=void 0!==t;t=!1!==t,this.eachColumn((function(o,a){if(a.batch){var r=[a.batch];a.batch instanceof Array&&(r=a.batch);var n=this.isColumnVisible(a.id);t||(n=!n),r.indexOf(e)>-1&&n?this.hideColumn(a.id,!t,!0):i||-1!=r.indexOf(e)||n||this.hideColumn(a.id,t,!0)}}),!0),this._refresh_columns()},save:"api->accounting/orders",scheme:{$init:function(e){e.product_id||(e.$css="highlight")}},ready:function(){i.configColumns=this.config.columns;var e=webix.storage.local.get("report-salary-table");e&&this.setState(e)},scroll:!0,on:{onCollectValues:function(e,t){for(var i in t.values)if(null===t.values[i].value){var o=t.values[i];t.values.splice(i,1),t.values.unshift(o)}t.values.unshift({id:"Empty",value:"Empty"}),t.values.unshift({id:"null/Empty",value:"null/Empty"})},onColumnResize:function(){webix.storage.local.put("report-salary-table",this.getState())},onAfterColumnDrop:function(){webix.storage.local.put("report-salary-table",this.getState())},onAfterColumnShow:function(){},onresize:webix.once((function(){})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,t){}}}]}},l.init=function(e){var t=this.$$("report-salary-table"),i=this;this.getDataGroup();var o=this.$$("dateFrom"),a=this.$$("dateTo"),r=this.$$("employees");webix.extend(t,webix.ProgressBar),o.attachEvent("onChange",(function(e){i.getDataGroup()})),a.attachEvent("onChange",(function(e){i.getDataGroup()})),r.attachEvent("onChange",(function(e){i.getDataGroup()}))},l.getDataGroup=function(){var e=this.$$("report-salary-table"),t=webix.Date.dateToStr("%d.%m.%y"),i=this.$$("dateFrom"),o=this.$$("dateTo"),a=t(i.getValue()),l=t(o.getValue()),s=this.$$("employees").getText(),c=this.$$("select-type").getValue(),d="AE",u={filter:{AE:{">=":a,"<=":l}}};2==c&&(d="date_carpenter",u={filter:{date_carpenter:{">=":a,"<=":l}}}),3==c&&(d="date_sewing",u={filter:{or:[{date_sewing:{">=":a,"<=":l}},{date_cut:{">=":a,"<=":l}}]}}),4==c&&(d="date_cut",u={filter:{or:[{date_sewing:{">=":a,"<=":l}},{date_cut:{">=":a,"<=":l}}]}});var h={expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"'+d+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]'};if(""!==s){var p=s.split(" ");2==c&&(u={filter:{date_carpenter:{">=":a,"<=":l},AZ:p[0]}}),1==c&&(u={filter:{or:[{AE:{">=":a,"<=":l},AU:p[0]},{AE:{">=":a,"<=":l},AP:p[0]},{AE:{">=":a,"<=":l},AK:p[0]},{AE:{">=":a,"<=":l},Z:p[0]}]}}),3==c&&(u={filter:{or:[{date_sewing:{">=":a,"<=":l},BO:p[0]},{date_cut:{">=":a,"<=":l},BV:p[0]}]}}),4==c&&(u={filter:{or:[{date_sewing:{">=":a,"<=":l},BO:p[0]},{date_cut:{">=":a,"<=":l},BV:p[0]}]}}),h.employee=s}var m=this.app.config.apiRest.getUrl("get","accounting/orders",h);webix.ajax().get(m,u).then((function(t){e.clearAll(),e.parse(t.json().items),e.sort([{by:d,dir:"asc"}]),e.group({by:function(e){return 1!=c?r(n(e[d])):e[d]},map:{value:[d]}}),e.enable(),e.openAll()}))},l.doRefresh=function(){var e=this.$$("report-salary-table");e.disable(),e.showProgress({type:"icon",hide:!1}),this.getDataGroup()},l.doClickOpenAll=function(){var e=this.$$("report-salary-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},l.showBatch=function(e){webix.storage.local.remove("report-salary-table"),this.$$("report-salary-table").showColumnBatch(e);var t=this.$$("report-salary-table");t.disable(),t.showProgress({type:"icon",hide:!1}),this.getDataGroup()},l.loadColumnsSetting=function(e,t){var i,o=this,a=[];this.configColumns.forEach((function(r,n){i="wxi-eye-slash",o.$$("report-salary-table").isColumnVisible(r.id)&&(i="wxi-eye"),r.id==t&&(e.data[n].icon="webix_icon webix_list_icon "+i,e.updatItem(t)),a.push({value:r.header[0].text,id:r.id,icon:"webix_icon webix_list_icon "+i})})),e.data=a},l.columnSettingClick=function(e,t){var i="webix_icon webix_list_icon wxi-eye",o=i,a=this.$$("report-salary-table");a.isColumnVisible(t)?a.hideColumn(t,{spans:!1}):a.showColumn(t,{spans:!1}),e.getItem(t).icon==i&&(o="webix_icon webix_list_icon wxi-eye-slash"),e.getItem(t).icon=o,e.updateItem(t),webix.storage.local.put("report-salary-table",a.getState())},l.doClickPrint=function(){var e=this.$$("report-salary-table");webix.print(e,{fit:"data"})},l.doClickToExcel=function(){var e=this.$$("report-salary-table");webix.toExcel(e)},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Зарплатная ведомость",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("time-work-table")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"time-work-table",urlEdit:"time-work",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"employee_id",header:"ID",width:30,sort:"string"},{id:"employee_name",header:"Сотрудник",width:180,sort:"string"},{id:"is_piecework",header:"Тип",width:40,sort:"string"},{id:"rate",header:"Ставка",width:80,sort:"string"},{id:"rate_day",header:"Ставка за день",width:100,sort:"string"},{id:"work_time_days",header:"Дни посещения",width:100,sort:"string"},{id:"work_time_hours",header:"Дни по часам",width:100,sort:"string"},{id:"salary_rate",header:"ЗП по ставке",width:100,sort:"string"},{id:"salary_piecework",header:"ЗП по сдельно",width:100,sort:"string"},{id:"award",header:"Премия",width:100,sort:"string"},{id:"surcharges",header:"Доп./Выч.",width:100,sort:"string"},{id:"salary",header:"К выплате",width:100,sort:"string"}],url:this.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{sort:"name"}),on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){this.$$("form-search");var t=this.$$("time-work-table"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),r=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),l=i(this.$$("dateTo").getValue()),s=(this.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:n,dateTo:l}),this);o.attachEvent("onChange",(function(e){n=i(o.getValue()),l=i(r.getValue()),s.changeColumns(o,r);var a=s.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:n,dateTo:l});t.clearAll(),t.load(a)})),r.attachEvent("onChange",(function(e){n=i(o.getValue()),l=i(r.getValue()),s.changeColumns(o,r);var a=s.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:n,dateTo:l});t.clearAll(),t.load(a)})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("time-work-table").unselect(),this.cashEdit.showForm(this.$$("time-work-table"))},r.resetColumns=function(){this.$$("time-work-table").config.columns=[{id:"employee_name",header:"Сотрудник",width:180,sort:"string"}],this.$$("time-work-table").refreshColumns()},r.changeColumns=function(e,t){var i=function(e,t){for(var i=[],o=new Date(e);o<=t;o.setDate(o.getDate()+1))i.push(new Date(o));return i}(e.getValue(),t.getValue());i.reverse();var o=webix.Date.dateToStr("%D %d"),a=webix.Date.dateToStr("%Y-%m-%d");for(var r in this.resetColumns(),i)this.addColumn(a(i[r]),o(i[r]))},r.addColumn=function(e,t){var i=this.$$("time-work-table").config.columns;console.log(e),i.splice(1,0,{id:e+"end",header:t+" к.",width:60,css:{"text-align":"right"},format:webix.Number.format,template:function(t){return 0==t[e].end?"":t[e].end}}),i.splice(1,0,{id:e+"start",header:t+" н.",width:60,css:{"text-align":"right"},format:webix.Number.format,template:function(t){return 0==t[e].start?"":t[e].start}}),this.$$("time-work-table").refreshColumns()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);i(2),i(4),i(3);var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return{id:"layout",type:"wide",cols:[{rows:[{view:"toolbar",paddingY:2,cols:[{view:"label",label:"Объем производства по месяцам",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("category-chart")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.add(webix.Date.yearStart(new Date),-2,"year")},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"chart",localId:"cashflow-chart",type:"line",value:"#value#",label:"#value#",barWidth:55,radius:2,alpha:.7,gradient:"rising",xAxis:{template:"'#period#",lines:!1},yAxis:{start:0,step:1e6,end:5e6}}]}]}},a.init=function(e){var t=this.$$("cashflow-chart"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this,s=this.app.config.apiRest.getUrl("get","accounting/report/turn-over-by-month",{dateFrom:r,dateTo:n});t.load(s),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var s=l.app.config.apiRest.getUrl("get","accounting/report/turn-over-by-month",{dateFrom:r,dateTo:n});t.clearAll(),t.load(s)})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue());var s=l.app.config.apiRest.getUrl("get","accounting/report/turn-over-by-month",{dateFrom:r,dateTo:n});t.clearAll(),t.load(s)}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Настройки",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("setting-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"setting-table",urlEdit:"setting",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наименование",width:280,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/settings",{sort:"name"}),save:"api->accounting/settings",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("setting-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/settings"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("setting-table").unselect(),this.cashEdit.showForm(this.$$("setting-table"))},o}(o.b)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return StoreProductView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),components_comboClose__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_4__),helpers_localviews__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var StoreProductView=function(_JetView){function StoreProductView(){return _JetView.apply(this,arguments)||this}_inheritsLoose(StoreProductView,_JetView);var _proto=StoreProductView.prototype;return _proto.config=function config(){var _this=this,scope=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Магазин: Товары",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("store-product-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return _this.doAddClick()}}]},{view:"treetable",localId:"store-product-table",urlEdit:"products/default/",urlEditFull:!0,css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:["#",{content:"selectFilter"},""],width:80},{id:"name",header:["Наименование",{content:"selectFilter"},""],width:180,sort:"string"},{id:"sku",header:["Артикул",{content:"selectFilter"},""],width:70,sort:"string"},{id:"categories",header:["Категории",{content:"selectFilter"},""],width:70,sort:"string"},{id:"price",header:["Цена.розн",{content:"selectFilter"},""],width:120,sort:"string"},{id:"is_price_coef",header:["Розн.по.коэф",{content:"selectFilter"},""],width:100,sort:"string"},{id:"price_coef",header:["Розн.коэф",{content:"selectFilter"},""],width:90,sort:"string"},{id:"price_opt",header:["Цена.опт",{content:"selectFilter"},""],width:120,sort:"string"},{id:"is_active",header:["Активен",{content:"selectFilter"},""],width:70,sort:"string"},{id:"type_id",header:["Тип",{content:"selectFilter"},""],width:90,sort:"string"},{id:"manufacturer_id",header:["Производитель",{content:"selectFilter"},""],width:120,sort:"string"},{id:"site_id",header:["Сайт",{content:"selectFilter"},""],width:120,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"},{id:"action-image",header:"",width:50,template:"<i class='mdi mdi-image hover'></i>"},{id:"action-variant",header:"",width:50,template:"<i class='mdi mdi-eye hover'></i>"}],url:this.app.config.apiRest.getUrl("get","products",{expand:"data,categories,images","per-page":-1}),save:"api->products",scheme:{},on:{onItemClick:function onItemClick(id,e,trg){if("action-delete"==id.column){var table=this;webix.confirm("Удалить запись?").then((function(e){webix.dp(table).save(id.row,"delete").then((function(e){webix.dp(table).ignore((function(){table.remove(id.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-edit"==id.column&&this.$scope.cashEdit.showForm(this),"action-variant"==id.column){var item=this.getItem(id.row),url=scope.app.config.apiRest.getUrl("get","products/product-variant-speed/form-variant",{expand:"data,categories","per-page":-1,typeId:item.type_id});webix.ajax(url,(function(text){var text1=eval(text),win=scope.ui({view:"form-variant"},scope.$$("layout"));win.show()}))}if("action-image"==id.column){var _url=scope.app.config.apiRest.getUrl("get","products/product-image/form-image-list",{expand:"data","per-page":-1,product_id:id.row});webix.ajax(_url,(function(text){var text1=eval(text),win=scope.ui({view:"form-image-list"},scope.$$("layout"));win.show()}))}},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},_proto.init=function(e){var t=this.$$("form-search"),i=this.$$("store-product-table"),o=this;this.uploader=webix.ui({localId:"uploadAPI",name:"uploader",inputName:"uploader",view:"uploader",datatype:null,upload:"",apiOnly:!0}),t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","products"),a).then((function(e){i.parse(e)}))}));this.win=this.ui({view:"window",id:"tmpWin",position:"center",head:"Preview",close:!0,move:!0,body:{id:"tmp",view:"template",width:500,autoheight:!0}}),this.cashEdit=this.ui(core_updateFormView__WEBPACK_IMPORTED_MODULE_1__.a),this.cashEdit.attachFormEvents=function(e){var t=this,i=(this.state,this.$$("btn_save")),o=this.$$("btn_copy"),a=this.$$("uploader");i.attachEvent("onItemClick",(function(e){t.doClickSave()})),o.attachEvent("onItemClick",(function(e){t.doClickSave(!0)})),this.$$("formEdit").elements.id.attachEvent("onChange",(function(e,i,o){var r=t.app.config.apiRest.getUrl("get","accounting/images",{type:"image",model:"product",id:t.state.tableRecord.id});a.define({upload:r});var n=[],l=t.state.tableRecord.images;for(var s in l)n.push({id:l[s].id,name:l[s].name,sizetext:l[s].size,status:"server"});a.files.clearAll(),a.files.parse(n)})),a.files.attachEvent("onBeforeDelete",(function(e){var i=a.files.getItem(e),o=e;i.newId&&(o=i.newId),t.app.config.apiRest.delete("accounting/images",{id:o}).then((function(){var e=0;for(var i in t.state.tableRecord.images){if(t.state.tableRecord.images[i].id==o){t.state.tableRecord.images.splice(e,1);break}e++}}))})),a.attachEvent("onBeforeFileAdd",(function(e,t,i){var o=e.file,a=new FileReader;return a.onload=function(e){$$("tmpWin").getBody().setValues({src:e.target.result}),$$("tmpWin").show()},a.readAsDataURL(o),!0})),a.attachEvent("onFileUpload",(function(e,i,o){e.newId=i.data.id,t.state.tableRecord.images.push(i.data)}))}},_proto.doAddClick=function(){this.$$("store-product-table").unselect(),this.cashEdit.showForm(this.$$("store-product-table"))},StoreProductView}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Товар: Спецификация параметров",width:350},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("product-variant-speed-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"treetable",localId:"product-variant-speed-table",urlEdit:"products/product-variant-speed",urlEditFull:!0,css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:["#",{content:"selectFilter"},""],width:80},{id:"A",header:["Атрибут",{content:"selectFilter"},""],width:180,sort:"string"},{id:"B",header:["Вид.",{content:"selectFilter"},""],width:100,sort:"string"},{id:"C",header:["Вариант",{content:"selectFilter"},""],width:100,sort:"string"},{id:"E",header:["Вид добавления",{content:"selectFilter"},""],width:50,sort:"string"},{id:"D",header:["Значение добавления.",{content:"selectFilter"},""],width:70,sort:"string"},{id:"F",header:["Артикул",{content:"selectFilter"},""],width:180,sort:"string"},{id:"G",header:["Группа",{content:"selectFilter"},""],width:70,sort:"string"},{id:"product_id",header:["product_id",{content:"selectFilter"},""],width:90,sort:"string"},{id:"type_id",header:["Тип",{content:"selectFilter"},""],width:90,sort:"string"},{id:"is_active",header:["Активен",{content:"selectFilter"},""],width:70,sort:"string"},{id:"index",header:["index",{content:"selectFilter"},""],width:70,sort:"string"},{id:"site_id",header:["Сайт",{content:"selectFilter"},""],width:70,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","products/product-variant-speeds",{expand:"data,categories","per-page":-1}),save:"api->products/product-variant-speeds",scheme:{},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("product-variant-speed-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","product-variant-speeds"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("product-variant-speed-table").unselect(),this.cashEdit.showForm(this.$$("product-variant-speed-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Посещения",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("time-work-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"time-work-table",urlEdit:"time-work",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"date_work",header:"Дата",width:100,sort:"string"},{id:"employee_name",header:"Сотрудник",width:180,sort:"string"},{id:"time_start",header:"Начало работы",width:180,sort:"string"},{id:"time_end",header:"Конец работы",width:180,sort:"string",edit:"text"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/employee-time-works",{sort:"name"}),save:"api->accounting/employee-time-works",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("time-work-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/employee-time-works"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("time-work-table").unselect(),this.cashEdit.showForm(this.$$("time-work-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);i(1),i(2),i(4),i(3);var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Посещения",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("time-work-table"))}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.add(webix.Date.weekStart(new Date),6,"day")},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){e.doClickOpenAll()}}]},{view:"treetable",localId:"time-work-table",css:"webix_header_border webix_data_border",leftSplit:1,select:"cell",multiselect:!0,blockselect:!0,clipboard:"block",editable:!0,editaction:"dblclick",resizeColumn:{headerOnly:!0},hover:"myhover",columns:[],scheme:{$group:{by:"department_id",map:{department:["department"],department_id:["department_id"],department_name:["department_name"],employee_name:["employee_name"],value:["index"]}}},ready:function(){this.openAll()},on:{"data->onStoreUpdated":function(){},onAfterEditStop:function(e,t,i){e.value!=e.old&&this.$scope.afterEditStop(e,t,i)},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},a.init=function(e){this.$$("form-search");var t=this.$$("time-work-table"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),a=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),n=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:r,dateTo:n,expand:"department"}),s=this;s.changeColumns(o,a),t.clearAll(),t.load(l).then((function(){t.openAll()})),t.attachEvent("onPaste",(function(e){var t=this;this.getSelectedId(!0).forEach((function(e){s.updateRowPaste(e.column,t.getItem(e.row))}))})),o.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue()),s.changeColumns(o,a);var l=s.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:r,dateTo:n});t.clearAll(),t.load(l).then((function(){t.openAll()}))})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),n=i(a.getValue()),s.changeColumns(o,a);var l=s.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:r,dateTo:n});t.clearAll(),t.load(l).then((function(){t.openAll()}))}))},a.updateRowPaste=function(e,t){var i=this,o=e.replace("-start","").replace("-end",""),a=(t.employee_id,0),r=t[o+"-id"];-1!=e.indexOf("-start")&&(a=1);var n={id:r};n[a?"int_start":"int_end"]=t[e];var l=i.app.config.apiRest.getUrl("put","accounting/employee-time-works",{},n.id);webix.ajax().put(l,n,{error:function(o,a,r){i.$$("time-work-table").addCellCss(t.id,e,"webix_invalid_cell")},success:function(o,a,r){i.$$("time-work-table").addCellCss(t.id,e,"webix_editing_cell")}})},a.resetColumns=function(){this.$$("time-work-table").config.columns=[{id:"employee_name",header:"Сотрудник",width:240,sort:"string",template:function(e,t){return e.$group?t.treetable(e,t)+e.department_name:t.treetable(e,t)+e.index+". "+e.employee_name}}]},a.changeColumns=function(e,t){var i=function(e,t){for(var i=[],o=new Date(e);o<=t;o.setDate(o.getDate()+1))i.push(new Date(o));return i}(e.getValue(),t.getValue());i.reverse();var o=webix.Date.dateToStr("%D %d"),a=webix.Date.dateToStr("%Y-%m-%d");for(var r in this.resetColumns(),i)this.addColumn(a(i[r]),o(i[r]));this.$$("time-work-table").refreshColumns()},a.addColumn=function(e,t){var i=this.$$("time-work-table").config.columns,o=[{text:t,colspan:2},"н."];i.splice(1,0,{id:e+"-end",header:[{text:"",colspan:2},"к."],width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-end"]&&0!=t[e+"-end"]?t[e+"-end"]:""},cssFormat:function(t,i){var o;return o="Заявление"==i[e+"-type"]?"highlight-green":{},"Прогул"==i[e+"-type"]&&(o="highlight-red"),o}}),i.splice(1,0,{id:e+"-start",header:o,width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-start"]&&0!=t[e+"-start"]?t[e+"-start"]:""},cssFormat:function(t,i){var o;return o="Заявление"==i[e+"-type"]?"highlight-green":{},"Прогул"==i[e+"-type"]&&(o="highlight-red"),o}})},a.afterEditStop=function(e,t,i){var o=this.$$("time-work-table").getItem(t.row),a=t.column,r=e.value?e.value:0;this.updateRow(a,o,r)},a.updateRow=function(e,t,i){var o=this,a=e.replace("-start","").replace("-end",""),r=(t.employee_id,0),n=t[a+"-id"];-1!=e.indexOf("-start")&&(r=1);var l={id:n};l[r?"int_start":"int_end"]=i;var s=o.app.config.apiRest.getUrl("put","accounting/employee-time-works",{},l.id);webix.ajax().put(s,l,{error:function(i,a,r){o.$$("time-work-table").addCellCss(t.id,e,"webix_invalid_cell")},success:function(i,a,r){o.$$("time-work-table").addCellCss(t.id,e,"webix_editing_cell")}})},a.doClickOpenAll=function(){var e=this.$$("time-work-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));var o=i(0),a=i(1),r=i(88);i(2),i(4),i(3);var n=webix.Date.dateToStr("%d.%m.%y %H:%i");webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:250,height:100}}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var l=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var l=o.prototype;return l.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:220,label:"Дата отгрузки",labelWidth:100,width:230,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Заявления на отсутствие",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"employee-work-time-report-table",urlEdit:"employee-work-time-report",css:"webix_header_border webix_data_border",select:"cell",editable:!0,editaction:"dblclick",resizeColumn:{headerOnly:!0},columns:[{id:"date_created",header:"Дата",width:100,sort:"string",format:n,editor:"date"},{id:"employee_id",header:["Сотрудник",{content:"selectFilter"}],width:180,sort:"string",collection:r.a},{id:"date_absence_start",header:["Время отстутствия с",{content:"textFilter"}],width:180,sort:"string",editor:"date",format:n},{id:"date_absence_end",header:["Время отстутствия по",{content:"textFilter"}],width:180,sort:"string",edit:"text",editor:"date",format:n},{id:"type",header:["Тип отстутствия",{content:"textFilter"}],width:120,sort:"string",edit:"text",editor:"text"},{id:"description",header:["Примечание",{content:"textFilter"}],width:280,sort:"string",editor:"text"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/employee-work-time-reports",{sort:"-date_created"}),save:"api->accounting/employee-work-time-reports",scheme:{$init:function(e){"Прогул"==e.type&&(e.$css="highlight-red")}},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-edit"==e.column&&this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},l.init=function(e){var t=this.$$("form-search"),i=this.$$("employee-work-time-report-table"),o=this,r=webix.Date.dateToStr("%Y-%m-%d"),n=this.$$("dateFrom"),l=this.$$("dateTo"),s=r(this.$$("dateFrom").getValue()),c=r(this.$$("dateTo").getValue());t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/employee-work-time-reports",{sort:"-date_created",expand:"employee"}),a).then((function(e){i.parse(e)}))})),n.attachEvent("onChange",(function(e){s=r(n.getValue()),c=r(l.getValue());var t;t={filter:{date_absence_start:{">=":s,"<=":c}}};var a=o.app.config.apiRest.getUrl("get","accounting/employee-work-time-reports",{sort:"-date_created",expand:"employee"});webix.ajax().get(a,t).then((function(e){i.clearAll(),i.parse(e)}))})),l.attachEvent("onChange",(function(e){s=r(n.getValue()),c=r(l.getValue());var t;t={filter:{date_absence_start:{">=":s,"<=":c}}};var a=o.app.config.apiRest.getUrl("get","accounting/employee-work-time-reports",{sort:"-date_created",expand:"employee"});webix.ajax().get(a,t).then((function(e){i.clearAll(),i.parse(e)}))})),this.cashEdit=this.ui(a.a)},l.doAddClick=function(){this.$$("employee-work-time-report-table").unselect(),this.cashEdit.showForm(this.$$("employee-work-time-report-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));var o=i(0),a=i(18),r=i(19),n=i(20),l=i(21);i(2);var s=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s=o.prototype;return s.config=function(){var e=this;return{view:"window",position:function(e){e.left=52,e.top=41,e.width=e.maxWidth/3,e.height=e.maxHeight-41},head:"Редактирование операции",close:!0,modal:!0,body:{view:"form",localId:"my_form1",margin:40,scroll:"auto",elements:[{margin:10,rows:[{view:"text",name:"id",width:150,hidden:!0},{view:"segmented",name:"type_operation",value:1,inputWidth:320,options:[{id:1,value:"Поступление"},{id:2,value:"Расход"},{id:3,value:"Перемещение"}],align:"center"},{localId:"label_move_from",label:"Откуда",view:"label",height:38,css:{"text-align":"center"},hidden:!0},{cols:[{label:"Дата оплаты",value:new Date,view:"datepicker",labelWidth:100,name:"date_operation",timepicker:!0,stringResult:!0},{name:"is_committed",view:"checkbox",width:40,value:!0,checkValue:1,uncheckValue:2},{label:"Подтвердить оплату",view:"label"}]},{label:"Счет",name:"account_id",localId:"account",value:"",options:a.a,placeholder:"Выберите счет",view:"combo",height:38,labelWidth:100,required:!0,invalidMessage:"Значение не может быть пустым!"},{height:38,cols:[{name:"value",label:"Сумма",view:"text",height:0,labelWidth:100,value:0,placeholder:"0.00",format:"1 111.00",validate:webix.rules.isNumber,invalidMessage:"Field can not be empty",required:!0},{label:"UAH (Украинская гривна)",view:"label",height:36}]},{localId:"label_value_break",template:"<a class='show-combo-value-break' href='javascript:void(0);'>Разбить сумму</a>",height:20,css:{"padding-left":"100px","margin-top":"0px !important"},hidden:!1,onClick:{"show-combo-value-break":function(e,t){this.$scope.$$("combo_value_break").isVisible()?this.$scope.$$("combo_value_break").hide():this.$scope.$$("combo_value_break").show()}}},{hidden:!0,name:"type_part_id",localId:"combo_value_break",value:"",options:[{id:1,value:"Выберите как разбить сумму"},{id:2,value:"Контрагент"},{id:3,value:"Статья"},{id:4,value:"Проект"},{id:5,value:"Контрагент, Статья"}],placeholder:"Выберите как разбить сумму",view:"combo",height:38,css:{"padding-left":"100px","margin-top":"0px !important"},width:230,on:{onChange:function(e){this.$scope.$$("table_part_value").showColumnBatch(e),e>1?this.$scope.$$("layout_part_value").show():(this.$scope.$$("layout_part_value").hide(),this.$scope.$$("table_part_value").clearAll())}}},{localId:"layout_part_value",padding:30,css:{background:"#f7fafb"},hidden:!0,rows:[{localId:"table_part_value",view:"datatable",css:"webix_header_border webix_data_border",columns:[{id:"id",header:"",hidden:!0},{id:"index",header:"#",width:20},{id:"contragent_id",editor:"combo",header:"Контрагент",options:r.a,fillspace:!0},{id:"category_id",editor:"combo",options:l.a,header:"Статья",adjust:!0,hidden:!0,batch:"3"},{id:"project_id",editor:"combo",options:n.a,header:"Проект",adjust:!0,hidden:!0,batch:"4"},{id:"value",editor:"text",header:"Сумма",width:100,sort:"int",css:{"text-align":"right"}},{id:"part_procent",header:"Доля,%",width:70,css:{"text-align":"right",math:"[$r,value]"}},{id:"employee_id",header:"Сотрудник",width:70,css:{"text-align":"right",math:"[$r,value]"}},{id:"action-delete-part",header:"",width:40,template:"{common.trashIcon()}"}],editable:!0,headerRowHeight:25,rowHeight:25,scroll:!1,width:300,autoheight:!0,math:!0,scheme:{$init:function(e){e.index=this.count()+1}},on:{onItemClick:function(e,t,i){"action-delete-part"==e.column&&this.remove(e)}}},{cols:[{borderless:!0,localId:"label_add_row_table",template:"<a class='add-to-table' href='javascript:void(0);'>Добавить...</a>",height:20,css:{"margin-top":"0px !important",background:"#f7fafb"},hidden:!1,onClick:{"add-to-table":function(e,t){this.$scope.$$("table_part_value").add({contragent_id:"",category_id:"",project_id:"",value:"0.00"})}}},{borderless:!0,localId:"label_add_row_table",template:"<strong>Итого</strong>",height:20,width:100,css:{"text-align":"right",background:"#f7fafb"}},{borderless:!0,localId:"label_add_row_table",template:"0.00",height:20,width:100,css:{"text-align":"right",background:"#f7fafb"}},{borderless:!0,localId:"label_add_row_table",template:"0.00",height:20,width:70,css:{"text-align":"right",background:"#f7fafb"}},{borderless:!0,localId:"label_add_row_table",template:"",height:20,width:40,css:{"text-align":"right",background:"#f7fafb"}}]}]},{label:"Контрагент1",name:"contragent_id",localId:"contragent",value:"1",options:r.a,view:"combo-close",height:38,labelWidth:100,placeholder:"Выберите контрагента1"},{label:"Статья1",name:"category_id",localId:"category",value:"1",options:l.a,view:"combo",height:38,labelWidth:100,placeholder:"Выберите статью"},{localId:"label_move_to",label:"Куда",view:"label",height:38,css:{"text-align":"center"},hidden:!0},{label:"Счет",name:"account_move_id",localId:"account",value:"",options:a.a,placeholder:"Выберите счет",view:"combo",height:38,labelWidth:100,hidden:!0,required:!0,invalidMessage:"Значение не может быть пустым!"},{label:"Проект",name:"project_id",localId:"project",value:"1",options:n.a,view:"combo",height:38,labelWidth:100,placeholder:"Выберите проект"},{name:"comment",label:"Назначение платежа1",view:"text",height:52,labelWidth:100,placeholder:"Введите комментарий"}]},{margin:10,cols:[{view:"template",template:" ",role:"placeholder",borderless:!0},{view:"button",label:"Отмена",css:"webix_transparent",align:"right",width:120},{view:"button",css:"webix_primary",label:"Сохранить",align:"right",width:120,click:function(){return e.doClickSave()}}]}]}}},s.init=function(e){$$("table1")&&this.$$("my_form1").bind("table1"),this.attachFormEvents()},s.attachFormEvents=function(){var e=this.$$("my_form1").elements.type_operation;e.attachEvent("onChange",(function(e,t){3===e?(this.$scope.$$("label_move_from").show(),this.$scope.$$("label_move_to").show(),this.getFormView().elements.account_move_id.show(),this.getFormView().elements.contragent_id.hide(),this.getFormView().elements.category_id.hide(),this.$scope.$$("label_value_break").hide()):(this.$scope.$$("label_move_from").hide(),this.$scope.$$("label_move_to").hide(),this.getFormView().elements.account_move_id.hide(),this.getFormView().elements.contragent_id.show(),this.getFormView().elements.category_id.show(),this.$scope.$$("label_value_break").show())}))},s.showParts=function(e){var t=this.$$("table_part_value");if(t.clearAll(),e)for(var i in e.data)t.add(e.data[i])},s.showWindow=function(e){if(this.showParts($$("table1").getSelectedItem()),this.$$("my_form1").clearValidation(),this.$$("my_form1").attachEvent("onBindApply",(function(){null==$$("table1").getCursor()&&this.setValues({id:null,date_operation:new Date,is_committed:1,type_operation:2})})),"create"==e);else{if(4==$$("table1").getSelectedItem().type_operation)return;$$("table1").getSelectedItem()&&$$("table1").getSelectedItem().data?this.$$("combo_value_break").show():(this.$$("combo_value_break").setValue(1),this.$$("combo_value_break").hide())}this.getRoot().show()},s.doClickSave=function(){if(this.$$("my_form1").validate()){var e=this.$$("my_form1").getValues(),t=e.id,i=(webix.Date.dateToStr("%Y-%m-%d"),{type_operation:e.type_operation,date_operation:e.date_operation,is_committed:e.is_committed,value:e.value,comment:e.comment,value_in_user_currency:e.value,currency_id:1,account_id:e.account_id,account_move_id:e.account_move_id,category_id:e.category_id,contragent_id:e.contragent_id,project_id:e.project_id,account:{name:this.$$("account").getText()},category:{name:this.$$("category").getText()},contragent:{id:e.contragent_id,name:this.$$("contragent").getText()},project:{name:this.$$("project").getText()},type_part_id:e.type_part_id,id:e.id}),o=this;if(t){i={type_operation:e.type_operation,date_operation:e.date_operation,is_committed:e.is_committed,value:e.value,comment:e.comment,value_in_user_currency:e.value,currency_id:1,account_id:e.account_id,account_move_id:e.account_move_id,category_id:e.category_id,contragent_id:e.contragent_id,project_id:e.project_id,account:this.$$("account").getText(),category:this.$$("category").getText(),contragent:this.$$("contragent").getText(),project:this.$$("project").getText(),type_part_id:e.type_part_id,id:parseInt(t)};var a=this.getParts();i.data=a,webix.dp($$("table1")).save(t,"update",i).then((function(e){webix.dp($$("table1")).ignore((function(){$$("table1").updateItem(t,i)})),o.getRoot().hide()}),(function(){webix.message("Data were not saved")})),o.getRoot().hide()}else{a=this.getParts();i.data=a,webix.dp($$("table1")).save(webix.uid(),"insert",i).then((function(e){webix.dp($$("table1")).ignore((function(){i.id=e.id,$$("table1").add(i,0),$$("table1").select(i.id),$$("table1").scrollTo(0,0)})),o.getRoot().hide()}),(function(){webix.message("Data were not saved")}))}}},s.getParts=function(){var e=this.$$("table_part_value").serialize(),t=[];for(var i in e)t.push(e[i]);return t},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Категории затрат",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("category-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"category-table",urlEdit:"category",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:["#",{content:"selectFilter"},""],width:80},{id:"name",header:["Наименование",{content:"selectFilter"},""],width:380,sort:"string"},{id:"activity_type",header:["Тип категории",{content:"selectFilter"},""]},{id:"transaction_category_type",header:["Тип операции",{content:"selectFilter"},""]},{id:"account_category_type",header:["account_category_type",{content:"selectFilter"},""]},{id:"outcome_classification",header:["outcome_classification",{content:"selectFilter"},""]},{id:"parent_balance_id",header:["parent_balance_id",{content:"selectFilter"},""]},{id:"parent_id",header:"Родитель"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/categories"),save:"api->accounting/categories",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("category-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/categories"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("category-table").unselect(),this.cashEdit.showForm(this.$$("category-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пользователи",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("user-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"user-table",urlEdit:"user",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"username",header:"Логин",width:150},{id:"email",header:"E-mail",width:200},{id:"status",header:"Статус",width:80,sort:"string",collection:[{id:"10",value:"Активен"},{id:"0",value:"Неактивен"}]},{id:"type",header:"Тип прав",width:80,sort:"string"},{id:"last_login",header:"Последний заход",width:140,sort:"string"},{id:"login_ip",header:"IP адрес",width:120,sort:"string"},{id:"created_at",header:"Создан",width:140,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/users",{sort:"name"}),save:"api->accounting/users",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("user-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/users",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("user-table").unselect(),this.cashEdit.showForm(this.$$("user-table"))},r.doClickOpenAll=function(){var e=this.$$("user-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("user-package-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"user-package-table",urlEdit:"user-package",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"user_id",header:"USER_ID",width:80,sort:"string"},{id:"package_id",header:"PACKAGE_ID",width:80,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/user-packages",{sort:"name"}),save:"api->accounting/user-packages",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("user-package-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/user-packages",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("user-package-table").unselect(),this.cashEdit.showForm(this.$$("user-package-table"))},r.doClickOpenAll=function(){var e=this.$$("user-package-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("store-site-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"store-site-table",urlEdit:"store-site",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"domain",header:"Домен",width:200},{id:"user_id",header:"USER_ID",width:80,sort:"string"},{id:"sites_avalible",header:"Доступые сайты",width:140,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/store-sites",{sort:"name"}),save:"api->accounting/store-sites",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("store-site-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/store-sites",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("store-site-table").unselect(),this.cashEdit.showForm(this.$$("store-site-table"))},r.doClickOpenAll=function(){var e=this.$$("store-site-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Работы",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{}]},{view:"treetable",localId:"work-directory-table",urlEdit:"work",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"name",header:"Наименование",width:250,template:function(e,t){return e.$group?t.treetable(e,t)+e.department.name:t.icon(e)+e.name}},{id:"department_id",header:"Подразделение",width:250,collection:this.app.config.apiRest.getCollection("accounting/departments",{"per-page":-1})},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/works",{sort:'[{"property":"name", "direction" : "ASC"}]',expand:"department"}),save:"api->accounting/works",scheme:{$group:{by:"department_id",map:{value:["department_id"],department:["department"]}},$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){var t=this.$$("form-search"),i=this.$$("work-directory-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/works",{sort:"name"}),a).then((function(e){i.clearAll(!0),i.parse(e)}))})),this.cashEdit=this.ui(a.a)},r.doAddClick=function(){this.$$("work-directory-table").unselect(),this.cashEdit.showForm(this.$$("work-directory-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=(i(74),i(18),i(5));var r=i(86);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.config=function(){return a.a.table=new r.default(this.app,"table1","http://admin.startsellshop.local/api/accounting/transaction/table?auth_token=7110eda4d09e062aa5e4a390b0a572ac0d2c02206"),{id:"layout",cols:[{rows:[a.a.table]}]}},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));var o=i(0);i(16),i(2),i(4),i(3);var a=webix.Date.dateToStr("%M %y"),r=webix.Date.dateToStr("%D"),n=webix.Date.dateToStr("%d.%m"),l=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var l=o.prototype;return l.config=function(){var e,t=this,i=this;return(e={localId:"winEdit",view:"window",position:"center",width:1e3,height:800}).position=function(e){e.left=44,e.top=34,e.width=e.maxWidth/2,e.height=e.maxHeight-34},e.close=!0,e.modal=!0,e.head=i.getParam("name"),e.body={localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return t.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return t.doClickToExcel()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){i.doClickOpenAll()}}]},{view:"treetable",localId:"calendar-employee-table",urlEdit:"employee",css:"webix_header_border webix_data_border",leftSplit:1,math:!0,select:!0,editable:!0,editaction:"dblclick",header:"123",resizeColumn:{headerOnly:!0},columns:[{id:"date_work",header:[i.getParam("name"),""],width:120,sort:"string",template:function(e,t){return e.$group&&(e.$css="highlight-bold"),e.$group?t.treetable(e,t)+a(e.value):t.treetable(e,t)+n(e.date_work)}},{id:"day_week",header:["День нед.",""],width:70,sort:"string",hidden:!1,cssFormat:function(e,t){if(0==t.date_type)return{"background-color":"#eee"}},template:function(e){return r(e.date_work)}},{id:"int_start",header:["Нач",""],width:60,sort:"string",css:{"text-align":"center"},template:function(e){return e.$group||0==e.int_start?"":e.int_start}},{id:"int_end",header:["Оконч.",""],width:60,sort:"string",css:{"text-align":"center"},template:function(e){return e.$group||0==e.int_end?"":e.int_end}},{id:"qty_hours",header:["К-во часов.",""],width:100,sort:"string",css:{"text-align":"center"},template:function(e){return e.$group?"":e.qty_hours}},{id:"transaction_sum",header:["Оплата",""],width:100,sort:"string",css:{"text-align":"right"}},{id:"rate_day",header:["З.п/ч",""],width:100,sort:"string",css:{"text-align":"right"},numberFormat:"1111"},{id:"description",header:["Примечание",""],width:130,sort:"string",fillspace:!0}],url:this.app.config.apiRest.getUrl("get","accounting/employee-time-works",{filter:'{"employee_id":'+i.getParam("id")+"}","per-page":"-1",sort:"date_work"}),save:"api->accounting/employee-time-works",scheme:{$group:{by:function(e){return a(e.date_work)},map:{value:["date_work"],transaction_sum:["transaction_sum","sum"],rate_day:["rate_day","sum"]}},$sort:{by:"date_work",dir:"asc",as:"date"}},ready:function(){},on:{onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]},e},l.init=function(e){this.$$("calendar-employee-table")},l.showWindow=function(e){var t=this.$$("calendar-employee-table");t.closeAll();var i=e.getSelectedItem();this.dateDocument=i.date_document;var o=e.getIndexById(i.id),a=t.getIdByIndex(o);t.open(a),this.getRoot().show(),t.showItem(a)},l.doClickOpenAll=function(){var e=this.$$("calendar-employee-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},l.doClickPrint=function(){var e=this.$$("calendar-employee-table");webix.print(e,{fit:"data"})},l.doClickToExcel=function(){var e=this.$$("calendar-employee-table");webix.toExcel(e,{filename:"hours_"+this.getParam("name"),styles:!1,filter:function(t){return 1==e.isBranchOpen(e.getParentId(t.id))}})},o}(o.b)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return InproduceView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),views_comment_index__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9),views_order_check_work__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8),core_window_WindowDirectoryView__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(17),components_tableDynamic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(93),core_formView__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(37),components_comboClose__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_9__);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function formatPercent(e){return 100*e}webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)1==t[o].$level&&(isNaN(e(t[o]))||(i+=1*e(t[o])));return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0})},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:".",decimalSize:2}),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCountEmpty=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.toolsContent=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.mathColumn=webix.extend({refresh:function refresh(master,node,value){var result=0,result2=0,_val=0,_val2=0,res=0,resultFormula="res = 0;";this.sumRes={};var scope=this;master.data.each((function(e){if(!e.$group&&e["$"+value.columnId]){var t=e["$"+value.columnId].match(/[^\[.\]$']+/g);resultFormula="res";var i={};t.forEach((function(t){var o=t.replace("r,","");e[o]&&(scope.sumRes[o]||(scope.sumRes[o]=0),i[o]||(i[o]=!0,scope.sumRes[o]+=1*e[o]),o="this.sumRes['"+o+"']"),resultFormula+=o}))}})),"res = 0;"!=resultFormula&&eval(resultFormula),result=value.format(res),node.innerHTML=result}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:350,height:200}}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var formatDate=webix.Date.dateToStr("%d.%m.%y"),formatDateHour=webix.Date.dateToStr("%d.%m.%y %H:00"),formatDateShort=webix.Date.dateToStr("%d.%m"),formatDateTimeDb=webix.Date.dateToStr("%Y-%m-%d %H:%i"),formatMonthYear=webix.Date.dateToStr("%M %y"),formatDateTime=webix.Date.dateToStr("%d.%m.%y %H:%i"),parserDate=webix.Date.strToDate("%Y-%m-%d"),parserDateTime=webix.Date.strToDate("%Y-%m-%d %H:%i"),parserDateTimeGroup=webix.Date.strToDate("%d.%m.%y %H:%i");function custom_checkbox(e,t,i){return i?"<div class='webix_table_checkbox checked'> YES </div>":"<div class='webix_table_checkbox notchecked'> NO </div>"}function columnGroupTemplate(e,t,i){return e.$group?t.treetable(e,t)+e.property_value:t.icon(e)+t.folder(e,t)+" "+i}webix.editors.buttonEditor={focus:function(){this.getInputNode(this.node).focus(),this.getInputNode(this.node).select()},getValue:function(){return this.getInputNode(this.node).refValue},setValue:function(e,t){var i="",o=this.config.collection.getItem(e);o&&(i=o.value),this.getInputNode(this.node).value=i,this.getInputNode(this.node).refValue=e},getInputNode:function(){return this.node.firstChild},render:function(){return webix.html.create("div",{class:"webix_dt_editor"},"<input type='text' disabled='disabled' /><button class='editor-button' style='position: absolute;margin: 1px; right:0; height:25px;'>...</button>")}};var InproduceView=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var i=t.prototype;return i.config=function(){var e=document.location.hash.split("/"),t=e[e.length-1];webix.storage.local.get(t+"_filter_state");return this.api=this.app.config.apiRest,{localId:"layout"}},i.urlChange=function(e,t){this.getParam("mode",!0);var i=this.getParam("mode",!0);this.mode=i,t[1]&&(this.urlParams=t[1].params),this.initParam&&this.setPage(),this.initParam=!0},i.init=function(e){var t=this;this.initParam=!1,this.use(webix_jet__WEBPACK_IMPORTED_MODULE_0__.c.UrlParam,["mode","id","account_id"]);var i=this.getParam("mode");this.app.statusView&&(i=this.app.statusView),this.mode=i,this.formEdit=this.ui(core_updateFormView__WEBPACK_IMPORTED_MODULE_1__.a),this.formComment=this.ui(views_comment_index__WEBPACK_IMPORTED_MODULE_2__.default),this.formView=this.ui(views_order_check_work__WEBPACK_IMPORTED_MODULE_3__.default),this.windowDirectory=this.ui(core_window_WindowDirectoryView__WEBPACK_IMPORTED_MODULE_4__.a);var o={view:"table-dynamic",state:{scope:t,params:{mode:i,id:this.getParam("id"),account_id:this.getParam("account_id")},apiRest:this.app.config.apiRest,urlTableUserLists:this.app.config.apiRest.getUrl("get","accounting/schema-table-user-lists",{"per-page":-1,sort:"sort_order"}),urlTableSettingUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-setting-users",{"per-page":-1,sort:'[{"property":"type_property","direction":"ASC"},{"property":"property_title","direction":"ASC"}]'}),urlTableUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-users",{"per-page":-1,sort:'[{"property":"sort_order","direction":"ASC"},{"property":"column_id","direction":"ASC"}]'}),urlTableUsersSave:"api->accounting/schema-table-users",urlTableSettingUsersSave:"api->accounting/schema-table-setting-users",urlTableUserListsPut:"accounting/schema-table-user-lists",formEdit:this.formEdit,formView:this.formView,formComment:this.formComment,windowDirectory:this.windowDirectory,type:"table"},stateCache:webix.storage.local.get(this.mode+"_table_filter_state")};this.table=webix.ui(o,this.$$("layout")),this.lastXHR={},webix.attachEvent("onBeforeAjax",(function(e,i,o,a,r,n,l){if(Object.keys(t.lastXHR).length>0)for(var s in t.lastXHR){var c=t.lastXHR[s];console.log(c.readyState),console.log("set abort = "),console.log(c),c.abort()}t.lastXHR[i]=a,console.log("set onBeforeAjax xhr = "),console.log(a),l.then((function(){delete t.lastXHR[i]}),(function(){delete t.lastXHR[i]}))}))},i.setPage=function(){this.table.state.params={mode:this.mode,id:this.getParam("id"),account_id:this.getParam("account_id")},this.table.state.stateCache=webix.storage.local.get(this.mode+"_filter_state"),this.table.setPage()},t}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(7),r=i(15);i(92);window.procent=function(e,t){var i=$$("table_part").getItem(e),o=$$(t).getValue();return Math.round(100*i.value*100/o)/100};var n=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){this.apiRest=this.app.config.apiRest,this.win={};return this.win},n.init=function(e,t){},n.showForm=function(e){var t=this,i=this,o=this.state,a=(this.apiRest,e.getSelectedItem()),n=a;o.tableId=e.config.urlEdit,o.table=e,o.tableRecord=a,o.isUpdate=n,o.formEdit=this.$$("formEdit"),o.formUrl="accounting/"+o.tableId+"/form",o.win={};var l=new r.default(this.app,"document-salary-accrual",a);o.win=this.ui({localId:"winEdit",view:"window",move:!0,resize:!0,height:500,position:"center",head:{cols:[{template:"Начисление зарплаты",type:"header",borderless:!0},{view:"icon",icon:"mdi mdi-fullscreen",tooltip:"enable fullscreen mode",click:function(e,t){o.win.config.fullscreen?(webix.fullscreen.exit(),this.define({icon:"mdi mdi-fullscreen",tooltip:"Enable fullscreen mode"})):(webix.fullscreen.set(o.win),this.define({icon:"mdi mdi-fullscreen-exit",tooltip:"Disable fullscreen mode"})),this.refresh()}},{view:"icon",icon:"wxi-close",tooltip:"Close window",click:function(){o.win.close()}}]},close:!0,modal:!0,body:{view:"layout",padding:10,margin:10,rows:[{localId:"formEdit",view:"form",width:1400,elements:[{margin:10,cols:[{id:"form_edit_id",label:"ID",name:"id",localId:"id",value:"",placeholder:"ID",view:"text",height:38,labelWidth:50,width:150,disabled:!0,invalidMessage:"Значение не может быть пустым!"},{id:"form_edit_date_document",name:"date_document",view:"datepicker",localId:"date_document",label:"Дата",labelWidth:50,width:180,value:new Date,required:!0,invalidMessage:"Значение не может быть пустым!"},{id:"form_edit_date_created",name:"date_created",view:"datepicker",localId:"date_created",label:"Дата",labelWidth:50,width:180,value:new Date,required:!0,invalidMessage:"Значение не может быть пустым!",hidden:!0},{id:"form_edit_type_document",name:"type_document",view:"text",localId:"type_document",label:"Тип документа",labelWidth:50,width:180,value:"",disabled:!0,format:"1 111,00",invalidMessage:"Значение не может быть пустым!",hidden:!0},{id:"form_edit_sum",name:"sum",view:"text",localId:"sum",label:"Сумма",labelWidth:50,width:180,value:"",disabled:!0,format:"1 111,00",invalidMessage:"Значение не может быть пустым!"}]}]},{view:"toolbar",paddingY:0,elements:[{view:"icon",icon:"mdi mdi-plus",autowidth:!0,click:function(){return t.doClickAdd()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,click:function(){return t.doClickFillAll()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return t.doClickPrint()}},{}]},l,{margin:10,cols:[{view:"template",template:" ",role:"placeholder",borderless:!0},{view:"button",label:"Печать",css:"webix_transparent",align:"right",width:120,click:function(){return t.doClickPrint()}},{view:"button",label:"Отмена",css:"webix_transparent",align:"right",width:120,click:function(){return t.doClickCancel()}},{view:"button",css:"webix_primary",label:"Сохранить",align:"right",width:120,click:function(){return t.doClickSave()}}]}]}}),webix.promise.defer().resolve(o.win.getBody()).then((function(e,t){var a=o.win.getBody().queryView({localId:"document-salary-accrual-table"});a.waitData.then((function(){a.data.attachEvent("onDataUpdate",(function(e,t,o){i.setSumByTableRows()})),a.data.attachEvent("onAfterAdd",(function(e,t,o){i.setSumByTableRows()})),a.data.attachEvent("onAfterDelete",(function(e){i.setSumByTableRows()})),a.data.attachEvent("onItemClick",(function(e){})),i.setSumByTableRows()}))})),o.win.show()},n.setSumByTableRows=function(){var e=this.state,t=e.win.getBody().queryView({localId:"document-salary-accrual-table"}),i=0;t.data.each((function(e){i+=parseFloat(e.salary),console.log(e),console.log(i)})),e.tableRecord.sum=i,e.win.getBody().queryView({localId:"formEdit"}).setValues(this.getRecord())},n.getRecord=function(){var e=this.state;return e.isUpdate?e.tableRecord:{date_operation:new Date,is_committed:1,type_operation:2}},n.doClickSave=function(e){void 0===e&&(e=!1),this.doSaveTable()},n.doSaveTable=function(){var e=this,t=this.state.win.getBody().queryView({localId:"document-salary-accrual-table"}),i=this.app.config.apiRest.getUrl("create","accounting/document-salary-accruals"),o=this.app.config.apiRest.getUrl("put","accounting/document-salary-accruals"),a=this.state.win.getBody().queryView({localId:"date_document"}).getValue(),r=this.app.config.apiRest.getUrl("create","accounting/list-salary-accruals"),n={},l=e.state.tableRecord?e.state.tableRecord.id:null,s=this.state;if(s.formEdit=s.win.getBody().queryView({localId:"formEdit"}),s.formEdit.validate()){var c=s.formEdit.getValues();t.data.each((function(t){if(!t.$group){for(var c in t)-1!=c.indexOf("$")&&delete t[c];delete t.depends,delete t.triggers,t.date_document=a,t.list_id?(o=e.app.config.apiRest.getUrl("put","accounting/document-salary-accruals",{},t.id),webix.ajax().sync().put(o,t)):(!1,t.list_id=l,delete t.id,n={date_document:a,type_document:7,sum:0},null==l?webix.ajax().post(r,n).then((function(e){var o=e.json();l=o.id,t.list_id=l,s.formEdit.setValues(o),webix.ajax().post(i,t).then((function(e){s.table.add(o),s.table.updateItem(l,o)})).then((function(){s.win.close()}))})):webix.ajax().post(i,t).then((function(e){})).then((function(){s.win.close()})))}})),c=s.formEdit.getValues(),s.table.updateItem(c.id,c),s.win.close()}},n.doClickCancel=function(){this.state.win.close()},n.doClickFillAll=function(e){void 0===e&&(e="");var t=this.state,i=this.state.win.getBody().queryView({localId:"document-salary-accrual-table"}),o={sort:"employee_name",dateDocument:webix.Date.dateToStr("%Y-%m-%d")(t.win.getBody().queryView({localId:"date_document"}).getValue()),filter1:'{"date_carpenter":{">=": "01.02.21", "<=":"28.02.21"}}',employee:"Василенко Роман"};e&&(o.employee_id=e);var a=this.app.config.apiRest.getUrl("get","accounting/employee-time-work/get-salary-by-days",o);webix.ajax().get(a).then((function(t){var o,a=t.json().data,r=[];for(var n in i.data.each((function(e){r[e.employee_id]=e})),a)if(delete(o=a[n]).id,r[o.employee_id]){if(""!=e){var l=[];for(var s in o)parseFloat(o[s])&&Math.round(o[s])!=Math.round(r[o.employee_id][s])&&l.push(s);for(var c in i.updateItem(r[o.employee_id].id,o),l)i.addCellCss(r[o.employee_id].id,l[c],"webix_editing_cell")}}else o.$css="webix_editing_cell",i.add(o);i.editCell(1,"employee_name",!0,!0)}))},n.doClickPrint=function(){var e=this.state.win.getBody().queryView({localId:"document-salary-accrual-table"});webix.print(e,{mode:"landscape",fit:"data"})},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));i(0);var o=i(1);i(2),i(4),i(3);var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){var e=this;return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=44,e.top=34,e.width=e.maxWidth/1.5,e.height=e.maxHeight-34},head:"Редактирование",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"auto",elements:[{borderless:!1,margin:10,type:"space",rows:[{cols:[{id:"order_field",label:"Свойство заказа",name:"order_field",options:{data:this.apiRest.getCollection("accounting/calculation-fields")},view:"combo",labelPosition:"top"},{id:"index_order",label:"Порядок выполнения",name:"index_order",view:"text",labelPosition:"top"},{id:"process_id",label:"Процесс",name:"process_id",view:"text",labelPosition:"top"},{},{},{},{}]},{cols:[{rows:[{id:"type",label:"Тип свойства",name:"type",options:[{id:"value",value:"Значение"},{id:"dir",value:"Справочник"}],view:"combo",labelPosition:"top"},{hidden:!1,rows:[{id:"directory_id",label:"Справочник",name:"directory_id",options:{data:this.apiRest.getCollection("accounting/calculation-directories")},view:"combo",labelPosition:"top"},{id:"directory_field",label:"Свойство справочника",name:"directory_field",options:[],view:"combo",labelPosition:"top"}]}]},{width:40},{rows:[{cols:[{label:"Условие",name:"rule",value:"=",options:["=",">","<",">=","<="],view:"combo",labelPosition:"top"},{label:"Значение",name:"value",value:"",view:"text",required:!0,labelPosition:"top"}]}]},{width:40},{rows:[{id:"result_type",label:"Тип результата",name:"result_type",value:"1",options:[{id:"value",value:"Значение"},{id:"dir",value:"Справочник"}],view:"combo",labelPosition:"top"},{hidden:!1,rows:[{label:"Свойство заказа для справочника",name:"order_result_type",value:"product_id",view:"combo",labelPosition:"top",hidden:!0},{id:"result_directory_id",label:"Справочник",value:"1",name:"result_directory_id",options:{data:this.apiRest.getCollection("accounting/calculation-directories")},view:"combo",labelPosition:"top"},{id:"result_directory_field",label:"Свойство справочника",name:"result_directory_field",view:"combo",labelPosition:"top",options:[]}]}]},{hidden:!1,rows:[{id:"result_value_operation",label:"Операция со значением",name:"result_value_operation",options:["=","+","-","+%","-%","formula"],view:"combo",labelPosition:"top"}]},{rows:[{id:"result_value",label:"Значение",hidden:!1,disabled:!1,name:"result_value",value:"",view:"text",labelPosition:"top"},{label:"Формула",view:"text",labelPosition:"top",name:"result_formula",hidden:!0}]}]}]},{margin:10,cols:[{view:"template",template:" ",role:"placeholder",borderless:!0},{view:"button",localId:"btn_copy",label:"Копировать",css:"webix_transparent",align:"right",width:120},{view:"button",label:"Отмена",css:"webix_transparent",align:"right",width:120,click:function(){return e.doClickCancel()}},{view:"button",localId:"btn_save",css:"webix_primary",label:"Сохранить",align:"right",width:120}]}]}}},a.init=function(){this.attachFormEvents()},a.attachFormEvents=function(){var e=this,t=(this.state,this.$$("btn_save")),i=this.$$("btn_copy"),o=this.$$("directory_id"),a=this.$$("directory_field"),r=this.$$("type"),n=this.$$("result_type"),l=this.$$("result_directory_id"),s=this.$$("result_directory_field"),c=this.$$("result_value"),d=this.$$("result_value_operation");this.apiRest;t.attachEvent("onItemClick",(function(t){e.doClickSave()})),i.attachEvent("onItemClick",(function(t){e.doClickSave(!0)})),o.attachEvent("onChange",(function(e){if(""!=e){a.setValue();var t=new webix.DataCollection({data:o.getList().getItem(o.getValue()).fields});a.getPopup().getList().sync(t)}})),r.attachEvent("onChange",(function(e){"dir"!=e?(o.hide(),a.hide()):(o.show(),a.show())})),l.attachEvent("onChange",(function(e){if(""!=e){s.setValue();var t=new webix.DataCollection({data:l.getList().getItem(l.getValue()).fields});s.getPopup().getList().sync(t)}})),n.attachEvent("onChange",(function(e){"dir"!=e?(l.hide(),s.hide(),c.show()):(l.show(),s.show(),c.hide())})),d.attachEvent("onChange",(function(e){"formula"==e&&"dir"==n.getValue()&&c.show()}))},o}(o.a)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);webix.GroupMethods.medianEmpty=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})};var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{view:"window",close:!0,modal:!0,height:500,width:600,position:"center",head:{cols:[{template:"Мощность в часах",type:"header",borderless:!0},{view:"icon",icon:"mdi mdi-fullscreen",tooltip:"enable fullscreen mode",click:function(){e.getRoot().config.fullscreen?(webix.fullscreen.exit(),this.define({icon:"mdi mdi-fullscreen",tooltip:"Enable fullscreen mode"})):(webix.fullscreen.set(e.getRoot()),this.define({icon:"mdi mdi-fullscreen-exit",tooltip:"Disable fullscreen mode"})),this.refresh()}},{view:"icon",icon:"wxi-close",tooltip:"Close window",click:function(){e.getRoot().close()}}]},body:{localId:"layout",type:"wide",cols:[{rows:[{view:"treetable",localId:"power-table",urlEdit:"employee",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[],scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}}},r.showWindow=function(){this.getRoot().show()},r.init=function(e){var t=this.$$("power-table");this.table=t;var i=this._parent.dateFrom,o=this._parent.dateFrom,r=(this.table,this.app.config.apiRest.getUrl("get","accounting/employee-time-work/powers",{dateFrom:i,dateTo:o,expand:"department,employee",filter:{status:1}}));this.changeColumns(i,o),t.clearAll();var n=i+"-power",l={department:["department"],department_id:["department_id"],department_name:["department_name"],employee_name:["employee_name"],value:["index"]};l[n]=[n,"medianEmpty"],t.load(r).then((function(){t.group({by:"department_id",map:l}),t.openAll()})),this.cashEdit=this.ui(a.a)},r.changeColumns=function(e,t){this.$$("power-table");var i=webix.Date.strToDate("%Y-%m-%d"),o=function(e,t){for(var i=[],o=new Date(e);o<=t;o.setDate(o.getDate()+1))i.push(new Date(o));return i}(i(e),i(t));o.reverse();var a=webix.Date.dateToStr("%D %d"),r=webix.Date.dateToStr("%Y-%m-%d");for(var n in this.resetColumns(),o)this.addColumn(r(o[n]),a(o[n]));this.$$("power-table").refreshColumns()},r.addColumn=function(e,t){var i=this.$$("power-table").config.columns,o=[{text:t,colspan:2},"н."];i.splice(1,0,{id:e+"-power",header:"Мощность, ч",fillspace:!0,css:{"text-align":"right"},format:webix.Number.format,editor:"text"}),i.splice(1,0,{id:e+"-end",header:[{text:"",colspan:2},"к."],width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-end"]&&0!=t[e+"-end"]?t[e+"-end"]:""}}),i.splice(1,0,{id:e+"-start",header:o,width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-start"]&&0!=t[e+"-start"]?t[e+"-start"]:""}})},r.resetColumns=function(){this.$$("power-table").config.columns=[{id:"employee_name",header:"Сотрудник",width:240,sort:"string",template:function(e,t){return e.$group?t.treetable(e,t)+e.department_name:t.treetable(e,t)+e.index+". "+e.employee_name}}]},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return u}));var o=i(0),a=(i(74),i(91),i(18)),r=i(19),n=i(20),l=i(21),s=i(7);window.procent=function(e,t){var i=$$("table_part").getItem(e),o=$$(t).getValue();return Math.round(100*i.value*100/o)/100};var c=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state||(o.state=new s.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o))),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=44,e.top=34,e.width=e.maxWidth/3,e.height=e.maxHeight-34},head:"Редактирование операции",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"auto",elements:this.state.formConfig}}},a.init=function(e,t){this.attachClickEvents()},a.showForm=function(e){var t=this,i=this.state,o=this.apiRest,a=e.getSelectedItem(),r=a;i.tableId=e.config.urlEdit,i.table=e,i.tableRecord=a,i.isUpdate=r,i.formEdit=this.$$("formEdit"),i.formUrl="accounting/"+i.tableId+"/form",i.win=this.$$("winEdit"),i.formEdit.clearValidation(),o.get(i.formUrl).then((function(e){t.showWindow(e,t)}))},a.showWindow=function(e,t){var i=t.state,o=Object.keys(i.formEdit.elements).length,a=e.json();i.formData=a,t.renderForm(o),i.formEdit.setValues(t.getRecord()),t.bindCollection(a),t.bindColumnCollection(a),t.showParts(i.tableRecord)},a.getRecord=function(){var e=this.state;return e.isUpdate?e.tableRecord:{date_operation:new Date,is_committed:1,type_operation:2}},a.attachFormParamsElements=function(){var e=this.state;this.$$("table_part_value").scheme_setter({$init:function(e){e.index=this.count()+1}}),e.table.scheme_setter({$init:function(e){},$update:function(e){}})},a.renderForm=function(e){var t=this.state;t.formConfig=t.formData.data.configForm,webix.ui(t.formConfig,t.formEdit),this.attachFormParamsElements(),this.attachFormEvents()},a.bindCollection=function(e){var t=this.state,i=this.apiRest,o=0,a=e.data.dataCollections,r=Object.keys(a).length,n={"per-page":-1};for(var l in a){var s=$$(l).getPopup().getList(),c=i.getCollection(a[l].url,n);c.waitData.then((function(){++o===r&&t.win.show()})),s.sync(c)}},a.bindColumnCollection=function(e){var t=this.apiRest,i={"per-page":-1},o=e.data.columnCollections;for(var a in o){var r=o[a];for(var n in r)this.$$(a).getColumnConfig(n).options=t.getCollection(r[n].url,i);this.$$(a).refreshColumns()}},a.attachFormEvents=function(){var e=this,t=this.state.formEdit.elements.type_operation,i=this.$$("combo_value_break"),o=this.$$("table_part_value"),a=this.$$("btn_save"),r=$$("form_edit_sum");t.attachEvent("onChange",(function(t,i){e.typeOperationChange(t)})),i.attachEvent("onChange",(function(t){e.comboValueBreakChange(t)})),a.attachEvent("onItemClick",(function(t){e.doClickSave()})),o.attachEvent("onItemClick",(function(e,t,i){"action-delete-part"===e.column&&this.remove(e.row)})),r.attachEvent("onChange",(function(e,t,i){1===o.data.count()&&(o.getItem(o.getIdByIndex(0)).value=e),o.refreshColumns()}))},a.typeOperationChange=function(e){var t=this.state,i=this.$$("label_move_from"),o=this.$$("label_move_to"),a=this.$$("label_value_break"),r=t.formEdit.elements.account_move_id,n=t.formEdit.elements.contragent_id,l=t.formEdit.elements.category_id,s=this.$$("combo_value_break"),c=3==e,d=[{element:i,status:c},{element:o,status:c},{element:r,status:c},{element:a,status:!c},{element:n,status:!c},{element:l,status:!c}];for(var u in c&&s.setValue(1),d)d[u].status?d[u].element.show():d[u].element.hide()},a.comboValueBreakChange=function(e){var t=this.state,i=this.$$("table_part_value"),o=this.$$("combo_value_break"),a=this.$$("layout_part_value"),r=t.formEdit.elements.contragent_id,n=t.formEdit.elements.category_id,l=t.formEdit.elements.project_id,s=e>1,c=3==e,d=4==e,u=[{element:a,status:s},{element:o,status:s},{element:r,status:!s},{element:n,status:!c},{element:l,status:!d}];for(var h in c&&n.setValue(""),d&&l.setValue(""),r.setValue(""),i.showColumnBatch(e),u)u[h].status?u[h].element.show():u[h].element.hide();s||i.clearAll()},a.attachClickEvents=function(){var e=this;webix.attachEvent("onClick",(function(t,i,o){t.target&&("show-combo-value-break"===t.target.classList.value&&e.onClickShowComboValueBreak(),"add-to-table"===t.target.classList.value&&e.$$("table_part_value").add({index:"",contragent_id:"",category_id:"",project_id:"",value:"0.00",part_procent:""}))}))},a.onClickShowComboValueBreak=function(){this.$$("combo_value_break").isVisible()?this.$$("combo_value_break").hide():this.$$("combo_value_break").show()},a.showParts=function(e){var t=this.state,i=this.$$("table_part_value");if(i.clearAll(),e){var o=t.table.data.getBranch(e.id);for(var a in o)i.add(o[a])}},a.doClickSave=function(){var e=this.state;if(e.formEdit.validate()){var t=e.formEdit.getValues();"undefined"!=t.$count&&delete t.$count,"undefined"!=t.$level&&delete t.$level,"undefined"!=t.$parent&&delete t.$parent,"undefined"!=t["action-edit"]&&delete t["action-edit"],"undefined"!=t["action-view"]&&delete t["action-view"],"undefined"!=t["action-delete"]&&delete t["action-delete"],t.account={name:this.$$("account").getText()};var i=this.getParts();i.length;var o=[];for(var a in 2==t.type_part_id&&(o=["category_id","project_id"]),3==t.type_part_id&&(o=["project_id"]),i){for(var r in i[a])-1!=o.indexOf(r)&&(i[a][r]=t[r]);"undefined"!=i[a].$count&&delete i[a].$count,"undefined"!=i[a].$level&&delete i[a].$level,"undefined"!=i[a].$parent&&delete i[a].$parent,"undefined"!=i[a].$part_procent&&delete i[a].$part_procent}t.data=i,webix.dp(e.table).save(e.isUpdate?t.id:webix.uid(),e.isUpdate?"update":"insert",t).then((function(i){webix.dp(e.table).ignore((function(){e.isUpdate?e.table.updateItem(t.id,i):e.table.add(i,0),i&&i.id&&e.table.select(i.id);var o=e.table.getSelectedId();if(i.data&&i.data.length>1)for(var a in i.data)e.isUpdate?e.table.updateItem(t.data[a].id,i.data[a]):e.table.add(i.data[a],0,o);e.isUpdate||e.table.scrollTo(0,0)})),e.table.refresh(),e.win.hide()}),(function(){webix.message("Ошибка! Данные не сохранены!")}))}},a.getParts=function(){var e=this.$$("table_part_value").serialize(),t=[];for(var i in e)t.push(e[i]);return t},o}(o.b);i(2),i(4),i(3);webix.proxy.idata={$proxy:!0,load:function(e,t){this._attachHandlers(e);var i=this.source;i+=-1==i.indexOf("?")?"?":"&";var o=t?t.count:e.config.datafetch||0,a=t?t.start:0;return i+="count="+o,i+=a?"&start="+a:"",webix.ajax(i).then(webix.bind((function(e){return e=e.json(),this._checkLoadNext(e,o),e.data}),this))},_checkLoadNext:function(e,t){e.data.length||(this._dontLoadNext=!0)},_attachHandlers:function(e){var t=this;e.config.columns?e.attachEvent("onScrollY",(function(){t._loadNext(this)})):e.attachEvent("onAfterScroll",(function(){t._loadNext(this)})),this._attachHandlers=function(){}},_loadNext:function(e){var t=e.getScrollState().y+e.$view.clientHeight,i=e.getItemNode(e.getLastId()),o=e.config.rowHeight||e.type.height;i&&t>=i.offsetTop+o&&!this._dontLoadNext&&e.loadNext(e.config.datafetch,e.count()+1)}};var d=webix.Date.dateToStr("%Y-%m-%d");webix.Date.weekEnd=function(){var e=webix.Date.weekStart(new Date);return e=webix.Date.add(e,1,"week"),e=webix.Date.add(e,-1,"minute")};var u=function(e){var t,i;function o(t,i,o,a){var r;return(r=e.call(this,t,i)||this)._componentData=a,r.urlConfig=o,r}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s=o.prototype;return s.config=function(){var e,t=this,i=(this.app.getService("locale")._,this);return{type:"wide",cols:[{css:"webix_shadow_medium",rows:[{view:"form",localId:"searchFormOperation",autoheight:!0,width:250,margin:1,scroll:"auto",elements:[{label:"Тип",view:"label"},{cols:[{view:"checkbox",localId:"search_type_operation",name:"type_operation.checkbox1",borderless:1,css:"small",width:33,value:"1",checkValue:"1",uncheckValue:0},{label:"Поступление",view:"label"}],height:30},{cols:[{view:"checkbox",width:33,name:"type_operation.checkbox2",value:"2",checkValue:"2",uncheckValue:0},{label:"Выплата",view:"label"}],height:30},{cols:[{view:"checkbox",width:33,name:"type_operation.checkbox3",value:"3,4",checkValue:"3,4",uncheckValue:0},{label:"Перемещение",view:"label"}],height:30},{label:"Дата оплаты",view:"label"},{cols:[{view:"checkbox",width:33,name:"is_committed.checkbox1",value:"1",uncheckValue:0,checkValue:"1"},{label:"Подтвержена",view:"label"}],height:30},{cols:[{view:"checkbox",width:33,name:"is_committed.checkbox2",value:"2",uncheckValue:0,checkValue:"2"},{label:"Не подтвержена",view:"label"}]},{label:"Период",view:"label"},{view:"datepicker-close",name:"date_operation",height:35,value:webix.Date.weekStart(new Date)},{view:"datepicker-close",name:"date_operation_to",height:35,value:webix.Date.weekEnd()},{label:"Счет и Юр.лицо",view:"label"},{localId:"searchAccountCombo",options:[],view:"combo-close",name:"account_id",height:35},{label:"Контрагент",view:"label",hidden:!1},{localId:"searchContragentCombo",hidden:!1,view:"combo-close",options:[],name:"contragent_id",height:35},{label:"Статья",view:"label"},{localId:"searchCategoryCombo",view:"combo-close",options:[],name:"category_id",height:35},{label:"Проект",view:"label",height:25},{localId:"searchProjectCombo",view:"combo-close",options:[],name:"project_id",height:35},{label:"Сумма",view:"label",height:25},{cols:[{view:"text",value:"",placeholder:"от",name:"value.range.1",height:35},{label:"-",view:"label",width:25},{view:"text",value:"",placeholder:"до",name:"value.range.2",height:35}]}]}]},{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",height:50,css:{"font-size":"22px",padding:"5px 0px 10px 15px","font-weight":700},template:"<div>Операции</div>",borderless:!0,width:130},{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return t.doAddClick()}},{},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){i.doRefresh()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"treetable",localId:"transaction",urlEdit:"transaction",css:"table-transaction",select:!0,scrollX:!1,scroll:"y",hover:"myhover",rowHeight:43,datafetch:100,columns:[{id:"ch1",header:{content:"masterCheckbox"},checkValue:"on",uncheckValue:"off",width:40,template:function(e,t,i,o){return 1==e.$level?t.checkbox(e,t,i,o):""}},{id:"is_committed",header:"",width:30,template:function(e,t,i,o){return 1==e.$level?"<span class='mdi mdi-check' value='"+e.is_committed+"' />":""}},{id:"date_operation",header:"Дата",sort:"string",editor:"date",adjust:!0,template:function(e,t){var i="";return 1==e.$level&&e.$count>1&&(i=t.icon(e,t)+webix.i18n.longDateFormatStr(e.date_operation)),1!=e.$level&&(i="<div class='subrowimage'><div></div></div>"),1==e.$level&&e.$count<2&&(i="<div style='margin-left:20px;'>"+webix.i18n.longDateFormatStr(e.date_operation)+"</div>"),1==e.$level&&2==e.is_committed&&(i='<div style="color:blue">'+i+"</div>"),i}},(e={id:"account",header:["Счет"],template:"#account.name#",adjust:!0},e.template=function(e,t){var i=e.account.name;return 3==e.type_operation&&(i='<span style="line-height: 20px; display: block;">'+e.account.name+"</span>"),i},e),{id:"type_operation",width:50,header:"Тип",sort:"server",template:function(e){return 1==e.type_operation?'<span class="webix_icon wxi-angle-double-left" style = "color: green"></span>':2==e.type_operation?'<span class="webix_icon wxi-angle-double-right" style = "color: red"></span>':3==e.type_operation||4==e.type_operation?'<span class="webix_icon wxi-sync" style = "color: grey"></span>':void 0}},{id:"contragent",header:"Контрагент",fillspace:!0,template:function(e){return 1==e.$level&&3==e.type_operation?"":1==e.$level&&e.$count>1&&""==e.contragent.name?'<span class="webix_snippet_tag">'+e.$count+" контрагента</span>":e.contragent.name}},{id:"category",header:"Статья",width:200,template:function(e){var t=e.comment?e.comment:"";return 1==e.$level&&3==e.type_operation?'<span class="webix_snippet_tag">Перемещение</span>':1==e.$level&&e.$count>1&&""==e.category.name?'<span class="webix_snippet_tag">'+e.$count+" статьи</span>":'<span style="display: block; line-height: 22px;">'+e.category.name+'</span><span style="display: block; line-height: 15px; font-size: 11px;color: #666;">'+t+"</span>"},sort:"string"},{id:"project",header:"Проект",fillspace:!0,autoheight:!0,template:function(e){return 1==e.$level&&3==e.type_operation?"":1==e.$level&&e.$count>1&&4==e.type_part_id?'<span class="webix_snippet_tag">'+e.$count+" проекта</span>":e.project.name}},{id:"value",header:"Сумма",adjust:!0,css:{color:"red","text-align":"right"},template:function(e){return 1==e.type_operation?'<span style = "color: green; text-align: right;">+ '+webix.Number.format(e.value,{decimalSize:0,groupSize:3,decimalDelimiter:".",groupDelimiter:" "})+"</span>":2==e.type_operation||3==e.type_operation?'<span style = "color: red;  text-align: right;">- '+webix.Number.format(e.value,{decimalSize:0,groupSize:3,decimalDelimiter:".",groupDelimiter:" "})+"</span>":4==e.type_operation?'<span style = "color: green;  text-align: right;">+ '+webix.Number.format(e.value,{decimalSize:0,groupSize:3,decimalDelimiter:".",groupDelimiter:" "})+"</span>":void 0}},{id:"id",hidden:!1},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}",hidden:!1},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}",hidden:!1}],save:"api->accounting/transactions",on:{onResize:webix.once((function(){})),onBeforeLoad:function(){webix.extend(this,webix.ProgressBar),this.disable(),this.showProgress({delay:2e3,hide:!1})},onAfterLoad:function(){this.count()&&(this.hideProgress(),this.enable())},onItemClick:function(e,t,i){if(2==this.getSelectedItem().$level)return this.clearSelection();if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeFilter:function(e,t,i){}}},{cols:[{view:"label",label:"0",localId:"count",template:"<div class='webix_el_box' style='line-height:32px'>Показано: #label# операций</div>"},{view:"label",label:"",localId:"income",template:"<div class='webix_el_box' style='line-height:32px; color: darkgreen'>Поступлений: #label#</div>"},{view:"label",label:"",localId:"outcome",template:"<div class='webix_el_box' style='line-height:32px; color: red'>Выплат: #label#</div>"},{view:"label",label:"",localId:"move",color:"grey",template:"<div class='webix_el_box' style='line-height:32px; color: #color#'>Перемещения: #label#</div>"},{view:"label",label:"",localId:"total",color:"grey",template:"<div class='webix_el_box' style='line-height:32px; color: #color#'>Итого:  #label#</div>"},{align:"right"}]}]}]}},s.init=function(e){var t=this.$$("form-search");this.view=e;var i=this.$$("searchAccountCombo").getPopup().getList();i.parse(a.a),(i=this.$$("searchContragentCombo").getPopup().getList()).parse(r.a),(i=this.$$("searchCategoryCombo").getPopup().getList()).parse(l.a),(i=this.$$("searchProjectCombo").getPopup().getList()).parse(n.a);var o=this.$$("searchFormOperation"),s=this.$$("transaction"),d=this;webix.extend(s,webix.ProgressBar),this.getData(),o.attachEvent("onChange",(function(e){d.getData()})),t.attachEvent("onChange",(function(e){d.doRefresh()})),this.cashEdit=this.ui(c)},s.doRefresh=function(){this.getData()},s.getParams=function(){var e=this.$$("searchFormOperation"),t=this.$$("form-search"),i=e.getValues(),o={},a={},r={};for(var n in i)if(i[n])if((a=n.split(".")).length>1)if("range"==a[1])r[a[0]]?r[a[0]]["<="]=i[n]:(r[a[0]]=[],r[a[0]]={">=":i[n]}),i[a[0]]=r[a[0]],o[a[0]]=i[a[0]];else{r[a[0]]||(r[a[0]]=[]);var l=i[n].split(",");if(l.length>1)for(var s in l)r[a[0]].push(l[s]);else r[a[0]].push(i[n]);i[a[0]]={in:r[a[0]]},o[a[0]]=i[a[0]]}else"date_operation"==n?i.date_operation_to?o[n]={">=":d(i[n]),"<=":d(i.date_operation_to)}:o[n]={">=":d(i[n]),"<=":d(i[n])}:o[n]=i[n];return delete o.date_operation_to,""!=t.getValue()&&(o={search:{comment:t.getValue(),"contragent.name":t.getValue(),"account.name":t.getValue()}}),o},s.getData=function(){var e=this.$$("transaction"),t=this.getParams(),i={filter:t},o=this,a=o.app.config.apiRest.getUrl("get","accounting/transactions",{expand:"contragent,category,project,account,data",sort:'[{"property":"date_operation","direction":"DESC"}]',filter:JSON.stringify(t)});e.config.url=a,e.clearAll(),e.load(a);var r=o.app.config.apiRest.getUrl("get","accounting/transaction/summary",{expand:"contragent,account"});webix.ajax().get(r,i).then((function(e){o.setTotal(e.json())}))},s.doAddClick=function(){this.$$("transaction").unselect(),this.cashEdit.showForm(this.$$("transaction"))},s.setTotal=function(e){var t=this.$$("income"),i=this.$$("outcome"),o=this.$$("move"),a=this.$$("total"),r=this.$$("count"),n=0,l=0,s=0,c=0,d=0;for(var u in e.data)1==e.data[u].type_operation&&(n=e.data[u].value),2==e.data[u].type_operation&&(l=e.data[u].value),3==e.data[u].type_operation&&(s=e.data[u].value),4==e.data[u].type_operation&&(c=e.data[u].value),n?t.setValue(webix.Number.format(n)):t.setValue(0),l?i.setValue(webix.Number.format(l)):i.setValue(0),d+=Number.parseInt(e.data[u].id_part);var h=webix.Number.format(n-l),p=webix.Number.format(s-c);o.setValue(p),a.setValue(h),r.setValue(d),h>=0?a.define("color","green"):a.define("color","red"),p>=0?o.define("color","green"):o.define("color","red"),t.refresh(),i.refresh(),o.refresh(),a.refresh(),r.refresh()},o}(o.b)},function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var o=new webix.DataCollection({data:[{id:1,title:"The Shawshank Redemption",year:1994,votes:678790,rating:9.2,rank:1},{id:2,title:"The Godfather",year:1972,votes:511495,rating:9.2,rank:2},{id:3,title:"The Godfather: Part II",year:1974,votes:319352,rating:9,rank:3},{id:4,title:"The Good, the Bad and the Ugly",year:1966,votes:213030,rating:8.9,rank:4},{id:5,title:"My Fair Lady",year:1964,votes:533848,rating:8.9,rank:5},{id:6,title:"12 Angry Men",year:1957,votes:164558,rating:8.9,rank:6}]})},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(6).a)).getUrl("get","accounting/employees",{sort:"name","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var o=i(0),a=i(7);window.procent=function(e,t){var i=$$("table_part").getItem(e),o=$$(t).getValue();return Math.round(100*i.value*100/o)/100};var r=webix.Date.dateToStr("%d.%m.%y"),n=webix.Date.dateToStr("%Y-%m-%d"),l=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var l=o.prototype;return l.config=function(){return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=44,e.top=34,e.width=e.maxWidth/3+70,e.height=e.maxHeight-42},head:"Редактирование",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"y",elements:this.state.formConfig}}},l.init=function(e,t){this.attachClickEvents()},l.showForm=function(e){var t=this,i=this.state,o=this.apiRest,a=e.getSelectedItem(),r=a;i.tableId=e.config.urlEdit,i.table=e,i.tableRecord=a,i.isUpdate=r,i.formEdit=this.$$("formEdit"),i.formUrl="accounting/"+i.tableId+"/form",i.win=this.$$("winEdit"),i.formEdit.clearValidation(),o.get(i.formUrl).then((function(e){t.showWindow(e,t)}))},l.showWindow=function(e,t){var i=t.state,o=Object.keys(i.formEdit.elements).length,a=e.json();i.formData=a,t.renderForm(o),i.formEdit.clear(),webix.extend(i.formEdit,webix.ProgressBar),i.formEdit.disable(),i.formEdit.showProgress({type:"icon",hide:!1}),t.bindCollection(a),i.win.show()},l.getRecord=function(){var e=this.state;return e.isUpdate?e.tableRecord:{C:r(new Date),D:r(webix.Date.add(new Date,21,"day",!0)),index:1,B:6,G:0,AE:n(webix.Date.add(new Date,14,"day",!0)),R:""}},l.renderForm=function(e){var t=this.state;0===e&&(t.formConfig=t.formData.data.configForm,webix.ui(t.formConfig,t.formEdit),this.attachFormEvents())},l.bindCollection=function(e){var t=this,i=this.state,o=this.apiRest,a=0,r=e.data.dataCollections,n=Object.keys(r).length,l={"per-page":-1,sort:"name"},s=function(e){l={"per-page":-1,sort:"name"};var s=$$(e).getPopup().getList();l.sort=r[e].sort?r[e].sort:l.sort;var c=r[e].field?r[e].field:"name",d=o.getCollection(r[e].url,l,c);d.waitData.then((function(){a++,r[e].params?r[e].params.filter&&function(){var t=r[e].params.filter,i=function(e){var i=new webix.DataCollection({data:d.data});i.filter((function(i){return i[e]==t[e]})),s.sync(i)};for(var o in t)i(o)}():s.sync(d),a===n&&(t.labelSetValue(),i.formEdit.setValues(t.getRecord()),i.isUpdate||t.setDefaultValues(),i.formEdit.enable(),i.formEdit.hideProgress())}))};for(var c in r)s(c)},l.bindColumnCollection=function(e){var t=this.apiRest,i={"per-page":-1},o=e.data.columnCollections;for(var a in o){var r=o[a];for(var n in r)this.$$(a).getColumnConfig(n).options=t.getCollection(r[n].url,i);this.$$(a).refreshColumns()}},l.attachFormEvents=function(){var e=this,t=(this.state,this.$$("btn_save")),i=this.$$("btn_copy"),o=this.$$("btn_cancel"),a=this.$$("btn_calculation"),r=this.$$("contragent"),n=this.$$("form_F"),l=this.$$("product"),s=this.$$("form_product_name"),c=this.$$("product_size"),d=this.$$("form_size_name"),u=this.$$("cloth"),h=this.$$("form_cloth_name"),p=this.$$("carcass_type"),m=(this.$$("carcass_type_name"),this.$$("leg")),g=this.$$("form_leg_name"),f=this.$$("button"),w=this.$$("form_button_name"),b=this.$$("bottom"),_=this.$$("form_bottom_name"),v=this.$$("stitching"),x=this.$$("form_stitching_name"),y=this.$$("option"),C=this.$$("form_option_name"),$=this.$$("product_type");t.attachEvent("onItemClick",(function(t){e.doClickSave()})),i.attachEvent("onItemClick",(function(t){e.doClickSave(!0)})),o.attachEvent("onItemClick",(function(t){e.state.win.hide()})),a.attachEvent("onItemClick",(function(t){e.doClickCalculation(!0)}));var k=this.apiRest,S={"per-page":-1};$.attachEvent("onChange",(function(e){l.setValue();var t=k.getCollection("accounting/product-beds",S);t.filter((function(t){return t.type_id==e})),l.getPopup().getList().sync(t)})),r.attachEvent("onChange",(function(t){n.setValue(r.getText()),e.setPrice()})),l.attachEvent("onChange",(function(t){s.setValue(l.getText()+" "+c.getText()),e.setPrice()})),c.attachEvent("onChange",(function(t){d.setValue(c.getText()),s.setValue(l.getText()+" "+c.getText()),e.changeSizeKarkasName(p.getText()),e.setPrice()})),u.attachEvent("onChange",(function(t){h.setValue(u.getText()),e.setPrice()})),m.attachEvent("onChange",(function(t){g.setValue(m.getText()),e.setPrice()})),f.attachEvent("onChange",(function(t){w.setValue(f.getText()),e.setPrice()})),b.attachEvent("onChange",(function(t){_.setValue(b.getText()),e.setPrice()})),v.attachEvent("onChange",(function(t){x.setValue(v.getText()),e.setPrice()})),p.attachEvent("onChange",(function(t){e.changeSizeKarkasName(p.getText()),e.setPrice()})),y.attachEvent("onChange",(function(t){C.setValue(y.getText()),e.setPrice()}))},l.changeSizeKarkasName=function(e){var t=this.$$("carcass_type_name"),i=this.$$("product_size");"без каркаса"==e&&t.setValue(""),"стандарт"==e&&t.setValue(i.getText()),"подиум"==e&&t.setValue(i.getText()),"люкс"==e?t.setValue(i.getText()+" "+e):t.setValue(i.getText())},l.attachClickEvents=function(){this.apiRest,this.state;webix.attachEvent("onClick",(function(e,t,i){}))},l.doClickSave=function(e){void 0===e&&(e=!1);var t=this.state;if(t.formEdit.validate()){var i=t.formEdit.getValues();e&&(t.isUpdate=!1,i.id=""),webix.dp(t.table).save(t.isUpdate?i.id:webix.uid(),t.isUpdate?"update":"insert",i).then((function(e){webix.dp(t.table).ignore((function(){t.isUpdate?t.table.updateItem(i.id,e):t.table.add(e,0),t.table.select(e.id),t.isUpdate||t.table.scrollTo(0,0)})),t.table.refresh(),t.win.hide()}),(function(){webix.message("Ошибка! Данные не сохранены!")}))}},l.setPrice=function(){var e=this.apiRest,t=this.state,i=this.$$("form_price"),o=e.getUrl("get","accounting/product-bed/get-price",{"per-page":"-1"}),a=t.formEdit.getValues();if(""!=a.product_id&&""!=a.cloth_id&&""!==a.size_id&&""!==a.leg_id&&""!==a.bottom_id&&""!==a.carcass_type_id){var r=webix.ajax().sync().get(o,a),n=JSON.parse(r.responseText);i.setValue(n.sum);var l=0;for(var s in n.rules)(l=parseInt(n.rules[s]))>0?(l="+"+n.rules[s],webix.html.removeCss(this.$$(s).$view,"red"),webix.html.addCss(this.$$(s).$view,"green"),this.$$(s).refresh()):(webix.html.removeCss(this.$$(s).$view,"green"),webix.html.addCss(this.$$(s).$view,"red"),this.$$(s).refresh()),this.$$(s).setValue(l)}},l.labelSetValue=function(){this.$$("options_id").setValue(""),this.$$("stitching_id").setValue(""),this.$$("carcass_type_id").setValue(""),this.$$("bottom_id").setValue(""),this.$$("button_id").setValue(""),this.$$("leg_id").setValue(""),this.$$("size_id").setValue(""),this.$$("cloth_id").setValue(""),this.$$("client_id").setValue(""),this.$$("form_price").setValue(0)},l.doClickCalculation=function(){this.setPrice()},l.setDefaultValues=function(){this.$$("leg").setValue(1),this.$$("carcass_type").setValue(2),this.$$("product_size").setValue(7),this.$$("product_type").setValue(1),this.$$("form_type").setValue("стандарт"),this.$$("bottom").setValue(5)},o}(o.b)},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(6).a)).getUrl("get","accounting/product-beds",{sort:"color","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict"},function(e,t,i){"use strict";i.r(t);var o={view:"datatable",localId:"document-salary-accrual-table",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"employee_id",header:"ID",width:30,sort:"string"},{id:"employee_name",header:"Сотрудник",width:180,sort:"string"},{id:"is_piecework",header:"Тип",width:40,sort:"string"},{id:"rate",header:"Ставка",width:80,sort:"string"},{id:"rate_day",header:"Ставка за день",width:100,sort:"string"},{id:"work_time_days",header:"Дни посещения",width:100,sort:"string"},{id:"work_time_hours",header:"Дни по часам",width:100,sort:"string"},{id:"salary_rate",header:"ЗП по ставке",width:100,sort:"string"},{id:"salary_piecework",header:"ЗП по сдельно",width:100,sort:"string"},{id:"award",header:"Премия",width:100,sort:"string"},{id:"surcharges",header:"Доп./Выч.",width:100,sort:"string"},{id:"salary",header:"К выплате",width:100,sort:"string"}],url:(new(i(6).a)).getUrl("get","accounting/employee-time-work/visits",{sort:"name"}),on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}};t.default=o},function(module,__webpack_exports__,__webpack_require__){"use strict";var components_comboClose__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_2__);function formatPercent(e){return 100*e}webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)1==t[o].$level&&(isNaN(e(t[o]))||(i+=1*e(t[o])));return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0})},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:".",decimalSize:2}),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCountEmpty=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.toolsContent=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.mathColumn=webix.extend({refresh:function refresh(master,node,value){var result=0,result2=0,_val=0,_val2=0,res=0,resultFormula="res = 0;";this.sumRes={};var scope=this;master.data.each((function(e){if(!e.$group&&e["$"+value.columnId]){var t=e["$"+value.columnId].match(/[^\[.\]$']+/g);resultFormula="res";var i={};t.forEach((function(t){var o=t.replace("r,","");e[o]&&(scope.sumRes[o]||(scope.sumRes[o]=0),i[o]||(i[o]=!0,scope.sumRes[o]+=1*e[o]),o="this.sumRes['"+o+"']"),resultFormula+=o}))}})),"res = 0;"!=resultFormula&&eval(resultFormula),result=value.format(res),node.innerHTML=result}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:350,height:200}}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var formatDate=webix.Date.dateToStr("%d.%m.%y"),formatDateHour=webix.Date.dateToStr("%d.%m.%y %H:00"),formatDateShort=webix.Date.dateToStr("%d.%m"),formatDateTimeDb=webix.Date.dateToStr("%Y-%m-%d %H:%i"),formatMonthYear=webix.Date.dateToStr("%M %y"),formatDateTime=webix.Date.dateToStr("%d.%m.%y %H:%i"),parserDate=webix.Date.strToDate("%Y-%m-%d"),parserDateTime=webix.Date.strToDate("%Y-%m-%d %H:%i"),parserDateTimeGroup=webix.Date.strToDate("%d.%m.%y %H:%i");function custom_checkbox(e,t,i){return i?"<div class='webix_table_checkbox checked'> YES </div>":"<div class='webix_table_checkbox notchecked'> NO </div>"}function columnGroupTemplate(e,t,i){return e.$group?t.treetable(e,t)+e.property_value:t.icon(e)+t.folder(e,t)+" "+i}webix.editors.buttonEditor={focus:function(){this.getInputNode(this.node).focus(),this.getInputNode(this.node).select()},getValue:function(){return this.getInputNode(this.node).refValue},setValue:function(e,t){var i="",o=this.config.collection.getItem(e);o&&(i=o.value),this.getInputNode(this.node).value=i,this.getInputNode(this.node).refValue=e},getInputNode:function(){return this.node.firstChild},render:function(){return webix.html.create("div",{class:"webix_dt_editor"},"<input type='text' disabled='disabled' /><button class='editor-button' style='position: absolute;margin: 1px; right:0; height:25px;'>...</button>")}},webix.protoUI({name:"table-dynamic",defaults:{localId:"layout"},$init:function(e){var t=this,i=this;this.initParam=!1,this.state=e.state,this.stateCache=e.stateCache,e.rows=[{view:"toolbar",padding:10,cols:[{view:"icon",icon:"mdi mdi-keyboard-backspace",autowidth:!0,value:!0,localId:"btn-back",click:function(){window.history.back()}},{type:"header",localId:"table-title",template:"Таблица",width:300,borderless:!0},{localId:"show-filter-date-range",hidden:!0,cols:[{localId:"filter-date-range-field",cols:[{localId:"filter-date-range-field-label",label:"",view:"label",width:20},{view:"datepicker",localId:"dateFrom",inputWidth:120,width:130,value:this.stateCache?this.stateCache.dateFrom:webix.Date.monthStart(new Date)},{label:"по",view:"label",width:27},{view:"datepicker",localId:"dateTo",inputWidth:120,width:120,value:this.stateCache?this.stateCache.dateTo:webix.Date.monthEnd(new Date)}]},{view:"icon",icon:"mdi mdi-filter",localId:"show-icon-filter-setting",width:30,css:"small",click:function(){i.showFilterSetting()}},{view:"icon",icon:"mdi mdi-sort",localId:"show-icon-sort-setting",width:30,css:"small",click:function(){i.showSortSetting()}},{view:"icon",icon:"mdi mdi-format-color-fill",localId:"show-icon-color-setting",width:30,css:"small",click:function(){i.showColorSetting()}},{view:"icon",icon:"mdi mdi-invert-colors",localId:"show-icon-color-column-setting",width:30,css:"small",click:function(){i.showColumnSetting()}}]},{localId:"show-filter",hidden:!0,cols:[{cols:[{width:25},{label:"Отбор по",view:"label",width:60,localId:"filter-field-label"},{view:"select",labelWidth:100,value:this.stateCache?this.stateCache.filterField:"",options:[],hidden:!1,localId:"filter-field"},{localId:"filter-layout",cols:[]}]}]},{view:"richselect",localId:"batch-column",value:4,labelWidth:100,options:[],width:250,hidden:!0,on:{onChange:function(e){i.selectColumnSettingForTable(e)}}},{view:"richselect",value:4,labelWidth:100,options:[],width:250,hidden:!1,localId:"select-type"},{view:"icon",icon:"mdi mdi-tools",localId:"show-icon-setting",width:30,hidden:!0,click:function(){i.showSetting()}}]},{view:"toolbar",localId:"show-toolbar",height:30,cols:[{view:"icon",icon:"mdi mdi-plus",localId:"show-add-button",tooltip:"Добавить",hidden:!0,width:30,click:function(){return t.doAddClick()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return t.showExportToExcelSetting()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,hidden:!1,click:function(){i.doClickOpenAll()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){i.doRefresh()}},{}]},{localId:"body-layout",cols:[{localId:"table-layout",view:"datatable"}]}],this.stateFilter=webix.storage.local.get(this.state.params.mode+"_"+this.state.type+"_filter_state"),this.$ready.push(this.setPage)},$ready:function(){},setPage:function(){this.showGoToBack(),this.model=this.capitalizeFirstLetter(this.state.params.mode),this.setSelectType(),this.schemaTableSetting=this.getSchemaTableSetting(),this.setTableSetting(),this.setFilterSetting(),this.getTable(),this.getDataTable(),this.attachToolBarEvents()},attachToolBarEvents:function(){var e=this;e.dateFrom.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.dateTo.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.filterField.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.filterInput.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()}))},eventSetColumnUserSize:function(e,t,i,o){var a=this;if(o){var r=this.table.getColumnConfig(e),n=this.state.apiRest.getUrl("get","accounting/schema-table-users/"+r.rowId);webix.ajax().put(n,{width:t,adjust:"",id:r.rowId},(function(e,t,i){a.showMessageResult(t.json(),i,!1)}))}},eventSetColumnUserSort:function(e,t,i){var o=this,a=this.table.getColumnConfig(e),r=this.table.getColumnConfig(t),n=this.state.apiRest.getUrl("get","accounting/schema-table-user/order");webix.ajax().get(n,{sort_order:a.sort_order,id:a.rowId,target_sort_order:r.sort_order,list_id:o.selectTypeValue},(function(e,t,i){o.showMessageResult(t.json(),i,!1)}))},putFilterState:function(){webix.storage.local.put(this.state.params.mode+"_"+this.state.type+"_filter_state",{dateFrom:this.dateFrom.getValue(),dateTo:this.dateTo.getValue(),filterField:this.filterField.getValue(),filterInput:this.filterInput.getValue()})},showGoToBack:function(){this.state.params.id?this.getEl("btn-back").show():this.getEl("btn-back").hide()},getEl:function(e){return this.queryView({localId:e})},capitalizeFirstLetter:function(e){var t=e.split("-"),i=[];return t.forEach((function(e){i.push(e.charAt(0).toUpperCase()+e.slice(1))})),i.join("")},setSelectType:function(){var e=this;this.selectType=this.getEl("select-type");var t=webix.ajax().sync().get(this.state.urlTableUserLists,{filter:{model:this.model},expand:"schemaTableUserFilter"}),i=JSON.parse(t.responseText);if(i.errors){for(var o in i.errors)webix.message({text:o+":"+i.errors[o],type:"error",expire:-1});throw webix.alert({title:"Ошибка",ok:"Ок",text:"Обратитесь к администратору системы"}),new Error}this.dataSelectType=i;var a,r=i.data.length,n="";e.schemaTableUserFilter=[],this.getSelectTypeState()&&(a=this.getSelectTypeState(),i.data.forEach((function(t){t.id==a&&(n=t.id,e.schemaTableUserFilter=t.schemaTableUserFilter,e.schemaFilterUserList=t.filter_setting,e.schemaSortUserList=t.sort_setting,e.schemaColorUserList=t.color_setting,e.schemaColumnUserList=t.column_setting)})),""==n&&webix.storage.local.remove(this.state.params.mode+"_"+this.state.type+"_select_type_state")),i.data.forEach((function(t){""==n&&1==t.is_default&&(n=t.id,e.schemaTableUserFilter=t.schemaTableUserFilter,e.schemaFilterUserList=t.filter_setting,e.schemaSortUserList=t.sort_setting,e.schemaColorUserList=t.color_setting,e.schemaColumnUserList=t.column_setting)})),this.selectType.define("options",{body:{data:i.data,on:{onItemClick:function(t){var i=this.getItem(t);e.selectTypeValue=t,e.schemaTableSetting=e.getSchemaTableSetting(),e.schemaTableUserFilter=i.schemaTableUserFilter,e.schemaFilterUserList=i.filter_setting,e.schemaSortUserList=i.sort_setting,e.schemaColorUserList=i.color_setting,e.schemaColumnUserList=i.column_setting,e.setColorSettingForTable(),e.setTableSetting(),e.setFilterSetting(),e.getDataTable(),e.putSelectTypeState(t)}}}}),this.selectType.refresh(),this.selectType.setValue(n),this.selectTypeValue=n,1==r?this.selectType.hide():this.selectType.show()},getSelectTypeState:function(){var e=webix.storage.local.get(this.state.params.mode+"_"+this.state.type+"_select_type_state");return!!e&&e.selectType},getSchemaTableSetting:function(){var e=this.state.urlTableSettingUsers,t=webix.ajax().sync().get(e,{filter:{model:this.model,list_id:this.selectTypeValue}}),i=JSON.parse(t.responseText),o={};return this.schemaTableSettingColumns=i.config.columns,this.schemaTableSettingItems=i.data,this.schemaTableSettingData=i,i.data.forEach((function(e){o[e.type_property]||(o[e.type_property]={}),o[e.type_property][e.property]=e})),o},setTableSetting:function(){var e=this.schemaTableSetting;for(var t in e.show)null!==this.getEl(t)&&"1"===e.show[t].value&&this.getEl(t).show();for(var i in e.template)null!==this.getEl(i)&&(this.getEl(i).define({template:e.template[i].value}),this.getEl(i).refresh());for(var o in e.filter)null!==this.getEl(o)&&("filter-field"==o&&(this.getEl(o+"-label").define({label:e.filter[o].value}),this.getEl(o+"-label").refresh()),"filter-date-range-field"==o&&(this.filterDateRangeField=e.filter[o].value))},setFilterSetting:function(){var e=this;this.getEl("filter-field").data.options=[],this.getEl("filter-field").refresh(),this.schemaTableUserFilter.forEach((function(t,i){e.getEl("filter-field").data.options.push({id:t.column_id,value:t.header}),0!=i||e.getEl("filter-input")||e.getEl("filter-layout").addView({view:"search-close",name:"text",value:e.stateFilter?e.stateFilter.filterInput:"",localId:"filter-input"})})),e.getEl("filter-field").refresh(),e.stateFilter&&e.getEl("filter-field").setValue(e.stateFilter.filterField)},getTable:function(){var e=this.getEl("body-layout"),t=this,i={view:"treetable",localId:"table-layout",urlEdit:this.state.params.mode,css:"webix_header_border webix_data_border ",leftSplit:0,select:"multiselect",resizeColumn:{headerOnly:!0},multiselect:!0,clipboard:"selection",tooltip:!0,editable:!0,editaction:"dblclick",sort:"multi",drag:!1,dragColumn:!0,math:!0,save:"api->accounting/"+this.getModelName(this.state.params.mode),scheme:{},ready:function(){},on:{onAfterColumnDrop:function(){},onItemDblClick:function(e,i,o){var a=this.getItem(e);"directory"==t.state.type&&(this.$scope.selectRecord(a),this.$scope.hideWindow()),a.account_id&&(this.$scope.urlParams.account_id&&this.$scope.show("inproduce/register-account-subconto?account_id="+a.account_id+"&subconto1_value="+a.subconto1_value),0==Object.keys(this.$scope.urlParams).length&&this.$scope.show("inproduce/register-account?account_id="+a.account_id+"&schema-table-user-id=196"))},onItemClick:function(e,i,o){if("action-edit"==e.column&&t.state.formEdit.showForm(this),"action-view-window"==e.column){var a=t.table.getColumnConfig(e.column),r={config:{options_url:t.getModelName(a.goto),options_url_edit:a.goto,header:[{text:"Specification"}],filter:{filterField:"list_id",filterInput:e.row}}};t.state.windowDirectory.showWindow({},t.table,r,t.state.scope,"document")}if("action-view"==e.column){var n=t.table.getColumnConfig(e.column);n.goto?t.$scope.show("inproduce/"+n.goto+"/"+e.row):t.state.formView.showWindow({},this)}if("action-delete"==e.column){var l=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(l).save(e.row,"delete").then((function(t){webix.dp(l).ignore((function(){l.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-comment"==e.column){var s=this.getItem(e);t.state.formComment.showForm(this,s.A)}},onBeforeLoad:function(){},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent),r=!0;return a||(r=!1),r&&(r=t.beforeDropChangeData(o,a.value,e)),r||(t.table.addRowCss(o.id,"highlight-red"),setInterval((function(){t.table.removeRowCss(o.id,"highlight-red")}),4e3)),r},onSelectChange:function(e,t,i){}},onClick:{"editor-button":function(e,i,o,a){var r=this.getEditState();return t.state.windowDirectory.showWindow({},t.table,r,t.state.scope,"directory"),!1}}};this.table=webix.ui(i,e,this.getEl("table-layout")),this.table.attachEvent("onKeyPress",(function(e,i){this.contextMenuSearchKey&&this.contextMenuSearchKey.destructor();var o=t.table.getSelectedId();webix.UIManager.getFocus();if(o&&o.column&&(70==e&&1==i.ctrlKey||70==e&&1==i.metaKey)){var a=webix.html.offset(t.table.getColumnConfig(o.column).node);this.contextMenuSearchKey=webix.ui(t.getSearchFieldByKeyPress(o.column,i.key,a)),this.contextMenuSearchKey.show(),this.contextMenuSearchKey.queryView({localId:"search-by-key-field"}).focus()}return!1})),webix.attachEvent("onFocusChange",(function(e){})),this.table.attachEvent("onColumnResize",(function(e,i,o,a){t.eventSetColumnUserSize(e,i,o,a)})),this.table.attachEvent("onAfterColumnDrop",(function(e,i,o){t.eventSetColumnUserSort(e,i,o)})),this.setColorSettingForTable()},getSearchFieldByKeyPress:function(e,t,i){var o=this;return{view:"context",localId:"search-by-key",position:function(e){e.left=i.x+20,e.top=i.y},body:{width:150,view:"text",value:"",localId:"search-by-key-field",on:{onEnter:function(){var t=this.getValue().toLowerCase(),i=o.table;if(i.clearCss("marker",!0),t&&t.length>2){var a=i.find((function(i){return!!i[e]&&-1!=i[e].toLowerCase().indexOf(t)}));if(a.length>0){a.forEach((function(e){i.addCss(e.id,"marker",!1)}));var r=i.getIndexById(a[0].id),n=i.config.rowHeight;i.scrollTo(0,r*n-10*n)}}this.getParentView().close(),i.refresh()},onTimedKeyPress:function(){}}},master:o.table}},getModelName:function(e){var t=e[e.length-1],i=e.split("-");return i=i[i.length-1],"y"==t&&i.length>3?e.replace(/y$/,"ies"):"s"==t&&i.length>3?e.replace(/s$/,"ses"):e+"s"},getDataTable:function getDataTable(){var scope=this;this.table.define("leftSplit",this.schemaTableSetting.datatable.leftSplit.value?1*this.schemaTableSetting.datatable.leftSplit.value:0),this.table.define("rightSplit",this.schemaTableSetting.datatable.rightSplit.value?1*this.schemaTableSetting.datatable.rightSplit.value:0),this.table.define("drag",!(!this.schemaTableSetting.access||!this.schemaTableSetting.access["can-drop"]||0==this.schemaTableSetting.access["can-drop"].value)&&"order"),scope.columns=[];var params={"per-page":2e3,"schema-table-user-id":scope.selectTypeValue},paramsSort=this.getSortParams();paramsSort.length>0&&(params.sort=paramsSort),"order"==this.state.params.mode&&(params.expand="comment,images");var url=new URL(location.href.replace("/#!","")),searchParams=new URLSearchParams(url.search);if(this.urlParams||!searchParams.get("account_id")&&!searchParams.get("subconto1_value")||(this.urlParams=[],searchParams.get("account_id")&&(this.urlParams.account_id=searchParams.get("account_id")),searchParams.get("subconto1_value")&&(this.urlParams.subconto1_value=searchParams.get("subconto1_value")),searchParams.get("schema-table-user-id")&&(this.urlParams["schema-table-user-id"]=searchParams.get("schema-table-user-id"))),this.urlParams)for(var key in this.urlParams)params[key]=this.urlParams[key];scope.tableUrl=this.state.scope.app.config.apiRest.getUrl("get","accounting/"+this.getModelName(this.state.params.mode),params),webix.extend(this.table,webix.ProgressBar),this.table.disable(),this.table.showProgress({type:"icon",hide:!1}),scope.filter=scope.getFilterParams(),webix.ajax().get(scope.tableUrl,scope.filter).then((function(data){scope.table.clearAll();var items=data.json(),dataItem=items.data?items.data:items.items;scope.dataItem=dataItem,items.config.columns=scope.dataDriverJsonToObject(items.config.columns),scope.table.config.columns=items.config.columns,scope.columns=items.config.columns,scope.table.refreshColumns(),scope.setColumnSettingForTable(),scope.table.parse(dataItem),scope.table.enable(),scope.table.hideProgress();var resultType="";if(scope.schemaTableSetting.group["group-by"].type)resultType=scope.schemaTableSetting.group["group-by"].type+"(obj."+scope.schemaTableSetting.group["group-by"].value+")";else{var configColumn=scope.table.getColumnConfig(scope.schemaTableSetting.group["group-by"].value);resultType="obj."+scope.schemaTableSetting.group["group-by"].value}scope.schemaTableSetting.group["group-by"].value&&scope.table.group({by:function by(obj){return eval(resultType)},map:{property_value:[function(obj){var per=eval(resultType),configColumn=scope.table.getColumnConfig(scope.schemaTableSetting.group["group-by"].value);return configColumn.collection?configColumn.collection.getItem(per)?configColumn.collection.getItem(per).value:scope.api.dataCollection["accounting/material-types"].getItem(per).value:eval(resultType)}],property_title:["A"],index:["","string"],I:["","string"],G:["G","sum"],value_sum:["value_sum","median"],L:["","string"],N:["","string"],O:["","string"],P:["","string"]}}),scope.table.openAll(),"directory"==scope.state.type&&(scope.table.select(scope.$scope.state.editor.value),scope.table.showItem(1*scope.$scope.state.editor.value)),webix.storage.local.get("finplan_version")!=items.config.version_frontend&&scope.versionReloadPage(items.config.version_frontend)}))},getSortParams:function(){var e="";if(this.filterDateRangeField&&(e='[{"property":"'+this.filterDateRangeField+'","direction":"ASC"}]'),this.schemaSortUserList&&this.schemaSortUserList.length>2){var t=JSON.parse(this.schemaSortUserList);for(var i in e=[],t)e.push({property:t[i].field,direction:t[i].direction});e=JSON.stringify(e)}return e},getFilterParams:function(){this.format=webix.Date.dateToStr("%Y-%m-%d"),this.dateFrom=this.getEl("dateFrom"),this.dateTo=this.getEl("dateTo"),this.filterField=this.getEl("filter-field"),this.showFilterDateRange=this.getEl("show-filter-date-range"),this.filterInput=this.getEl("filter-input"),this.dateFromValue=this.format(this.dateFrom.getValue()),this.dateToValue=this.format(this.dateTo.getValue()),this.filterFieldValue=this.filterField.getValue(),this.filterInputValue=this.filterInput.getValue();var e={filter:{or:[]}},t={},i={};if(this.showFilterDateRange.isVisible()&&this.filterDateRangeField&&(i[this.filterDateRangeField]={">=":this.dateFromValue,"<=":this.dateToValue},e.filter.or=[i]),this.schemaFilterUserList&&this.schemaFilterUserList.length>2){var o=JSON.parse(this.schemaFilterUserList),a={},r={or:[]};for(var n in o)"dateFrom"==o[n].value&&(o[n].value=this.dateFromValue),"dateTo"==o[n].value&&(o[n].value=this.dateToValue),"in"==o[n].comparison&&(o[n].value=o[n].value.split(",")),"or"==o[n].operator&&(r.or.push(a),a={}),a[o[n].field]||(a[o[n].field]={}),a[o[n].field][o[n].comparison]=o[n].value;r.or.push(a),e.filter=r}return""!=this.filterField&&""!=this.filterInputValue&&(t[this.filterFieldValue]={},t[this.filterFieldValue].like=this.filterInputValue,e.filter.or=[t]),this.state.params.id&&(e.filter.and=[{list_id:this.state.params.id}]),console.log(e),e},dataDriverJsonToObject:function dataDriverJsonToObject(configColumns){return configColumns.forEach((function(item,key){var myObj={func:{}};item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("webix")&&(eval(" myObj.func = (obj) => { return "+item.format+"(obj); }"),configColumns[key].numberFormat="1111.00"),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatMonthYear")&&(eval(" myObj.func = (obj) => { return "+item.format+"(obj); }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateTime")&&(eval(" myObj.func = (obj) => { try {formatDateTime(obj)} catch (e) { debugger; obj = obj.trim(); } return  (obj!='' && obj!=null) ? formatDateTime(obj) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateShort")&&(eval(" myObj.func = (obj) => { try {formatDateShort(obj)} catch (e) { debugger; obj = obj.trim();} return  (obj!='' && obj!=null) ? formatDateShort(obj) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDate")&&(eval(" myObj.func = (obj) => { try {formatDate(obj)} catch (e) { debugger; } return  (obj!='' && obj!=null) ? formatDate(obj) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateHour")&&(eval(" myObj.func = (obj) => { try {formatDateHour(obj)} catch (e) { debugger; } return  (obj!='' && obj!=null) ? formatDateHour(obj) : ''; }"),configColumns[key].format=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("(obj,common,value)")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("custom_checkbox")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("columnGroupTemplate")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func)})),configColumns},setColumnSettingForTable:function(){var e,t=this.getEl("batch-column"),i=[],o="0",a=0;for(var r in this.schemaColumnUserListObject=JSON.parse(this.schemaColumnUserList),e=this.schemaColumnUserListObject){1==++a&&(o=this.selectColumnSettingId?this.selectColumnSettingId:r);var n=e[r];i.push({id:r,value:n.value})}t.define("options",{body:{data:i}}),t.setValue(o),this.selectColumnSettingForTable(o),0==a||1==a?t.hide():t.show(),t.refresh()},selectColumnSettingForTable:function(e){var t=this;t.selectColumnSettingId=e;var i=this.schemaColumnUserListObject,o={},a={};for(var r in i){o=i[r].category;var n=function(i){console.log(i);var n=o[i];if(r==e)a[n.field]=n,t.table.getColumnConfig(n.field).cssFormat=function(e,t){return n};else{var l=t.table.getColumnConfig(n.field);l&&(l.cssFormat="")}};for(var l in o)n(l)}var s=function(e){t.table.getColumnConfig(e)&&(t.table.getColumnConfig(e).cssFormat=function(t,i){return a[e]})};for(var c in a)s(c);t.table.refreshColumns()},showFilterSetting:function(){var e={view:"window",head:"Настройки фильтра",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-filter-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderFilterSetting()}]}]}};this.winFilter=webix.ui(e),this.setElementFilterForm(),this.winFilter.show()},setElementFilterForm:function(){if(this.schemaFilterUserList&&this.schemaFilterUserList.length>2){var e=JSON.parse(this.schemaFilterUserList),t=this.winFilter.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementFilterForm(i));this.winFilter.queryView("form").setValues(e)}},getElementFilterForm:function(e){var t=this;return{localId:"element-filter-"+e,rows:[{cols:[{view:"combo",name:e+".operator",labelWidth:150,labelPosition:"top",label:"Оператор",value:"",disabled:0==e,options:["","and","or"]},{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"date_shipment",options:this.table.config.columns},{view:"combo",name:e+".comparison",labelWidth:150,labelPosition:"top",label:"Тип сравнения",value:"=",options:["=",">=","<=","in","!="]},{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Значение",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementFilterForm("element-filter-"+e)}}]},{height:20}]}},deleteElementFilterForm:function(e){var t=this.winFilter.queryView({localId:"form-row-layout"}),i=this.winFilter.queryView({localId:e});t.removeView(i)},getHeaderFilterSetting:function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-filter-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementFilterForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-setting",css:"webix_primary",click:function(){e.doSaveFilterSettingClick(this.getTopParentView().queryView("form").getValues()),e.winFilter.close()}}]}]}]},doSaveFilterSettingClick:function(e){var t=this;if(this.selectTypeValue){t.schemaFilterUserList=JSON.stringify(e);var i=this.state.apiRest.getUrl("put",this.state.urlTableUserListsPut,{},this.selectTypeValue);webix.ajax().put(i,{filter_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},showSetting:function(){var e=this;this.state.model=this.model,this.state.dataList="",this.state.listId="",this.state.tableSetiingConfigColumn=[],this.state.tableSettingItems=[],this.state.dataList=this.dataSelectType.data,this.state.listId=this.selectTypeValue,this.state.listId=this.selectTypeValue;var t=webix.ajax().sync().get(this.state.urlTableUserLists,{filter:{model:this.state.model}});this.state.dataList=JSON.parse(t.responseText);var i=webix.ajax().sync().get(e.state.urlTableUsers,{filter:{model:e.state.model,list_id:e.state.listId}}),o=JSON.parse(i.responseText);this.state.tableConfigColumn=o.config.columns,this.state.tableItems=o.data?o.data:o.items,this.state.tableSetiingConfigColumn=this.schemaTableSettingColumns,this.state.tableSettingItems=this.schemaTableSettingItems,this.state.tableSetiingData=this.schemaTableSettingData,this.win={};var a={view:"window",head:{cols:[{width:4},{type:"header",template:"Настройки таблицы",borderless:!0},{view:"icon",icon:"mdi mdi-close",align:"right",click:function(){this.getTopParentView().hide()}}]},width:950,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!1,body:{localId:"body-setting-layout",css:"webix_primary",type:"space",cols:[{view:"menu",layout:"y",width:250,select:!0,localId:"menu-list",scroll:!0,onContext:{},data:this.state.dataList,ready:function(){this.select(e.state.listId),e.attachEventShowColumns()},on:{onItemClick:function(t){var i=webix.ajax().sync().get(e.state.urlTableUsers,{filter:{model:e.state.model,list_id:t}}),o=JSON.parse(i.responseText);e.state.tableConfigColumn=o.config.columns,e.state.tableItems=o.data?o.data:o.items,e.state.listId=t;var a=this.getParentView().queryView({localId:"showColumnsTab"}),r=this.getParentView().queryView({localId:"settingColumnsTab"}),n=this.getParentView().queryView({localId:"tablePropertyTab"});a.define("rows",e.getHeaderShowColumns()),a.reconstruct(),e.attachEventShowColumns(),r.define("rows",e.getHeaderSettingColumns()),r.reconstruct();var l=webix.ajax().sync().get(e.state.urlTableSettingUsers,{filter:{model:e.state.model,list_id:t}}),s=JSON.parse(l.responseText);e.state.tableSetiingData=s,e.state.tableSetiingConfigColumn=s.config.columns,e.state.tableSettingItems=s.data?s.data:s.items,n.define("rows",e.getHeaderTableProperty()),n.reconstruct()}}},{view:"resizer"},{rows:[{view:"tabbar",value:"showColumnsTab",options:[{id:"showColumnsTab",value:"Видимые колонки"},{id:"settingColumnsTab",value:"Свойства колонок"},{id:"tablePropertyTab",value:"Настройки таблицы"}],on:{onItemClick:function(e,t){this.getParentView().queryView({localId:this.getValue()}).show()}}},{animate:!1,width:660,cells:[{localId:"showColumnsTab",type:"space",rows:this.getHeaderShowColumns()},{localId:"settingColumnsTab",type:"space",rows:this.getHeaderSettingColumns()},{localId:"tablePropertyTab",type:"space",rows:this.getHeaderTableProperty()}]}]}]}};this.win=webix.ui(a),this.contentMenu=this.$scope.ui(this.getContentMenu(),e),this.contentMenu.attachTo(this.win.queryView({localId:"menu-list"})),this.win.show()},getHeaderShowColumns:function(){var e=this,t=this;return[{view:"text",localId:"search-show-columns",placeholder:"поиск"},{cols:[{view:"dataview",localId:"dataview-show-columns",borderless:!1,select:!0,xCount:2,scroll:!0,type:{width:"auto",markCheckbox:function(e,t){return"<span class='metadata_config_check webix_icon wxi-checkbox-"+(e.hidden?"blank":"marked")+" +square-o'></span>"}},onClick:{metadata_config_check:function(e,i){var o=this.getItem(i);(o.hidden=o.hidden?0:1,this.updateItem(i,o),1==o.hidden)?t.table.hideColumn(o.column_id):-1!=t.table.getColumnIndex(o.column_id)?t.table.showColumn(o.column_id):(t.table.config.columns.splice(o.id,0,{id:o.column_id,header:o.header,adjust:"header",hidden:0}),t.table.refreshColumns())}},on:{onBeforeSelect:function(e){return!this.getItem(e).hidden}},scheme:{$init:function(e){e.hidden&&(e.$css="metadata_list_item_disabled")}},template:"{common.markCheckbox()}<div style='margin-top:5px;'>#header# (#column_id#)</div>",data:t.state.tableItems,datatype:"json",save:t.state.urlTableUsersSave}]},{type:"space",borderless:!0,cols:[{view:"button",label:"Копировать в базовые настройки",localId:"save-setting",css:"webix_primary",click:function(){return e.doSaveBaseSettingClick()}},{}]}]},attachEventShowColumns:function(){var e=this.win.queryView({localId:"search-show-columns"}),t=this.win.queryView({localId:"dataview-show-columns"});e.attachEvent("onChange",(function(e,i,o){t.filter((function(t){return-1!=t.column_id.toString().indexOf(e)})),0==t.count()&&t.filter((function(t){return-1!=t.header.toString().indexOf(e)}))}))},getHeaderSettingColumns:function(){var e=[],t=[],i=[],o=[],a=[],r=[],n=[];return this.state.tableItems.forEach((function(e){0==e.hidden&&n.push(e)})),this.state.tableConfigColumn.forEach((function(n){"header_filter_type"==n.id&&(e=n.options),"header_total_type"==n.id&&(t=n.options),"format"==n.id&&(i=n.options),"sort_type"==n.id&&(o=n.options),"editor"==n.id&&(a=n.options),"form_edit"==n.id&&(r=n.options)})),[{view:"datatable",css:"webix_header_border webix_data_border",select:"row",editable:!0,editaction:"click",tooltip:!0,leftSplit:2,borderless:!1,columns:[{id:"index",header:"#",hidden:!1,width:40,css:{"background-color":"#F4F5F9"}},{id:"header",header:"Колонка",adjust:"all",editor:"text",css:{"background-color":"#F4F5F9"},tooltip:"#column_id#"},{id:"sort_order",header:"Порядок",editor:"text",adjust:"all"},{id:"header_filter_type",header:"Тип фильтра",editor:"select",options:e,adjust:"all"},{id:"header_total_type",header:"Тип итого",editor:"select",options:t,adjust:"all"},{id:"editor",header:"Редактор",editor:"select",options:a,adjust:"all"},{id:"format",header:"Формат колонки",editor:"select",options:i,adjust:"header"},{id:"css",header:"Стиль",editor:"popup",adjust:"header"},{id:"css_format",header:"Css Формат",editor:"popup",adjust:"header"},{id:"sort_type",header:"Тип сорт.",editor:"select",options:o,adjust:"all"},{id:"width",header:"Ширина",editor:"text",adjust:"all"},{id:"adjust",header:"Рег.ширины",editor:"text",adjust:"all"},{id:"template",header:"Шаблон",editor:"popup",adjust:"header"},{id:"options",header:"Список",editor:"popup",adjust:"header"},{id:"options_url",header:"Url справочника",editor:"popup",adjust:"all"},{id:"use_filter",header:"Исп. в фильтре",editor:"text",adjust:"all"},{id:"math",header:"Math",editor:"popup",adjust:"all"},{id:"form_edit",header:"Форма редакт.",editor:"select",options:r,adjust:"all"},{id:"goto",header:"url",editor:"popup",adjust:"all"},{id:"",header:"",fillspace:!0}],data:n,datatype:"json",save:this.state.urlTableUsersSave,scheme:{$init:function(e){e.index=this.count()-1+1}}}]},getHeaderTableProperty:function(){return this.state.tableSetiingData.config.columns=this.dataDriverJsonToObject(this.state.tableSetiingData.config.columns),[{view:"treetable",css:"webix_header_border webix_data_border",select:"cell",editable:!0,editaction:"click",tooltip:!0,data:this.state.tableSetiingData,save:this.state.urlTableSettingUsersSave,scheme:{$init:function(e){e.index=this.count()-1+1},$group:{by:"type_property",map:{property_value:["type_property"],property_title:["property_title"],value:["","string"]}}},ready:function(){this.openAll()}}]},doSaveBaseSettingClick:function(){var e=this.state.apiRest.getUrl("get","accounting/schema-table-user-list/save-to-base-setting"),t=webix.ajax().sync().get(e,{listId:this.state.listId,model:this.state.model}),i=JSON.parse(t.responseText);this.showMessageError(i)},getContentMenu:function(){var e=this;return{view:"contextmenu",editable:!0,editor:"text",data:[{id:"add",value:"Копировать"},{id:"rename",value:"Переименовать"},{id:"is_default",value:"По умолчанию"},{id:"copy_user",value:"Для пользователя"},{$template:"Separator"},{id:"delete",value:"Удалить"}],on:{onItemClick:function(t){var i=this.getContext();i.obj,i.id;"delete"==t&&e.doDeleteMenuClick(i.id,i.obj),"add"==t&&e.doSaveSettingClick(),"rename"==t&&e.doRenameClick(i.id,i),"is_default"==t&&e.doDefaultMenuClick(i.id,i),"copy_user"==t&&e.doCopyUsertMenuClick(i.id,i)}}}},doSaveSettingClick:function(){var e=this.state.apiRest.getUrl("get","accounting/schema-table-user/save-setting"),t=webix.ajax().sync().get(e,{listId:this.state.listId,model:this.state.model}),i=JSON.parse(t.responseText),o=this.win.queryView({localId:"menu-list"});o.add(i.data),o.select(i.data.id),o.callEvent("onItemClick",[i.data.id])},doDeleteMenuClick:function(e,t){var i=this.state.apiRest.getUrl("delete","accounting/schema-table-user-lists",{},e);204==webix.ajax().sync().del(i).status?(t.remove(e),t.select(t.getFirstId()),this.state.listId=t.getFirstId()):webix.message("Ошибка! Данные не удалены!")},doDefaultMenuClick:function(e,t){var i=this.state.apiRest.getUrl("get","accounting/schema-table-user-list/set-default",{id:e}),o=webix.ajax().sync().get(i),a=JSON.parse(o.responseText);1==a.success?(t.obj.data.each((function(e){e.id==t.id?(e.icon="mdi mdi-flip-to-front",e.is_default=1,e.editor="text"):(e.icon="mdi mdi-flip-to-back",e.is_default=0)})),t.obj.refresh()):webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))},doRenameClick:function(e,t){var i=this.state.apiRest.getUrl("put","accounting/schema-table-user-lists",{},e);webix.prompt({text:"Изменить название",ok:"Сохранить",cancel:"Отмена",input:{required:!0,value:t.obj.getItem(e).value,placeholder:"Введите название"},width:350}).then((function(e){var o=webix.ajax().sync().put(i,{name:e}),a=JSON.parse(o.responseText);if(200==o.status){var r=t.obj.getItem(t.id);r.name=e,r.value=e,t.obj.refresh()}else webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))})).fail((function(){}))},doCopyUsertMenuClick:function(e,t){var i=this;this.state.apiRest.getUrl("get","accounting/users");webix.ui({view:"window",width:500,height:400,head:"Копировать настройи для пользователя",modal:!0,position:"center",close:!0,body:{type:"space",cols:[{type:"form",rows:[{view:"combo-close",localId:"combo-user",options:this.state.apiRest.getCollection("accounting/users",{"per-page":-1},"email"),label:"Выберите пользователя",labelWidth:180,required:!0,placeholder:"Выберите пользователя"},{cols:[{view:"button",label:"Сохранить",click:function(){var e=this.getTopParentView().queryView({localId:"combo-user"}).getValue(),o=i.state.apiRest.getUrl("get","accounting/schema-table-user/save-setting-for-user"),a=webix.ajax().sync().get(o,{listId:t.id,model:i.state.model,userId:e}),r=JSON.parse(a.responseText);this.getTopParentView().hide(),i.showMessageError(r)}},{},{}]}]}]}}).show()},showSortSetting:function(){var e={view:"window",head:"Настройки сортировки",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-sort-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderSortSetting()}]}]}};this.winSort=webix.ui(e),this.setElementSortForm(),this.winSort.show()},setElementSortForm:function(){if(this.schemaSortUserList&&this.schemaSortUserList.length>2){var e=JSON.parse(this.schemaSortUserList),t=this.winSort.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementSortForm(i));this.winSort.queryView("form").setValues(e)}},getElementSortForm:function(e){var t=this;return{localId:"element-sort-"+e,rows:[{cols:[{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"date_shipment",options:this.table.config.columns},{view:"combo",name:e+".direction",labelWidth:150,labelPosition:"top",label:"Тип сортировки",value:"ASC",options:[{id:"ASC",value:"по возрастанию"},{id:"DESC",value:"по убыванию"}]},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementSortForm("element-sort-"+e)}}]},{height:20}]}},deleteElementSortForm:function(e){var t=this.winSort.queryView({localId:"form-row-layout"}),i=this.winSort.queryView({localId:e});t.removeView(i)},getHeaderSortSetting:function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-sort-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementSortForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-setting",css:"webix_primary",click:function(){e.doSaveSortSettingClick(this.getTopParentView().queryView("form").getValues()),e.winSort.close()}}]}]}]},doSaveSortSettingClick:function(e){var t=this;if(this.selectTypeValue){t.schemaSortUserList=JSON.stringify(e);var i=this.state.apiRest.getUrl("put",this.state.urlTableUserListsPut,{},this.selectTypeValue);webix.ajax().put(i,{sort_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},setColorSettingForTable:function setColorSettingForTable(){var colorSetting=JSON.parse(this.schemaColorUserList),condition=[],obj={func:function(){}},index=-1;for(var key in colorSetting){var item=colorSetting[key];""!=item.operator.trim()||(index++,condition[index]=[]),condition[index].push(item)}var conditionFunction="function(item, view, prop) { item.index = (this.count())+1; ";condition.forEach((function(e){if(e.length>1){var t="(",i={};e.forEach((function(e){var o="="==e.comparison?"==":e.comparison,a=-1!=e.value.indexOf("{")?e.value.replace("{","").replace("}",""):"'"+e.value+"'",r="";"and"==e.operator&&(r="&&"),"or"==e.operator&&(r="||"),t+=r+" item."+e.field+" "+o+" "+a+" ",i=e})),t+=")";var o='{"background-color":"'+i.color+'"}';conditionFunction+="if "+t+" { item.$css = "+o+"; } "}if(1==e.length){var a=e[0],r='{"background-color":"'+a.color+'"}',n="="==a.comparison?"==":a.comparison,l=-1!=a.value.indexOf("{")?a.value.replace("{","").replace("}",""):"'"+a.value+"'";conditionFunction+="if (item."+a.field+" "+n+" "+l+") { item.$css = "+r+"; } "}})),conditionFunction+="}",console.log(conditionFunction),eval(" obj.func = "+conditionFunction),this.table.define("scheme",{$init:obj.func})},showColorSetting:function(){var e={view:"window",head:"Настройки цветов",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-color-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderColorSetting()}]}]}};this.winColor=webix.ui(e),this.setElementColorForm(),this.winColor.show()},setElementColorForm:function(){if(this.schemaColorUserList&&this.schemaColorUserList.length>2){var e=JSON.parse(this.schemaColorUserList),t=this.winColor.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementColorForm(i));this.winColor.queryView("form").setValues(e)}},getElementColorForm:function(e){var t=this;return{localId:"element-color-"+e,rows:[{cols:[{view:"combo",name:e+".operator",labelWidth:150,labelPosition:"top",label:"Оператор",value:"",disabled:0==e,options:[" ","and","or"]},{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"",options:this.table.config.columns},{view:"combo",name:e+".comparison",labelWidth:150,labelPosition:"top",label:"Тип сравнения",value:"==",options:["==",">=","<=","!="]},{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Значение",value:""},{view:"colorpicker",name:e+".color",labelWidth:150,labelPosition:"top",label:"Цвет",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementColorForm("element-color-"+e)}}]},{height:20}]}},deleteElementColorForm:function(e){var t=this.winColor.queryView({localId:"form-row-layout"}),i=this.winColor.queryView({localId:e});t.removeView(i)},getHeaderColorSetting:function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-color-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementColorForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-color-setting",css:"webix_primary",click:function(){e.doSaveColorSettingClick(this.getTopParentView().queryView("form").getValues()),e.winColor.close()}}]}]}]},doSaveColorSettingClick:function(e){var t=this;if(this.selectTypeValue){t.schemaColorUserList=JSON.stringify(e);var i=this.state.apiRest.getUrl("put",this.state.urlTableUserListsPut,{},this.selectTypeValue);webix.ajax().put(i,{color_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},showColumnSetting:function(){var e=this,t={view:"window",head:"Настройки  столбцов",width:800,height:600,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-color-column-layout",type:"space",cols:[{rows:[{rows:this.getHeaderColumnSetting()},{padding:10,cols:[{},{},{view:"button",label:"Сохранить",localId:"save-column-setting",css:"webix_primary",click:function(){e.doSaveColumnSettingClick(this.getTopParentView().queryView("form").getValues()),e.winColumn.close()}}]}]}]}};this.winColumn=webix.ui(t),this.setCategoryColumnForm(),this.winColumn.show()},setCategoryColumnForm:function(){if(this.schemaColumnUserList&&this.schemaColumnUserList.length>2){var e=JSON.parse(this.schemaColumnUserList),t=this.winColumn.queryView({localId:"form-row-layout"});for(var i in e)for(var o in t.addView(this.getCategoryColumnForm(i)),e[i].category){t.queryView({localId:"form-subrow-layout"+i}).addView(this.getElementColumnForm(i,o))}this.winColumn.queryView("form").setValues(e)}},getCategoryColumnForm:function(e){var t=this;return{localId:"category-column-"+e,rows:[{type:"form",rows:[{cols:[{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Название расцветки",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteCategoryColumnForm("category-column-"+e,e)}}]},{localId:"form-subrow-layout"+e,rows:[]},{cols:[{view:"button",label:"+",localId:"add-column-category",css:"webix_primary",width:40,click:function(){var i=this.getTopParentView().queryView({localId:"form-subrow-layout"+e}),o="0";i.getChildViews().length>0&&(o=t.getLasElementId(this,e)),i.addView(t.getElementColumnForm(e,o))}},{},{}]}]},{height:10}]}},getLasElementId:function(e,t){var i=e.getTopParentView().queryView("form").getValues()[t];return(1*Object.keys(i.category)[Object.keys(i.category).length-1]+1).toString()},getLasCategoryId:function(e){var t=e.getTopParentView().queryView("form").getValues();return(1*Object.keys(t)[Object.keys(t).length-1]+1).toString()},getElementColumnForm:function(e,t){var i=this;return{localId:"element-column-"+e+"-"+t,rows:[{cols:[{view:"combo",name:e+".category."+t+".field",labelWidth:150,labelPosition:"top",label:"Выберите колонку",value:"",options:this.table.config.columns},{view:"combo",name:e+".category."+t+".font-weight",labelWidth:150,labelPosition:"top",label:"Стиль текста",value:"normal",options:[{id:"normal",value:"нормальный"},{id:"500",value:"полужирный"},{id:"700",value:"жирный"}]},{view:"combo",name:e+".category."+t+".text-align",labelWidth:150,labelPosition:"top",label:"Выравнять текст",value:"left",options:[{id:"left",value:"по левому краю"},{id:"center",value:"по середине"},{id:"right",value:"по правому краю"}]},{view:"colorpicker",name:e+".category."+t+".color",labelWidth:150,labelPosition:"top",label:"Цвет текста",value:""},{view:"colorpicker",name:e+".category."+t+".background-color",labelWidth:150,labelPosition:"top",label:"Цвет фона",value:""},{view:"icon",icon:"mdi mdi-close",css:"small",labelPosition:"top",click:function(){i.deleteElementColumnForm("element-column-"+e+"-"+t,e,t)}}]},{height:20}]}},deleteCategoryColumnForm:function(e,t){var i=this.winColumn.queryView({localId:"form-row-layout"}),o=this.winColumn.queryView({localId:e});t==this.selectColumnSettingId&&(this.selectColumnSettingId=null);var a=JSON.parse(this.schemaColumnUserList),r=a[t]?a[t].category:{};for(var n in r)this.table.getColumnConfig(r[n].field).cssFormat="";this.table.refreshColumns(),i.removeView(o)},deleteElementColumnForm:function(e,t,i){var o=this.winColumn.queryView({localId:"form-subrow-layout"+t}),a=this.winColumn.queryView({localId:e}),r=JSON.parse(this.schemaColumnUserList);if(r[t]){var n=r[t].category[i];this.table.getColumnConfig(n.field).cssFormat="",this.table.refreshColumns()}o.removeView(a)},getHeaderColumnSetting:function(){var e=this;return[{view:"form",borderless:!0,complexData:!0,localId:"form-column",scroll:"y",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-column-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i="0";t.getChildViews().length>0&&(i=e.getLasCategoryId(this)),t.addView(e.getCategoryColumnForm(i))}}]},{}]}]},doSaveColumnSettingClick:function(e){var t=this;if(this.selectTypeValue){t.schemaColumnUserList=JSON.stringify(e);var i=this.state.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{column_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,i,o){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3}),t.setColumnSettingForTable()}})}},doRefresh:function(){this.getDataTable()},doAddClick:function(){this.table.unselect(),this.table.listId=this.state.params.id,this.state.formEdit.showForm(this.table)},doClickOpenAll:function(){var e=this.table;e.getOpenItems().length>0?e.closeAll():e.openAll()},showExportToExcelSetting:function(){var e={view:"window",head:"Настройки экспорта в Excel",width:950,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-print-layout",css:"webix_primary",type:"space",cols:[{view:"menu",layout:"y",width:250,select:!0,localId:"menu-list-print",onContext:{},url:this.state.apiRest.getUrl("get","accounting/schema-print-user-lists",{"per-page":-1,filter:'{"list_id":"'+this.selectTypeValue+'"}'}),hidden:!0,on:{onAfterLoad:function(){this.data.count()>0&&this.show(),this.select(this.data.getFirstId()),this.callEvent("onItemClick",[this.data.getFirstId()])},onItemClick:function(e){var t=this.getTopParentView().queryView({localId:"print-column-select"});JSON.parse(this.getItem(e).setting).forEach((function(e){t.data.each((function(t){t.id==e.id&&(t.hidden=e.hidden)}))})),t.refresh()}}},{type:"form",rows:[{header:"Показывать",rows:this.getHeaderPrintColumns()}]}]}};this.winPrint=webix.ui(e),this.contentMenuPrint=this.$scope.ui(this.getContentMenuPrint(),this),this.contentMenuPrint.attachTo(this.winPrint.queryView({localId:"menu-list-print"})),this.winPrint.show()},getHeaderPrintColumns:function(){var e=this;return[{view:"dataview",localId:"print-column-select",select:!0,type:{width:250,markCheckbox:function(e,t){return"<span class='metadata_config_check webix_icon wxi-checkbox-"+(e.hidden?"blank":"marked")+" +square-o'></span>"}},onClick:{metadata_config_check:function(e,t){var i=this.getItem(t);i.hidden=i.hidden?0:1,this.updateItem(t,i)}},on:{onBeforeSelect:function(e){return!this.getItem(e).hidden}},scheme:{$init:function(e){e.hidden&&(e.$css="metadata_list_item_disabled")}},template:function(e,t){return t.markCheckbox(e,t)+"<div style='margin-top:5px;'>"+e.header[0].text+"</div>"},data:e.table.config.columns,datatype:"json"},{cols:[{},{},{view:"button",label:"Сохранить настройки",localId:"save-setting",css:"webix_primary",click:function(){var t=this.getTopParentView().queryView({localId:"print-column-select"}).data.serialize();e.doSavePrintSettingClick(t)}},{view:"button",label:"Печать",localId:"print-button",css:"webix_primary",click:function(){var t=this.getTopParentView().queryView({localId:"print-column-select"}).data.serialize();e.doClickToExcel(t),this.getTopParentView().close()}}]}]},doSavePrintSettingClick:function(e){var t=this,i=this.state.apiRest.getUrl("get","accounting/schema-print-user-lists"),o=[];e.forEach((function(e){o.push({id:e.id,hidden:e.hidden?e.hidden:0})})),webix.ajax().post(i,{model:this.model,setting:JSON.stringify(o),name:"Печать",list_id:this.selectTypeValue},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})},doClickToExcel:function(e){var t=this.table,i="";this.filter.filter.or.forEach((function(e){for(var t in e)if(i=i+"_"+t,"object"==typeof e[t])for(var o in e[t])i=i+"_"+e[t][o];else i=i+"_"+e[t]}));var o=[];e.forEach((function(e){e.hidden||o.push(e)})),webix.toExcel(t,{filename:this.state.params.mode+i,styles:!1,ignore:{"action-edit":!0},columns:o})},getContentMenuPrint:function(){var e=this;return{view:"contextmenu",localId:"cmenu-print",editable:!0,editor:"text",data:[{id:"rename",value:"Переименовать"},{id:"is_default",value:"По умолчанию"},{$template:"Separator"},{id:"delete",value:"Удалить"}],on:{onItemClick:function(t){var i=this.getContext();i.obj,i.id;"delete"==t&&e.doDeleteMenuPrintClick(i.id,i.obj),"rename"==t&&e.doRenamePrintClick(i.id,i),"is_default"==t&&e.doDefaultMenuPrintClick(i.id,i)}}}},doDeleteMenuPrintClick:function(e,t){var i=this.state.apiRest.getUrl("delete","accounting/schema-print-user-lists",{},e);204==webix.ajax().sync().del(i).status?(t.remove(e),t.select(t.getFirstId()),t.callEvent("onItemClick",[t.getFirstId()])):webix.message("Ошибка! Данные не удалены!")},doRenamePrintClick:function(e,t){var i=this.state.apiRest.getUrl("put","accounting/schema-print-user-lists",{},e);webix.prompt({text:"Изменить название",ok:"Сохранить",cancel:"Отмена",input:{required:!0,value:t.obj.getItem(e).value,placeholder:"Введите название"},width:350}).then((function(e){var o=webix.ajax().sync().put(i,{name:e}),a=JSON.parse(o.responseText);if(200==o.status){var r=t.obj.getItem(t.id);r.name=e,r.value=e,t.obj.refresh()}else webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))})).fail((function(){}))},doDefaultMenuPrintClick:function(e,t){var i=this.state.apiRest.getUrl("get","accounting/schema-print-user-list/set-default",{id:e}),o=webix.ajax().sync().get(i),a=JSON.parse(o.responseText);1==a.success?(t.obj.data.each((function(e){e.id==t.id?(e.icon="mdi mdi-flip-to-front",e.is_default=1,e.editor="text"):(e.icon="mdi mdi-flip-to-back",e.is_default=0)})),t.obj.refresh()):webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))},showMessageError:function(e){if(e.errors)for(var t in e.errors)webix.message({text:t+":"+e.errors[t],type:"error",expire:-1});e.success&&webix.message({text:"Данные успешно сохранены!",type:"info",expire:2e3})},beforeDropChangeData:function(e,t,i){var o=this,a=this.table,r=this.schemaTableSetting.group["group-by"].value,n=this;a.getSelectedId(!0);return i.source.forEach((function(e){a.getItem(e)[r]=formatDateTimeDb(parserDateTimeGroup(t)),a.refresh(e);var i=o.state.apiRest.getUrl("put","accounting/"+n.getModelName(n.state.params.mode),{},e);webix.ajax().sync().put(i,a.getItem(e))})),!0},putSelectTypeState:function(e){webix.storage.local.put(this.state.params.mode+"_"+this.state.type+"_select_type_state",{selectType:e})},showMessageResult:function(e,t,i){if(e.errors)for(var o in e.errors)webix.message({text:o+":"+e.errors[o],type:"error",expire:-1});200==t.status&&!e.errors&&i&&webix.message({text:"Данные cохранены",type:"info",expire:1e3}),204==t.status&&webix.message({text:"Ошибка! Данные не сохранены",type:"error",expire:-1})},versionReloadPage:function(e){webix.storage.local.put("finplan_version",e),webix.modalbox({title:"Доступна новая версия "+e,buttons:["Обновить"],text:"Обновите страницу"}).then((function(e){location.reload(!0)}))}},webix.ui.layout)},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(6).a)).getUrl("get","accounting/cloths",{sort:"color","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.full_name}}})},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);webix.Date.dateToStr("%M %y");var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){firebase.initializeApp({databaseURL:"https://webix-demo.firebaseio.com/"});var e=firebase.database(),t=(webix.proxy("firebase",e.ref("tasks")),"//docs.webix.com/kanban/samples/server"),i="https://docs.webix.com/samples/63_kanban/common/imgs/",o=[{id:1,value:"Rick Lopes",image:i+"1.jpg"},{id:2,value:"Martin Farrell",image:i+"2.jpg"},{id:3,value:"Douglass Moore",image:i+"3.jpg"},{id:4,value:"Eric Doe",image:i+"4.jpg"},{id:5,value:"Sophi Elliman",image:i+"5.jpg"},{id:6,value:"Anna O'Neal"},{id:7,value:"Marcus Storm",image:i+"7.jpg"},{id:8,value:"Nick Branson",image:i+"8.jpg"},{id:9,value:"CC",image:i+"9.jpg"}],a=["Better late than never","Webix Jet tutorial","SpreadSheet NodeJS","Kanban tutorial","Take it easy"];return{localId:"layout",cols:[{view:"form",rows:[{view:"label",label:"Select placeholder"},{view:"list",width:200,borderless:!0,autoheight:!0,select:!0,data:[{id:1,value:"France",expense:[1,2,3],income:842},{id:2,value:"Poland",expense:684,income:781},{id:3,value:"China",expense:8142,income:7813}],on:{onAfterSelect:function(e){var t=this.getItem(e);$$("ssheet").setPlaceholder(t)}},ready:function(){this.select(1)}},{}]},{view:"kanban",id:"kb",cols:[{rows:[{view:"kanbanheader",label:"Backlog",link:"new",on:{onBeforeCardAdd:function(e,t){e.color=Math.floor(3*Math.random())+1,e.text=a[Math.floor(5*Math.random())]}}},{id:"new",view:"kanbanlist",status:"new"}]},{rows:[{view:"kanbanheader",label:"In Progress",link:"work"},{id:"work",view:"kanbanlist",status:"work"}]},{rows:[{view:"kanbanheader",label:"Testing",link:"test"},{id:"test",view:"kanbanlist",status:"test"}]},{rows:[{view:"kanbanheader",label:"Done",link:"done"},{id:"done",view:"kanbanlist",status:"done"}]}],attachments:t+"/attachments",save:{url:"json->"+t+"/tasks/common",trackMove:!0},data:JSON.parse('[{"status":"new","text":"Test new authentification service","tags":[1,2,3],"comments":[1,2,3],"attachments":[{"id":1,"link":"/kanban/samples/server/attachments/file003.xls","size":2702}],"id":"1"},{"status":"test","user_id":"9","text":"Portlets view","tags":["4","2"],"comments":[1],"attachments":[{"id":4,"link":"/kanban/samples/server/attachments/file004.txt","size":787},{"id":5,"link":"/kanban/samples/server/attachments/file001.rar","size":2702}],"id":"5","color":""},{"status":"work","user_id":3,"text":"SpreadSheet NodeJS","tags":[3],"id":"4"},{"status":"work","user_id":"7","text":"Webix Jet tutorial","tags":["4","6"],"attachments":[{"id":8,"link":"/kanban/samples/server/attachments/image004.jpg","size":84683}],"id":"6","color":"3"},{"status":"work","user_id":"5","text":"Performance tests","tags":["1"],"comments":[2,3],"attachments":[{"id":1621588830346,"link":"/kanban/samples/server/attachments/HR-Dashboard.pdf","size":30671}],"id":"2","color":""},{"status":"work","user_id":6,"text":"Kanban tutorial","tags":[2],"comments":[3],"id":"3"}]'),users:o,editor:!0}]}},a.init=function(){$$("kb").waitData.then((function(){$$("kb").data.each((function(e){if(e.attachments){for(var t=0;t<e.attachments.length;t++)e.attachments[t].link="//docs.webix.com"+e.attachments[t].link;$$("kb").refresh()}}))}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);webix.Date.dateToStr("%M %y");var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){firebase.initializeApp({databaseURL:"https://webix-demo.firebaseio.com/"});var e=firebase.database();webix.proxy("firebase",e.ref("tasks"));return{localId:"layout",cols:[{view:"form",rows:[{view:"label",label:"Select placeholder"},{view:"list",width:200,borderless:!0,autoheight:!0,select:!0,data:[{id:1,value:"France",expense:[1,2,3],income:842},{id:2,value:"Poland",expense:684,income:781},{id:3,value:"China",expense:8142,income:7813}],on:{onAfterSelect:function(e){var t=this.getItem(e);$$("ssheet").setPlaceholder(t)}},ready:function(){this.select(1)}},{}]},{view:"spreadsheet",id:"ssheet",toolbar:"full",data:{styles:[["top","#FFEFEF;#6E6EFF;center;'PT Sans', Tahoma;17px;"],["subtop","#818181;#EAEAEA;center;'PT Sans', Tahoma;15px;;;bold;;;0-0-0-0,;"],["count","#818181;#EAEAEA;center;'PT Sans', Tahoma;15px;;;;;;0-0-0-0,;"],["calc-top","#818181;#EAEAEA;;'PT Sans', Tahoma;15px;;;bold;;;0-0-0-0,;"],["calc-other","#818181;#EAEAEA;;'PT Sans', Tahoma;15px;;;bold;;;0-0-0-0,;"]],data:[[1,1,"Report 2015","top"],[2,1,"Countries:","subtop"],[3,1,"={{value}}","count"],[2,2,"Expense","count"],[3,2,"={{expense}}"],[2,3,"Income","count"],[3,3,"={{income}}"],[2,6,"Total:","calc-top"],[3,6,"=B3-C3"],[2,7,"Std Deviation:","calc-top"],[3,7,"=STDEVP(B3:C3)"]],spans:[[1,1,3,1]],sizes:[[0,7,130],[0,8,200],[0,5,20],[0,4,20]]}}]}},a.init=function(){$$("ssheet").hideGridlines(!0),$$("ssheet").hideHeaders(!0),this.tableUrl=this.app.config.apiRest.getUrl("get","accounting/employee-salaries",{sort:"sort: date_salary",expand:"documentSalaryAccrual, employee,transactionPart","per-page":-1});webix.ajax().get(this.tableUrl,{filter:{employee_id:24}}).then((function(e){var t=e.json(),i=[];t.data.forEach((function(e,o){var a=o+1;0==o&&t.config.columns.forEach((function(e,t){var o=[1,t+1,e.header[0],"subtop"];i.push(o)})),t.config.columns.forEach((function(t,o){var r=[a+1,o+1,e[t.id]];i.push(r)}))}));$$("ssheet").parse([{name:"Sheet1",content:{data:i,styles:[["subtop","#818181;#EAEAEA;center;'PT Sans', Tahoma;13px;;;bold;;;0-0-0-0,;"]],sizes:[[0,7,130],[0,1,200],[0,5,20],[0,4,20]]}}]),$$("ssheet").hideGridlines(!0)}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(87);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){return{view:"datatable",autoConfig:!0}},r.init=function(e){e.parse(a.a)},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return{}},a.init=function(e){var t=this.app.getService("user").getUser();t.type,t.start_page?this.show(t.start_page):this.show("/top/inproduce/order")},o}(i(0).b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));var o=i(0),a=i(87),r=i(120),n=i.n(r);var l=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){return{template:n.a}},r.init=function(e){e.setValues({record:a.a.serialize()})},o}(o.b)},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.HandlebarsEnvironment=d;var a=i(10),r=o(i(13)),n=i(101),l=i(131),s=o(i(103)),c=i(104);t.VERSION="4.7.3";t.COMPILER_REVISION=8;t.LAST_COMPATIBLE_COMPILER_REVISION=7;t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};function d(e,t,i){this.helpers=e||{},this.partials=t||{},this.decorators=i||{},n.registerDefaultHelpers(this),l.registerDefaultDecorators(this)}d.prototype={constructor:d,logger:s.default,log:s.default.log,registerHelper:function(e,t){if("[object Object]"===a.toString.call(e)){if(t)throw new r.default("Arg not supported with multiple helpers");a.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if("[object Object]"===a.toString.call(e))a.extend(this.partials,e);else{if(void 0===t)throw new r.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if("[object Object]"===a.toString.call(e)){if(t)throw new r.default("Arg not supported with multiple decorators");a.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){c.resetLoggedProperties()}};var u=s.default.log;t.log=u,t.createFrame=a.createFrame,t.logger=s.default},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.registerDefaultHelpers=function(e){a.default(e),r.default(e),n.default(e),l.default(e),s.default(e),c.default(e),d.default(e)},t.moveHelperToHooks=function(e,t,i){e.helpers[t]&&(e.hooks[t]=e.helpers[t],i||delete e.helpers[t])};var a=o(i(124)),r=o(i(125)),n=o(i(126)),l=o(i(127)),s=o(i(128)),c=o(i(129)),d=o(i(130))},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";t.__esModule=!0;var o=i(10),a={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=o.indexOf(a.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=a.lookupLevel(e),"undefined"!=typeof console&&a.lookupLevel(a.level)<=e){var t=a.methodMap[e];console[t]||(t="log");for(var i=arguments.length,o=Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];console[t].apply(console,o)}}};t.default=a,e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.createProtoAccessControl=function(e){var t=Object.create(null);t.constructor=!1,t.__defineGetter__=!1,t.__defineSetter__=!1,t.__lookupGetter__=!1;var i=Object.create(null);return i.__proto__=!1,{properties:{whitelist:o.createNewLookupObject(i,e.allowedProtoProperties),defaultValue:e.allowProtoPropertiesByDefault},methods:{whitelist:o.createNewLookupObject(t,e.allowedProtoMethods),defaultValue:e.allowProtoMethodsByDefault}}},t.resultIsAllowed=function(e,t,i){return n("function"==typeof e?t.methods:t.properties,i)},t.resetLoggedProperties=function(){Object.keys(r).forEach((function(e){delete r[e]}))};var o=i(133),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(103)),r=Object.create(null);function n(e,t){return void 0!==e.whitelist[t]?!0===e.whitelist[t]:void 0!==e.defaultValue?e.defaultValue:(function(e){!0!==r[e]&&(r[e]=!0,a.log("error",'Handlebars: Access has been denied to resolve the property "'+e+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(t),!1)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return InproduceView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),views_comment_index__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9),views_order_check_work__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8),core_window_WindowDirectoryView__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(17),core_formView__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(37),components_comboClose__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_8__);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function formatPercent(e){return 100*e}webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)1==t[o].$level&&(isNaN(e(t[o]))||(i+=1*e(t[o])));return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0})},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:".",decimalSize:2}),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCountEmpty=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.toolsContent=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.mathColumn=webix.extend({refresh:function refresh(master,node,value){var result=0,result2=0,_val=0,_val2=0,res=0,resultFormula="res = 0;";this.sumRes={};var scope=this;master.data.each((function(e){if(!e.$group&&e["$"+value.columnId]){var t=e["$"+value.columnId].match(/[^\[.\]$']+/g);resultFormula="res";var i={};t.forEach((function(t){var o=t.replace("r,","");e[o]&&(scope.sumRes[o]||(scope.sumRes[o]=0),i[o]||(i[o]=!0,scope.sumRes[o]+=1*e[o]),o="this.sumRes['"+o+"']"),resultFormula+=o}))}})),"res = 0;"!=resultFormula&&eval(resultFormula),result=value.format(res),node.innerHTML=result}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:350,height:200}}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var formatDate=webix.Date.dateToStr("%d.%m.%y"),formatDateHour=webix.Date.dateToStr("%d.%m.%y %H:00"),formatDateShort=webix.Date.dateToStr("%d.%m"),formatDateTimeDb=webix.Date.dateToStr("%Y-%m-%d %H:%i"),formatMonthYear=webix.Date.dateToStr("%M %y"),formatDateTime=webix.Date.dateToStr("%d.%m.%y %H:%i"),parserDate=webix.Date.strToDate("%Y-%m-%d"),parserDateTime=webix.Date.strToDate("%Y-%m-%d %H:%i"),parserDateTimeGroup=webix.Date.strToDate("%d.%m.%y %H:%i");function custom_checkbox(e,t,i){return i?"<div class='webix_table_checkbox checked'> YES </div>":"<div class='webix_table_checkbox notchecked'> NO </div>"}function columnGroupTemplate(e,t,i){return e.$group?t.treetable(e,t)+e.property_value:t.icon(e)+t.folder(e,t)+" "+i}webix.editors.buttonEditor={focus:function(){this.getInputNode(this.node).focus(),this.getInputNode(this.node).select()},getValue:function(){return this.getInputNode(this.node).refValue},setValue:function(e,t){var i="",o=this.config.collection.getItem(e);o&&(i=o.value),this.getInputNode(this.node).value=i,this.getInputNode(this.node).refValue=e},getInputNode:function(){return this.node.firstChild},render:function(){return webix.html.create("div",{class:"webix_dt_editor"},"<input type='text' disabled='disabled' /><button class='editor-button' style='position: absolute;margin: 1px; right:0; height:25px;'>...</button>")}};var InproduceView=function(_JetView){function InproduceView(){return _JetView.apply(this,arguments)||this}_inheritsLoose(InproduceView,_JetView);var _proto=InproduceView.prototype;return _proto.config=function(){var e=this,t=document.location.hash.split("/"),i=t[t.length-1],o=webix.storage.local.get(i+"_filter_state"),a=this;return this.api=this.app.config.apiRest,{localId:"layout",rows:[{view:"toolbar",padding:10,cols:[{view:"icon",icon:"mdi mdi-keyboard-backspace",autowidth:!0,value:!0,localId:"btn-back",click:function(){window.history.back()}},{type:"header",localId:"table-title",template:"Таблица",width:300,borderless:!0},{localId:"show-filter-date-range",hidden:!0,cols:[{localId:"filter-date-range-field",cols:[{localId:"filter-date-range-field-label",label:"",view:"label",width:20},{view:"datepicker",localId:"dateFrom",inputWidth:120,width:130,value:o?o.dateFrom:webix.Date.monthStart(new Date)},{label:"по",view:"label",width:27},{view:"datepicker",localId:"dateTo",inputWidth:120,width:120,value:o?o.dateTo:webix.Date.monthEnd(new Date)}]},{view:"icon",icon:"mdi mdi-filter",localId:"show-icon-filter-setting",width:30,css:"small",click:function(){a.showFilterSetting()}},{view:"icon",icon:"mdi mdi-sort",localId:"show-icon-sort-setting",width:30,css:"small",click:function(){a.showSortSetting()}},{view:"icon",icon:"mdi mdi-format-color-fill",localId:"show-icon-color-setting",width:30,css:"small",click:function(){a.showColorSetting()}},{view:"icon",icon:"mdi mdi-invert-colors",localId:"show-icon-color-column-setting",width:30,css:"small",click:function(){a.showColumnSetting()}}]},{localId:"show-filter",hidden:!0,cols:[{cols:[{width:25},{label:"Отбор по",view:"label",width:60,localId:"filter-field-label"},{view:"select",labelWidth:100,value:o?o.dateFrom:"",options:[],hidden:!1,localId:"filter-field"},{localId:"filter-layout",cols:[]}]}]},{view:"richselect",localId:"batch-column",value:4,labelWidth:100,options:[],width:250,hidden:!0,on:{onChange:function(e){a.selectColumnSettingForTable(e)}}},{view:"richselect",value:4,labelWidth:100,options:[],width:250,hidden:!1,localId:"select-type"},{view:"icon",icon:"mdi mdi-tools",localId:"show-icon-setting",width:30,hidden:!0,click:function(){a.showSetting()}}]},{view:"toolbar",localId:"show-toolbar",height:30,cols:[{view:"icon",icon:"mdi mdi-plus",localId:"show-add-button",tooltip:"Добавить",hidden:!0,width:30,click:function(){return e.doAddClick()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.showExportToExcelSetting()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,hidden:!1,click:function(){a.doClickOpenAll()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){a.doRefresh()}},{}]},{localId:"body-layout",cols:[{localId:"table-layout",view:"datatable"}]}]}},_proto.urlChange=function(e,t){this.getParam("mode",!0);var i=this.getParam("mode",!0);this.mode=i,t[1]&&(this.urlParams=t[1].params),this.initParam&&this.setPage(),this.initParam=!0},_proto.init=function(e){var t=this;this.initParam=!1,this.use(webix_jet__WEBPACK_IMPORTED_MODULE_0__.c.UrlParam,["mode","id","account_id"]);var i=this.getParam("mode");this.app.statusView&&(i=this.app.statusView),this.mode=i,this.state={},this.stateFilter=webix.storage.local.get(this.mode+"_filter_state"),this.state.urlTableUserLists=this.app.config.apiRest.getUrl("get","accounting/schema-table-user-lists",{"per-page":-1,sort:"sort_order"}),this.setPage(),this.attachToolBarEvents(),this.formEdit=this.ui(core_updateFormView__WEBPACK_IMPORTED_MODULE_1__.a),this.windowDirectory=this.ui(core_window_WindowDirectoryView__WEBPACK_IMPORTED_MODULE_4__.a),this.formComment=this.ui(views_comment_index__WEBPACK_IMPORTED_MODULE_2__.default),this.formView=this.ui(views_order_check_work__WEBPACK_IMPORTED_MODULE_3__.default),this.lastXHR={},webix.attachEvent("onBeforeAjax",(function(e,i,o,a,r,n,l){if(Object.keys(t.lastXHR).length>0)for(var s in t.lastXHR){var c=t.lastXHR[s];console.log(c.readyState),console.log("set abort = "),console.log(c),c.abort()}t.lastXHR[i]=a,console.log("set onBeforeAjax xhr = "),console.log(a),l.then((function(){delete t.lastXHR[i]}),(function(){delete t.lastXHR[i]}))}))},_proto.setPage=function(){this.showGoToBack(),this.model=this.capitalizeFirstLetter(this.mode),this.setSelectType(),this.schemaTableSetting=this.getSchemaTableSetting(),this.setTableSetting(),this.setFilterSetting(),this.getTable(),this.getDataTable()},_proto.getTable=function(){var e=this.$$("body-layout"),t=this,i={view:"treetable",localId:"table-layout",urlEdit:this.mode,css:"webix_header_border webix_data_border ",leftSplit:15,select:"multiselect",resizeColumn:{headerOnly:!0},multiselect:!0,clipboard:"selection",tooltip:!0,editable:!0,editaction:"dblclick",sort:"multi",drag:!1,dragColumn:!0,math:!0,save:"api->accounting/"+this.getModelName(this.mode),scheme:{},ready:function(){},on:{onAfterColumnDrop:function(){},onItemDblClick:function(e,t,i){var o=this.getItem(e);o.account_id&&(this.$scope.urlParams.account_id&&this.$scope.show("inproduce/register-account-subconto?account_id="+o.account_id+"&subconto1_value="+o.subconto1_value),0==Object.keys(this.$scope.urlParams).length&&this.$scope.show("inproduce/register-account?account_id="+o.account_id+"&schema-table-user-id=196"))},onItemClick:function(e,t,i){if("action-edit"==e.column&&this.$scope.formEdit.showForm(this),"action-view"==e.column){var o=this.$scope.table.getColumnConfig(e.column);o.goto?this.$scope.show("inproduce/"+o.goto+"/"+e.row):this.$scope.formView.showWindow({},this)}if("action-delete"==e.column){var a=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(a).save(e.row,"delete").then((function(t){webix.dp(a).ignore((function(){a.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-comment"==e.column){var r=this.getItem(e);this.$scope.formComment.showForm(this,r.A)}},onBeforeLoad:function(){},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent),r=!0;return a||(r=!1),r&&(r=t.beforeDropChangeData(o,a.value,e)),r||(t.table.addRowCss(o.id,"highlight-red"),setInterval((function(){t.table.removeRowCss(o.id,"highlight-red")}),4e3)),r},onSelectChange:function(e,t,i){}},onClick:{"editor-button":function(e,t,i,o){var a=this.getEditState();return this.$scope.windowDirectory.showWindow({},this,a),!1}}};this.table=webix.ui(i,e,this.$$("table-layout")),this.setColorSettingForTable()},_proto.getDataTable=function getDataTable(){var scope=this;this.table.define("leftSplit",this.schemaTableSetting.datatable.leftSplit.value?1*this.schemaTableSetting.datatable.leftSplit.value:0),this.table.define("rightSplit",this.schemaTableSetting.datatable.rightSplit.value?1*this.schemaTableSetting.datatable.rightSplit.value:0),this.table.define("drag",!(!this.schemaTableSetting.access||!this.schemaTableSetting.access["can-drop"]||0==this.schemaTableSetting.access["can-drop"].value)&&"order"),scope.columns=[];var params={"per-page":2e3,"schema-table-user-id":scope.selectTypeValue},paramsSort=this.getSortParams();paramsSort.length>0&&(params.sort=paramsSort),"order"==this.mode&&(params.expand="comment,images");var url=new URL(location.href.replace("/#!","")),searchParams=new URLSearchParams(url.search);if(this.urlParams||!searchParams.get("account_id")&&!searchParams.get("subconto1_value")||(this.urlParams=[],searchParams.get("account_id")&&(this.urlParams.account_id=searchParams.get("account_id")),searchParams.get("subconto1_value")&&(this.urlParams.subconto1_value=searchParams.get("subconto1_value")),searchParams.get("schema-table-user-id")&&(this.urlParams["schema-table-user-id"]=searchParams.get("schema-table-user-id"))),this.urlParams)for(var key in this.urlParams)params[key]=this.urlParams[key];scope.tableUrl=this.app.config.apiRest.getUrl("get","accounting/"+this.getModelName(this.mode),params),webix.extend(this.table,webix.ProgressBar),this.table.disable(),this.table.showProgress({type:"icon",hide:!1}),scope.filter=scope.getFilterParams(),webix.ajax().get(scope.tableUrl,scope.filter).then((function(data){scope.table.clearAll();var items=data.json(),dataItem=items.data?items.data:items.items;scope.dataItem=dataItem,items.config.columns=scope.dataDriverJsonToObject(items.config.columns),scope.table.config.columns=items.config.columns,scope.columns=items.config.columns,scope.table.refreshColumns(),scope.setColumnSettingForTable(),scope.table.parse(dataItem),scope.table.enable(),scope.table.hideProgress();var resultType="";if(scope.schemaTableSetting.group["group-by"].type)resultType=scope.schemaTableSetting.group["group-by"].type+"(obj."+scope.schemaTableSetting.group["group-by"].value+")";else{var configColumn=scope.table.getColumnConfig(scope.schemaTableSetting.group["group-by"].value);resultType="obj."+scope.schemaTableSetting.group["group-by"].value}scope.table.group({by:function by(obj){return eval(resultType)},map:{property_value:[function(obj){var per=eval(resultType),configColumn=scope.table.getColumnConfig(scope.schemaTableSetting.group["group-by"].value);return configColumn.collection?configColumn.collection.getItem(per)?configColumn.collection.getItem(per).value:scope.api.dataCollection["accounting/material-types"].getItem(per).value:eval(resultType)}],property_title:["A"],index:["","string"],I:["","string"],G:["G","sum"],value_sum:["value_sum","median"],L:["","string"],N:["","string"],O:["","string"],P:["","string"]}}),scope.table.openAll()}))},_proto.getSortParams=function(){var e="";if(this.filterDateRangeField&&(e='[{"property":"'+this.filterDateRangeField+'","direction":"ASC"}]'),this.schemaSortUserList&&this.schemaSortUserList.length>2){var t=JSON.parse(this.schemaSortUserList);for(var i in e=[],t)e.push({property:t[i].field,direction:t[i].direction});e=JSON.stringify(e)}return e},_proto.getFilterParams=function(){this.format=webix.Date.dateToStr("%Y-%m-%d"),this.dateFrom=this.$$("dateFrom"),this.dateTo=this.$$("dateTo"),this.filterField=this.$$("filter-field"),this.showFilterDateRange=this.$$("show-filter-date-range"),this.filterInput=this.$$("filter-input"),this.dateFromValue=this.format(this.dateFrom.getValue()),this.dateToValue=this.format(this.dateTo.getValue()),this.filterFieldValue=this.filterField.getValue(),this.filterInputValue=this.filterInput.getValue();var e={filter:{or:[]}},t={},i={};if(this.showFilterDateRange.isVisible()&&this.filterDateRangeField&&(i[this.filterDateRangeField]={">=":this.dateFromValue,"<=":this.dateToValue},e.filter.or=[i]),this.schemaFilterUserList&&this.schemaFilterUserList.length>2){var o=JSON.parse(this.schemaFilterUserList),a={},r={or:[]};for(var n in o)"dateFrom"==o[n].value&&(o[n].value=this.dateFromValue),"dateTo"==o[n].value&&(o[n].value=this.dateToValue),"in"==o[n].comparison&&(o[n].value=o[n].value.split(",")),"or"==o[n].operator&&(r.or.push(a),a={}),a[o[n].field]||(a[o[n].field]={}),a[o[n].field][o[n].comparison]=o[n].value;r.or.push(a),e.filter=r}return this.filterField.isVisible()&&""!=this.filterInputValue&&(t[this.filterFieldValue]={},t[this.filterFieldValue].like=this.filterInputValue,e.filter.or=[t]),this.getParam("id")&&(e.filter.and=[{list_id:this.getParam("id")}]),console.log(e),e},_proto.setTableSetting=function(){var e=this.schemaTableSetting;for(var t in e.show)null!==this.$$(t)&&"1"===e.show[t].value&&this.$$(t).show();for(var i in e.template)null!==this.$$(i)&&(this.$$(i).define({template:e.template[i].value}),this.$$(i).refresh());for(var o in e.filter)null!==this.$$(o)&&("filter-field"==o&&(this.$$(o+"-label").define({label:e.filter[o].value}),this.$$(o+"-label").refresh()),"filter-date-range-field"==o&&(this.filterDateRangeField=e.filter[o].value))},_proto.setFilterSetting=function(){var e=this;e.$$("filter-field").data.options=[],e.$$("filter-field").refresh(),this.schemaTableUserFilter.forEach((function(t,i){e.$$("filter-field").data.options.push({id:t.column_id,value:t.header}),0!=i||e.$$("filter-input")||e.$$("filter-layout").addView({view:"search-close",name:"text",value:e.stateFilter?e.stateFilter.filterInput:"",localId:"filter-input"})})),e.$$("filter-field").refresh(),e.stateFilter&&e.$$("filter-field").setValue(e.stateFilter.filterField)},_proto.getSchemaTableSetting=function(){var e=this.app.config.apiRest.getUrl("get","accounting/schema-table-setting-users",{"per-page":-1,sort:'[{"property":"type_property","direction":"ASC"},{"property":"property_title","direction":"ASC"}]'}),t=webix.ajax().sync().get(e,{filter:{model:this.model,list_id:this.selectTypeValue}}),i=JSON.parse(t.responseText),o={};return this.schemaTableSettingColumns=i.config.columns,this.schemaTableSettingItems=i.data,this.schemaTableSettingData=i,i.data.forEach((function(e){o[e.type_property]||(o[e.type_property]={}),o[e.type_property][e.property]=e})),o},_proto.setSelectType=function(){var e=this;this.selectType=this.$$("select-type");var t=webix.ajax().sync().get(this.state.urlTableUserLists,{filter:{model:this.model},expand:"schemaTableUserFilter"}),i=JSON.parse(t.responseText);if(i.errors){for(var o in i.errors)webix.message({text:o+":"+i.errors[o],type:"error",expire:-1});throw webix.alert({title:"Ошибка",ok:"Ок",text:"Обратитесь к администратору системы"}),new Error}this.dataSelectType=i;var a,r=i.data.length,n="";e.schemaTableUserFilter=[],this.getSelectTypeState()&&(a=this.getSelectTypeState(),i.data.forEach((function(t){t.id==a&&(n=t.id,e.schemaTableUserFilter=t.schemaTableUserFilter,e.schemaFilterUserList=t.filter_setting,e.schemaSortUserList=t.sort_setting,e.schemaColorUserList=t.color_setting,e.schemaColumnUserList=t.column_setting)})),""==n&&webix.storage.local.remove(this.mode+"_select_type_state")),i.data.forEach((function(t){""==n&&1==t.is_default&&(n=t.id,e.schemaTableUserFilter=t.schemaTableUserFilter,e.schemaFilterUserList=t.filter_setting,e.schemaSortUserList=t.sort_setting,e.schemaColorUserList=t.color_setting,e.schemaColumnUserList=t.column_setting)})),this.selectType.define("options",{body:{data:i.data,on:{onItemClick:function(t){var i=this.getItem(t);e.selectTypeValue=t,e.schemaTableSetting=e.getSchemaTableSetting(),e.schemaTableUserFilter=i.schemaTableUserFilter,e.schemaFilterUserList=i.filter_setting,e.schemaSortUserList=i.sort_setting,e.schemaColorUserList=i.color_setting,e.schemaColumnUserList=i.column_setting,e.setColorSettingForTable(),e.setTableSetting(),e.setFilterSetting(),e.getDataTable(),e.putSelectTypeState(t)}}}}),this.selectType.refresh(),this.selectType.setValue(n),this.selectTypeValue=n,1==r?this.selectType.hide():this.selectType.show()},_proto.attachToolBarEvents=function(){var e=this;e.dateFrom.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.dateTo.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.filterField.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.filterInput.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.table.attachEvent("onColumnResize",(function(t,i,o,a){e.eventSetColumnUserSize(t,i,o,a)})),e.table.attachEvent("onAfterColumnDrop",(function(t,i,o){e.eventSetColumnUserSort(t,i,o)}))},_proto.eventSetColumnUserSize=function(e,t,i,o){var a=this;this.app.config.apiRest.getUrl("get","accounting/schema-table-users");if(o){var r=this.table.getColumnConfig(e),n=this.app.config.apiRest.getUrl("get","accounting/schema-table-users/"+r.rowId);webix.ajax().put(n,{width:t,adjust:"",id:r.rowId},(function(e,t,i){a.showMessageResult(t.json(),i,!1)}))}},_proto.eventSetColumnUserSort=function(e,t,i){var o=this,a=this.table.getColumnConfig(e),r=this.table.getColumnConfig(t),n=this.app.config.apiRest.getUrl("get","accounting/schema-table-user/order");webix.ajax().get(n,{sort_order:a.sort_order,id:a.rowId,target_sort_order:r.sort_order,list_id:o.selectTypeValue},(function(e,t,i){o.showMessageResult(t.json(),i,!1)}))},_proto.showMessageResult=function(e,t,i){if(e.errors)for(var o in e.errors)webix.message({text:o+":"+e.errors[o],type:"error",expire:-1});200==t.status&&!e.errors&&i&&webix.message({text:"Данные cохранены",type:"info",expire:1e3}),204==t.status&&webix.message({text:"Ошибка! Данные не сохранены",type:"error",expire:-1})},_proto.showSetting=function(){var e=this;this.state={model:this.capitalizeFirstLetter(this.mode),urlTableUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-users",{"per-page":-1,sort:'[{"property":"sort_order","direction":"ASC"},{"property":"column_id","direction":"ASC"}]'}),urlTableUserLists:this.app.config.apiRest.getUrl("get","accounting/schema-table-user-lists",{"per-page":-1,sort:"sort_order"}),urlTableSettingUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-setting-users",{"per-page":-1,sort:"type-property"}),dataList:"",urlTableUsersSave:"api->accounting/schema-table-users",urlTableSettingUsersSave:"api->accounting/schema-table-setting-users",listId:"",tableSetiingConfigColumn:[],tableSettingItems:[]},this.state.dataList=this.dataSelectType.data,this.state.listId=this.selectTypeValue,this.state.listId=this.selectTypeValue;var t=webix.ajax().sync().get(this.state.urlTableUserLists,{filter:{model:this.state.model}});this.state.dataList=JSON.parse(t.responseText);var i=webix.ajax().sync().get(e.state.urlTableUsers,{filter:{model:e.state.model,list_id:e.state.listId}}),o=JSON.parse(i.responseText);this.state.tableConfigColumn=o.config.columns,this.state.tableItems=o.data?o.data:o.items,this.state.tableSetiingConfigColumn=this.schemaTableSettingColumns,this.state.tableSettingItems=this.schemaTableSettingItems,this.state.tableSetiingData=this.schemaTableSettingData,this.win={};var a={view:"window",head:{cols:[{width:4},{type:"header",template:"Настройки таблицы",borderless:!0},{view:"icon",icon:"mdi mdi-close",align:"right",click:function(){this.getTopParentView().hide()}}]},width:950,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!1,body:{localId:"body-setting-layout",css:"webix_primary",type:"space",cols:[{view:"menu",layout:"y",width:250,select:!0,localId:"menu-list",scroll:!0,onContext:{},data:this.state.dataList,ready:function(){this.select(e.state.listId),e.attachEventShowColumns()},on:{onItemClick:function(t){var i=webix.ajax().sync().get(e.state.urlTableUsers,{filter:{model:e.state.model,list_id:t}}),o=JSON.parse(i.responseText);e.state.tableConfigColumn=o.config.columns,e.state.tableItems=o.data?o.data:o.items,e.state.listId=t;var a=e.$$(this.getParentView().queryView({localId:"showColumnsTab"})),r=e.$$(this.getParentView().queryView({localId:"settingColumnsTab"})),n=e.$$(this.getParentView().queryView({localId:"tablePropertyTab"}));a.define("rows",e.getHeaderShowColumns()),a.reconstruct(),e.attachEventShowColumns(),r.define("rows",e.getHeaderSettingColumns()),r.reconstruct();var l=webix.ajax().sync().get(e.state.urlTableSettingUsers,{filter:{model:e.state.model,list_id:t}}),s=JSON.parse(l.responseText);e.state.tableSetiingData=s,e.state.tableSetiingConfigColumn=s.config.columns,e.state.tableSettingItems=s.data?s.data:s.items,n.define("rows",e.getHeaderTableProperty()),n.reconstruct()}}},{view:"resizer"},{rows:[{view:"tabbar",value:"showColumnsTab",options:[{id:"showColumnsTab",value:"Видимые колонки"},{id:"settingColumnsTab",value:"Свойства колонок"},{id:"tablePropertyTab",value:"Настройки таблицы"}],on:{onItemClick:function(t,i){e.$$(this.getParentView().queryView({localId:this.getValue()})).show()}}},{animate:!1,width:660,cells:[{localId:"showColumnsTab",type:"space",rows:this.getHeaderShowColumns()},{localId:"settingColumnsTab",type:"space",rows:this.getHeaderSettingColumns()},{localId:"tablePropertyTab",type:"space",rows:this.getHeaderTableProperty()}]}]}]}};this.win=webix.ui(a),this.contentMenu=this.ui(this.getContentMenu(),e),this.contentMenu.attachTo(this.win.queryView({localId:"menu-list"})),this.win.show()},_proto.getHeaderShowColumns=function(){var e=this,t=this;return[{view:"text",localId:"search-show-columns",placeholder:"поиск"},{cols:[{view:"dataview",localId:"dataview-show-columns",borderless:!1,select:!0,xCount:2,scroll:!0,type:{width:"auto",markCheckbox:function(e,t){return"<span class='metadata_config_check webix_icon wxi-checkbox-"+(e.hidden?"blank":"marked")+" +square-o'></span>"}},onClick:{metadata_config_check:function(e,i){var o=this.getItem(i);(o.hidden=o.hidden?0:1,this.updateItem(i,o),1==o.hidden)?t.table.hideColumn(o.column_id):-1!=t.table.getColumnIndex(o.column_id)?t.table.showColumn(o.column_id):(t.table.config.columns.splice(o.id,0,{id:o.column_id,header:o.header,adjust:"header",hidden:0}),t.table.refreshColumns())}},on:{onBeforeSelect:function(e){return!this.getItem(e).hidden}},scheme:{$init:function(e){e.hidden&&(e.$css="metadata_list_item_disabled")}},template:"{common.markCheckbox()}<div style='margin-top:5px;'>#header# (#column_id#)</div>",data:t.state.tableItems,datatype:"json",save:t.state.urlTableUsersSave}]},{type:"space",borderless:!0,cols:[{view:"button",label:"Копировать в базовые настройки",localId:"save-setting",css:"webix_primary",click:function(){return e.doSaveBaseSettingClick()}},{}]}]},_proto.attachEventShowColumns=function(){var e=this.win.queryView({localId:"search-show-columns"}),t=this.win.queryView({localId:"dataview-show-columns"});e.attachEvent("onChange",(function(e,i,o){t.filter((function(t){return-1!=t.column_id.toString().indexOf(e)})),0==t.count()&&t.filter((function(t){return-1!=t.header.toString().indexOf(e)}))}))},_proto.getHeaderSettingColumns=function(){var e=[],t=[],i=[],o=[],a=[],r=[],n=[];return this.state.tableItems.forEach((function(e){0==e.hidden&&n.push(e)})),this.state.tableConfigColumn.forEach((function(n){"header_filter_type"==n.id&&(e=n.options),"header_total_type"==n.id&&(t=n.options),"format"==n.id&&(i=n.options),"sort_type"==n.id&&(o=n.options),"editor"==n.id&&(a=n.options),"form_edit"==n.id&&(r=n.options)})),[{view:"datatable",css:"webix_header_border webix_data_border",select:"row",editable:!0,editaction:"click",tooltip:!0,leftSplit:2,borderless:!1,columns:[{id:"index",header:"#",hidden:!1,width:40,css:{"background-color":"#F4F5F9"}},{id:"header",header:"Колонка",adjust:"all",editor:"text",css:{"background-color":"#F4F5F9"},tooltip:"#column_id#"},{id:"sort_order",header:"Порядок",editor:"text",adjust:"all"},{id:"header_filter_type",header:"Тип фильтра",editor:"select",options:e,adjust:"all"},{id:"header_total_type",header:"Тип итого",editor:"select",options:t,adjust:"all"},{id:"editor",header:"Редактор",editor:"select",options:a,adjust:"all"},{id:"format",header:"Формат колонки",editor:"select",options:i,adjust:"header"},{id:"css",header:"Стиль",editor:"popup",adjust:"header"},{id:"css_format",header:"Css Формат",editor:"popup",adjust:"header"},{id:"sort_type",header:"Тип сорт.",editor:"select",options:o,adjust:"all"},{id:"width",header:"Ширина",editor:"text",adjust:"all"},{id:"adjust",header:"Рег.ширины",editor:"text",adjust:"all"},{id:"template",header:"Шаблон",editor:"popup",adjust:"header"},{id:"options",header:"Список",editor:"popup",adjust:"header"},{id:"options_url",header:"Url справочника",editor:"popup",adjust:"all"},{id:"use_filter",header:"Исп. в фильтре",editor:"text",adjust:"all"},{id:"math",header:"Math",editor:"popup",adjust:"all"},{id:"form_edit",header:"Форма редакт.",editor:"select",options:r,adjust:"all"},{id:"goto",header:"url",editor:"popup",adjust:"all"},{id:"",header:"",fillspace:!0}],data:n,datatype:"json",save:this.state.urlTableUsersSave,scheme:{$init:function(e){e.index=this.count()-1+1}}}]},_proto.getHeaderTableProperty=function(){return this.state.tableSetiingData.config.columns=this.dataDriverJsonToObject(this.state.tableSetiingData.config.columns),[{view:"treetable",css:"webix_header_border webix_data_border",select:"cell",editable:!0,editaction:"click",tooltip:!0,data:this.state.tableSetiingData,save:this.state.urlTableSettingUsersSave,scheme:{$init:function(e){e.index=this.count()-1+1},$group:{by:"type_property",map:{property_value:["type_property"],property_title:["property_title"],value:["","string"]}}},ready:function(){this.openAll()}}]},_proto.doSaveBaseSettingClick=function(){var e=this.app.config.apiRest.getUrl("get","accounting/schema-table-user-list/save-to-base-setting"),t=webix.ajax().sync().get(e,{listId:this.state.listId,model:this.state.model}),i=JSON.parse(t.responseText);this.showMessageError(i)},_proto.getContentMenu=function(){var e=this;return{view:"contextmenu",editable:!0,editor:"text",data:[{id:"add",value:"Копировать"},{id:"rename",value:"Переименовать"},{id:"is_default",value:"По умолчанию"},{id:"copy_user",value:"Для пользователя"},{$template:"Separator"},{id:"delete",value:"Удалить"}],on:{onItemClick:function(t){var i=this.getContext();i.obj,i.id;"delete"==t&&e.doDeleteMenuClick(i.id,i.obj),"add"==t&&e.doSaveSettingClick(),"rename"==t&&e.doRenameClick(i.id,i),"is_default"==t&&e.doDefaultMenuClick(i.id,i),"copy_user"==t&&e.doCopyUsertMenuClick(i.id,i)}}}},_proto.doSaveSettingClick=function(){var e=this.app.config.apiRest.getUrl("get","accounting/schema-table-user/save-setting"),t=webix.ajax().sync().get(e,{listId:this.state.listId,model:this.state.model}),i=JSON.parse(t.responseText),o=this.win.queryView({localId:"menu-list"});o.add(i.data),o.select(i.data.id),o.callEvent("onItemClick",[i.data.id])},_proto.doDeleteMenuClick=function(e,t){var i=this.app.config.apiRest.getUrl("delete","accounting/schema-table-user-lists",{},e);204==webix.ajax().sync().del(i).status?(t.remove(e),t.select(t.getFirstId()),this.state.listId=t.getFirstId()):webix.message("Ошибка! Данные не удалены!")},_proto.doDefaultMenuClick=function(e,t){var i=this.app.config.apiRest.getUrl("get","accounting/schema-table-user-list/set-default",{id:e}),o=webix.ajax().sync().get(i),a=JSON.parse(o.responseText);1==a.success?(t.obj.data.each((function(e){e.id==t.id?(e.icon="mdi mdi-flip-to-front",e.is_default=1,e.editor="text"):(e.icon="mdi mdi-flip-to-back",e.is_default=0)})),t.obj.refresh()):webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))},_proto.doRenameClick=function(e,t){var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},e);webix.prompt({text:"Изменить название",ok:"Сохранить",cancel:"Отмена",input:{required:!0,value:t.obj.getItem(e).value,placeholder:"Введите название"},width:350}).then((function(e){var o=webix.ajax().sync().put(i,{name:e}),a=JSON.parse(o.responseText);if(200==o.status){var r=t.obj.getItem(t.id);r.name=e,r.value=e,t.obj.refresh()}else webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))})).fail((function(){}))},_proto.doCopyUsertMenuClick=function(e,t){var i=this;this.app.config.apiRest.getUrl("get","accounting/users");webix.ui({view:"window",width:500,height:400,head:"Копировать настройи для пользователя",modal:!0,position:"center",close:!0,body:{type:"space",cols:[{type:"form",rows:[{view:"combo-close",localId:"combo-user",options:this.app.config.apiRest.getCollection("accounting/users",{"per-page":-1},"email"),label:"Выберите пользователя",labelWidth:180,required:!0,placeholder:"Выберите пользователя"},{cols:[{view:"button",label:"Сохранить",click:function(){var e=this.getTopParentView().queryView({localId:"combo-user"}).getValue(),o=i.app.config.apiRest.getUrl("get","accounting/schema-table-user/save-setting-for-user"),a=webix.ajax().sync().get(o,{listId:t.id,model:i.state.model,userId:e}),r=JSON.parse(a.responseText);this.getTopParentView().hide(),i.showMessageError(r)}},{},{}]}]}]}}).show()},_proto.putFilterState=function(){webix.storage.local.put(this.mode+"_filter_state",{dateFrom:this.dateFrom.getValue(),dateTo:this.dateTo.getValue(),filterField:this.filterField.getValue(),filterInput:this.filterInput.getValue()})},_proto.getSelectTypeState=function(){var e=webix.storage.local.get(this.mode+"_select_type_state");return!!e&&e.selectType},_proto.putSelectTypeState=function(e){webix.storage.local.put(this.mode+"_select_type_state",{selectType:e})},_proto.showMessageError=function(e){if(e.errors)for(var t in e.errors)webix.message({text:t+":"+e.errors[t],type:"error",expire:-1});e.success&&webix.message({text:"Данные успешно сохранены!",type:"info",expire:2e3})},_proto.doRefresh=function(){this.getDataTable()},_proto.getModelName=function(e){var t=e[e.length-1],i=e.split("-");return i=i[i.length-1],"y"==t&&i.length>3?e.replace(/y$/,"ies"):"s"==t&&i.length>3?e.replace(/s$/,"ses"):e+"s"},_proto.doClickOpenAll=function(){var e=this.table;e.getOpenItems().length>0?e.closeAll():e.openAll()},_proto.capitalizeFirstLetter=function(e){var t=e.split("-"),i=[];return t.forEach((function(e){i.push(e.charAt(0).toUpperCase()+e.slice(1))})),i.join("")},_proto.dataDriverJsonToObject=function dataDriverJsonToObject(configColumns){return configColumns.forEach((function(item,key){var myObj={func:{}};item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("webix")&&(eval(" myObj.func = (obj) => { return "+item.format+"(obj); }"),configColumns[key].numberFormat="1111.00"),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatMonthYear")&&(eval(" myObj.func = (obj) => { return "+item.format+"(obj); }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateTime")&&(eval(" myObj.func = (obj) => { try {formatDateTime(obj)} catch (e) { debugger; obj = obj.trim(); } return  (obj!='' && obj!=null) ? formatDateTime(obj) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateShort")&&(eval(" myObj.func = (obj) => { try {formatDateShort(obj)} catch (e) { debugger; obj = obj.trim();} return  (obj!='' && obj!=null) ? formatDateShort(obj) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDate")&&(eval(" myObj.func = (obj) => { try {formatDate(obj)} catch (e) { debugger; } return  (obj!='' && obj!=null) ? formatDate(obj) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateHour")&&(eval(" myObj.func = (obj) => { try {formatDateHour(obj)} catch (e) { debugger; } return  (obj!='' && obj!=null) ? formatDateHour(obj) : ''; }"),configColumns[key].format=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("(obj,common,value)")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("custom_checkbox")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("columnGroupTemplate")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func)})),configColumns},_proto.doAddClick=function(){this.table.unselect(),this.formEdit.showForm(this.table)},_proto.beforeDropChangeData=function(e,t,i){var o=this.table,a=this.schemaTableSetting.group["group-by"].value;o.getSelectedId(!0);return i.source.forEach((function(e){o.getItem(e)[a]=formatDateTimeDb(parserDateTimeGroup(t)),o.refresh(e),o.updateItem(e,o.getItem(e))})),!0},_proto.showExportToExcelSetting=function(){var e={view:"window",head:"Настройки экспорта в Excel",width:950,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-print-layout",css:"webix_primary",type:"space",cols:[{view:"menu",layout:"y",width:250,select:!0,localId:"menu-list-print",onContext:{},url:this.app.config.apiRest.getUrl("get","accounting/schema-print-user-lists",{"per-page":-1,filter:'{"list_id":"'+this.selectTypeValue+'"}'}),hidden:!0,on:{onAfterLoad:function(){this.data.count()>0&&this.show(),this.select(this.data.getFirstId()),this.callEvent("onItemClick",[this.data.getFirstId()])},onItemClick:function(e){var t=this.getTopParentView().queryView({localId:"print-column-select"});JSON.parse(this.getItem(e).setting).forEach((function(e){t.data.each((function(t){t.id==e.id&&(t.hidden=e.hidden)}))})),t.refresh()}}},{type:"form",rows:[{header:"Показывать",rows:this.getHeaderPrintColumns()}]}]}};this.winPrint=webix.ui(e),this.contentMenuPrint=this.ui(this.getContentMenuPrint(),this),this.contentMenuPrint.attachTo(this.winPrint.queryView({localId:"menu-list-print"})),this.winPrint.show()},_proto.getHeaderPrintColumns=function(){var e=this;return[{view:"dataview",localId:"print-column-select",select:!0,type:{width:250,markCheckbox:function(e,t){return"<span class='metadata_config_check webix_icon wxi-checkbox-"+(e.hidden?"blank":"marked")+" +square-o'></span>"}},onClick:{metadata_config_check:function(e,t){var i=this.getItem(t);i.hidden=i.hidden?0:1,this.updateItem(t,i)}},on:{onBeforeSelect:function(e){return!this.getItem(e).hidden}},scheme:{$init:function(e){e.hidden&&(e.$css="metadata_list_item_disabled")}},template:function(e,t){return t.markCheckbox(e,t)+"<div style='margin-top:5px;'>"+e.header[0].text+"</div>"},data:e.table.config.columns,datatype:"json"},{cols:[{},{},{view:"button",label:"Сохранить настройки",localId:"save-setting",css:"webix_primary",click:function(){var t=this.getTopParentView().queryView({localId:"print-column-select"}).data.serialize();e.doSavePrintSettingClick(t)}},{view:"button",label:"Печать",localId:"print-button",css:"webix_primary",click:function(){var t=this.getTopParentView().queryView({localId:"print-column-select"}).data.serialize();e.doClickToExcel(t),this.getTopParentView().close()}}]}]},_proto.doSavePrintSettingClick=function(e){var t=this,i=this.app.config.apiRest.getUrl("get","accounting/schema-print-user-lists"),o=[];e.forEach((function(e){o.push({id:e.id,hidden:e.hidden?e.hidden:0})})),webix.ajax().post(i,{model:this.model,setting:JSON.stringify(o),name:"Печать",list_id:this.selectTypeValue},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})},_proto.doClickToExcel=function(e){var t=this.table,i="";this.filter.filter.or.forEach((function(e){for(var t in e)if(i=i+"_"+t,"object"==typeof e[t])for(var o in e[t])i=i+"_"+e[t][o];else i=i+"_"+e[t]}));var o=[];e.forEach((function(e){e.hidden||o.push(e)})),webix.toExcel(t,{filename:this.mode+i,styles:!1,ignore:{"action-edit":!0},columns:o})},_proto.getContentMenuPrint=function(){var e=this;return{view:"contextmenu",localId:"cmenu-print",editable:!0,editor:"text",data:[{id:"rename",value:"Переименовать"},{id:"is_default",value:"По умолчанию"},{$template:"Separator"},{id:"delete",value:"Удалить"}],on:{onItemClick:function(t){var i=this.getContext();i.obj,i.id;"delete"==t&&e.doDeleteMenuPrintClick(i.id,i.obj),"rename"==t&&e.doRenamePrintClick(i.id,i),"is_default"==t&&e.doDefaultMenuPrintClick(i.id,i)}}}},_proto.doDeleteMenuPrintClick=function(e,t){var i=this.app.config.apiRest.getUrl("delete","accounting/schema-print-user-lists",{},e);204==webix.ajax().sync().del(i).status?(t.remove(e),t.select(t.getFirstId()),t.callEvent("onItemClick",[t.getFirstId()])):webix.message("Ошибка! Данные не удалены!")},_proto.doRenamePrintClick=function(e,t){var i=this.app.config.apiRest.getUrl("put","accounting/schema-print-user-lists",{},e);webix.prompt({text:"Изменить название",ok:"Сохранить",cancel:"Отмена",input:{required:!0,value:t.obj.getItem(e).value,placeholder:"Введите название"},width:350}).then((function(e){var o=webix.ajax().sync().put(i,{name:e}),a=JSON.parse(o.responseText);if(200==o.status){var r=t.obj.getItem(t.id);r.name=e,r.value=e,t.obj.refresh()}else webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))})).fail((function(){}))},_proto.doDefaultMenuPrintClick=function(e,t){var i=this.app.config.apiRest.getUrl("get","accounting/schema-print-user-list/set-default",{id:e}),o=webix.ajax().sync().get(i),a=JSON.parse(o.responseText);1==a.success?(t.obj.data.each((function(e){e.id==t.id?(e.icon="mdi mdi-flip-to-front",e.is_default=1,e.editor="text"):(e.icon="mdi mdi-flip-to-back",e.is_default=0)})),t.obj.refresh()):webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))},_proto.showFilterSetting=function(){var e={view:"window",head:"Настройки фильтра",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-filter-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderFilterSetting()}]}]}};this.winFilter=webix.ui(e),this.setElementFilterForm(),this.winFilter.show()},_proto.setElementFilterForm=function(){if(this.schemaFilterUserList&&this.schemaFilterUserList.length>2){var e=JSON.parse(this.schemaFilterUserList),t=this.winFilter.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementFilterForm(i));this.winFilter.queryView("form").setValues(e)}},_proto.getElementFilterForm=function(e){var t=this;return{localId:"element-filter-"+e,rows:[{cols:[{view:"combo",name:e+".operator",labelWidth:150,labelPosition:"top",label:"Оператор",value:"",disabled:0==e,options:["","and","or"]},{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"date_shipment",options:this.table.config.columns},{view:"combo",name:e+".comparison",labelWidth:150,labelPosition:"top",label:"Тип сравнения",value:"=",options:["=",">=","<=","in","!="]},{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Значение",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementFilterForm("element-filter-"+e)}}]},{height:20}]}},_proto.deleteElementFilterForm=function(e){var t=this.winFilter.queryView({localId:"form-row-layout"}),i=this.winFilter.queryView({localId:e});t.removeView(i)},_proto.getHeaderFilterSetting=function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-filter-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementFilterForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-setting",css:"webix_primary",click:function(){e.doSaveFilterSettingClick(this.getTopParentView().queryView("form").getValues()),e.winFilter.close()}}]}]}]},_proto.doSaveFilterSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaFilterUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{filter_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},_proto.showSortSetting=function(){var e={view:"window",head:"Настройки сортировки",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-sort-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderSortSetting()}]}]}};this.winSort=webix.ui(e),this.setElementSortForm(),this.winSort.show()},_proto.setElementSortForm=function(){if(this.schemaSortUserList&&this.schemaSortUserList.length>2){var e=JSON.parse(this.schemaSortUserList),t=this.winSort.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementSortForm(i));this.winSort.queryView("form").setValues(e)}},_proto.getElementSortForm=function(e){var t=this;return{localId:"element-sort-"+e,rows:[{cols:[{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"date_shipment",options:this.table.config.columns},{view:"combo",name:e+".direction",labelWidth:150,labelPosition:"top",label:"Тип сортировки",value:"ASC",options:[{id:"ASC",value:"по возрастанию"},{id:"DESC",value:"по убыванию"}]},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementSortForm("element-sort-"+e)}}]},{height:20}]}},_proto.deleteElementSortForm=function(e){var t=this.winSort.queryView({localId:"form-row-layout"}),i=this.winSort.queryView({localId:e});t.removeView(i)},_proto.getHeaderSortSetting=function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-sort-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementSortForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-setting",css:"webix_primary",click:function(){e.doSaveSortSettingClick(this.getTopParentView().queryView("form").getValues()),e.winSort.close()}}]}]}]},_proto.doSaveSortSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaSortUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{sort_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},_proto.setColorSettingForTable=function setColorSettingForTable(){var colorSetting=JSON.parse(this.schemaColorUserList),condition=[],obj={func:function(){}},index=-1;for(var key in colorSetting){var item=colorSetting[key];""!=item.operator.trim()||(index++,condition[index]=[]),condition[index].push(item)}var conditionFunction="function(item, view, prop) { item.index = (this.count())+1; ";condition.forEach((function(e){if(e.length>1){var t="(",i={};e.forEach((function(e){var o="="==e.comparison?"==":e.comparison,a=-1!=e.value.indexOf("{")?e.value.replace("{","").replace("}",""):"'"+e.value+"'",r="";"and"==e.operator&&(r="&&"),"or"==e.operator&&(r="||"),t+=r+" item."+e.field+" "+o+" "+a+" ",i=e})),t+=")";var o='{"background-color":"'+i.color+'"}';conditionFunction+="if "+t+" { item.$css = "+o+"; } "}if(1==e.length){var a=e[0],r='{"background-color":"'+a.color+'"}',n="="==a.comparison?"==":a.comparison,l=-1!=a.value.indexOf("{")?a.value.replace("{","").replace("}",""):"'"+a.value+"'";conditionFunction+="if (item."+a.field+" "+n+" "+l+") { item.$css = "+r+"; } "}})),conditionFunction+="}",console.log(conditionFunction),eval(" obj.func = "+conditionFunction),this.table.define("scheme",{$init:obj.func})},_proto.showColorSetting=function(){var e={view:"window",head:"Настройки цветов",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-color-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderColorSetting()}]}]}};this.winColor=webix.ui(e),this.setElementColorForm(),this.winColor.show()},_proto.setElementColorForm=function(){if(this.schemaColorUserList&&this.schemaColorUserList.length>2){var e=JSON.parse(this.schemaColorUserList),t=this.winColor.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementColorForm(i));this.winColor.queryView("form").setValues(e)}},_proto.getElementColorForm=function(e){var t=this;return{localId:"element-color-"+e,rows:[{cols:[{view:"combo",name:e+".operator",labelWidth:150,labelPosition:"top",label:"Оператор",value:"",disabled:0==e,options:[" ","and","or"]},{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"",options:this.table.config.columns},{view:"combo",name:e+".comparison",labelWidth:150,labelPosition:"top",label:"Тип сравнения",value:"==",options:["==",">=","<=","!="]},{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Значение",value:""},{view:"colorpicker",name:e+".color",labelWidth:150,labelPosition:"top",label:"Цвет",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementColorForm("element-color-"+e)}}]},{height:20}]}},_proto.deleteElementColorForm=function(e){var t=this.winColor.queryView({localId:"form-row-layout"}),i=this.winColor.queryView({localId:e});t.removeView(i)},_proto.getHeaderColorSetting=function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-color-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementColorForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-color-setting",css:"webix_primary",click:function(){e.doSaveColorSettingClick(this.getTopParentView().queryView("form").getValues()),e.winColor.close()}}]}]}]},_proto.doSaveColorSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaColorUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{color_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},_proto.setColumnSettingForTable=function(){var e,t=this.$$("batch-column"),i=[],o="0",a=0;for(var r in this.schemaColumnUserListObject=JSON.parse(this.schemaColumnUserList),e=this.schemaColumnUserListObject){1==++a&&(o=this.selectColumnSettingId?this.selectColumnSettingId:r);var n=e[r];i.push({id:r,value:n.value})}t.define("options",{body:{data:i}}),t.setValue(o),this.selectColumnSettingForTable(o),0==a||1==a?t.hide():t.show(),t.refresh()},_proto.selectColumnSettingForTable=function(e){var t=this;t.selectColumnSettingId=e;var i=this.schemaColumnUserListObject,o={},a={};for(var r in i){o=i[r].category;var n=function(i){console.log(i);var n=o[i];if(r==e)a[n.field]=n,t.table.getColumnConfig(n.field).cssFormat=function(e,t){return n};else{var l=t.table.getColumnConfig(n.field);l&&(l.cssFormat="")}};for(var l in o)n(l)}var s=function(e){t.table.getColumnConfig(e)&&(t.table.getColumnConfig(e).cssFormat=function(t,i){return a[e]})};for(var c in a)s(c);t.table.refreshColumns()},_proto.showColumnSetting=function(){var e=this,t={view:"window",head:"Настройки  столбцов",width:800,height:600,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-color-column-layout",type:"space",cols:[{rows:[{rows:this.getHeaderColumnSetting()},{padding:10,cols:[{},{},{view:"button",label:"Сохранить",localId:"save-column-setting",css:"webix_primary",click:function(){e.doSaveColumnSettingClick(this.getTopParentView().queryView("form").getValues()),e.winColumn.close()}}]}]}]}};this.winColumn=webix.ui(t),this.setCategoryColumnForm(),this.winColumn.show()},_proto.setCategoryColumnForm=function(){if(this.schemaColumnUserList&&this.schemaColumnUserList.length>2){var e=JSON.parse(this.schemaColumnUserList),t=this.winColumn.queryView({localId:"form-row-layout"});for(var i in e)for(var o in t.addView(this.getCategoryColumnForm(i)),e[i].category){t.queryView({localId:"form-subrow-layout"+i}).addView(this.getElementColumnForm(i,o))}this.winColumn.queryView("form").setValues(e)}},_proto.getCategoryColumnForm=function(e){var t=this;return{localId:"category-column-"+e,rows:[{type:"form",rows:[{cols:[{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Название расцветки",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteCategoryColumnForm("category-column-"+e,e)}}]},{localId:"form-subrow-layout"+e,rows:[]},{cols:[{view:"button",label:"+",localId:"add-column-category",css:"webix_primary",width:40,click:function(){var i=this.getTopParentView().queryView({localId:"form-subrow-layout"+e}),o="0";i.getChildViews().length>0&&(o=t.getLasElementId(this,e)),i.addView(t.getElementColumnForm(e,o))}},{},{}]}]},{height:10}]}},_proto.getLasElementId=function(e,t){var i=e.getTopParentView().queryView("form").getValues()[t];return(1*Object.keys(i.category)[Object.keys(i.category).length-1]+1).toString()},_proto.getLasCategoryId=function(e){var t=e.getTopParentView().queryView("form").getValues();return(1*Object.keys(t)[Object.keys(t).length-1]+1).toString()},_proto.getElementColumnForm=function(e,t){var i=this;return{localId:"element-column-"+e+"-"+t,rows:[{cols:[{view:"combo",name:e+".category."+t+".field",labelWidth:150,labelPosition:"top",label:"Выберите колонку",value:"",options:this.table.config.columns},{view:"combo",name:e+".category."+t+".font-weight",labelWidth:150,labelPosition:"top",label:"Стиль текста",value:"normal",options:[{id:"normal",value:"нормальный"},{id:"500",value:"полужирный"},{id:"700",value:"жирный"}]},{view:"combo",name:e+".category."+t+".text-align",labelWidth:150,labelPosition:"top",label:"Выравнять текст",value:"left",options:[{id:"left",value:"по левому краю"},{id:"center",value:"по середине"},{id:"right",value:"по правому краю"}]},{view:"colorpicker",name:e+".category."+t+".color",labelWidth:150,labelPosition:"top",label:"Цвет текста",value:""},{view:"colorpicker",name:e+".category."+t+".background-color",labelWidth:150,labelPosition:"top",label:"Цвет фона",value:""},{view:"icon",icon:"mdi mdi-close",css:"small",labelPosition:"top",click:function(){i.deleteElementColumnForm("element-column-"+e+"-"+t,e,t)}}]},{height:20}]}},_proto.deleteCategoryColumnForm=function(e,t){var i=this.winColumn.queryView({localId:"form-row-layout"}),o=this.winColumn.queryView({localId:e});t==this.selectColumnSettingId&&(this.selectColumnSettingId=null);var a=JSON.parse(this.schemaColumnUserList),r=a[t]?a[t].category:{};for(var n in r)this.table.getColumnConfig(r[n].field).cssFormat="";this.table.refreshColumns(),i.removeView(o)},_proto.deleteElementColumnForm=function(e,t,i){var o=this.winColumn.queryView({localId:"form-subrow-layout"+t}),a=this.winColumn.queryView({localId:e}),r=JSON.parse(this.schemaColumnUserList);if(r[t]){var n=r[t].category[i];this.table.getColumnConfig(n.field).cssFormat="",this.table.refreshColumns()}o.removeView(a)},_proto.getHeaderColumnSetting=function(){var e=this;return[{view:"form",borderless:!0,complexData:!0,localId:"form-column",scroll:"y",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-column-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i="0";t.getChildViews().length>0&&(i=e.getLasCategoryId(this)),t.addView(e.getCategoryColumnForm(i))}}]},{}]}]},_proto.doSaveColumnSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaColumnUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{column_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,i,o){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3}),t.setColumnSettingForTable()}})}},_proto.showGoToBack=function(){this.getParam("id")?this.$$("btn-back").show():this.$$("btn-back").hide()},InproduceView}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){var e=this;return{view:"window",position:"center",head:{type:"header",template:"Login",css:"webix_dark"},body:{view:"form",localId:"form",width:400,rows:[{view:"text",name:"login",label:"User Name",labelPosition:"top"},{view:"text",type:"password",name:"pass",label:"Password",labelPosition:"top"},{view:"button",value:"Login",click:function(){return e.Login()},hotkey:"enter"}],rules:{login:webix.rules.isNotEmpty,pass:webix.rules.isNotEmpty}}}},a.init=function(e){this.getRoot().show()},a.Login=function(){var e=this.app.getService("user"),t=this.getRoot().queryView({view:"form"});this.app;if(t.validate()){var i=t.getValues();e.login(i.login,i.pass).catch((function(){webix.html.removeCss(t.$view,"invalid_login"),t.elements.pass.focus(),webix.delay((function(){webix.html.addCss(t.$view,"invalid_login")}))}))}},o}(i(0).b)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return InproduceView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),views_comment_index__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9),views_order_check_work__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8),core_window_WindowDirectoryView__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(17),components_tableDynamic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(93),core_formView__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(37),components_comboClose__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_9__);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function formatPercent(e){return 100*e}webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)1==t[o].$level&&(isNaN(e(t[o]))||(i+=1*e(t[o])));return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0})},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:".",decimalSize:2}),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCountEmpty=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.toolsContent=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.mathColumn=webix.extend({refresh:function refresh(master,node,value){var result=0,result2=0,_val=0,_val2=0,res=0,resultFormula="res = 0;";this.sumRes={};var scope=this;master.data.each((function(e){if(!e.$group&&e["$"+value.columnId]){var t=e["$"+value.columnId].match(/[^\[.\]$']+/g);resultFormula="res";var i={};t.forEach((function(t){var o=t.replace("r,","");e[o]&&(scope.sumRes[o]||(scope.sumRes[o]=0),i[o]||(i[o]=!0,scope.sumRes[o]+=1*e[o]),o="this.sumRes['"+o+"']"),resultFormula+=o}))}})),"res = 0;"!=resultFormula&&eval(resultFormula),result=value.format(res),node.innerHTML=result}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:350,height:200}}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var formatDate=webix.Date.dateToStr("%d.%m.%y"),formatDateHour=webix.Date.dateToStr("%d.%m.%y %H:00"),formatDateShort=webix.Date.dateToStr("%d.%m"),formatDateTimeDb=webix.Date.dateToStr("%Y-%m-%d %H:%i"),formatMonthYear=webix.Date.dateToStr("%M %y"),formatDateTime=webix.Date.dateToStr("%d.%m.%y %H:%i"),parserDate=webix.Date.strToDate("%Y-%m-%d"),parserDateTime=webix.Date.strToDate("%Y-%m-%d %H:%i"),parserDateTimeGroup=webix.Date.strToDate("%d.%m.%y %H:%i");function custom_checkbox(e,t,i){return i?"<div class='webix_table_checkbox checked'> YES </div>":"<div class='webix_table_checkbox notchecked'> NO </div>"}function columnGroupTemplate(e,t,i){return e.$group?t.treetable(e,t)+e.property_value:t.icon(e)+t.folder(e,t)+" "+i}webix.editors.buttonEditor={focus:function(){this.getInputNode(this.node).focus(),this.getInputNode(this.node).select()},getValue:function(){return this.getInputNode(this.node).refValue},setValue:function(e,t){var i="",o=this.config.collection.getItem(e);o&&(i=o.value),this.getInputNode(this.node).value=i,this.getInputNode(this.node).refValue=e},getInputNode:function(){return this.node.firstChild},render:function(){return webix.html.create("div",{class:"webix_dt_editor"},"<input type='text' disabled='disabled' /><button class='editor-button' style='position: absolute;margin: 1px; right:0; height:25px;'>...</button>")}};var InproduceView=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var i=t.prototype;return i.config=function(){var e=document.location.hash.split("/"),t=e[e.length-1];webix.storage.local.get(t+"_filter_state");return this.api=this.app.config.apiRest,{localId:"layout"}},i.urlChange=function(e,t){this.getParam("mode",!0);var i=this.getParam("mode",!0);this.mode=i,t[1]&&(this.urlParams=t[1].params),this.initParam&&this.setPage(),this.initParam=!0},i.init=function(e){var t=this;this.initParam=!1,this.use(webix_jet__WEBPACK_IMPORTED_MODULE_0__.c.UrlParam,["mode","id","account_id"]);var i=this.getParam("mode");this.app.statusView&&(i=this.app.statusView),this.mode=i,this.formEdit=this.ui(core_updateFormView__WEBPACK_IMPORTED_MODULE_1__.a),this.formComment=this.ui(views_comment_index__WEBPACK_IMPORTED_MODULE_2__.default),this.formView=this.ui(views_order_check_work__WEBPACK_IMPORTED_MODULE_3__.default),this.windowDirectory=this.ui(core_window_WindowDirectoryView__WEBPACK_IMPORTED_MODULE_4__.a);var o={view:"table-dynamic",state:{scope:t,params:{mode:i,id:this.getParam("id"),account_id:this.getParam("account_id")},apiRest:this.app.config.apiRest,urlTableUserLists:this.app.config.apiRest.getUrl("get","accounting/schema-table-user-lists",{"per-page":-1,sort:"sort_order"}),urlTableSettingUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-setting-users",{"per-page":-1,sort:'[{"property":"type_property","direction":"ASC"},{"property":"property_title","direction":"ASC"}]'}),urlTableUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-users",{"per-page":-1,sort:'[{"property":"sort_order","direction":"ASC"},{"property":"column_id","direction":"ASC"}]'}),urlTableUsersSave:"api->accounting/schema-table-users",urlTableSettingUsersSave:"api->accounting/schema-table-setting-users",urlTableUserListsPut:"accounting/schema-table-user-lists",formEdit:this.formEdit,formView:this.formView,formComment:this.formComment,windowDirectory:this.windowDirectory,cachePrefix:""},stateCache:webix.storage.local.get(this.mode+"_filter_state")};this.table=webix.ui(o,this.$$("layout")),this.lastXHR={},webix.attachEvent("onBeforeAjax",(function(e,i,o,a,r,n,l){if(Object.keys(t.lastXHR).length>0)for(var s in t.lastXHR){var c=t.lastXHR[s];console.log(c.readyState),console.log("set abort = "),console.log(c),c.abort()}t.lastXHR[i]=a,console.log("set onBeforeAjax xhr = "),console.log(a),l.then((function(){delete t.lastXHR[i]}),(function(){delete t.lastXHR[i]}))}))},i.setPage=function(){this.table.state.params={mode:this.mode,id:this.getParam("id"),account_id:this.getParam("account_id")},this.table.state.stateCache=webix.storage.local.get(this.mode+"_filter_state"),this.table.setPage()},t}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return InproduceView}));var webix_jet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),core_updateFormView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),views_comment_index__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9),views_order_check_work__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8),core_formView__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(37),components_comboClose__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2),components_comboDateClose__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(4),components_searchClose__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(3),components_searchClose__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(components_searchClose__WEBPACK_IMPORTED_MODULE_7__);function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function formatPercent(e){return 100*e}webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)1==t[o].$level&&(isNaN(e(t[o]))||(i+=1*e(t[o])));return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCountEmpty=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.toolsContent=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.ui.datafilter.mathColumn=webix.extend({refresh:function refresh(master,node,value){var result=0,result2=0,_val=0,_val2=0,res=0,resultFormula="res = 0;";this.sumRes={};var scope=this;master.data.each((function(e){if(!e.$group&&e["$"+value.columnId]){var t=e["$"+value.columnId].match(/[^\[.\]$']+/g);resultFormula="res";var i={};t.forEach((function(t){var o=t.replace("r,","");e[o]&&(scope.sumRes[o]||(scope.sumRes[o]=0),i[o]||(i[o]=!0,scope.sumRes[o]+=1*e[o]),o="this.sumRes['"+o+"']"),resultFormula+=o}))}})),"res = 0;"!=resultFormula&&eval(resultFormula),result=value.format(res),node.innerHTML=result}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:350,height:200}}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var formatDate=webix.Date.dateToStr("%d.%m.%y"),formatDateHour=webix.Date.dateToStr("%d.%m.%y %H:00"),formatDateShort=webix.Date.dateToStr("%d.%m"),formatDateTimeDb=webix.Date.dateToStr("%Y-%m-%d %H:%i"),formatMonthYear=webix.Date.dateToStr("%M %y"),formatDateTime=webix.Date.dateToStr("%d.%m.%y %H:%i"),parserDate=webix.Date.strToDate("%Y-%m-%d"),parserDateTime=webix.Date.strToDate("%Y-%m-%d %H:%i"),parserDateTimeGroup=webix.Date.strToDate("%d.%m.%y %H:%i");function custom_checkbox(e,t,i){return i?"<div class='webix_table_checkbox checked'> YES </div>":"<div class='webix_table_checkbox notchecked'> NO </div>"}function columnGroupTemplate(e,t,i){return e.$group?t.treetable(e,t)+e.property_value:i}var InproduceView=function(_JetView){function InproduceView(){return _JetView.apply(this,arguments)||this}_inheritsLoose(InproduceView,_JetView);var _proto=InproduceView.prototype;return _proto.config=function(){var e=this,t=document.location.hash.split("/"),i=t[t.length-1],o=webix.storage.local.get(i+"_filter_state"),a=this;return this.api=this.app.config.apiRest,{localId:"layout",rows:[{view:"toolbar",padding:10,cols:[{type:"header",localId:"table-title",template:"Таблица",width:300,borderless:!0},{localId:"show-filter-date-range",hidden:!0,cols:[{localId:"filter-date-range-field",cols:[{localId:"filter-date-range-field-label",label:"",view:"label",width:20},{view:"datepicker",localId:"dateFrom",inputWidth:120,width:130,value:o?o.dateFrom:webix.Date.monthStart(new Date)},{label:"по",view:"label",width:27},{view:"datepicker",localId:"dateTo",inputWidth:120,width:120,value:o?o.dateTo:webix.Date.monthEnd(new Date)}]},{view:"icon",icon:"mdi mdi-filter",localId:"show-icon-filter-setting",width:30,css:"small",click:function(){a.showFilterSetting()}},{view:"icon",icon:"mdi mdi-sort",localId:"show-icon-sort-setting",width:30,css:"small",click:function(){a.showSortSetting()}},{view:"icon",icon:"mdi mdi-format-color-fill",localId:"show-icon-color-setting",width:30,css:"small",click:function(){a.showColorSetting()}},{view:"icon",icon:"mdi mdi-invert-colors",localId:"show-icon-color-column-setting",width:30,css:"small",click:function(){a.showColumnSetting()}}]},{localId:"show-filter",hidden:!0,cols:[{cols:[{width:25},{label:"Отбор по",view:"label",width:60,localId:"filter-field-label"},{view:"select",labelWidth:100,value:o?o.dateFrom:"",options:[],hidden:!1,localId:"filter-field"},{localId:"filter-layout",cols:[]}]}]},{view:"richselect",localId:"batch-column",value:4,labelWidth:100,options:[],width:250,hidden:!0,on:{onChange:function(e){a.selectColumnSettingForTable(e)}}},{view:"richselect",value:4,labelWidth:100,options:[],width:250,hidden:!1,localId:"select-type"},{view:"icon",icon:"mdi mdi-tools",localId:"show-icon-setting",width:30,hidden:!0,click:function(){a.showSetting()}}]},{view:"toolbar",localId:"show-toolbar",height:30,cols:[{view:"icon",icon:"mdi mdi-plus",localId:"show-add-button",tooltip:"Добавить",hidden:!0,width:30,click:function(){return e.doAddClick()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.showExportToExcelSetting()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,hidden:!1,click:function(){a.doClickOpenAll()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){a.doRefresh()}},{}]},{localId:"body-layout",cols:[{localId:"table-layout",view:"datatable"}]}]}},_proto.urlChange=function(e,t,i){this.getParam("mode",!0);var o=this.getParam("mode",!0);this.mode=o,this.initParam&&this.setPage(),this.initParam=!0},_proto.init=function(e){this.initParam=!1,this.use(webix_jet__WEBPACK_IMPORTED_MODULE_0__.c.UrlParam,["mode","id"]);var t=this.getParam("mode");this.app.statusView&&(t=this.app.statusView),this.mode=t,this.state={},this.stateFilter=webix.storage.local.get(this.mode+"_filter_state"),this.state.urlTableUserLists=this.app.config.apiRest.getUrl("get","accounting/schema-table-user-lists",{"per-page":-1,sort:"sort_order"}),this.setPage(),this.formEdit=this.ui(core_updateFormView__WEBPACK_IMPORTED_MODULE_1__.a),this.formComment=this.ui(views_comment_index__WEBPACK_IMPORTED_MODULE_2__.default),this.formView=this.ui(views_order_check_work__WEBPACK_IMPORTED_MODULE_3__.default)},_proto.setPage=function(){this.model=this.capitalizeFirstLetter(this.mode),this.setSelectType(),this.schemaTableSetting=this.getSchemaTableSetting(),this.setTableSetting(),this.setFilterSetting(),this.getTable(),this.getDataTable()},_proto.getTable=function(){var e=this.mode;"company-room"==this.mode&&(e="company/87tYxy9nkl6Nfwk035E0/rooms"),"department"==this.mode&&(e="company/87tYxy9nkl6Nfwk035E0/departments");var t=this.$$("body-layout"),i=this,o={view:"treetable",localId:"table-layout",urlEdit:this.mode,css:"webix_header_border webix_data_border ",select:"multiselect",resizeColumn:{headerOnly:!0},multiselect:!0,clipboard:"selection",tooltip:!0,editable:!0,editaction:"dblclick",sort:"multi",drag:!1,dragColumn:!0,math:!0,save:"firestore->"+e,scheme:{},ready:function(){},on:{onAfterColumnDrop:function(){},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-edit"==e.column&&this.$scope.formEdit.showForm(this),"action-view"==e.column){var a=this.$scope.table.getColumnConfig(e.column);a.goto?this.$scope.show("inproduce/"+a.goto+"/"+e.row):this.$scope.formView.showWindow({},this)}if("action-delete"==e.column){o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-comment"==e.column){var r=this.getItem(e);this.$scope.formComment.showForm(this,r.A)}},onBeforeLoad:function(){},onBeforeDrop:function(e,t){var o=this.getItem(e.start),a=this.getItem(e.parent),r=!0;return a||(r=!1),r&&(r=i.beforeDropChangeData(o,a.value,e)),r||(i.table.addRowCss(o.id,"highlight-red"),setInterval((function(){i.table.removeRowCss(o.id,"highlight-red")}),4e3)),r},onSelectChange:function(e,t,i){}}};this.table=webix.ui(o,t,this.$$("table-layout"))},_proto.getDataTable=function(){var e=this;e.columns=[];var t={"per-page":2e3,"schema-table-user-id":e.selectTypeValue},i=this.getSortParams();i.length>0&&(t.sort=i),"order"==this.mode&&(t.expand="comment,images"),e.tableUrl=this.app.config.apiRest.getUrl("get","accounting/"+this.getModelName(this.mode),t),webix.extend(this.table,webix.ProgressBar),this.table.disable(),this.table.showProgress({type:"icon",hide:!1}),webix.firebase.ref("configTableUser/"+this.mode+"/config/columns").get().then((function(t){e.table.clearAll();var i={config:{}};i.config.columns=t.val(),null!=i.config.columns&&(i.config.columns=e.dataDriverJsonToObject(i.config.columns),e.table.config.columns=i.config.columns,e.columns=i.config.columns,e.table.refreshColumns());var o=e.mode;"company-room"==e.mode&&(o="company/87tYxy9nkl6Nfwk035E0/rooms"),"department"==e.mode&&(o="company/87tYxy9nkl6Nfwk035E0/departments"),e.table.define("url","firestore->"+o),e.table.waitData.then((function(t){e.table.enable(),e.table.hideProgress()}))}))},_proto.getSortParams=function(){var e="";if(this.filterDateRangeField&&(e='[{"property":"'+this.filterDateRangeField+'","direction":"ASC"}]'),this.schemaSortUserList&&this.schemaSortUserList.length>2){var t=JSON.parse(this.schemaSortUserList);for(var i in e=[],t)e.push({property:t[i].field,direction:t[i].direction});e=JSON.stringify(e)}return e},_proto.getFilterParams=function(){this.format=webix.Date.dateToStr("%Y-%m-%d"),this.dateFrom=this.$$("dateFrom"),this.dateTo=this.$$("dateTo"),this.filterField=this.$$("filter-field"),this.showFilterDateRange=this.$$("show-filter-date-range"),this.filterInput=this.$$("filter-input"),this.dateFromValue=this.format(this.dateFrom.getValue()),this.dateToValue=this.format(this.dateTo.getValue()),this.filterFieldValue=this.filterField.getValue(),this.filterInputValue=this.filterInput.getValue();var e={filter:{or:[]}},t={},i={};if(this.showFilterDateRange.isVisible()&&this.filterDateRangeField&&(i[this.filterDateRangeField]={">=":this.dateFromValue,"<=":this.dateToValue},e.filter.or=[i]),this.schemaFilterUserList&&this.schemaFilterUserList.length>2){var o=JSON.parse(this.schemaFilterUserList),a={},r={or:[]};for(var n in o)"dateFrom"==o[n].value&&(o[n].value=this.dateFromValue),"dateTo"==o[n].value&&(o[n].value=this.dateToValue),"in"==o[n].comparison&&(o[n].value=o[n].value.split(",")),"or"==o[n].operator&&(r.or.push(a),a={}),a[o[n].field]||(a[o[n].field]={}),a[o[n].field][o[n].comparison]=o[n].value;r.or.push(a),e.filter=r}return this.filterField.isVisible()&&""!=this.filterInputValue&&(t[this.filterFieldValue]=this.filterInputValue,e.filter.or=[t]),this.getParam("id")&&(e.filter.and=[{list_id:this.getParam("id")}]),console.log(e),e},_proto.setTableSetting=function(){var e=this.schemaTableSetting;for(var t in e.show)null!==this.$$(t)&&"1"===e.show[t].value&&this.$$(t).show();for(var i in e.template)null!==this.$$(i)&&(this.$$(i).define({template:e.template[i].value}),this.$$(i).refresh());for(var o in e.filter)null!==this.$$(o)&&("filter-field"==o&&(this.$$(o+"-label").define({label:e.filter[o].value}),this.$$(o+"-label").refresh()),"filter-date-range-field"==o&&(this.filterDateRangeField=e.filter[o].value))},_proto.setFilterSetting=function(){var e=this;e.$$("filter-field").data.options=[],e.$$("filter-field").refresh(),this.schemaTableUserFilter.forEach((function(t,i){e.$$("filter-field").data.options.push({id:t.column_id,value:t.header}),0!=i||e.$$("filter-input")||e.$$("filter-layout").addView({view:"search-close",name:"text",value:e.stateFilter?e.stateFilter.filterInput:"",localId:"filter-input"})})),e.$$("filter-field").refresh(),e.stateFilter&&e.$$("filter-field").setValue(e.stateFilter.filterField)},_proto.getSchemaTableSetting=function(){var e=this.app.config.apiRest.getUrl("get","accounting/schema-table-setting-users",{"per-page":-1,sort:'[{"property":"type_property","direction":"ASC"},{"property":"property_title","direction":"ASC"}]'}),t=webix.ajax().sync().get(e,{filter:{model:this.model,list_id:this.selectTypeValue}}),i=JSON.parse(t.responseText),o={};return this.schemaTableSettingColumns=i.config.columns,this.schemaTableSettingItems=i.data,this.schemaTableSettingData=i,i.data.forEach((function(e){o[e.type_property]||(o[e.type_property]={}),o[e.type_property][e.property]=e})),o},_proto.setSelectType=function(){var e=this;this.selectType=this.$$("select-type");var t=webix.ajax().sync().get(this.state.urlTableUserLists,{filter:{model:this.model},expand:"schemaTableUserFilter"}),i=JSON.parse(t.responseText);this.dataSelectType=i;var o,a=i.data.length,r="";e.schemaTableUserFilter=[],this.getSelectTypeState()&&(o=this.getSelectTypeState(),i.data.forEach((function(t){t.id==o&&(r=t.id,e.schemaTableUserFilter=t.schemaTableUserFilter,e.schemaFilterUserList=t.filter_setting,e.schemaSortUserList=t.sort_setting,e.schemaColorUserList=t.color_setting,e.schemaColumnUserList=t.column_setting)})),""==r&&webix.storage.local.remove(this.mode+"_select_type_state")),i.data.forEach((function(t){""==r&&1==t.is_default&&(r=t.id,e.schemaTableUserFilter=t.schemaTableUserFilter,e.schemaFilterUserList=t.filter_setting,e.schemaSortUserList=t.sort_setting,e.schemaColorUserList=t.color_setting,e.schemaColumnUserList=t.column_setting)})),this.selectType.define("options",{body:{data:i.data,on:{onItemClick:function(t){var i=this.getItem(t);e.selectTypeValue=t,e.schemaTableSetting=e.getSchemaTableSetting(),e.schemaTableUserFilter=i.schemaTableUserFilter,e.schemaFilterUserList=i.filter_setting,e.schemaSortUserList=i.sort_setting,e.schemaColorUserList=i.color_setting,e.schemaColumnUserList=i.column_setting,e.setColorSettingForTable(),e.setTableSetting(),e.setFilterSetting(),e.getDataTable(),e.putSelectTypeState(t)}}}}),this.selectType.refresh(),this.selectType.setValue(r),this.selectTypeValue=r,1==a?this.selectType.hide():this.selectType.show()},_proto.attachToolBarEvents=function(){var e=this;e.dateFrom.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.dateTo.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.filterField.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.filterInput.attachEvent("onChange",(function(t){e.getDataTable(),e.putFilterState()})),e.table.attachEvent("onColumnResize",(function(t,i,o,a){e.eventSetColumnUserSize(t,i,o,a)})),e.table.attachEvent("onAfterColumnDrop",(function(t,i,o){e.eventSetColumnUserSort(t,i,o)}))},_proto.eventSetColumnUserSize=function(e,t,i,o){var a=this;this.app.config.apiRest.getUrl("get","accounting/schema-table-users");if(o){var r=this.table.getColumnConfig(e),n=this.app.config.apiRest.getUrl("get","accounting/schema-table-users/"+r.rowId);webix.ajax().put(n,{width:t,adjust:"",id:r.rowId},(function(e,t,i){a.showMessageResult(t.json(),i,!1)}))}},_proto.eventSetColumnUserSort=function(e,t,i){var o=this.table.getColumnConfig(e),a=this.table.getColumnConfig(t),r=50;a.sort_order<o.sort_order&&(r=-50),o.sort_order=a.sort_order+1*r;var n=this.app.config.apiRest.getUrl("get","accounting/schema-table-users/"+o.rowId);webix.ajax().put(n,{sort_order:a.sort_order+1*r,id:o.rowId},(function(e,t,i){scope.showMessageResult(t.json(),i,!1)}))},_proto.showMessageResult=function(e,t,i){if(e.errors)for(var o in e.errors)webix.message({text:o+":"+e.errors[o],type:"error",expire:-1});200==t.status&&!e.errors&&i&&webix.message({text:"Данные cохранены",type:"info",expire:1e3}),204==t.status&&webix.message({text:"Ошибка! Данные не сохранены",type:"error",expire:-1})},_proto.showSetting=function(){var e=this;this.state={model:this.capitalizeFirstLetter(this.mode),urlTableUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-users",{"per-page":-1,sort:'[{"property":"sort_order","direction":"ASC"},{"property":"column_id","direction":"ASC"}]'}),urlTableUserLists:this.app.config.apiRest.getUrl("get","accounting/schema-table-user-lists",{"per-page":-1,sort:"sort_order"}),urlTableSettingUsers:this.app.config.apiRest.getUrl("get","accounting/schema-table-setting-users",{"per-page":-1,sort:"type-property"}),dataList:"",urlTableUsersSave:"api->accounting/schema-table-users",urlTableSettingUsersSave:"api->accounting/schema-table-setting-users",listId:"",tableSetiingConfigColumn:[],tableSettingItems:[]},this.state.dataList=this.dataSelectType.data,this.state.listId=this.selectTypeValue,this.state.listId=this.selectTypeValue;var t=webix.ajax().sync().get(this.state.urlTableUserLists,{filter:{model:this.state.model}});this.state.dataList=JSON.parse(t.responseText);var i=webix.ajax().sync().get(e.state.urlTableUsers,{filter:{model:e.state.model,list_id:e.state.listId}}),o=JSON.parse(i.responseText);this.state.tableConfigColumn=o.config.columns,this.state.tableItems=o.data?o.data:o.items,this.state.tableSetiingConfigColumn=this.schemaTableSettingColumns,this.state.tableSettingItems=this.schemaTableSettingItems,this.state.tableSetiingData=this.schemaTableSettingData,this.win={};var a={view:"window",head:{cols:[{width:4},{type:"header",template:"Настройки таблицы",borderless:!0},{view:"icon",icon:"mdi mdi-close",align:"right",click:function(){this.getTopParentView().hide()}}]},width:950,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!1,body:{localId:"body-setting-layout",css:"webix_primary",type:"space",cols:[{view:"menu",layout:"y",width:250,select:!0,localId:"menu-list",onContext:{},data:this.state.dataList,ready:function(){this.select(e.state.listId),e.attachEventShowColumns()},on:{onItemClick:function(t){var i=webix.ajax().sync().get(e.state.urlTableUsers,{filter:{model:e.state.model,list_id:t}}),o=JSON.parse(i.responseText);e.state.tableConfigColumn=o.config.columns,e.state.tableItems=o.data?o.data:o.items,e.state.listId=t;var a=e.$$(this.getParentView().queryView({localId:"showColumnsTab"})),r=e.$$(this.getParentView().queryView({localId:"settingColumnsTab"})),n=e.$$(this.getParentView().queryView({localId:"tablePropertyTab"}));a.define("rows",e.getHeaderShowColumns()),a.reconstruct(),e.attachEventShowColumns(),r.define("rows",e.getHeaderSettingColumns()),r.reconstruct();var l=webix.ajax().sync().get(e.state.urlTableSettingUsers,{filter:{model:e.state.model,list_id:t}}),s=JSON.parse(l.responseText);e.state.tableSetiingData=s,e.state.tableSetiingConfigColumn=s.config.columns,e.state.tableSettingItems=s.data?s.data:s.items,n.define("rows",e.getHeaderTableProperty()),n.reconstruct()}}},{view:"resizer"},{rows:[{view:"tabbar",value:"showColumnsTab",options:[{id:"showColumnsTab",value:"Видимые колонки"},{id:"settingColumnsTab",value:"Свойства колонок"},{id:"tablePropertyTab",value:"Настройки таблицы"}],on:{onItemClick:function(t,i){e.$$(this.getParentView().queryView({localId:this.getValue()})).show()}}},{animate:!1,width:660,cells:[{localId:"showColumnsTab",type:"space",rows:this.getHeaderShowColumns()},{localId:"settingColumnsTab",type:"space",rows:this.getHeaderSettingColumns()},{localId:"tablePropertyTab",type:"space",rows:this.getHeaderTableProperty()}]}]}]}};this.win=webix.ui(a),this.contentMenu=this.ui(this.getContentMenu(),e),this.contentMenu.attachTo(this.win.queryView({localId:"menu-list"})),this.win.show()},_proto.getHeaderShowColumns=function(){var e=this,t=this;return[{view:"text",localId:"search-show-columns",placeholder:"поиск"},{cols:[{view:"dataview",localId:"dataview-show-columns",borderless:!1,select:!0,xCount:2,scroll:!0,type:{width:"auto",markCheckbox:function(e,t){return"<span class='metadata_config_check webix_icon wxi-checkbox-"+(e.hidden?"blank":"marked")+" +square-o'></span>"}},onClick:{metadata_config_check:function(e,i){var o=this.getItem(i);(o.hidden=o.hidden?0:1,this.updateItem(i,o),1==o.hidden)?t.table.hideColumn(o.column_id):-1!=t.table.getColumnIndex(o.column_id)?t.table.showColumn(o.column_id):(t.table.config.columns.splice(o.id,0,{id:o.column_id,header:o.header,adjust:"header",hidden:0}),t.table.refreshColumns())}},on:{onBeforeSelect:function(e){return!this.getItem(e).hidden}},scheme:{$init:function(e){e.hidden&&(e.$css="metadata_list_item_disabled")}},template:"{common.markCheckbox()}<div style='margin-top:5px;'>#header# (#column_id#)</div>",data:t.state.tableItems,datatype:"json",save:t.state.urlTableUsersSave}]},{type:"space",borderless:!0,cols:[{view:"button",label:"Копировать в базовые настройки",localId:"save-setting",css:"webix_primary",click:function(){return e.doSaveBaseSettingClick()}},{}]}]},_proto.attachEventShowColumns=function(){var e=this.win.queryView({localId:"search-show-columns"}),t=this.win.queryView({localId:"dataview-show-columns"});e.attachEvent("onChange",(function(e,i,o){t.filter((function(t){return-1!=t.column_id.toString().indexOf(e)})),0==t.count()&&t.filter((function(t){return-1!=t.header.toString().indexOf(e)}))}))},_proto.getHeaderSettingColumns=function(){var e=[],t=[],i=[],o=[],a=[],r=[],n=[];return this.state.tableItems.forEach((function(e){0==e.hidden&&n.push(e)})),this.state.tableConfigColumn.forEach((function(n){"header_filter_type"==n.id&&(e=n.options),"header_total_type"==n.id&&(t=n.options),"format"==n.id&&(i=n.options),"sort_type"==n.id&&(o=n.options),"editor"==n.id&&(a=n.options),"form_edit"==n.id&&(r=n.options)})),[{view:"datatable",css:"webix_header_border webix_data_border",select:"row",editable:!0,editaction:"click",tooltip:!0,leftSplit:2,borderless:!1,columns:[{id:"index",header:"#",hidden:!1,width:40,css:{"background-color":"#F4F5F9"}},{id:"header",header:"Колонка",adjust:"all",editor:"text",css:{"background-color":"#F4F5F9"},tooltip:"#column_id#"},{id:"sort_order",header:"Порядок",editor:"text",adjust:"all"},{id:"header_filter_type",header:"Тип фильтра",editor:"select",options:e,adjust:"all"},{id:"header_total_type",header:"Тип итого",editor:"select",options:t,adjust:"all"},{id:"editor",header:"Редактор",editor:"select",options:a,adjust:"all"},{id:"format",header:"Формат колонки",editor:"select",options:i,adjust:"header"},{id:"css",header:"Стиль",editor:"popup",adjust:"header"},{id:"css_format",header:"Css Формат",editor:"popup",adjust:"header"},{id:"sort_type",header:"Тип сорт.",editor:"select",options:o,adjust:"all"},{id:"width",header:"Ширина",editor:"text",adjust:"all"},{id:"adjust",header:"Рег.ширины",editor:"text",adjust:"all"},{id:"template",header:"Шаблон",editor:"popup",adjust:"header"},{id:"options",header:"Список",editor:"popup",adjust:"header"},{id:"use_filter",header:"Исп. в фильтре",editor:"text",adjust:"all"},{id:"math",header:"Math",editor:"popup",adjust:"all"},{id:"form_edit",header:"Форма редакт.",editor:"select",options:r,adjust:"all"},{id:"goto",header:"url",editor:"popup",adjust:"all"},{id:"",header:"",fillspace:!0}],data:n,datatype:"json",save:this.state.urlTableUsersSave,scheme:{$init:function(e){e.index=this.count()-1+1}}}]},_proto.getHeaderTableProperty=function(){return this.state.tableSetiingData.config.columns=this.dataDriverJsonToObject(this.state.tableSetiingData.config.columns),[{view:"treetable",css:"webix_header_border webix_data_border",select:"cell",editable:!0,editaction:"click",tooltip:!0,data:this.state.tableSetiingData,save:this.state.urlTableSettingUsersSave,scheme:{$init:function(e){e.index=this.count()-1+1},$group:{by:"type_property",map:{property_value:["type_property"],property_title:["property_title"],value:["","string"]}}},ready:function(){this.openAll()}}]},_proto.doSaveBaseSettingClick=function(){var e=this.app.config.apiRest.getUrl("get","accounting/schema-table-user-list/save-to-base-setting"),t=webix.ajax().sync().get(e,{listId:this.state.listId,model:this.state.model}),i=JSON.parse(t.responseText);this.showMessageError(i)},_proto.getContentMenu=function(){var e=this;return{view:"contextmenu",editable:!0,editor:"text",data:[{id:"add",value:"Копировать"},{id:"rename",value:"Переименовать"},{id:"is_default",value:"По умолчанию"},{id:"copy_user",value:"Для пользователя"},{$template:"Separator"},{id:"delete",value:"Удалить"}],on:{onItemClick:function(t){var i=this.getContext();i.obj,i.id;"delete"==t&&e.doDeleteMenuClick(i.id,i.obj),"add"==t&&e.doSaveSettingClick(),"rename"==t&&e.doRenameClick(i.id,i),"is_default"==t&&e.doDefaultMenuClick(i.id,i),"copy_user"==t&&e.doCopyUsertMenuClick(i.id,i)}}}},_proto.doSaveSettingClick=function(){var e=this.app.config.apiRest.getUrl("get","accounting/schema-table-user/save-setting"),t=webix.ajax().sync().get(e,{listId:this.state.listId,model:this.state.model}),i=JSON.parse(t.responseText),o=this.win.queryView({localId:"menu-list"});o.add(i.data),o.select(i.data.id),o.callEvent("onItemClick",[i.data.id])},_proto.doDeleteMenuClick=function(e,t){var i=this.app.config.apiRest.getUrl("delete","accounting/schema-table-user-lists",{},e);204==webix.ajax().sync().del(i).status?(t.remove(e),t.select(t.getFirstId()),this.state.listId=t.getFirstId()):webix.message("Ошибка! Данные не удалены!")},_proto.doDefaultMenuClick=function(e,t){var i=this.app.config.apiRest.getUrl("get","accounting/schema-table-user-list/set-default",{id:e}),o=webix.ajax().sync().get(i),a=JSON.parse(o.responseText);1==a.success?(t.obj.data.each((function(e){e.id==t.id?(e.icon="mdi mdi-flip-to-front",e.is_default=1,e.editor="text"):(e.icon="mdi mdi-flip-to-back",e.is_default=0)})),t.obj.refresh()):webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))},_proto.doRenameClick=function(e,t){var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},e);webix.prompt({text:"Изменить название",ok:"Сохранить",cancel:"Отмена",input:{required:!0,value:t.obj.getItem(e).value,placeholder:"Введите название"},width:350}).then((function(e){var o=webix.ajax().sync().put(i,{name:e}),a=JSON.parse(o.responseText);if(200==o.status){var r=t.obj.getItem(t.id);r.name=e,r.value=e,t.obj.refresh()}else webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))})).fail((function(){}))},_proto.doCopyUsertMenuClick=function(e,t){var i=this;this.app.config.apiRest.getUrl("get","accounting/users");webix.ui({view:"window",width:500,height:400,head:"Копировать настройи для пользователя",modal:!0,position:"center",close:!0,body:{type:"space",cols:[{type:"form",rows:[{view:"combo-close",localId:"combo-user",options:this.app.config.apiRest.getCollection("accounting/users",{"per-page":-1},"email"),label:"Выберите пользователя",labelWidth:180,required:!0,placeholder:"Выберите пользователя"},{cols:[{view:"button",label:"Сохранить",click:function(){var e=this.getTopParentView().queryView({localId:"combo-user"}).getValue(),o=i.app.config.apiRest.getUrl("get","accounting/schema-table-user/save-setting-for-user"),a=webix.ajax().sync().get(o,{listId:t.id,model:i.state.model,userId:e}),r=JSON.parse(a.responseText);this.getTopParentView().hide(),i.showMessageError(r)}},{},{}]}]}]}}).show()},_proto.putFilterState=function(){webix.storage.local.put(this.mode+"_filter_state",{dateFrom:this.dateFrom.getValue(),dateTo:this.dateTo.getValue(),filterField:this.filterField.getValue(),filterInput:this.filterInput.getValue()})},_proto.getSelectTypeState=function(){var e=webix.storage.local.get(this.mode+"_select_type_state");return!!e&&e.selectType},_proto.putSelectTypeState=function(e){webix.storage.local.put(this.mode+"_select_type_state",{selectType:e})},_proto.showMessageError=function(e){if(e.errors)for(var t in e.errors)webix.message({text:t+":"+e.errors[t],type:"error",expire:-1});e.success&&webix.message({text:"Данные успешно сохранены!",type:"info",expire:2e3})},_proto.doRefresh=function(){this.getDataTable()},_proto.getModelName=function(e){return"y"==e[e.length-1]?e.replace(/y$/,"ies"):e+"s"},_proto.doClickOpenAll=function(){var e=this.table;e.getOpenItems().length>0?e.closeAll():e.openAll()},_proto.capitalizeFirstLetter=function(e){var t=e.split("-"),i=[];return t.forEach((function(e){i.push(e.charAt(0).toUpperCase()+e.slice(1))})),i.join("")},_proto.dataDriverJsonToObject=function dataDriverJsonToObject(configColumns){return configColumns.forEach((function(item,key){var myObj={func:{}};item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("webix")&&(eval(" myObj.func = (obj) => { return "+item.format+"(obj); }"),configColumns[key].numberFormat="1111.00"),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatMonthYear")&&(eval(" myObj.func = (obj) => { return "+item.format+"(obj); }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateTime")&&(eval(" myObj.func = (obj) => { try {formatDateTime(obj.trim())} catch (e) { debugger; } return  (obj) ? formatDateTime(obj.trim()) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateShort")&&(eval(" myObj.func = (obj) => { try {formatDateShort(obj.trim())} catch (e) { debugger; } return  (obj) ? formatDateShort(obj.trim()) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDate")&&(eval(" myObj.func = (obj) => { try {formatDate(obj.trim())} catch (e) { debugger; } return  (obj) ? formatDate(obj.trim()) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateHour")&&(eval(" myObj.func = (obj) => { try {formatDateHour(obj.trim())} catch (e) { debugger; } return  (obj) ? formatDateHour(obj.trim()) : ''; }"),configColumns[key].format=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("(obj,common,value)")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("custom_checkbox")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("columnGroupTemplate")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func)})),configColumns},_proto.doAddClick=function(){this.table.unselect(),this.formEdit.showForm(this.table)},_proto.beforeDropChangeData=function(e,t,i){var o=this.table,a=this.schemaTableSetting.group["group-by"].value;o.getSelectedId(!0);return i.source.forEach((function(e){o.getItem(e)[a]=formatDateTimeDb(parserDateTimeGroup(t)),o.refresh(e),o.updateItem(e,o.getItem(e))})),!0},_proto.showExportToExcelSetting=function(){var e={view:"window",head:"Настройки экспорта в Excel",width:950,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-print-layout",css:"webix_primary",type:"space",cols:[{view:"menu",layout:"y",width:250,select:!0,localId:"menu-list-print",onContext:{},url:this.app.config.apiRest.getUrl("get","accounting/schema-print-user-lists",{"per-page":-1,filter:'{"list_id":"'+this.selectTypeValue+'"}'}),hidden:!0,on:{onAfterLoad:function(){this.data.count()>0&&this.show(),this.select(this.data.getFirstId()),this.callEvent("onItemClick",[this.data.getFirstId()])},onItemClick:function(e){var t=this.getTopParentView().queryView({localId:"print-column-select"});JSON.parse(this.getItem(e).setting).forEach((function(e){t.data.each((function(t){t.id==e.id&&(t.hidden=e.hidden)}))})),t.refresh()}}},{type:"form",rows:[{header:"Показывать",rows:this.getHeaderPrintColumns()}]}]}};this.winPrint=webix.ui(e),this.contentMenuPrint=this.ui(this.getContentMenuPrint(),this),this.contentMenuPrint.attachTo(this.winPrint.queryView({localId:"menu-list-print"})),this.winPrint.show()},_proto.getHeaderPrintColumns=function(){var e=this;return[{view:"dataview",localId:"print-column-select",select:!0,type:{width:250,markCheckbox:function(e,t){return"<span class='metadata_config_check webix_icon wxi-checkbox-"+(e.hidden?"blank":"marked")+" +square-o'></span>"}},onClick:{metadata_config_check:function(e,t){var i=this.getItem(t);i.hidden=i.hidden?0:1,this.updateItem(t,i)}},on:{onBeforeSelect:function(e){return!this.getItem(e).hidden}},scheme:{$init:function(e){e.hidden&&(e.$css="metadata_list_item_disabled")}},template:function(e,t){return t.markCheckbox(e,t)+"<div style='margin-top:5px;'>"+e.header[0].text+"</div>"},data:e.table.config.columns,datatype:"json"},{cols:[{},{},{view:"button",label:"Сохранить настройки",localId:"save-setting",css:"webix_primary",click:function(){var t=this.getTopParentView().queryView({localId:"print-column-select"}).data.serialize();e.doSavePrintSettingClick(t)}},{view:"button",label:"Печать",localId:"print-button",css:"webix_primary",click:function(){var t=this.getTopParentView().queryView({localId:"print-column-select"}).data.serialize();e.doClickToExcel(t),this.getTopParentView().close()}}]}]},_proto.doSavePrintSettingClick=function(e){var t=this,i=this.app.config.apiRest.getUrl("get","accounting/schema-print-user-lists"),o=[];e.forEach((function(e){o.push({id:e.id,hidden:e.hidden?e.hidden:0})})),webix.ajax().post(i,{model:this.model,setting:JSON.stringify(o),name:"Печать",list_id:this.selectTypeValue},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})},_proto.doClickToExcel=function(e){var t=this.table,i="";this.filter.filter.or.forEach((function(e){for(var t in e)if(i=i+"_"+t,"object"==typeof e[t])for(var o in e[t])i=i+"_"+e[t][o];else i=i+"_"+e[t]}));var o=[];e.forEach((function(e){e.hidden||o.push(e)})),webix.toExcel(t,{filename:this.mode+i,styles:!1,ignore:{"action-edit":!0},columns:o})},_proto.getContentMenuPrint=function(){var e=this;return{view:"contextmenu",localId:"cmenu-print",editable:!0,editor:"text",data:[{id:"rename",value:"Переименовать"},{id:"is_default",value:"По умолчанию"},{$template:"Separator"},{id:"delete",value:"Удалить"}],on:{onItemClick:function(t){var i=this.getContext();i.obj,i.id;"delete"==t&&e.doDeleteMenuPrintClick(i.id,i.obj),"rename"==t&&e.doRenamePrintClick(i.id,i),"is_default"==t&&e.doDefaultMenuPrintClick(i.id,i)}}}},_proto.doDeleteMenuPrintClick=function(e,t){var i=this.app.config.apiRest.getUrl("delete","accounting/schema-print-user-lists",{},e);204==webix.ajax().sync().del(i).status?(t.remove(e),t.select(t.getFirstId()),t.callEvent("onItemClick",[t.getFirstId()])):webix.message("Ошибка! Данные не удалены!")},_proto.doRenamePrintClick=function(e,t){var i=this.app.config.apiRest.getUrl("put","accounting/schema-print-user-lists",{},e);webix.prompt({text:"Изменить название",ok:"Сохранить",cancel:"Отмена",input:{required:!0,value:t.obj.getItem(e).value,placeholder:"Введите название"},width:350}).then((function(e){var o=webix.ajax().sync().put(i,{name:e}),a=JSON.parse(o.responseText);if(200==o.status){var r=t.obj.getItem(t.id);r.name=e,r.value=e,t.obj.refresh()}else webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))})).fail((function(){}))},_proto.doDefaultMenuPrintClick=function(e,t){var i=this.app.config.apiRest.getUrl("get","accounting/schema-print-user-list/set-default",{id:e}),o=webix.ajax().sync().get(i),a=JSON.parse(o.responseText);1==a.success?(t.obj.data.each((function(e){e.id==t.id?(e.icon="mdi mdi-flip-to-front",e.is_default=1,e.editor="text"):(e.icon="mdi mdi-flip-to-back",e.is_default=0)})),t.obj.refresh()):webix.message("Ошибка! Данные не изменены!"+JSON.stringify(a.errors))},_proto.showFilterSetting=function(){var e={view:"window",head:"Настройки фильтра",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-filter-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderFilterSetting()}]}]}};this.winFilter=webix.ui(e),this.setElementFilterForm(),this.winFilter.show()},_proto.setElementFilterForm=function(){if(this.schemaFilterUserList&&this.schemaFilterUserList.length>2){var e=JSON.parse(this.schemaFilterUserList),t=this.winFilter.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementFilterForm(i));this.winFilter.queryView("form").setValues(e)}},_proto.getElementFilterForm=function(e){var t=this;return{localId:"element-filter-"+e,rows:[{cols:[{view:"combo",name:e+".operator",labelWidth:150,labelPosition:"top",label:"Оператор",value:"",disabled:0==e,options:["","and","or"]},{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"date_shipment",options:this.table.config.columns},{view:"combo",name:e+".comparison",labelWidth:150,labelPosition:"top",label:"Тип сравнения",value:"=",options:["=",">=","<=","in"]},{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Значение",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementFilterForm("element-filter-"+e)}}]},{height:20}]}},_proto.deleteElementFilterForm=function(e){var t=this.winFilter.queryView({localId:"form-row-layout"}),i=this.winFilter.queryView({localId:e});t.removeView(i)},_proto.getHeaderFilterSetting=function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-filter-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementFilterForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-setting",css:"webix_primary",click:function(){e.doSaveFilterSettingClick(this.getTopParentView().queryView("form").getValues()),e.winFilter.close()}}]}]}]},_proto.doSaveFilterSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaFilterUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{filter_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},_proto.showSortSetting=function(){var e={view:"window",head:"Настройки сортировки",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-sort-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderSortSetting()}]}]}};this.winSort=webix.ui(e),this.setElementSortForm(),this.winSort.show()},_proto.setElementSortForm=function(){if(this.schemaSortUserList&&this.schemaSortUserList.length>2){var e=JSON.parse(this.schemaSortUserList),t=this.winSort.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementSortForm(i));this.winSort.queryView("form").setValues(e)}},_proto.getElementSortForm=function(e){var t=this;return{localId:"element-sort-"+e,rows:[{cols:[{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"date_shipment",options:this.table.config.columns},{view:"combo",name:e+".direction",labelWidth:150,labelPosition:"top",label:"Тип сортировки",value:"ASC",options:[{id:"ASC",value:"по возрастанию"},{id:"DESC",value:"по убыванию"}]},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementSortForm("element-sort-"+e)}}]},{height:20}]}},_proto.deleteElementSortForm=function(e){var t=this.winSort.queryView({localId:"form-row-layout"}),i=this.winSort.queryView({localId:e});t.removeView(i)},_proto.getHeaderSortSetting=function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-sort-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementSortForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-setting",css:"webix_primary",click:function(){e.doSaveSortSettingClick(this.getTopParentView().queryView("form").getValues()),e.winSort.close()}}]}]}]},_proto.doSaveSortSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaSortUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{sort_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},_proto.setColorSettingForTable=function setColorSettingForTable(){var colorSetting=JSON.parse(this.schemaColorUserList),condition=[],obj={func:function(){}},index=-1;for(var key in colorSetting){var item=colorSetting[key];""!=item.operator.trim()||(index++,condition[index]=[]),condition[index].push(item)}var conditionFunction="function(item, view, prop) { item.index = (this.count())+1; ";condition.forEach((function(e){if(e.length>1){var t="(",i={};e.forEach((function(e){var o="="==e.comparison?"==":e.comparison,a=-1!=e.value.indexOf("{")?e.value.replace("{","").replace("}",""):"'"+e.value+"'",r="";"and"==e.operator&&(r="&&"),"or"==e.operator&&(r="||"),t+=r+" item."+e.field+" "+o+" "+a+" ",i=e})),t+=")";var o='{"background-color":"'+i.color+'"}';conditionFunction+="if "+t+" { item.$css = "+o+"; } "}if(1==e.length){var a=e[0],r='{"background-color":"'+a.color+'"}',n="="==a.comparison?"==":a.comparison,l=-1!=a.value.indexOf("{")?a.value.replace("{","").replace("}",""):"'"+a.value+"'";conditionFunction+="if (item."+a.field+" "+n+" "+l+") { item.$css = "+r+"; } "}})),conditionFunction+="}",console.log(conditionFunction),eval(" obj.func = "+conditionFunction),this.table.define("scheme",{$init:obj.func})},_proto.showColorSetting=function(){var e={view:"window",head:"Настройки цветов",width:700,height:500,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-color-layout",css:"webix_primary",type:"space",cols:[{type:"form",rows:[{rows:this.getHeaderColorSetting()}]}]}};this.winColor=webix.ui(e),this.setElementColorForm(),this.winColor.show()},_proto.setElementColorForm=function(){if(this.schemaColorUserList&&this.schemaColorUserList.length>2){var e=JSON.parse(this.schemaColorUserList),t=this.winColor.queryView({localId:"form-row-layout"});for(var i in e)t.addView(this.getElementColorForm(i));this.winColor.queryView("form").setValues(e)}},_proto.getElementColorForm=function(e){var t=this;return{localId:"element-color-"+e,rows:[{cols:[{view:"combo",name:e+".operator",labelWidth:150,labelPosition:"top",label:"Оператор",value:"",disabled:0==e,options:[" ","and","or"]},{view:"combo",name:e+".field",labelWidth:150,labelPosition:"top",label:"Выберите поле",value:"",options:this.table.config.columns},{view:"combo",name:e+".comparison",labelWidth:150,labelPosition:"top",label:"Тип сравнения",value:"==",options:["==",">=","<=","!="]},{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Значение",value:""},{view:"colorpicker",name:e+".color",labelWidth:150,labelPosition:"top",label:"Цвет",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteElementColorForm("element-color-"+e)}}]},{height:20}]}},_proto.deleteElementColorForm=function(e){var t=this.winColor.queryView({localId:"form-row-layout"}),i=this.winColor.queryView({localId:e});t.removeView(i)},_proto.getHeaderColorSetting=function(){var e=this;return[{view:"form",complexData:!0,scroll:"auto",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-color-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i=t.getChildViews().length;t.addView(e.getElementColorForm(i))}}]},{},{cols:[{},{},{view:"button",label:"Сохранить",localId:"save-color-setting",css:"webix_primary",click:function(){e.doSaveColorSettingClick(this.getTopParentView().queryView("form").getValues()),e.winColor.close()}}]}]}]},_proto.doSaveColorSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaColorUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{color_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,t,i){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3})}})}},_proto.setColumnSettingForTable=function(){var e,t=this.$$("batch-column"),i=[],o="0",a=0;for(var r in this.schemaColumnUserListObject=JSON.parse(this.schemaColumnUserList),e=this.schemaColumnUserListObject){1==++a&&(o=this.selectColumnSettingId?this.selectColumnSettingId:r);var n=e[r];i.push({id:r,value:n.value})}t.define("options",{body:{data:i}}),t.setValue(o),this.selectColumnSettingForTable(o),0==a||1==a?t.hide():t.show(),t.refresh()},_proto.selectColumnSettingForTable=function(e){var t=this;t.selectColumnSettingId=e;var i=this.schemaColumnUserListObject,o={},a={};for(var r in i){o=i[r].category;var n=function(i){console.log(i);var n=o[i];if(r==e)a[n.field]=n,t.table.getColumnConfig(n.field).cssFormat=function(e,t){return n};else{var l=t.table.getColumnConfig(n.field);l&&(l.cssFormat="")}};for(var l in o)n(l)}t.table.refreshColumns()},_proto.showColumnSetting=function(){var e=this,t={view:"window",head:"Настройки  столбцов",width:800,height:600,position:"center",modal:!0,close:!0,move:!0,resize:!0,body:{localId:"body-setting-color-column-layout",type:"space",cols:[{rows:[{rows:this.getHeaderColumnSetting()},{padding:10,cols:[{},{},{view:"button",label:"Сохранить",localId:"save-column-setting",css:"webix_primary",click:function(){e.doSaveColumnSettingClick(this.getTopParentView().queryView("form").getValues()),e.winColumn.close()}}]}]}]}};this.winColumn=webix.ui(t),this.setCategoryColumnForm(),this.winColumn.show()},_proto.setCategoryColumnForm=function(){if(this.schemaColumnUserList&&this.schemaColumnUserList.length>2){var e=JSON.parse(this.schemaColumnUserList),t=this.winColumn.queryView({localId:"form-row-layout"});for(var i in e)for(var o in t.addView(this.getCategoryColumnForm(i)),e[i].category){t.queryView({localId:"form-subrow-layout"+i}).addView(this.getElementColumnForm(i,o))}this.winColumn.queryView("form").setValues(e)}},_proto.getCategoryColumnForm=function(e){var t=this;return{localId:"category-column-"+e,rows:[{type:"form",rows:[{cols:[{view:"text",name:e+".value",labelWidth:150,labelPosition:"top",label:"Название расцветки",value:""},{view:"icon",icon:"mdi mdi-close",labelPosition:"top",labelWidth:34,click:function(){t.deleteCategoryColumnForm("category-column-"+e,e)}}]},{localId:"form-subrow-layout"+e,rows:[]},{cols:[{view:"button",label:"+",localId:"add-column-category",css:"webix_primary",width:40,click:function(){var i=this.getTopParentView().queryView({localId:"form-subrow-layout"+e}),o="0";i.getChildViews().length>0&&(o=t.getLasElementId(this,e)),i.addView(t.getElementColumnForm(e,o))}},{},{}]}]},{height:10}]}},_proto.getLasElementId=function(e,t){var i=e.getTopParentView().queryView("form").getValues()[t];return(1*Object.keys(i.category)[Object.keys(i.category).length-1]+1).toString()},_proto.getLasCategoryId=function(e){var t=e.getTopParentView().queryView("form").getValues();return(1*Object.keys(t)[Object.keys(t).length-1]+1).toString()},_proto.getElementColumnForm=function(e,t){var i=this;return{localId:"element-column-"+e+"-"+t,rows:[{cols:[{view:"combo",name:e+".category."+t+".field",labelWidth:150,labelPosition:"top",label:"Выберите колонку",value:"",options:this.table.config.columns},{view:"combo",name:e+".category."+t+".font-weight",labelWidth:150,labelPosition:"top",label:"Стиль текста",value:"normal",options:[{id:"normal",value:"нормальный"},{id:"500",value:"полужирный"},{id:"700",value:"жирный"}]},{view:"combo",name:e+".category."+t+".text-align",labelWidth:150,labelPosition:"top",label:"Выравнять текст",value:"left",options:[{id:"left",value:"по левому краю"},{id:"center",value:"по середине"},{id:"right",value:"по правому краю"}]},{view:"colorpicker",name:e+".category."+t+".color",labelWidth:150,labelPosition:"top",label:"Цвет текста",value:""},{view:"colorpicker",name:e+".category."+t+".background-color",labelWidth:150,labelPosition:"top",label:"Цвет фона",value:""},{view:"icon",icon:"mdi mdi-close",css:"small",labelPosition:"top",click:function(){i.deleteElementColumnForm("element-column-"+e+"-"+t,e,t)}}]},{height:20}]}},_proto.deleteCategoryColumnForm=function(e,t){var i=this.winColumn.queryView({localId:"form-row-layout"}),o=this.winColumn.queryView({localId:e});t==this.selectColumnSettingId&&(this.selectColumnSettingId=null);var a=JSON.parse(this.schemaColumnUserList),r=a[t]?a[t].category:{};for(var n in r)this.table.getColumnConfig(r[n].field).cssFormat="";this.table.refreshColumns(),i.removeView(o)},_proto.deleteElementColumnForm=function(e,t,i){var o=this.winColumn.queryView({localId:"form-subrow-layout"+t}),a=this.winColumn.queryView({localId:e}),r=JSON.parse(this.schemaColumnUserList);if(r[t]){var n=r[t].category[i];this.table.getColumnConfig(n.field).cssFormat="",this.table.refreshColumns()}o.removeView(a)},_proto.getHeaderColumnSetting=function(){var e=this;return[{view:"form",borderless:!0,complexData:!0,localId:"form-column",scroll:"y",elements:[{localId:"form-row-layout",rows:[]},{cols:[{},{},{view:"button",label:"+",localId:"add-column-element",css:"webix_primary",width:40,click:function(){var t=this.getTopParentView().queryView({localId:"form-row-layout"}),i="0";t.getChildViews().length>0&&(i=e.getLasCategoryId(this)),t.addView(e.getCategoryColumnForm(i))}}]},{}]}]},_proto.doSaveColumnSettingClick=function(e){var t=this;if(this.selectTypeValue){t.schemaColumnUserList=JSON.stringify(e);var i=this.app.config.apiRest.getUrl("put","accounting/schema-table-user-lists",{},this.selectTypeValue);webix.ajax().put(i,{column_setting:JSON.stringify(e)},{error:function(e,i,o){t.showMessageError(i.json())},success:function(e,i,o){webix.message({text:"Данные успешно сохранены!",type:"info",expire:4e3}),t.setColumnSettingForTable()}})}},InproduceView}(webix_jet__WEBPACK_IMPORTED_MODULE_0__.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return d}));var o=i(0),a=i(7),r=i(5);function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function s(e,t,i){return function(t){function o(e,i){var o;return(o=t.call(this,e,i)||this).state=new a.a(n(o)),o.state.app=e,o}l(o,t);var d=o.prototype;return d.config=function(){return e},d.init=function(e,t){var o=this.state;o.table=this.$$("table-register"+i),o.tableUrl=this.app.config.apiRest.getUrl("get","accounting/register/turnover"),this.attachTableEvents()},d.attachTableEvents=function(){var e=this.state;e.scope=this;var t={};e.table.attachEvent("onItemDblClick",(function(i){t=e.table.getSelectedItem(),webix.ajax().get(e.tableUrl,{account:t.account_id,account_type:t.account_type}).then((function(i){var o="report"+t.account_id+(t.account_type||0);e.tableId=o,r.a[o]||(r.a[o]=s(c(i,e.tableId),e.scope,o),$$("top:menu").add({id:o,value:"ОСВ:"+t.account,icon:"mdi mdi-view-dashboard"},null,"info"),$$("top:menu").open("info"),$$("views").addView({id:o,rows:[r.a[o]]}),$$("tabs").addOption(o,t.account,!0)),console.log(e.scope.$$("table-register"+e.tableId))}))}))},o}(o.b)}function c(e,t){return void 0===t&&(t=""),{rows:[{view:"toolbar",cols:[{view:"icon",icon:"mdi mdi-close",click:function(){}}],css:{"text-align":"right"}},{view:"datatable",close:!0,localId:"table-register"+t,autoConfig:!0,css:"webix_header_border webix_data_border",header:!0,title:"Оборотно-сальдовая ведомость",footer:!0,scroll:!0,autoheight:!0,select:"cell",resizeColumn:{headerOnly:!0},columns:[{header:"",width:50},{id:"account",header:"Субконто",width:170,template:function(e){return e.account_date?webix.i18n.dateFormatStr(e.account_date)+"  №"+e.account:e.account}},{id:"sum_debet_start",header:[{text:"Сальдо на начало",colspan:2},"Дебет"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{id:"sum_credit_start",header:[{text:"",colspan:2},"Кредит"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{id:"sum_debet",header:[{text:"Оборот за период",colspan:2},"Дебет"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"},format:webix.Number.format},{id:"sum_credit",header:[{text:"",colspan:2},"Кредит"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"},format:webix.Number.format},{id:"sum_debet_end",header:[{text:"Сальдо на конец",colspan:2},"Дебет"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{id:"sum_credit_end",header:[{text:"",colspan:2},"Кредит"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{header:"",fillspace:!0}],data:e},{}]}}var d=function(e){function t(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(n(o)),o.state.app=t,o}l(t,e);var i=t.prototype;return i.config=function(){return{type:"wide",cols:[{rows:[{view:"tabbar",id:"tabs",multiview:!0,close:!0,options:[{id:"t1",value:"ОСВ",hidden:!1,close:!1}],optionWidth:180},{view:"multiview",id:"views",cells:[{id:"t1",rows:[{height:50,css:{"padding-left":150},template:"<h2>Отчеты</h2>",borderless:!1},{view:"toolbar",height:40,paddingY:2,cols:[{view:"menu",data:[{id:"2",value:"Экспорт",submenu:[{id:"3",value:"Excel"},{value:"Csv"},{value:"Pdf"}]}],type:{subsign:!0},on:{onMenuItemClick:function(e){3==e&&webix.toExcel("table-register",{spans:!0,styles:!0})}}},{view:"datepicker",localId:"dateFrom",name:"date_from",align:"left",width:120,value:webix.Date.monthStart(new Date)},{view:"label",label:"по",align:"left",width:30},{view:"datepicker",localId:"dateTo",name:"date_to",align:"left",width:120,value:new Date},{},{label:"",view:"search",width:300,align:"right"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("table-register")}}]},{height:70,template:"<h2>Оборотно-сальдовая ведомость</h2>",align:"center,middle"},{rows:[c(""),{align:"bottom"}]}]}]}]}]}},i.init=function(e,t){var i=this.state;i.scope=this,i.table=this.$$("table-register"),i.tabbar=this.$$("tabbar"),i.tableUrl=this.app.config.apiRest.getUrl("get","accounting/register/turnover-period");var o=webix.Date.dateToStr("%Y-%m-%d"),a=this.$$("dateFrom"),n=this.$$("dateTo"),l={dateFrom:o(a.getValue()),dateTo:o(n.getValue())};webix.ajax().get(i.tableUrl,l).then((function(e){i.table.clearAll(),i.table.parse(e.json().data)})),r.a.t1=s(c("","t1"),i.scope,"t1"),$$("top:menu").getItem("t1")&&$$("top:menu").remove("t1"),this.attachTableEvents()},i.attachTableEvents=function(){var e=this.state,t=webix.Date.dateToStr("%Y-%m-%d"),i=this.$$("dateFrom"),o=this.$$("dateTo"),a=t(i.getValue()),n=t(o.getValue());e.scope=this;var l={};e.table.attachEvent("onItemDblClick",(function(t){l=e.table.getSelectedItem(),webix.ajax().get(e.tableUrl,{dateFrom:a,dateTo:n,account:l.account,account_type:l.account_type}).then((function(t){var i="report"+l.account_id+(l.account_type||0);e.tableId=i,r.a[i]||(r.a[i]=s(c(t,e.tableId),e.scope,i),$$("views").addView({id:i,rows:[r.a[i]]}),$$("tabs").addOption(i,l.account,!0)),console.log(e.scope.$$("table-register"+e.tableId))}))})),$$("tabs").attachEvent("onOptionRemove",(function(e,t){$$("views").removeView(e),delete r.a[e],$$("top:menu").remove(e)}))},t}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.config=function(){var e=this,t=this.app.getService("locale");return{type:"clean",rows:[{type:"header",template:"Настройки"},{type:"form",rows:[{view:"segmented",localId:"lang",label:(0,t._)("AppsLanguage"),labelWidth:200,options:[{id:"en",value:"English"},{id:"de",value:"Deutsche"},{id:"ru",value:"Русский"}],optionWidth:100,click:function(){var i=e.$$("lang").getValue();t.setLang(i)},value:t.getLang()}]},{template:"Выберите язык"}]}},o}(i(0).b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0);var a=webix.Date.dateToStr("%d.%m.%y"),r=webix.Date.dateToStr("%H.%i"),n=function(e){var t,i;function n(){return e.apply(this,arguments)||this}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var l=n.prototype;return l.config=function(){var e=this,t=(this.app.getService("locale")._,{view:"button",label:"Выход",width:120,click:function(){return e.show("/logout")}}),i=this,o={view:"toolbar",css:"webix_dark",localId:"toolbar",elements:[{view:"icon",icon:"mdi mdi-menu",click:function(e,t,o){i.$$("top:menu").toggle()}},{view:"label",label:"ФинПлан"},{width:380,cols:[{view:"label",localId:"totalAccountsLabel",label:"",itemClick:this.doClickBalance}]},t,{view:"icon",icon:"widget_icon wxi-drag",localId:"commentLabel",popup:"commentPopup"}]},a={view:"sidebar",localId:"shop:menu",id:"shop:menu",css:"webix_sidebar webix_dark",select:!0,collapsed:!0,multipleOpen:!0,data:[]},r=webix.storage.local.get("wjet_permission");return a.data=r||{},a.data.push({value:"Настройки",id:"settings",icon:"mdi mdi-tools"}),a.data.push({value:"Открытые отчеты",id:"info",icon:"mdi mdi-folder-open",data:[]}),a.data.push({value:"Открытые отчеты1",id:"store.product",icon:"mdi mdi-folder-open"}),{rows:[o,{cols:[a,{$subview:!0}]}]}},l.init=function(){this.use(o.c.Menu,"shop:menu");var e,t=this;this.app.config.apiRest.getUrl("get","accounting/transaction/summaryaccount"),webix.storage.local.get("wjet_user").user_id;e={view:"popup",width:500,id:"commentPopup",body:{rows:[{view:"list",localId:"commentList",type:{height:67,template:function(e){return a(e.time_comment)+" "+r(e.time_comment)+" "+e.user_name+"<br/>№"+e.order_no+" - "+e.comment}},on:{onItemClick:function(e,i,o){var a=t.app.config.apiRest.getUrl("get","accounting/comment/comment-view-ok",{id:e});this.getParentView().hide(),webix.ajax().get(a).then((function(e){t.setComments(e.json())}))}}},{view:"menu",data:[{value:"Показать все",href:"#!/top/comment"}]}]}},this.winComment=this.ui(e);var i=this.app.config.apiRest.getUrl("get","accounting/comment/comment-view");webix.ajax().get(i).then((function(e){t.setComments(e.json())})),this.$$("totalAccountsLabel").attachEvent("onItemClick",(function(e,t){}))},l.setComments=function(e){var t=this.$$("commentLabel"),i=$$("commentPopup").queryView("list");e.total>0?t.config.badge=e.total:t.config.badge="",i.clearAll(),i.parse(e),t.refresh()},l.setTotalAccounts=function(e){var t=this.$$("totalAccountsLabel");t.setValue(e.total),e.total>=0?t.define("color","white"):t.define("color","red"),t.refresh()},l.doClickBalance=function(e,t){var i=this;this.win||(this.win=webix.ui({view:"window",modal:!0,head:{cols:[{template:"Остатки на счетах",type:"header",borderless:!0},{view:"icon",icon:"mdi mdi-fullscreen",tooltip:"enable fullscreen mode",click:function(){i.win.config.fullscreen?(webix.fullscreen.exit(),this.define({icon:"mdi mdi-fullscreen",tooltip:"Enable fullscreen mode"})):(webix.fullscreen.set(i.win),this.define({icon:"mdi mdi-fullscreen-exit",tooltip:"Disable fullscreen mode"})),this.refresh()}},{view:"icon",icon:"wxi-close",tooltip:"Close window",click:function(){i.win.hide()}}]},localId:"win2",height:550,width:500,position:"center",body:{rows:[{view:"datatable",scrollX:!1,hover:"myhover",scheme:{$sort:{by:"name",dir:"asc"}},columns:[{id:"name",header:"Счета",fillspace:!0},{id:"balance",header:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"},format:webix.Number.format,adjust:!1}],url:"api->accounting/transaction/summaryaccount"}]}})),this.win.isVisible()?this.win.hide():this.win.show()},n}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));var o=i(0),a=(i(2),i(4),i(3),i(8));webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--){if(1==t[o].$level)""!=e(t[o])&&(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||""!=e[i.columnId]&&(o+=1)})),o=webix.i18n.numberFormat(o,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(o=i.format(o)),i.template&&(o=i.template({value:o})),t.style.textAlign="right",t.innerHTML=o}},webix.ui.datafilter.summColumn),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",timepicker:!0,icons:!0}},text:{view:"popup",body:{view:"textarea",width:250,height:100}}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var r=webix.Date.dateToStr("%d.%m.%y"),n=webix.Date.dateToStr("%d.%m.%y %H:%i"),l=webix.Date.strToDate("%Y-%m-%d"),s=(webix.Date.strToDate("%Y-%m-%d %H:%i"),webix.Date.strToDate("%d.%m.%y"),function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s=o.prototype;return s.config=function(){var e=this,t=this;this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"01.12.20"}}'});return{rows:[{cols:[{view:"label",width:200,height:30,template:"План (общий)",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return e.doClickPrint()}},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{view:"toggle",type:"icon",icon:"mdi mdi-calendar",localId:"toggleTime",autowidth:!0,value:!0,click:function(){t.doTimeToggle()}},{view:"icon",icon:"mdi mdi-update",autowidth:!0,value:!0,click:function(){location.reload(!0)}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(e){t.showBatch(e)}}},{view:"icon",icon:"mdi mdi-tools",autowidth:!0,popup:{view:"contextmenu",scroll:"y",width:200,height:550,autoheight:!1,localId:"columns-setting",data:[{value:"Profile",href:"#profile"},{value:"Settings",href:"#settings"},{value:"Dummy"},{id:"logout",value:"Logout"}],$init:function(){t.loadColumnsSetting(this,null)},on:{onMenuItemClick:function(e){t.columnSettingClick(this,e)}}}}]},{view:"treetable",urlEdit:"order",css:"webix_header_border webix_data_border",leftSplit:3,select:"cell",resizeColumn:{headerOnly:!0},localId:"start-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",dragColumn:!0,sort:"multi",headermenu:!0,tooltip:!0,clipboard:"selection",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:180,tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+e.value:e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"action-view",header:"",width:50,template:function(e,t){return e.$group?"":t.editIcon()}},{id:"AE",header:"Дата Гот.",width:120,editor:"date",template:function(e,t){return r(e.date_obivka)}},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text"},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text"},{id:"G",width:100,header:["Сумма план",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text"},{id:"V",header:["Сумма факт",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500}},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,editor:"text"},{id:"H",header:["Дата кл.",{content:"textFilter"},""],width:70,editor:"text"},{id:"AA",header:["К.об.план",{content:"textFilter"},{content:"totalColumn"}],width:80,css:{"text-align":"right","font-weight":500},batch:1},{id:"AB",header:["К.об.факт",{content:"textFilter"},{content:"totalColumn"}],width:80,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"W",header:["Об.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-marker-check"></i><span style="display:none;">1</span>':null===e.W?"":e.W}},{id:"CH",header:["К.шв.план",{content:"textFilter"},{content:"totalColumn"}],width:80,css:{"text-align":"right","font-weight":500},batch:1},{id:"coef_sewing",header:["К.шв.факт",{content:"textFilter"},{content:"totalColumn"}],width:80,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"BP",header:["Шв.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check-circle"></i><span style="display:none;">1</span>':null===e.BP?"":e.BP}},{id:"M",header:["Ст.ткани",{content:"selectFilter"},""],width:70,editor:"text"},{id:"K",header:["Дата ткани",{content:"textFilter"},""],width:90,editor:"text"},{id:"CI",header:["К.кр.план",{content:"textFilter"},{content:"totalColumn"}],width:85,css:{"text-align":"right","font-weight":500},batch:1},{id:"coef_cut",header:["К.кр.факт",{content:"textFilter"},{content:"totalColumn"}],width:90,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"BW",header:["Крой",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.BW?'<i class="mdi mdi-check-circle"></i><span style="display:none;">1</span>':null===e.BW?"":e.BW}},{id:"AG",header:["К.ст.план",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1},{id:"coef_carpenter",header:["К.ст.факт",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check-circle"></i><span style="display:none;">1</span>':null===e.BA?"":e.BA}},{id:"CF",header:["Уп.",{content:"numberFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.CF?'<i class="mdi mdi-check-circle"></i><span style="display:none;">1</span>':null===e.CF?"":e.CF}},{id:"date_shipment",header:["Дата отгр.",{content:"selectFilter"},""],width:100,editor:"date",hidden:!1,template:function(e){return r(l(e.date_shipment))}},{id:"B",header:["Отгр.",{content:"selectFilter"},""],width:70,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":4==e.B?'<i class="mdi mdi-check-circle"></i><span style="display:none;">отг.</span>':null===e.B?"":e.B}},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,css:{"text-align":"center"},batch:1,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,template:function(e){return r(l(e.date_obivka))}},{id:"date_sewing",header:["Дата Шв.",{content:"selectFilter"},""],width:80,editor:"date",format:webix.Date.dateToStr("%d.%m.%y"),batch:1},{id:"date_cut",header:["Дата Крой",{content:"selectFilter"},""],width:100,editor:"date",batch:1,hidden:!1,template:function(e){return r(l(e.date_cut))}},{id:"date_carpenter",header:["Дата Ст.",{content:"selectFilter"},""],width:90,batch:1,editor:"date",format:webix.Date.dateToStr("%d.%m.%y")},{id:"CG",header:["Дата Уп",{content:"selectFilter"},""],width:100,editor:"date",batch:1,hidden:!1},{id:"coefMoney",header:["К.ден.план",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1,template:function(e){var t=parseFloat(e.G.replace(",",""));return e.$group?webix.Number.format(t/7860,{decimalDelimiter:".",decimalSize:2}):webix.Number.format(parseFloat(t/7860),{decimalDelimiter:",",decimalSize:2})}},{id:"AO",header:["К.ден.факт",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"Z",header:["Обивщик ФИО",{content:"selectFilter"},""],width:100,editor:"text"},{id:"BO",header:["Пошив ФИО",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},{id:"BV",header:["Крой ФИО",{content:"selectFilter"},""],width:115,editor:"text"},{id:"AZ",header:["Столярка ФИО",{content:"selectFilter"},""],width:115,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:function(e){return r(e.date_obivka)},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],coef_cut:["coef_cut","median"],coef_carpenter:["coef_carpenter","median"],CH:["CH","median"],CI:["CI","median"],value:[function(e){return r(e.date_obivka)}],A:["A"]}},$sort:{by:"AE",dir:"asc",as:"date"},$init:function(e){if("заказано"==e.M&&(e.$css="highlight",e.K)){var t=webix.Date.dateToStr("%y"),i=webix.Date.strToDate("%d.%m.%y");t(new Date);l(e.K)>i(e.AE)&&(e.$css="highlight-red")}if(e.date_client){var o=webix.Date.dateToStr("%d"),a=webix.Date.dateToStr("%m"),r=webix.Date.strToDate("%d.%m.%y")(e.AE),n=o(e.date_client),s=o(r),c=a(e.date_client),d=a(r);n-s<3&&c==d&&(e.$css="highlight-bold")}}},ready:function(){t.configColumns=JSON.parse(JSON.stringify(this.config.columns));var e=webix.storage.local.get("start-table");e&&this.setState(e)},scroll:!0,on:{onColumnResize:function(){webix.storage.local.put("start-table",this.getState())},onAfterColumnDrop:function(){webix.storage.local.put("start-table",this.getState())},onAfterColumnShow:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)},onItemClick:function(e,t,i){"action-view"==e.column&&this.$scope.formEdit.showWindow({},this)}}}]}},s.init=function(e){var t=this.$$("start-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),r=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),l=i(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest,webix.extend(t,webix.ProgressBar);var s=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+l+'"}}'}),c=this;this.restApi.getLoad(s).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),l=i(r.getValue());var a=c.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+l+'"}}'});c.restApi.getLoad(a).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),r.attachEvent("onChange",(function(e){n=i(o.getValue()),l=i(r.getValue());var a=c.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+l+'"}}'});c.restApi.getLoad(a).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),this.formEdit=this.ui(a.default)},s.doTimeToggle=function(){var e=this.$$("toggleTime"),t=this.$$("start-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=(this.$$("dateFrom"),this.$$("dateTo"),i(this.$$("dateFrom").getValue())),a=i(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest,webix.extend(t,webix.ProgressBar);var l=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+o+'","<=":"'+a+'"}}'});this.restApi.getLoad(l).then((function(i){t.clearAll(),t.parse(i.json().items),e.getValue()?t.group({by:function(e){return r(e.date_obivka)},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],coef_cut:["coef_cut","median"],coef_carpenter:["coef_carpenter","median"],CH:["CH","median"],CI:["CI","median"],value:[function(e){return r(e.date_obivka)}],A:["A"]}}):t.group({by:function(e){return n(e.date_obivka)},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],coef_cut:["coef_cut","median"],coef_carpenter:["coef_carpenter","median"],CH:["CH","median"],CI:["CI","median"],value:[function(e){return n(e.date_obivka)}],A:["A"]}})}))},s.doRefresh=function(){var e=this.$$("start-table"),t=webix.Date.dateToStr("%d.%m.%y"),i=t(this.$$("dateFrom").getValue()),o=t(this.$$("dateTo").getValue()),a=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+i+'","<=":"'+o+'"}}'});e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(a).then((function(t){e.clearAll(),e.parse(t.json().items),e.enable()}))},s.doClickOpenAll=function(){var e=this.$$("start-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},s.showBatch=function(e){this.$$("start-table").showColumnBatch(e)},s.beforeDropChangeData=function(e,t){var i={AE:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_obivka=t,e.AE=r(t),webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},s.loadColumnsSetting=function(e,t){var i,o=this,a=[];this.configColumns.forEach((function(r,n){i="wxi-eye-slash",o.$$("start-table").isColumnVisible(r.id)&&(i="wxi-eye"),r.id==t&&(e.data[n].icon="webix_icon webix_list_icon "+i,e.updatItem(t)),a.push({value:r.header[0].text,id:r.id,icon:"webix_icon webix_list_icon "+i})})),e.data=a},s.columnSettingClick=function(e,t){var i="webix_icon webix_list_icon wxi-eye",o=i,a=this.$$("start-table");a.isColumnVisible(t)?a.hideColumn(t,{spans:!1}):a.showColumn(t,{spans:!1}),e.getItem(t).icon==i&&(o="webix_icon webix_list_icon wxi-eye-slash"),e.getItem(t).icon=o,e.updateItem(t),webix.storage.local.put("start-table",a.getState())},s.doClickPrint=function(){var e=this.$$("start-table");webix.print(e,{fit:"data"})},s.doClickToExcel=function(){var e=this.$$("start-table");webix.toExcel(e)},o}(o.b))},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function r(){return e.apply(this,arguments)||this}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=r.prototype;return n.config=function(){var e=this;this.use(o.c.UrlParam,["id"]);var t=this.getParam("id");return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Товар: Экспорт в Битрикс",width:350},{},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"treetable",localId:"product-variant-speed-table",urlEdit:"products/product-variant-speed",urlEditFull:!0,css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},rowHeight:60,columns:[{id:"url",header:["Символьный код",{content:"selectFilter"},""],width:180,sort:"string"},{id:"url_category",header:["Символьный код (категории)",{content:"selectFilter"},""],width:100,sort:"string"},{id:"name",header:["Наименование",{content:"selectFilter"},""],width:220,sort:"string"},{id:"offer_name",header:["Наименование (ТП)",{content:"selectFilter"},""],width:280,sort:"string"},{id:"offer_code",header:["Код элемента (ТП)",{content:"selectFilter"},""],width:70,sort:"string"},{id:"offer_property_1",header:["Спальное место",{content:"selectFilter"},""],width:70,sort:"string"},{id:"offer_property_2",header:["Цвет",{content:"selectFilter"},""],width:50,sort:"string"},{id:"offer_property_3",header:["Ткань",{content:"selectFilter"},""],width:90,sort:"string"},{id:"offer_price_opt",header:["Закупочная цена",{content:"selectFilter"},""],width:90,sort:"string"},{id:"offer_price",header:["Розничная цена",{content:"selectFilter"},""],width:70,sort:"string"},{id:"offer_price_discount",header:["Цена со скидкой",{content:"selectFilter"},""],width:70,sort:"string"},{id:"offer_discount",header:["Cкидка",{content:"selectFilter"},""],width:70,sort:"string"},{id:"offer_picture_anons",header:["ТП картинка для анонса",{content:"selectFilter"},""],width:90,sort:"string"},{id:"offer_picture_details",header:["ТП картинка детальная",{content:"selectFilter"},""],width:90,sort:"string"},{id:"offer_pictures",header:["ТП картинки",{content:"selectFilter"},""],width:90,sort:"string"},{id:"is_active",header:["Активность",{content:"selectFilter"},""],width:70,sort:"string"},{id:"picture_anons",header:["Картинка для анонса",{content:"selectFilter"},""],width:90,sort:"string"},{id:"picture_details",header:["Картинка детальная",{content:"selectFilter"},""],width:90,sort:"string"},{id:"pictures",header:["Картинки",{content:"selectFilter"},""],width:90,sort:"string"},{id:"id_model",header:["Код",{content:"selectFilter"},""],width:50,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","products/product-variant-speed/export-bitrix",{expand:"data,categories","per-page":-1,id:t}),scheme:{},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("product-variant-speed-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","product-variant-speeds"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("product-variant-speed-table").unselect(),this.cashEdit.showForm(this.$$("product-variant-speed-table"))},n.doClickToExcel=function(){var e=this.$$("product-variant-speed-table");webix.toExcel(e)},r}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(1);i(2),i(4),i(3);var r=function(e){var t,i;function r(){return e.apply(this,arguments)||this}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=r.prototype;return n.config=function(){var e=this;this.use(o.c.UrlParam,["id"]);var t=this.getParam("id");return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Товар: Экспорт в Битрикс",width:350},{},{view:"icon",icon:"mdi mdi-microsoft-excel",autowidth:!0,click:function(){return e.doClickToExcel()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"treetable",localId:"export-cloth-table",urlEdit:"products/export-cloth",urlEditFull:!0,css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},rowHeight:60,columns:[{id:"full_name",header:["Наименование",{content:"selectFilter"},""],width:280,sort:"string"},{id:"name",header:["Коллекция",{content:"selectFilter"},""],width:70,sort:"string"},{id:"color_real",header:["Цвет",{content:"selectFilter"},""],width:70,sort:"string"},{id:"order_sort",header:["Сорт.",{content:"selectFilter"},""],width:50,sort:"string"},{id:"id",header:["Внешний Код",{content:"selectFilter"},""],width:90,sort:"string"},{id:"param_link",header:["Ссылка",{content:"selectFilter"},""],width:90,sort:"string"},{id:"description",header:["Описание",{content:"selectFilter"},""],width:70,sort:"string"},{id:"param_description",header:["Полное описание",{content:"selectFilter"},""],width:70,sort:"string"},{id:"category",header:["Категория",{content:"selectFilter"},""],width:70,sort:"string"},{id:"pictures",header:["Картинка",{content:"selectFilter"},""],width:70,sort:"string"},{id:"provider",header:["Производитель",{content:"selectFilter"},""],width:70,sort:"string"},{id:"param_type",header:["Тип ткани",{content:"selectFilter"},""],width:70,sort:"string"},{id:"param_structure",header:["Состав",{content:"selectFilter"},""],width:70,sort:"string"},{id:"param_test",header:["Тест",{content:"selectFilter"},""],width:70,sort:"string"},{id:"param_weight",header:["Вес",{content:"selectFilter"},""],width:70,sort:"string"},{id:"param_permeation",header:["Пропитка",{content:"selectFilter"},""],width:70,sort:"string"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","products/product-variant-speed/export-cloth-bitrix",{expand:"data,categories","per-page":-1,id:t}),scheme:{},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("export-cloth-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","products/product-variant-speed/export-cloth-bitrix"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("export-cloth-table").unselect(),this.cashEdit.showForm(this.$$("export-cloth-table"))},n.doClickToExcel=function(){var e=this.$$("export-cloth-table");webix.toExcel(e)},r}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(9);webix.Date.dateToStr("%d.%m.%y");var r=webix.Date.dateToStr("%d.%m.%y %H:%i"),n=(webix.Date.dateToStr("%H.%i"),function(e){var t,i;function n(){return e.apply(this,arguments)||this}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var l=n.prototype;return l.config=function(){var e=this,t=(this.app.getService("locale")._,[{view:"label",label:webix.storage.local.get("wjet_user").user,width:180,css:{"font-weight":"normal"}},{view:"button",label:"Выход",width:120,click:function(){return e.show("/logout")}}]),i=this;return{rows:[{view:"toolbar",css:"webix_dark",localId:"toolbar",elements:[{view:"icon",icon:"mdi mdi-menu",click:function(e,t,o){i.$$("top:menu").toggle()}},{view:"label",label:"ФинПлан "+webix.storage.local.get("finplan_version")},{width:380,cols:[{view:"label",localId:"totalAccountsLabel",label:"",itemClick:this.doClickBalance}]},{cols:t},{view:"icon",icon:"widget_icon wxi-drag",localId:"commentLabel",popup:"commentPopup"}]},{cols:[{view:"sidebar",localId:"top:menu",id:"top:menu",css:"webix_sidebar webix_dark",select:!0,collapsed:!0,multipleOpen:!0,data:[]},{$subview:!0}]}]}},l.init=function(){this.use(o.c.Menu,"top:menu");var e=this,t=(this.app.config.apiRest.getUrl("get","accounting/transaction/summaryaccount"),this.app.config.apiRest.getUrl("get","users/is-logged-token"));webix.ajax().get(t).then((function(t){var i=t.json();webix.storage.local.put("wjet_permission",i.user.permissions_finplan),e.$$("top:menu").define("data",i.user.permissions_finplan)}));webix.storage.local.get("wjet_user").user_id;var i={},n=this.app.getService("user").getUser(),l=webix.firebase.ref("accounting/comment").orderByChild("users_view/"+n.user_id).equalTo(null).limitToLast(50);if(webix.proxy.firebase.params={orderByChild:"users_view/"+n.user_id,equalTo:null,limitToLast:50},webix.proxy.firestore.params={orderBy:{field:"createdAt",direction:"desc"},where:{field:"isMessageRead",operator:"==",value:!1},limit:50},""!=n.firebase_uid){i={view:"popup",width:500,id:"commentPopup",body:{rows:[{view:"list",localId:"commentList",type:{height:67,template:function(e){return r(new Date(e.createdAt))+" "+e.finPlanUserName+"<br/>№"+e.finPlanOrderNo+" - "+e.message}},url:webix.proxy("firestore","messages/"+n.firebase_uid+"/Jgy8bWLyxQWUX81tL7Pb"),on:{onAfterAdd:function(t,i){e.setCommentsFireBase(this.count())},onAfterLoad:function(t,i){e.setCommentsFireBase(this.count())},onAfterDelete:function(t,i){e.setCommentsFireBase(this.count())},onSelectChange:function(){e.setCommentsFireBase(this.count())},onItemClick:function(t,i,o){var a=this.getItem(t);this.getParentView().hide(),webix.firestore.collection("messages").doc(n.firebase_uid).collection("Jgy8bWLyxQWUX81tL7Pb").doc(t).set({isMessageRead:!0}),e.setComments(a,-1)}}},{height:30,cols:[{view:"button",label:"Показать все",hidden:0!=n.type&&10!=n.type,css:"webix_primary",click:function(){e.formComment.showForm(this),e.winComment.hide()}},{},{}]}]}},this.winComment=this.ui(i);$$("commentPopup").queryView("list")}else i={view:"popup",id:"commentPopup",body:{}},this.winComment=this.ui(i);0!=n.type&&10!=n.type||(l.on("child_added",(function(e){e.val().uid=e.key})),this.$$("totalAccountsLabel").attachEvent("onItemClick",(function(e,t){}))),this.formComment=this.ui(a.default)},l.setCommentsFireBase=function(e){var t=this.$$("commentLabel");t.config.badge=0==e?"":e,t.refresh()},l.setComments=function(e,t){var i=this.$$("commentLabel"),o=($$("commentPopup").queryView("list"),i.config.badge?1*parseInt(i.config.badge)+t:1);i.config.badge=e?0==o?"":o:"",i.refresh()},l.setTotalAccounts=function(e){var t=this.$$("totalAccountsLabel");t.setValue(e.total),e.total>=0?t.define("color","white"):t.define("color","red"),t.refresh()},l.doClickBalance=function(e,t){var i=this;this.win||(this.win=webix.ui({view:"window",modal:!0,head:{cols:[{template:"Остатки на счетах",type:"header",borderless:!0},{view:"icon",icon:"mdi mdi-fullscreen",tooltip:"enable fullscreen mode",click:function(){i.win.config.fullscreen?(webix.fullscreen.exit(),this.define({icon:"mdi mdi-fullscreen",tooltip:"Enable fullscreen mode"})):(webix.fullscreen.set(i.win),this.define({icon:"mdi mdi-fullscreen-exit",tooltip:"Disable fullscreen mode"})),this.refresh()}},{view:"icon",icon:"wxi-close",tooltip:"Close window",click:function(){i.win.hide()}}]},localId:"win2",height:550,width:500,position:"center",body:{rows:[{view:"datatable",scrollX:!1,hover:"myhover",scheme:{$sort:{by:"name",dir:"asc"}},columns:[{id:"name",header:"Счета",fillspace:!0},{id:"balance",header:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"},format:webix.Number.format,adjust:!1}],url:"api->accounting/transaction/summaryaccount"}]}})),this.win.isVisible()?this.win.hide():this.win.show()},n}(o.b))},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.config=function(){},o}(JetView)},function(e,t,i){"use strict";i.r(t),t.default={AppsLanguage:"Anwendungssprache"}},function(e,t,i){"use strict";i.r(t),t.default={AppsLanguage:"Application's language"}},function(e,t,i){"use strict";i.r(t),t.default={AppsLanguage:"Язык"}},function(e,t,i){var o=i(122);e.exports=(o.default||o).template({1:function(e,t,i,o,a){var r,n=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<li>"+s("function"==typeof(r=null!=(r=c(i,"title")||(null!=t?c(t,"title"):t))?r:l)?r.call(n,{name:"title",hash:{},data:a,loc:{start:{line:7,column:4},end:{line:7,column:13}}}):r)+", "+s("function"==typeof(r=null!=(r=c(i,"year")||(null!=t?c(t,"year"):t))?r:l)?r.call(n,{name:"year",hash:{},data:a,loc:{start:{line:7,column:15},end:{line:7,column:23}}}):r)+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,a){var r,n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"You can use handlebar templates for a plain HTML content \n\nhttps://handlebarsjs.com\n\n<h3>Records</h3>\n"+(null!=(r=n(i,"each").call(null!=t?t:e.nullContext||{},null!=t?n(t,"record"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:6,column:0},end:{line:8,column:9}}}))?r:"")},useData:!0})},function(e,t,i){var o={"./account-directory":22,"./account-directory/":22,"./account-directory/index":22,"./account-directory/index.js":22,"./admin":23,"./admin/":23,"./admin/index":23,"./admin/index.js":23,"./admin/kanban":95,"./admin/kanban.js":95,"./admin/management-table":24,"./admin/management-table/":24,"./admin/management-table/index":24,"./admin/management-table/index.js":24,"./admin/pro":96,"./admin/pro.js":96,"./client/order":25,"./client/order/":25,"./client/order/index":25,"./client/order/index.js":25,"./cloth-directory":11,"./cloth-directory/":11,"./cloth-directory/index":11,"./cloth-directory/index.js":11,"./comment":9,"./comment/":9,"./comment/index":9,"./comment/index.js":9,"./contragent-product-bed":26,"./contragent-product-bed/":26,"./contragent-product-bed/index":26,"./contragent-product-bed/index.js":26,"./contragents-directory":27,"./contragents-directory/":27,"./contragents-directory/index":27,"./contragents-directory/index.js":27,"./data":97,"./data.js":97,"./department-directory":28,"./department-directory/":28,"./department-directory/index":28,"./department-directory/index.js":28,"./directory":29,"./directory-type":30,"./directory-type/":30,"./directory-type/index":30,"./directory-type/index.js":30,"./directory/":29,"./directory/index":29,"./directory/index.js":29,"./document-salary-accrual":15,"./document-salary-accrual/":15,"./document-salary-accrual/index":15,"./document-salary-accrual/index.js":15,"./document-salary-accrual/table":92,"./document-salary-accrual/table.js":92,"./employee-details":31,"./employee-details/":31,"./employee-details/employee-month-hours":81,"./employee-details/employee-month-hours.js":81,"./employee-details/index":31,"./employee-details/index.js":31,"./employee-directory":32,"./employee-directory/":32,"./employee-directory/index":32,"./employee-directory/index.js":32,"./employee-salary":33,"./employee-salary-month":34,"./employee-salary-month/":34,"./employee-salary-month/index":34,"./employee-salary-month/index.js":34,"./employee-salary-type-directory":35,"./employee-salary-type-directory/":35,"./employee-salary-type-directory/index":35,"./employee-salary-type-directory/index.js":35,"./employee-salary/":33,"./employee-salary/index":33,"./employee-salary/index.js":33,"./firebase":36,"./firebase/":36,"./firebase/index":36,"./firebase/index.js":36,"./home":98,"./home.js":98,"./info":99,"./info.js":99,"./inproduce":82,"./inproduce.js":82,"./inproduce_old":105,"./inproduce_old.js":105,"./list-salary-accrual":38,"./list-salary-accrual/":38,"./list-salary-accrual/edit":83,"./list-salary-accrual/edit.js":83,"./list-salary-accrual/index":38,"./list-salary-accrual/index.js":38,"./login":106,"./login.js":106,"./main":107,"./main.js":107,"./order":39,"./order-calculation-directory":40,"./order-calculation-directory/":40,"./order-calculation-directory/index":40,"./order-calculation-directory/index.js":40,"./order-calculation-field":41,"./order-calculation-field/":41,"./order-calculation-field/index":41,"./order-calculation-field/index.js":41,"./order-calculation-rule":42,"./order-calculation-rule/":42,"./order-calculation-rule/edit":84,"./order-calculation-rule/edit.js":84,"./order-calculation-rule/index":42,"./order-calculation-rule/index.js":42,"./order-carpenter":43,"./order-carpenter/":43,"./order-carpenter/index":43,"./order-carpenter/index.js":43,"./order-change-log":44,"./order-change-log/":44,"./order-change-log/index":44,"./order-change-log/index.js":44,"./order-cut":45,"./order-cut/":45,"./order-cut/index":45,"./order-cut/index.js":45,"./order-gant":46,"./order-gant/":46,"./order-gant/index":46,"./order-gant/index.js":46,"./order-gantt-plan":47,"./order-gantt-plan/":47,"./order-gantt-plan/index":47,"./order-gantt-plan/index.js":47,"./order-payment":48,"./order-payment/":48,"./order-payment/index":48,"./order-payment/index.js":48,"./order-result":49,"./order-result/":49,"./order-result/index":49,"./order-result/index.js":49,"./order-sewing":50,"./order-sewing-cut":51,"./order-sewing-cut/":51,"./order-sewing-cut/index":51,"./order-sewing-cut/index.js":51,"./order-sewing/":50,"./order-sewing/index":50,"./order-sewing/index.js":50,"./order-sewing/power-form":85,"./order-sewing/power-form.js":85,"./order-shipment":52,"./order-shipment/":52,"./order-shipment/index":52,"./order-shipment/index.js":52,"./order-upholstery":53,"./order-upholstery/":53,"./order-upholstery/index":53,"./order-upholstery/index.js":53,"./order-work-status-directory":54,"./order-work-status-directory/":54,"./order-work-status-directory/index":54,"./order-work-status-directory/index.js":54,"./order/":39,"./order/check-work":8,"./order/check-work.js":8,"./order/index":39,"./order/index.js":39,"./package-directory":55,"./package-directory/":55,"./package-directory/index":55,"./package-directory/index.js":55,"./plan":56,"./plan/":56,"./plan/index":56,"./plan/index.js":56,"./product-bed-size-directory":57,"./product-bed-size-directory/":57,"./product-bed-size-directory/index":57,"./product-bed-size-directory/index.js":57,"./product-bed-type-directory":58,"./product-bed-type-directory/":58,"./product-bed-type-directory/index":58,"./product-bed-type-directory/index.js":58,"./product-work-salary":14,"./product-work-salary/":14,"./product-work-salary/index":14,"./product-work-salary/index.js":14,"./products-bed":59,"./products-bed/":59,"./products-bed/index":59,"./products-bed/index.js":59,"./realtime":108,"./realtime.js":108,"./register":60,"./register/":60,"./register/index":60,"./register/index.js":60,"./report":61,"./report-balance":62,"./report-balance/":62,"./report-balance/index":62,"./report-balance/index.js":62,"./report-cash-flow":63,"./report-cash-flow-chart":64,"./report-cash-flow-chart/":64,"./report-cash-flow-chart/index":64,"./report-cash-flow-chart/index.js":64,"./report-cash-flow/":63,"./report-cash-flow/index":63,"./report-cash-flow/index.js":63,"./report-salary":65,"./report-salary-total":66,"./report-salary-total/":66,"./report-salary-total/index":66,"./report-salary-total/index.js":66,"./report-salary/":65,"./report-salary/index":65,"./report-salary/index.js":65,"./report-turnover":67,"./report-turnover/":67,"./report-turnover/index":67,"./report-turnover/index.js":67,"./report/":61,"./report/index":61,"./report/index.js":61,"./report/report-ocv":109,"./report/report-ocv.js":109,"./setting-directory":68,"./setting-directory/":68,"./setting-directory/index":68,"./setting-directory/index.js":68,"./settings":110,"./settings.js":110,"./shop":111,"./shop.js":111,"./start":112,"./start.js":112,"./store/product":69,"./store/product-variant":70,"./store/product-variant/":70,"./store/product-variant/export-bitrix":113,"./store/product-variant/export-bitrix.js":113,"./store/product-variant/export-cloth":114,"./store/product-variant/export-cloth.js":114,"./store/product-variant/index":70,"./store/product-variant/index.js":70,"./store/product/":69,"./store/product/index":69,"./store/product/index.js":69,"./time-work":71,"./time-work-by-day":72,"./time-work-by-day/":72,"./time-work-by-day/index":72,"./time-work-by-day/index.js":72,"./time-work-report":73,"./time-work-report/":73,"./time-work-report/index":73,"./time-work-report/index.js":73,"./time-work/":71,"./time-work/index":71,"./time-work/index.js":71,"./top":115,"./top.js":115,"./transaction":80,"./transaction-category-directory":75,"./transaction-category-directory/":75,"./transaction-category-directory/index":75,"./transaction-category-directory/index.js":75,"./transaction/":80,"./transaction/cashEdit":74,"./transaction/cashEdit.js":74,"./transaction/cashes":86,"./transaction/cashes.js":86,"./transaction/filter":116,"./transaction/filter.js":116,"./transaction/index":80,"./transaction/index.js":80,"./user-directory":76,"./user-directory/":76,"./user-directory/index":76,"./user-directory/index.js":76,"./user-package":77,"./user-package/":77,"./user-package/index":77,"./user-package/index.js":77,"./user-sites-directory":78,"./user-sites-directory/":78,"./user-sites-directory/index":78,"./user-sites-directory/index.js":78,"./work-directory":79,"./work-directory/":79,"./work-directory/index":79,"./work-directory/index.js":79};function a(e){var t=r(e);return i(t)}function r(e){if(!i.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=r,e.exports=a,a.id=121},function(e,t,i){e.exports=i(123).default},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.__esModule=!0;var r=a(i(100)),n=o(i(134)),l=o(i(13)),s=a(i(10)),c=a(i(135)),d=o(i(137));function u(){var e=new r.HandlebarsEnvironment;return s.extend(e,r),e.SafeString=n.default,e.Exception=l.default,e.Utils=s,e.escapeExpression=s.escapeExpression,e.VM=c,e.template=function(t){return c.template(t,e)},e}var h=u();h.create=u,d.default(h),h.default=h,t.default=h,e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0;var o=i(10);t.default=function(e){e.registerHelper("blockHelperMissing",(function(t,i){var a=i.inverse,r=i.fn;if(!0===t)return r(this);if(!1===t||null==t)return a(this);if(o.isArray(t))return t.length>0?(i.ids&&(i.ids=[i.name]),e.helpers.each(t,i)):a(this);if(i.data&&i.ids){var n=o.createFrame(i.data);n.contextPath=o.appendContextPath(i.data.contextPath,i.name),i={data:n}}return r(t,i)}))},e.exports=t.default},function(e,t,i){"use strict";(function(o){t.__esModule=!0;var a,r=i(10),n=i(13),l=(a=n)&&a.__esModule?a:{default:a};t.default=function(e){e.registerHelper("each",(function(e,t){if(!t)throw new l.default("Must pass iterator to #each");var i,a=t.fn,n=t.inverse,s=0,c="",d=void 0,u=void 0;function h(t,i,o){d&&(d.key=t,d.index=i,d.first=0===i,d.last=!!o,u&&(d.contextPath=u+t)),c+=a(e[t],{data:d,blockParams:r.blockParams([e[t],t],[u+t,null])})}if(t.data&&t.ids&&(u=r.appendContextPath(t.data.contextPath,t.ids[0])+"."),r.isFunction(e)&&(e=e.call(this)),t.data&&(d=r.createFrame(t.data)),e&&"object"==typeof e)if(r.isArray(e))for(var p=e.length;s<p;s++)s in e&&h(s,s,s===e.length-1);else if(o.Symbol&&e[o.Symbol.iterator]){for(var m=[],g=e[o.Symbol.iterator](),f=g.next();!f.done;f=g.next())m.push(f.value);for(p=(e=m).length;s<p;s++)h(s,s,s===e.length-1)}else i=void 0,Object.keys(e).forEach((function(e){void 0!==i&&h(i,s-1),i=e,s++})),void 0!==i&&h(i,s-1,!0);return 0===s&&(c=n(this)),c}))},e.exports=t.default}).call(this,i(102))},function(e,t,i){"use strict";t.__esModule=!0;var o,a=i(13),r=(o=a)&&o.__esModule?o:{default:o};t.default=function(e){e.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new r.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0;var o,a=i(10),r=i(13),n=(o=r)&&o.__esModule?o:{default:o};t.default=function(e){e.registerHelper("if",(function(e,t){if(2!=arguments.length)throw new n.default("#if requires exactly one argument");return a.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||a.isEmpty(e)?t.inverse(this):t.fn(this)})),e.registerHelper("unless",(function(t,i){if(2!=arguments.length)throw new n.default("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:i.inverse,inverse:i.fn,hash:i.hash})}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("log",(function(){for(var t=[void 0],i=arguments[arguments.length-1],o=0;o<arguments.length-1;o++)t.push(arguments[o]);var a=1;null!=i.hash.level?a=i.hash.level:i.data&&null!=i.data.level&&(a=i.data.level),t[0]=a,e.log.apply(e,t)}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",(function(e,t,i){return e?i.lookupProperty(e,t):e}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0;var o,a=i(10),r=i(13),n=(o=r)&&o.__esModule?o:{default:o};t.default=function(e){e.registerHelper("with",(function(e,t){if(2!=arguments.length)throw new n.default("#with requires exactly one argument");a.isFunction(e)&&(e=e.call(this));var i=t.fn;if(a.isEmpty(e))return t.inverse(this);var o=t.data;return t.data&&t.ids&&((o=a.createFrame(t.data)).contextPath=a.appendContextPath(t.data.contextPath,t.ids[0])),i(e,{data:o,blockParams:a.blockParams([e],[o&&o.contextPath])})}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.registerDefaultDecorators=function(e){r.default(e)};var o,a=i(132),r=(o=a)&&o.__esModule?o:{default:o}},function(e,t,i){"use strict";t.__esModule=!0;var o=i(10);t.default=function(e){e.registerDecorator("inline",(function(e,t,i,a){var r=e;return t.partials||(t.partials={},r=function(a,r){var n=i.partials;i.partials=o.extend({},n,t.partials);var l=e(a,r);return i.partials=n,l}),t.partials[a.args[0]]=a.fn,r}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.createNewLookupObject=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return o.extend.apply(void 0,[Object.create(null)].concat(t))};var o=i(10)},function(e,t,i){"use strict";function o(e){this.string=e}t.__esModule=!0,o.prototype.toString=o.prototype.toHTML=function(){return""+this.string},t.default=o,e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,i=l.COMPILER_REVISION;if(t>=l.LAST_COMPATIBLE_COMPILER_REVISION&&t<=l.COMPILER_REVISION)return;if(t<l.LAST_COMPATIBLE_COMPILER_REVISION){var o=l.REVISION_CHANGES[i],a=l.REVISION_CHANGES[t];throw new n.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+o+") or downgrade your runtime to an older version ("+a+").")}throw new n.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")},t.template=function(e,t){if(!t)throw new n.default("No environment passed to template");if(!e||!e.main)throw new n.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var i=e.compiler&&7===e.compiler[0];var o={strict:function(e,t,i){if(!(e&&t in e))throw new n.default('"'+t+'" not defined in '+e,{loc:i});return e[t]},lookupProperty:function(e,t){var i=e[t];return null==i||Object.prototype.hasOwnProperty.call(e,t)||d.resultIsAllowed(i,o.protoAccessControl,t)?i:void 0},lookup:function(e,t){for(var i=e.length,a=0;a<i;a++){if(null!=(e[a]&&o.lookupProperty(e[a],t)))return e[a][t]}},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:a.escapeExpression,invokePartial:function(i,o,r){r.hash&&(o=a.extend({},o,r.hash),r.ids&&(r.ids[0]=!0)),i=t.VM.resolvePartial.call(this,i,o,r);var l=a.extend({},r,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),s=t.VM.invokePartial.call(this,i,o,l);if(null==s&&t.compile&&(r.partials[r.name]=t.compile(i,e.compilerOptions,t),s=r.partials[r.name](o,l)),null!=s){if(r.indent){for(var c=s.split("\n"),d=0,u=c.length;d<u&&(c[d]||d+1!==u);d++)c[d]=r.indent+c[d];s=c.join("\n")}return s}throw new n.default("The partial "+r.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var i=e[t];return i.decorator=e[t+"_d"],i},programs:[],program:function(e,t,i,o,a){var r=this.programs[e],n=this.fn(e);return t||a||o||i?r=u(this,e,n,t,i,o,a):r||(r=this.programs[e]=u(this,e,n)),r},data:function(e,t){for(;e&&t--;)e=e._parent;return e},mergeIfNeeded:function(e,t){var i=e||t;return e&&t&&e!==t&&(i=a.extend({},t,e)),i},nullContext:Object.seal({}),noop:t.VM.noop,compilerInfo:e.compiler};function r(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=i.data;r._setup(i),!i.partial&&e.useData&&(a=p(t,a));var n=void 0,l=e.useBlockParams?[]:void 0;function s(t){return""+e.main(o,t,o.helpers,o.partials,a,l,n)}return e.useDepths&&(n=i.depths?t!=i.depths[0]?[t].concat(i.depths):i.depths:[t]),(s=m(e.main,s,o,i.depths||[],a,l))(t,i)}return r.isTop=!0,r._setup=function(r){if(r.partial)o.protoAccessControl=r.protoAccessControl,o.helpers=r.helpers,o.partials=r.partials,o.decorators=r.decorators,o.hooks=r.hooks;else{var n=a.extend({},t.helpers,r.helpers);!function(e,t){Object.keys(e).forEach((function(i){var o=e[i];e[i]=function(e,t){var i=t.lookupProperty;return c.wrapHelper(e,(function(e){return a.extend({lookupProperty:i},e)}))}(o,t)}))}(n,o),o.helpers=n,e.usePartial&&(o.partials=o.mergeIfNeeded(r.partials,t.partials)),(e.usePartial||e.useDecorators)&&(o.decorators=a.extend({},t.decorators,r.decorators)),o.hooks={},o.protoAccessControl=d.createProtoAccessControl(r);var l=r.allowCallsToHelperMissing||i;s.moveHelperToHooks(o,"helperMissing",l),s.moveHelperToHooks(o,"blockHelperMissing",l)}},r._child=function(t,i,a,r){if(e.useBlockParams&&!a)throw new n.default("must pass block params");if(e.useDepths&&!r)throw new n.default("must pass parent depths");return u(o,t,e[t],i,0,a,r)},r},t.wrapProgram=u,t.resolvePartial=function(e,t,i){e?e.call||i.name||(i.name=e,e=i.partials[e]):e="@partial-block"===i.name?i.data["partial-block"]:i.partials[i.name];return e},t.invokePartial=function(e,t,i){var o=i.data&&i.data["partial-block"];i.partial=!0,i.ids&&(i.data.contextPath=i.ids[0]||i.data.contextPath);var r=void 0;i.fn&&i.fn!==h&&function(){i.data=l.createFrame(i.data);var e=i.fn;r=i.data["partial-block"]=function(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return i.data=l.createFrame(i.data),i.data["partial-block"]=o,e(t,i)},e.partials&&(i.partials=a.extend({},i.partials,e.partials))}();void 0===e&&r&&(e=r);if(void 0===e)throw new n.default("The partial "+i.name+" could not be found");if(e instanceof Function)return e(t,i)},t.noop=h;var o,a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(10)),r=i(13),n=(o=r)&&o.__esModule?o:{default:o},l=i(100),s=i(101),c=i(136),d=i(104);function u(e,t,i,o,a,r,n){function l(t){var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],l=n;return!n||t==n[0]||t===e.nullContext&&null===n[0]||(l=[t].concat(n)),i(e,t,e.helpers,e.partials,a.data||o,r&&[a.blockParams].concat(r),l)}return(l=m(i,l,e,n,o,r)).program=t,l.depth=n?n.length:0,l.blockParams=a||0,l}function h(){return""}function p(e,t){return t&&"root"in t||((t=t?l.createFrame(t):{}).root=e),t}function m(e,t,i,o,r,n){if(e.decorator){var l={};t=e.decorator(t,l,i,o&&o[0],r,n,o),a.extend(t,l)}return t}},function(e,t,i){"use strict";t.__esModule=!0,t.wrapHelper=function(e,t){if("function"!=typeof e)return e;return function(){var i=arguments[arguments.length-1];return arguments[arguments.length-1]=t(i),e.apply(this,arguments)}}},function(e,t,i){"use strict";(function(i){t.__esModule=!0,t.default=function(e){var t=void 0!==i?i:window,o=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=o),e}},e.exports=t.default}).call(this,i(102))},function(module,exports){function columnGroupTemplate(e,t,i){return e.$group?t.treetable(e,t)+e.property_value:t.icon(e)+t.folder(e,t)+" "+i}webix.protoUI({name:"table-setting",defaults:{view:"treetable",localId:"table-directory",urlEdit:"",css:"webix_header_border webix_data_border ",leftSplit:1,select:"multiselect",resizeColumn:{headerOnly:!0},multiselect:!0,clipboard:"selection",tooltip:!0,editable:!0,editaction:"dblclick",sort:"multi",drag:!1,dragColumn:!0,math:!0,on:{onAfterColumnDrop:function(){},onItemDblClick:function(e,t,i){var o=this.getItem(e);this.$scope.selectRecord(o),this.$scope.hideWindow(),o.account_id&&(this.$scope.urlParams.account_id&&this.$scope.show("inproduce/register-account-subconto?account_id="+o.account_id+"&subconto1_value="+o.subconto1_value),0==Object.keys(this.$scope.urlParams).length&&this.$scope.show("inproduce/register-account?account_id="+o.account_id+"&schema-table-user-id=196"))},onItemClick:function(e,t,i){if("action-edit"==e.column&&this.$scope.state.table.$scope.formEdit.showForm(this),"action-view"==e.column){var o=this.$scope.table.getColumnConfig(e.column);o.goto?this.$scope.show("inproduce/"+o.goto+"/"+e.row):this.$scope.formView.showWindow({},this)}if("action-delete"==e.column){var a=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(a).save(e.row,"delete").then((function(t){webix.dp(a).ignore((function(){a.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}if("action-comment"==e.column){var r=this.getItem(e);this.$scope.formComment.showForm(this,r.A)}},onBeforeLoad:function(){},onBeforeDrop:function(e,t){var i=this.getItem(e.start),o=this.getItem(e.parent),a=!0;return o||(a=!1),a&&(a=scope.beforeDropChangeData(i,o.value,e)),a||(scope.table.addRowCss(i.id,"highlight-red"),setInterval((function(){scope.table.removeRowCss(i.id,"highlight-red")}),4e3)),a},onSelectChange:function(e,t,i){}},onClick:{"editor-button":function(e,t,i,o){var a=this.getEditState();return this.$scope.windowDirectory.showWindow({},this,a),!1}}},$init:function(){this.getDataTable()},getTable:function(){},getDataTable:function(){var e=this;e.table=this,e.columns=[],webix.extend(e,webix.ProgressBar),e.disable(),e.showProgress({type:"icon",hide:!1}),e.filter={},e.tableUrl=e.$scope.directoryUrl,webix.ajax().get(e.tableUrl,e.filter).then((function(t){e.table.clearAll();var i=t.json(),o=i.data?i.data:i.items;e.dataItem=o,i.config.columns=e.dataDriverJsonToObject(i.config.columns),e.table.config.columns=i.config.columns,e.columns=i.config.columns,e.table.refreshColumns(),e.table.parse(o),e.table.enable(),e.table.hideProgress(),e.table.select(e.$scope.state.editor.value),e.table.showItem(1*e.$scope.state.editor.value);e.table.openAll()}))},dataDriverJsonToObject:function dataDriverJsonToObject(configColumns){return configColumns.forEach((function(item,key){var myObj={func:{}};item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("webix")&&(eval(" myObj.func = (obj) => { return "+item.format+"(obj); }"),configColumns[key].numberFormat="1111.00"),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatMonthYear")&&(eval(" myObj.func = (obj) => { return "+item.format+"(obj); }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateTime")&&(eval(" myObj.func = (obj) => { try {formatDateTime(obj)} catch (e) { debugger; obj = obj.trim(); } return  (obj!='' && obj!=null) ? formatDateTime(obj) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateShort")&&(eval(" myObj.func = (obj) => { try {formatDateShort(obj)} catch (e) { debugger; obj = obj.trim();} return  (obj!='' && obj!=null) ? formatDateShort(obj) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDate")&&(eval(" myObj.func = (obj) => { try {formatDate(obj)} catch (e) { debugger; } return  (obj!='' && obj!=null) ? formatDate(obj) : ''; }"),configColumns[key].format=myObj.func),item.format&&"function"!=typeof configColumns[key].format&&0==item.format.indexOf("formatDateHour")&&(eval(" myObj.func = (obj) => { try {formatDateHour(obj)} catch (e) { debugger; } return  (obj!='' && obj!=null) ? formatDateHour(obj) : ''; }"),configColumns[key].format=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("(obj,common,value)")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("custom_checkbox")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func),item.template&&"function"!=typeof configColumns[key].template&&0==item.template.indexOf("columnGroupTemplate")&&(eval(" myObj.func = "+item.template),configColumns[key].template=myObj.func)})),configColumns}},webix.ui.treetable)},function(e,t,i){var o={"./de":117,"./de.js":117,"./en":118,"./en.js":118,"./ru":119,"./ru.js":119};function a(e){var t=r(e);return i(t)}function r(e){if(!i.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=r,e.exports=a,a.id=139},function(e,t,i){},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return c})),i.d(t,"App",(function(){return c}));i(91);var o=i(6);var a={status:function(){return new webix.promise((function(e){e(webix.storage.local.get("wjet_user"))}))},login:function(e,t){this.logout();var i=(new o.a).getUrl("get","users/login");return new webix.promise((function(o,a){webix.ajax().post(i,{username:e,password:t},(function(e,t,i){var a=t.json();a.success?(webix.storage.local.put("wjet_user",{user:a.user.email,token:a.token,user_id:a.user.id,type:a.user.type,firebase_uid:a.user.firebase_uid}),webix.storage.local.put("wjet_permission",a.user.permissions_finplan),o({user:a.user.email,token:a.token,type:a.user.type,start_page:a.user.start_page,firebase_uid:a.user.firebase_uid})):o(null)}))}))},logout:function(){return new webix.promise((function(e,t){webix.storage.local.remove("wjet_user"),e(null)}))}},r=i(0),n=(i(140),i(5));function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}var s={};webix.firebase=firebase.database(),webix.firestore=firebase.firestore(),webix.firestore.settings({timestampsInSnapshots:!0});webix.Date.dateToStr("%Y-%m-%d %H:%i:%s");var c=function(e){var t,i;function c(t){var i,c=new o.a,d={id:"finplan",version:"1.0.0",debug:!0,
//!PRODUCTION,
access:"reader",apiRest:c,statusView:"",views:function(e){return n.a[e]||e}};return i=e.call(this,l({},d,{},s))||this,webix.Date.startOnMonday=!0,webix.proxy.api={$proxy:!0,load:function(e,t){return webix.ajax().get(c.getUrl("get",this.source),this.params)},save:function(e,t,i){var o,a=t.data.id;if("update"===t.operation){var r;return 1==e._in_edit_mode&&(o=i.config.master.getEditor()),r=t.data,webix.ajax().put(c.getUrl("put",this.source,this.params,a),r,{error:function(t,r,n){if(1==e._in_edit_mode){var l=i.config.master.getSelectedId(),s=o?o.column:l.column;e.addCellCss(a,s,"webix_invalid_cell")}else webix.message({text:"Данные  не сохранены",type:"error",expire:-1})},success:function(t,r,n){var l=r.json();if(l.errors)for(var s in l.errors)webix.message({text:"Запись не сохранена!",type:"error"}),webix.message({text:s+":"+l.errors[s],type:"error",expire:-1});else{var c=e.getItem(a);l.updated&&(c.updated=l.updated,c=e.getItem(a));var d=i.config.master.getSelectedId(),u=o?o.column:d.column;u&&e.addCellCss(a,u,"webix_editing_cell")}if(l.changeData)for(var s in l.changeData)webix.message({text:s+":  "+l.changeData[s].old+" Изменено на: "+l.changeData[s].new+" User:"+l.changeData[s].user,type:"error",expire:-1})}})}return"insert"===t.operation?(delete t.data.id,webix.ajax().post(c.getUrl("create",this.source,this.params),t.data)):"delete"===t.operation?webix.ajax().del(c.getUrl("delete",this.source,this.params,a),t.data):void 0}},i.use(r.c.User,{model:a}),i.use(r.c.Locale,{lang:"ru",webix:{ru:"ru-RU"},storage:webix.storage.prefix(i.config.id,webix.storage.local)}),i}return i=e,(t=c).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,c}(r.a)}])}));