!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.finplan=t():e.finplan=t()}(window,(function(){return function(e){var t={};function i(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(o,a,function(t){return e[t]}.bind(null,a));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/codebase/",i(i.s=96)}([function(e,t,i){"use strict";function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}i.d(t,"c",(function(){return L})),i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return d}));var a=function(){},n=function(){function e(e){this.webixJet=!0,this.webix=e,this._events=[],this._subs={},this._data={}}var t=e.prototype;return t.getRoot=function(){return this._root},t.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.setParam=function(e,t,i){if(this._data[e]!==t&&(this._data[e]=t,this._segment.update(e,t,0),i))return this.show(null)},t.getParam=function(e,t){var i=this._data[e];if(void 0!==i||!t)return i;var o=this.getParentView();return o?o.getParam(e,t):void 0},t.getUrl=function(){return this._segment.suburl()},t.getUrlString=function(){return this._segment.toString()},t.getParentView=function(){return this._parent},t.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView((function(i){return(i.config.id===e||i.config.localId===e)&&i.$scope===t.$scope}),"self")}return e},t.on=function(e,t,i){var o=e.attachEvent(t,i);return this._events.push({obj:e,id:o}),o},t.contains=function(e){for(var t in this._subs){var i=this._subs[t].view;if(i===e||i.contains(e))return!0}return!1},t.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},t.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:"_top"===e?(this._subs[e]={url:"",id:null,popup:!0},this.getSubViewInfo(e)):this._parent?this._parent.getSubViewInfo(e):null},t._detachEvents=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id)},t._destroySubs=function(){for(var e in this._subs){var t=this._subs[e].view;t&&t.destructor()}this._subs={}},t._init_url_data=function(){var e=this._segment.current();this._data={},this.webix.extend(this._data,e.params,!0)},t._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var e in this._subs){var t=this._subs[e];if(!t.branch&&t.view&&"_top"!==e){var i=t.view._getDefaultSub();if(i)return i}}},t._routed_view=function(){var e=this.getParentView();if(!e)return!0;var t=e._getDefaultSub();return!(!t&&t!==this)&&e._routed_view()},e}();function r(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),i=[],o=0;o<t.length;o++){var a=t[o],n={},r=a.indexOf(":");if(-1===r&&(r=a.indexOf("?")),-1!==r){var l=a.substr(r+1).split(/[\:\?\&]/g),c=Array.isArray(l),s=0;for(l=c?l:l[Symbol.iterator]();;){var d;if(c){if(s>=l.length)break;d=l[s++]}else{if((s=l.next()).done)break;d=s.value}var u=d.split("=");n[u[0]]=decodeURIComponent(u[1])}}i[o]={page:r>-1?a.substr(0,r):a,params:n,isNew:!0}}return i}function l(e){var t=[],i=e,o=Array.isArray(i),a=0;for(i=o?i:i[Symbol.iterator]();;){var n;if(o){if(a>=i.length)break;n=i[a++]}else{if((a=i.next()).done)break;n=a.value}var r=n;t.push("/"+r.page);var l=c(r.params);l&&t.push("?"+l)}return t.join("")}function c(e){var t=[];for(var i in e)t.length&&t.push("&"),t.push(i+"="+encodeURIComponent(e[i]));return t.join("")}var s=function(){function e(e,t){this._next=1,this.route="string"==typeof e?{url:r(e),path:e}:e,this.index=t}var t=e.prototype;return t.current=function(){return this.route.url[this.index]},t.next=function(){return this.route.url[this.index+this._next]},t.suburl=function(){return this.route.url.slice(this.index)},t.shift=function(){return new e(this.route,this.index+this._next)},t.refresh=function(){for(var e=this.route.url,t=this.index+1;t<e.length;t++)e[t].isNew=!0},t.toString=function(){var e=l(this.suburl());return e?e.substr(1):""},t._join=function(e,t){var i=this.route.url;if(null===e)return i;var o=this.route.url;if(i=o.slice(0,this.index+(t?this._next:0)),e){i=i.concat(r(e));for(var a=0;a<i.length;a++)o[a]&&(i[a].view=o[a].view),o[a]&&i[a].page===o[a].page&&(i[a].isNew=!1)}return i},t.append=function(e){var t=this._join(e,!0);return this.route.path=l(t),this.route.url=t,this.route.path},t.show=function(e,t,i){var o=this,n=this._join(e,i);return new Promise((function(e,i){var r=l(n),c={url:n,redirect:r,confirm:Promise.resolve()},s=t?t.app:null;if(s&&!s.callEvent("app:guard",[c.redirect,t,c]))return void i(new a);c.confirm.catch((function(e){return i(e)})).then((function(){if(null!==c.redirect){if(c.redirect!==r)return s.show(c.redirect),void i(new a);o.route.path=r,o.route.url=n,e()}else i(new a)}))}))},t.size=function(e){this._next=e},t.split=function(){var t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=l(t.url)),new e(t,0)},t.update=function(e,t,i){var o=this.route.url[this.index+(i||0)];if(!o)return this.route.url.push({page:"",params:{}}),this.update(e,t,i);""===e?o.page=t:o.params[e]=t,this.route.path=l(this.route.url)},e}(),d=function(e){function t(t,i){var o;return(o=e.call(this,t.webix)||this).app=t,o._children=[],o}o(t,e);var i=t.prototype;return i.ui=function(e,t){var i=(t=t||{}).container||e.container,o=this.app.createView(e);return this._children.push(o),o.render(i,this._segment,this),"object"!=typeof e||e instanceof n?o:o.getRoot()},i.show=function(e,t){if(t=t||{},"object"==typeof e){for(var i in e)this.setParam(i,e[i]);e=null}else{if("/"===e.substr(0,1))return this.app.show(e);if(0===e.indexOf("./")&&(e=e.substr(2)),0===e.indexOf("../")){var o=this.getParentView();return o?o.show(e.substr(3),t):this.app.show("/"+e.substr(3))}var a=this.getSubViewInfo(t.target);if(a){if(a.parent!==this)return a.parent.show(e,t);if(t.target&&"default"!==t.target)return this._renderFrameLock(t.target,a.subview,e)}else if(e)return this.app.show("/"+e)}return this._show(this._segment,e,this)},i._show=function(e,t,i){var o=this;return e.show(t,i,!0).then((function(){return o._init_url_data(),o._urlChange()})).then((function(){e.route.linkRouter&&(o.app.getRouter().set(e.route.path,{silent:!0}),o.app.callEvent("app:route",[e.route.path]))}))},i.init=function(e,t){},i.ready=function(e,t){},i.config=function(){this.app.webix.message("View:Config is not implemented")},i.urlChange=function(e,t){},i.destroy=function(){},i.destructor=function(){this.destroy(),this._destroyKids(),this._root.destructor(),e.prototype.destructor.call(this)},i.use=function(e,t){e(this.app,this,t)},i.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},i.render=function(e,t,i){var o=this;"string"==typeof t&&(t=new s(t,0)),this._segment=t,this._parent=i,this._init_url_data();var a="string"==typeof(e=e||document.body)?this.webix.toNode(e):e;return this._container!==a?(this._container=a,this._render(t)):this._urlChange().then((function(){return o.getRoot()}))},i._render=function(e){var t=this,i=this.config();return i.then?i.then((function(i){return t._render_final(i,e)})):this._render_final(i,e)},i._render_final=function(e,t){var i,o=this,a=null,n=null,r=!1;if(this._container.tagName?n=this._container:(a=this._container).popup?(n=document.body,r=!0):n=this.webix.$$(a.id),!this.app||!n)return Promise.reject(null);var l=this._segment.current(),c={ui:{}};this.app.copyConfig(e,c.ui,this._subs),this.app.callEvent("app:render",[this,t,c]),c.ui.$scope=this,!a&&l.isNew&&l.view&&l.view.destructor();try{if(a&&!r){var s=n,d=s.getParentView();d&&"multiview"===d.name&&!c.ui.id&&(c.ui.id=s.config.id)}this._root=this.app.webix.ui(c.ui,n);var u=this._root;r&&u.setPosition&&!u.isVisible()&&u.show(),a&&(a.view&&a.view!==this&&a.view!==this.app&&a.view.destructor(),a.id=this._root.config.id,this.getParentView()||!this.app.app?a.view=this:a.view=this.app),l.isNew&&(l.view=this,l.isNew=!1),i=Promise.resolve(this._init(this._root,t)).then((function(){return o._urlChange().then((function(){return o._initUrl=null,o.ready(o._root,t.suburl())}))}))}catch(e){i=Promise.reject(e)}return i.catch((function(e){return o._initError(o,e)}))},i._init=function(e,t){return this.init(e,t.suburl())},i._urlChange=function(){var e=this;this.app.callEvent("app:urlchange",[this,this._segment]);var t=[];for(var i in this._subs){var o=this._subs[i],a=this._renderFrameLock(i,o,null);a&&t.push(a)}return Promise.all(t).then((function(){return e.urlChange(e._root,e._segment.suburl())}))},i._renderFrameLock=function(e,t,i){if(!t.lock){var o=this._renderFrame(e,t,i);o&&(t.lock=o.then((function(){return t.lock=null}),(function(){return t.lock=null})))}return t.lock},i._renderFrame=function(e,t,i){var o=this;if("default"===e){if(this._segment.next())return this._createSubView(t,this._segment.shift());t.view&&t.popup&&(t.view.destructor(),t.view=null)}if(null!==i&&(t.url=i),t.route){if(null!==i)return t.route.show(i,t.view).then((function(){return o._createSubView(t,t.route)}));if(t.branch)return}var a=t.view;if(!a&&t.url){if("string"==typeof t.url)return t.route=new s(t.url,0),this._createSubView(t,t.route);"function"!=typeof t.url||a instanceof t.url||(a=new t.url(this.app,"")),a||(a=t.url)}if(a)return a.render(t,t.route||this._segment,this)},i._initError=function(e,t){return this.app&&this.app.error("app:error:initview",[t,e]),!0},i._createSubView=function(e,t){var i=this;return this.app.createFromURL(t.current()).then((function(o){return o.render(e,t,i)}))},i._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(n),u=function(e){function t(t,i){var o;return(o=e.call(this,t,i)||this)._ui=i.ui,o}return o(t,e),t.prototype.config=function(){return this._ui},t}(d),h=function(){function e(e,t,i){this.path="",this.app=i}var t=e.prototype;return t.set=function(e,t){this.path=e;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.get=function(){return this.path},e}(),p=!0,f=function(e){function t(t){var i,o=(t||{}).webix||window.webix;return(i=e.call(this,o)||this).config=i.webix.extend({name:"App",version:"1.0",start:"/home"},t,!0),i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),i.webix.EventSystem),i}o(t,e);var i=t.prototype;return i.getUrl=function(){return this._subSegment.suburl()},i.getUrlString=function(){return this._subSegment.toString()},i.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},i.setService=function(e,t){this._services[e]=t},i.destructor=function(){this.getSubView().destructor(),e.prototype.destructor.call(this)},i.copyConfig=function(e,t,i){if((e instanceof n||"function"==typeof e&&e.prototype instanceof n)&&(e={$subview:e}),void 0!==e.$subview)return this.addSubView(e,t,i);for(var o in t=t||(e instanceof Array?[]:{}),e){var a=e[o];if("function"==typeof a&&a.prototype instanceof n&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp)t[o]=a;else if(a instanceof Date)t[o]=new Date(a);else{var r=this.copyConfig(a,a instanceof Array?[]:{},i);null!==r&&(t[o]=r)}}return t},i.getRouter=function(){return this.$router},i.clickHandler=function(e,t){if(e&&(t=t||e.target||e.srcElement)&&t.getAttribute){var i=t.getAttribute("trigger");if(i)return this._forView(t,(function(e){return e.app.trigger(i)})),e.cancelBubble=!0,e.preventDefault();var o=t.getAttribute("route");if(o)return this._forView(t,(function(e){return e.show(o)})),e.cancelBubble=!0,e.preventDefault()}var a=t.parentNode;a&&this.clickHandler(e,a)},i.getRoot=function(){return this.getSubView().getRoot()},i.refresh=function(){var e=this;return this._subSegment?this.getSubView().refresh().then((function(t){return e.callEvent("app:route",[e.getUrl()]),t})):Promise.resolve(null)},i.loadView=function(e){var t=this,i=this.config.views,o=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(o="function"==typeof i?i(e):i[e])&&(e=o,o=null),o||(o="_blank"===e?{}:this._loadViewDynamic(e))}catch(t){o=this._loadError(e,t)}return o.then||(o=Promise.resolve(o)),o=o.then((function(e){return e.__esModule?e.default:e})).catch((function(i){return t._loadError(e,i)}))},i._forView=function(e,t){var i=this.webix.$$(e);i&&t(i.$scope)},i._loadViewDynamic=function(e){return null},i.createFromURL=function(e){var t=this;return e.isNew||!e.view?this.loadView(e.page).then((function(e){return t.createView(e,name)})):Promise.resolve(e.view)},i.createView=function(e,i){if("function"==typeof e){if(e.prototype instanceof t)return new e({app:this,name:i,router:h});if(e.prototype instanceof n)return new e(this,{name:i});e=e(this)}return e instanceof n?e:new u(this,{name:i,ui:e})},i.show=function(e){return this.render(this._container,e||this.config.start)},i.trigger=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];this.apply(e,i)},i.apply=function(e,t){this.callEvent(e,t)},i.action=function(e){return this.webix.bind((function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];this.apply(e,i)}),this)},i.on=function(e,t){this.attachEvent(e,t)},i.use=function(e,t){e(this,null,t)},i.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var i=0;i<t.length;i++)if(console.error(t[i]),t[i]instanceof Error){var o=t[i].message;0===o.indexOf("Module build failed")?(o=o.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+o+"</pre>"):(o+="<br><br>Check console for more details",this.webix.message({type:"error",text:o,expire:-1}))}},i.render=function(e,t,i){var o=this;this._container="string"==typeof e?this.webix.toNode(e):e||document.body;var a=null;!this.$router?(p&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(e){return o.clickHandler(e)})),p=!1),"string"==typeof t&&(t=new s(t,0)),this._subSegment=this._first_start(t),this._subSegment.route.linkRouter=!0):a="string"==typeof t?t:this.app?t.split().route.path||this.config.start:t.toString();var n=this.getSubView(),r=this._subSegment,l=r.show(a,n).then((function(){return o.createFromURL(r.current())})).then((function(t){return t.render(e,r)})).then((function(e){return o.$router.set(r.route.path,{silent:!0}),o.callEvent("app:route",[o.getUrl()]),e}));return this.ready=this.ready.then((function(){return l})),l},i.getSubView=function(){if(this._subSegment){var e=this._subSegment.current().view;if(e)return e}return new d(this,{})},i._first_start=function(e){var t=this;this._segment=e;if(this.$router=new this.config.router((function(e){return setTimeout((function(){t.show(e).catch((function(e){if(!(e instanceof a))throw e}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){t.webix.html.removeCss(i,"webixappstart"),t.webix.html.addCss(i,"webixapp")}),10)}if(e)this.app&&(e.current().view=this,e.next()?(e.refresh(),e=e.split()):e=new s(this.config.start,0));else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),e=new s(o,0)}return e},i._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},i.addSubView=function(e,t,i){var o=!0!==e.$subview?e.$subview:null,a=e.name||(o?this.webix.uid():"default");return t.id=e.id||"s"+this.webix.uid(),(i[a]={id:t.id,url:o,branch:e.branch,popup:e.popup}).popup?null:t},t}(n),m=function(){function e(e,t){var i=this;this.config=t||{},this._detectPrefix(),this.cb=e,window.onpopstate=function(){return i.cb(i.get())}}var t=e.prototype;return t.set=function(e,t){var i=this;if(this.config.routes){var o=e.split("?",2);for(var a in this.config.routes)if(this.config.routes[a]===o[0]){e=a+(o.length>1?"?"+o[1]:"");break}}this.get()!==e&&window.history.pushState(null,null,this.prefix+this.sufix+e),t&&t.silent||setTimeout((function(){return i.cb(e)}),1)},t.get=function(){var e=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(e="/"!==e&&"#"!==e?e:"",this.config.routes){var t=e.split("?",2),i=this.config.routes[t[0]];i&&(e=i+(t.length>1?"?"+t[1]:""))}return e},t._detectPrefix=function(){var e=this.config.routerPrefix;this.sufix="#"+(void 0===e?"!":e),this.prefix=document.location.href.split("#",2)[0]},t._getRaw=function(){return document.location.href},e}(),g=!1;function w(e){if(!g&&e){g=!0;var t=window;t.Promise||(t.Promise=e.promise);var i=e.version.split(".");10*i[0]+1*i[1]<53&&(e.ui.freeze=function(t){var i=t();return i&&i.then?i.then((function(t){return e.ui.$freeze=!1,e.ui.resize(),t})):(e.ui.$freeze=!1,e.ui.resize()),i});var o=e.ui.baselayout.prototype.addView,a=e.ui.baselayout.prototype.removeView,n={addView:function(e,t){var i=this;if(!this.$scope||!this.$scope.webixJet||e.queryView)return o.apply(this,arguments);var a=function(){var a=i.$scope,n={};e=a.app.copyConfig(e,{},n),o.apply(i,[e,t]);var r=function(e){a._renderFrame(e,n[e],null).then((function(){a._subs[e]=n[e]}))};for(var l in n)r(l);return{v:e.id}}();return"object"==typeof a?a.v:void 0},removeView:function(){if(a.apply(this,arguments),this.$scope&&this.$scope.webixJet){var t=this.$scope._subs;for(var i in t){var o=t[i];e.$$(o.id)||(o.view.destructor(),delete t[i])}}}};e.extend(e.ui.layout.prototype,n,!0),e.extend(e.ui.baselayout.prototype,n,!0),e.protoUI({name:"jetapp",$init:function(t){this.$app=new this.app(t);var i=e.uid().toString();for(var o in t.body={id:i},this.$ready.push((function(){this.$app.render({id:i})})),this.$app){var a=this.$app[o];"function"!=typeof a||this[o]||(this[o]=a.bind(this.$app))}}},e.ui.proxy)}}var b=function(e){function t(t){var i;return t.router=t.router||m,w((i=e.call(this,t)||this).webix),i}return o(t,e),t.prototype._loadViewDynamic=function(e){return e=e.replace(/\./g,"/"),i(77)("./"+e)},t}(f);function v(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function x(e,t,i){for(var o in e)v(e,o)&&t.call(i||e,e[o],o,e)}function _(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}var y=String.prototype.replace,$=String.prototype.split,C=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},k={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:C,chinese:function(){return 0},croatian:C,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:C,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},A={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function I(e){var t,i=(t={},x(A,(function(e,i){x(e,(function(e){t[e]=i}))})),t);return i[e]||i[$.call(e,/-/,1)[0]]||i.en}function S(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var F=/\$/g,E=/%\{(.*?)\}/g;function D(e,t,i,o){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var a=e,n=o||E,r="number"==typeof t?{smart_count:t}:t;if(null!=r.smart_count&&a){var l=$.call(a,"||||");a=(l[function(e,t){return k[I(e)](t)}(i||"en",r.smart_count)]||l[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return a=y.call(a,n,(function(e,t){return v(r,t)&&null!=r[t]?y.call(r[t],F,"$$"):e}))}function V(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var i=t.allowMissing?D:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:i,this.warn=t.warn||_,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",i=e&&e.suffix||"}";if("||||"===t||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(S(t)+"(.*?)"+S(i),"g")}(t.interpolation)}V.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},V.prototype.extend=function(e,t){x(e,(function(e,i){var o=t?t+"."+i:i;"object"==typeof e?this.extend(e,o):this.phrases[o]=e}),this)},V.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:x(e,(function(e,i){var o=t?t+"."+i:i;"object"==typeof e?this.unset(e,o):delete this.phrases[o]}),this)},V.prototype.clear=function(){this.phrases={}},V.prototype.replace=function(e){this.clear(),this.extend(e)},V.prototype.t=function(e,t){var i,o,a=null==t?{}:t;if("string"==typeof this.phrases[e])i=this.phrases[e];else if("string"==typeof a._)i=a._;else if(this.onMissingKey){o=(0,this.onMissingKey)(e,a,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),o=e;return"string"==typeof i&&(o=D(i,a,this.currentLocale,this.tokenRegex)),o},V.prototype.has=function(e){return v(this.phrases,e)},V.transformPhrase=function(e,t,i){return D(e,t,i)};var O=V;function j(e,t,i){if(t.urls)i=t.urls[i]||i;else if(t.param){var o;(o={})[t.param]=i,i=o}e.show(i)}var B={good:"check",error:"warning",saving:"refresh fa-spin"},P={good:"Ok",error:"Error",saving:"Connecting..."};function R(e,t,i){for(var o=0;o<i.length;o++)e[i[o]]=t[o+1]?t[o+1].page:""}var T=window.webix;T&&w(T);var L={UnloadGuard:function(e,t,i){t.on(e,"app:guard",(function(e,o,n){if(o===t||o.contains(t)){var r=i();n.confirm=!1===r?Promise.reject(new a):n.confirm.then((function(){return r}))}}))},Locale:function(e,t,o){var a=(o=o||{}).storage,n=a?a.get("lang")||"en":o.lang||"en";function r(t,i,r){i.__esModule&&(i=i.default);var l={phrases:i};o.polyglot&&e.webix.extend(l,o.polyglot);var s=c.polyglot=new O(l);if(s.locale(t),c._=e.webix.bind(s.t,s),n=t,a&&a.put("lang",n),o.webix){var d=o.webix[t];d&&e.webix.i18n.setLocale(d)}return r?Promise.resolve():e.refresh()}function l(e,t){if(!1!==o.path){var a=(o.path?o.path+"/":"")+e;r(e,i(94)("./"+a),t)}}var c={getLang:function(){return n},setLang:l,setLangData:r,_:null,polyglot:null};e.setService("locale",c),l(n,!0)},Menu:function(e,t,i){var o=t.getSubViewInfo().parent,a=t.$$(i.id||i),n=!1;a.attachEvent("onchange",(function(){n||j(o,i,this.getValue())})),a.attachEvent("onafterselect",(function(){if(!n){var e=null;a.setValue?e=this.getValue():a.getSelectedId&&(e=a.getSelectedId()),j(o,i,e)}})),t.on(e,"app:route",(function(){var e="";if(i.param)e=t.getParam(i.param,!0);else{var r=o.getUrl()[1];r&&(e=r.page)}e&&(n=!0,a.setValue&&a.getValue()!==e?a.setValue(e):a.select&&a.exists(e)&&a.getSelectedId()!==e&&a.select(e),n=!1)}))},Theme:function(e,t,i){var o=(i=i||{}).storage,a=o?o.get("theme")||"flat-default":i.theme||"flat-default",n={getTheme:function(){return a},setTheme:function(t,i){for(var n=t.split("-"),r=document.getElementsByTagName("link"),l=0;l<r.length;l++){var c=r[l].getAttribute("title");c&&(c===t||c===n[0]?r[l].disabled=!1:r[l].disabled=!0)}e.webix.skin.set(n[0]),e.webix.html.removeCss(document.body,"theme-"+a),e.webix.html.addCss(document.body,"theme-"+t),a=t,o&&o.put("theme",t),i||e.refresh()}};e.setService("theme",n),n.setTheme(a,!0)},User:function(e,t,i){var o=(i=i||{}).login||"/login",a=i.logout||"/logout",n=i.afterLogin||e.config.start,r=i.afterLogout||"/login",l=i.ping||3e5,c=i.model,s=i.user,d={getUser:function(){return s},getStatus:function(e){return e?c.status().catch((function(){return null})).then((function(e){s=e})):null!==s},login:function(t,i){return c.login(t,i).then((function(t){if(s=t,!t)throw new Error("Access denied");e.callEvent("app:user:login",[s]),e.show(n)}))},logout:function(){return s=null,c.logout().then((function(t){return e.callEvent("app:user:logout",[]),t}))}};function u(e,t){e===a?(d.logout(),t.redirect=r):e===o||d.getStatus()||(t.redirect=o)}e.setService("user",d),e.attachEvent("app:guard",(function(e,t,o){return!(!i.public||!i.public(e))||(void 0===s&&(o.confirm=d.getStatus(!0).then((function(){return u(e,o)}))),u(e,o))})),l&&setInterval((function(){return d.getStatus(!0)}),l)},Status:function(e,t,i){var o="good",a=0,n=!1,r=i.expire;r||!1===r||(r=2e3);var l=i.texts||P,c=i.icons||B;function s(e){var a=t.$$(i.target);a&&(e||(e="<div class='status_"+o+"'><span class='webix_icon fa-"+c[o]+"'></span> "+l[o]+"</div>"),a.setHTML(e))}function d(){a--,f("good")}function u(e){a--,f("error",e)}function h(e){a++,f("saving"),e&&e.then&&e.then(d,u)}function p(){0===a&&s(" ")}function f(t,i){a<0&&(a=0),"saving"===t?(o="saving",s()):(n="error"===t,0===a&&(o=n?"error":"good",n?e.error("app:error:server",[i.responseText||i]):r&&setTimeout(p,r),s()))}function m(i){var o=e.webix.dp(i);o&&(t.on(o,"onAfterDataSend",h),t.on(o,"onAfterSaveError",(function(e,t,i){return u(i)})),t.on(o,"onAfterSave",d))}"string"==typeof i&&(i={target:i}),e.setService("status",{getStatus:function(){return o},setStatus:f,track:m}),i.remote&&t.on(e.webix,"onRemoteCall",h),i.ajax&&t.on(e.webix,"onBeforeAjax",(function(e,t,i,o,a,n,r){h(r)})),i.data&&m(i.data)},UrlParam:function(e,t,i){var o=i.route||i,a={};t.on(e,"app:urlchange",(function(e,i){t===e&&(R(a,i.suburl(),o),i.size(o.length+1))}));var n=t.setParam,r=t.getParam;t.setParam=function(e,i,r){var l=o.indexOf(e);return l>=0?(a[e]=i,this._segment.update("",i,l+1),r?t.show(null):void 0):n.call(this,e,i,r)},t.getParam=function(e,t){var i=a[e];return void 0!==i?i:r.call(this,e,t)},R(a,t.getUrl(),o)}},U=window;U.Promise||(U.Promise=U.webix.promise)},function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i(0),a=i(7);window.procent=function(e,t){var i=$$("table_part").getItem(e),o=$$(t).getValue();return Math.round(100*i.value*100/o)/100};var n=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=44,e.top=34,e.width=e.maxWidth/3,e.height=e.maxHeight-38},head:"Редактирование",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"auto",elements:this.state.formConfig}}},n.init=function(e,t){this.attachClickEvents()},n.showForm=function(e){var t=this,i=this.state,o=this.apiRest,a=e.getSelectedItem(),n=a;i.tableId=e.config.urlEdit,i.table=e,i.tableRecord=a,i.isUpdate=n,i.formEdit=this.$$("formEdit"),i.formUrl="accounting/"+i.tableId+"/form",i.win=this.$$("winEdit"),i.formEdit.clearValidation(),o.get(i.formUrl).then((function(e){t.showWindow(e,t)}))},n.showWindow=function(e,t){var i=t.state,o=Object.keys(i.formEdit.elements).length,a=e.json();i.formData=a,t.renderForm(o),i.formEdit.clear(),webix.extend(i.formEdit,webix.ProgressBar),i.formEdit.disable(),i.formEdit.showProgress({type:"icon",hide:!1}),t.bindCollection(a),i.win.show()},n.getRecord=function(){var e=this.state;return e.isUpdate?e.tableRecord:{date_operation:new Date,is_committed:1,type_operation:2}},n.renderForm=function(e){var t=this.state;0===e&&(t.formConfig=t.formData.data.configForm,webix.ui(t.formConfig,t.formEdit),this.attachFormEvents())},n.bindCollection=function(e){var t=this.state,i=this,o=this.apiRest,a=0,n=e.data.dataCollections,r=Object.keys(n).length,l={"per-page":-1},c=function(e){var c=$$(e).getPopup().getList(),s=n[e].field?n[e].field:"name",d=o.getCollection(n[e].url,l,s);d.waitData.then((function(){a++,c.sync(d),a===r&&(t.formEdit.setValues(i.getRecord()),t.formEdit.enable(),t.formEdit.hideProgress())}))};for(var s in n)c(s);0==r&&(t.formEdit.setValues(i.getRecord()),t.formEdit.enable(),t.formEdit.hideProgress())},n.bindColumnCollection=function(e){var t=this.apiRest,i={"per-page":-1},o=e.data.columnCollections;for(var a in o){var n=o[a];for(var r in n)this.$$(a).getColumnConfig(r).options=t.getCollection(n[r].url,i);this.$$(a).refreshColumns()}},n.attachFormEvents=function(){var e=this,t=(this.state,this.$$("btn_save")),i=this.$$("btn_copy");t.attachEvent("onItemClick",(function(t){e.doClickSave()})),i.attachEvent("onItemClick",(function(t){e.doClickSave(!0)}))},n.attachClickEvents=function(){webix.attachEvent("onClick",(function(e,t,i){}))},n.doClickSave=function(e){void 0===e&&(e=!1);var t=this.state;if(t.formEdit.validate()){var i=t.formEdit.getValues();e&&(t.isUpdate=!1,i.id=""),webix.dp(t.table).save(t.isUpdate?i.id:webix.uid(),t.isUpdate?"update":"insert",i).then((function(e){webix.dp(t.table).ignore((function(){t.isUpdate?t.table.updateItem(i.id,e):t.table.add(e,0),t.table.select(e.id),t.isUpdate||t.table.scrollTo(0,0)})),t.table.refresh(),t.win.hide()}),(function(){webix.message("Ошибка! Данные не сохранены!")}))}},o}(o.b)},function(e,t,i){"use strict";i(0);webix.protoUI({name:"combo-close",$cssName:"search custom",$init:function(){this.attachEvent("onTimedKeyPress",this.toggleDeleteIcon),this.attachEvent("onChange",this.toggleDeleteIcon),this.attachEvent("onItemClick",this.onItemClick),this.$ready.push(this.toggleDeleteIcon)},$renderIcon:function(){for(var e=this.config,t=["menu-down","close"],i=e.aheight-2*e.inputPadding,o=(i-18)/2-1,a="",n=2,r=0;r<t.length;r++)a+="<span style='right:"+n+"px;height:"+(i-o)+"px;padding-top:"+o+"px;' class='webix_input_icon wxi-"+t[r]+"'></span>",n+=18;return a},onItemClick:function(e,t){"close"==t.target.className.substr(t.target.className.indexOf("wxi-")+4)&&(this.setValue(""),this.getPopup().hide(this.getInputNode()))},toggleDeleteIcon:function(){this.getValue()?webix.html.removeCss(this.$view,"no-delete"):webix.html.addCss(this.$view,"no-delete",!0)},on_click:{webix_input_icon:function(e,t,i){i.className.substr(i.className.indexOf("wxi-")+4);this.getInputNode().focus()}}},webix.ui.combo)},function(e,t){webix.protoUI({name:"search-close",$cssName:"search custom",$init:function(){this.attachEvent("onTimedKeyPress",this.toggleDeleteIcon),this.attachEvent("onChange",this.toggleDeleteIcon),this.$ready.push(this.toggleDeleteIcon)},$renderIcon:function(){for(var e=this.config,t=["search","close"],i=e.aheight-2*e.inputPadding,o=(i-18)/2-1,a="",n=2,r=0;r<t.length;r++)a+="<span style='right:"+n+"px;height:"+(i-o)+"px;padding-top:"+o+"px;' class='webix_input_icon wxi-"+t[r]+"'></span>",n+=18;return a},toggleDeleteIcon:function(){this.getValue()?webix.html.removeCss(this.$view,"no-delete"):webix.html.addCss(this.$view,"no-delete",!0)},on_click:{webix_input_icon:function(e,t,i){var o=i.className.substr(i.className.indexOf("wxi-")+4);"close"==o&&this.setValue(""),this.callEvent("on"+o+"IconClick",[e]),this.getInputNode().focus()}}},webix.ui.search)},function(e,t,i){"use strict";i(0);webix.protoUI({name:"datepicker-close",$cssName:"search custom",$init:function(){this.attachEvent("onTimedKeyPress",this.toggleDeleteIcon),this.attachEvent("onChange",this.toggleDeleteIcon),this.attachEvent("onItemClick",this.onItemClick),this.$ready.push(this.toggleDeleteIcon)},$renderIcon:function(){for(var e=this.config,t=["calendar","close"],i=e.aheight-2*e.inputPadding,o=(i-18)/2-1,a="",n=2,r=0;r<t.length;r++)a+="<span style='right:"+n+"px;height:"+(i-o)+"px;padding-top:"+o+"px;' class='webix_input_icon wxi-"+t[r]+"'></span>",n+=18;return a},onItemClick:function(e,t){"close"==t.target.className.substr(t.target.className.indexOf("wxi-")+4)&&(this.setValue(""),this.getPopup().hide(this.getInputNode()))},toggleDeleteIcon:function(){this.getValue()?webix.html.removeCss(this.$view,"no-delete"):webix.html.addCss(this.$view,"no-delete",!0)},on_click:{webix_input_icon:function(e,t,i){var o=i.className.substr(i.className.indexOf("wxi-")+4);"close"==o&&this.setValue(""),this.callEvent("on"+o+"IconClick",[e]),this.getInputNode().focus()}}},webix.ui.datepicker)},function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var o=function(){function e(){"localhost:8082"==location.host?this.urlBase="http://admin.startsellshop.local/api":this.urlBase="http://admin.startsell.biz/api",this.authKeyName="auth_token",this.dataCollection={}}var t=e.prototype;return t.getAuthKey=function(){if(!this.authKey){var e=webix.storage.local.get("wjet_user");this.authKey=e?e.token:""}return this.authKey},t.getUrl=function(e,t,i,o){void 0===i&&(i={}),void 0===o&&(o="");var a=this.urlBase+"/"+t;this.authKeyName,this.authKey;i[this.authKeyName]=this.getAuthKey();var n=[];for(var r in i)i.hasOwnProperty(r)&&n.push(r+"="+encodeURIComponent(i[r]));return{get:a+"?"+(i=n.join("&")),create:a+"?"+i,put:a+"/"+o+"?"+i,delete:a+"/"+o+"?"+i}[e]},t.get=function(e,t){var i=this.getUrl("get",e,t);return this.getData(i,e)},t.post=function(e,t){return this.getUrl("create",e,t)},t.put=function(e,t){return t[id]?this.getUrl("put",e,t):alert("You need fill params[id]")},t.delete=function(e,t){return t[id]?this.getUrl("delete",e,t):alert("You need fill params[id]")},t.getData=function(e,t,i){return this.dataCollection[t]||(this.dataCollection[t]=webix.ajax(e,i)),this.dataCollection[t]},t.getLoad=function(e,t,i){return webix.ajax(e,t,{error:function(e,t,i){}})},t.getCollection=function(e,t,i){void 0===i&&(i="name");var o=this.getUrl("get",e,t);return this.dataCollection[e]||(this.dataCollection[e]=new webix.DataCollection({url:o,scheme:{$init:function(e){e.value=e[i]}}})),this.dataCollection[e]},e}()},function(e,t,i){"use strict";t.a={}},function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i(16);var o=function(){function e(e){this.$scope=e,this.tableId=null,this.isUpdate=null,this.formEdit=null,this.formUrl=null,this.formConfig={},this.formData={}}var t=e.prototype;return t.actionUpdate=function(e){},t.actionCreate=function(e){},t.actionSave=function(e){},e}()},function(e,t,i){"use strict";t.__esModule=!0,t.extend=l,t.indexOf=function(e,t){for(var i=0,o=e.length;i<o;i++)if(e[i]===t)return i;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}if(!n.test(e))return e;return e.replace(a,r)},t.isEmpty=function(e){return!e&&0!==e||!(!d(e)||0!==e.length)},t.createFrame=function(e){var t=l({},e);return t._parent=e,t},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},a=/[&<>"'`=]/g,n=/[&<>"'`=]/;function r(e){return o[e]}function l(e){for(var t=1;t<arguments.length;t++)for(var i in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],i)&&(e[i]=arguments[t][i]);return e}var c=Object.prototype.toString;t.toString=c;var s=function(e){return"function"==typeof e};s(/x/)&&(t.isFunction=s=function(e){return"function"==typeof e&&"[object Function]"===c.call(e)}),t.isFunction=s;var d=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===c.call(e)};t.isArray=d},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(5).a)).getUrl("get","accounting/accounts",{sort:"name","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";t.__esModule=!0;var o=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function a(e,t){var i=t&&t.loc,n=void 0,r=void 0,l=void 0,c=void 0;i&&(n=i.start.line,r=i.end.line,l=i.start.column,c=i.end.column,e+=" - "+n+":"+l);for(var s=Error.prototype.constructor.call(this,e),d=0;d<o.length;d++)this[o[d]]=s[o[d]];Error.captureStackTrace&&Error.captureStackTrace(this,a);try{i&&(this.lineNumber=n,this.endLineNumber=r,Object.defineProperty?(Object.defineProperty(this,"column",{value:l,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:c,enumerable:!0})):(this.column=l,this.endColumn=c))}catch(e){}}a.prototype=new Error,t.default=a,e.exports=t.default},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(5).a)).getUrl("get","accounting/contragents",{sort:"name","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(5).a)).getUrl("get","accounting/projects",{sort:"name","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(5).a)).getUrl("get","accounting/categories",{sort:"name","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=function(e){var t,i;function o(t,i,o){var a;return(a=e.call(this,t,i)||this).grid_config=o,a.name=i,a}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.config=function(){return{view:"treetable",localId:this.name+"-table",css:"webix_header_border webix_data_border",leftSplit:2,rightSplit:3,select:!0,resizeColumn:{headerOnly:!0},columns:this.grid_config.columns,url:this.grid_config.url,save:this.grid_config.save,scheme:this.grid_config.scheme,editable:!0,editaction:"dblclick",math:!0,hover:"myhover",on:{"data->onStoreUpdated":function(){this.data.each((function(e,t,i,o){}))},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}},onAfterEditStop:function(e,t,i){var o=this;e.value!=e.old&&(o.addCellCss(t.row,t.column,"highlight"),setTimeout((function(){o.removeCellCss(t.row,t.column,"highlight")}),3e3))},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}},o}(i(0).b),a=(i(2),i(4),i(3),i(57));webix.ui.datafilter.countColumn=webix.extend({refresh:function(e,t,i){var o=0;e.data.each((function(e){e.$group||o++})),t.innerHTML=o}},webix.ui.datafilter.summColumn);var n=function(e){var t,i;function o(t,i,o){var n={color:"green","text-align":"right","font-weight":100},r={"text-align":"right"},l=o?+o.id:0;return e.call(this,t,i,{url:t.config.apiRest.getUrl("get","accounting/document-salary-accruals",{filter:'{"list_id":'+l+"}","per-page":"-1"}),columns:[{id:"employee_name",header:["Сотрудник",{content:"countColumn"}],width:240,sort:"string",template:function(e,t){return e.$group?t.folder(e,t)+e.department_name:t.treetable(e,t)+e.employee_name}},{id:"employee_id",header:["ID",""],width:30,sort:"string",hidden:!0},{id:"is_piecework",header:["Тип",""],width:70,sort:"string",type:"select",collection:a.a},{id:"rate",header:["Ставка.",""],width:80,sort:"string",editor:"text",format:webix.Number.format,css:n},{id:"rate_day",header:["Ставка за день",""],width:120,sort:"string",format:webix.Number.format,css:r},{id:"all_time_days",header:["Рабочих дней",{content:"summColumn"}],width:110,sort:"string",format:webix.Number.format,css:r},{id:"work_time_days",header:["Дни посещения",{content:"summColumn"}],width:120,sort:"string",format:webix.Number.format,css:r},{id:"work_time_hours",header:["Дни по часам",{content:"summColumn"}],width:110,sort:"string",format:webix.Number.format,css:r},{id:"salary_rate",header:["ЗП по ставке",{content:"summColumn"}],width:100,sort:"string",math:"[$r,work_time_hours]*[$r,rate_day]",format:webix.Number.format,css:r},{id:"salary_piecework",header:["ЗП по сдельно",{content:"summColumn"}],width:110,sort:"string",editor:"text",format:webix.Number.format,css:n},{id:"award",header:["Премия",{content:"summColumn"}],width:100,sort:"string",editor:"text",format:webix.Number.format,css:n},{id:"surcharges",header:["Доп./Выч.",{content:"summColumn"}],width:120,sort:"string",editor:"text",format:webix.Number.format,css:n},{fillspace:!0},{id:"salary",width:100,sort:"string",math:"[$r,salary_rate] + [$r,award]+ [$r,surcharges] +[$r,salary_piecework]",format:webix.Number.format,css:r,header:["К выплате",{content:"summColumn"}]},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],scheme:{$group:{by:function(e){return e.department_name},map:{department_name:["department_name"],employee_name:["employee_name"],index:["index"],salary:["salary","sum"]}},$sort:[{by:"department_name",dir:"asc",as:"string"},{by:"employee_name",dir:"asc",as:"string"}]}})||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o}(o)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return c}));var o=i(0),a=i(9),n=i(11),r=i(12),l=i(13);i(2);var c=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var c=o.prototype;return c.config=function(){var e=this;return{view:"window",position:function(e){e.left=52,e.top=41,e.width=e.maxWidth/3,e.height=e.maxHeight-41},head:"Редактирование операции",close:!0,modal:!0,body:{view:"form",localId:"my_form1",margin:40,scroll:"auto",elements:[{margin:10,rows:[{view:"text",name:"id",width:150,hidden:!0},{view:"segmented",name:"type_operation",value:1,inputWidth:320,options:[{id:1,value:"Поступление"},{id:2,value:"Расход"},{id:3,value:"Перемещение"}],align:"center"},{localId:"label_move_from",label:"Откуда",view:"label",height:38,css:{"text-align":"center"},hidden:!0},{cols:[{label:"Дата оплаты",value:new Date,view:"datepicker",labelWidth:100,name:"date_operation",timepicker:!0,stringResult:!0},{name:"is_committed",view:"checkbox",width:40,value:!0,checkValue:1,uncheckValue:2},{label:"Подтвердить оплату",view:"label"}]},{label:"Счет",name:"account_id",localId:"account",value:"",options:a.a,placeholder:"Выберите счет",view:"combo",height:38,labelWidth:100,required:!0,invalidMessage:"Значение не может быть пустым!"},{height:38,cols:[{name:"value",label:"Сумма",view:"text",height:0,labelWidth:100,value:0,placeholder:"0.00",format:"1 111.00",validate:webix.rules.isNumber,invalidMessage:"Field can not be empty",required:!0},{label:"UAH (Украинская гривна)",view:"label",height:36}]},{localId:"label_value_break",template:"<a class='show-combo-value-break' href='javascript:void(0);'>Разбить сумму</a>",height:20,css:{"padding-left":"100px","margin-top":"0px !important"},hidden:!1,onClick:{"show-combo-value-break":function(e,t){this.$scope.$$("combo_value_break").isVisible()?this.$scope.$$("combo_value_break").hide():this.$scope.$$("combo_value_break").show()}}},{hidden:!0,name:"type_part_id",localId:"combo_value_break",value:"",options:[{id:1,value:"Выберите как разбить сумму"},{id:2,value:"Контрагент"},{id:3,value:"Статья"},{id:4,value:"Проект"},{id:5,value:"Контрагент, Статья"}],placeholder:"Выберите как разбить сумму",view:"combo",height:38,css:{"padding-left":"100px","margin-top":"0px !important"},width:230,on:{onChange:function(e){this.$scope.$$("table_part_value").showColumnBatch(e),e>1?this.$scope.$$("layout_part_value").show():(this.$scope.$$("layout_part_value").hide(),this.$scope.$$("table_part_value").clearAll())}}},{localId:"layout_part_value",padding:30,css:{background:"#f7fafb"},hidden:!0,rows:[{localId:"table_part_value",view:"datatable",css:"webix_header_border webix_data_border",columns:[{id:"id",header:"",hidden:!0},{id:"index",header:"#",width:20},{id:"contragent_id",editor:"combo",header:"Контрагент",options:n.a,fillspace:!0},{id:"category_id",editor:"combo",options:l.a,header:"Статья",adjust:!0,hidden:!0,batch:"3"},{id:"project_id",editor:"combo",options:r.a,header:"Проект",adjust:!0,hidden:!0,batch:"4"},{id:"value",editor:"text",header:"Сумма",width:100,sort:"int",css:{"text-align":"right"}},{id:"part_procent",header:"Доля,%",width:70,css:{"text-align":"right",math:"[$r,value]"}},{id:"action-delete-part",header:"",width:40,template:"{common.trashIcon()}"}],editable:!0,headerRowHeight:25,rowHeight:25,scroll:!1,width:300,autoheight:!0,math:!0,scheme:{$init:function(e){e.index=this.count()+1}},on:{onItemClick:function(e,t,i){"action-delete-part"==e.column&&this.remove(e)}}},{cols:[{borderless:!0,localId:"label_add_row_table",template:"<a class='add-to-table' href='javascript:void(0);'>Добавить...</a>",height:20,css:{"margin-top":"0px !important",background:"#f7fafb"},hidden:!1,onClick:{"add-to-table":function(e,t){this.$scope.$$("table_part_value").add({contragent_id:"",category_id:"",project_id:"",value:"0.00"})}}},{borderless:!0,localId:"label_add_row_table",template:"<strong>Итого</strong>",height:20,width:100,css:{"text-align":"right",background:"#f7fafb"}},{borderless:!0,localId:"label_add_row_table",template:"0.00",height:20,width:100,css:{"text-align":"right",background:"#f7fafb"}},{borderless:!0,localId:"label_add_row_table",template:"0.00",height:20,width:70,css:{"text-align":"right",background:"#f7fafb"}},{borderless:!0,localId:"label_add_row_table",template:"",height:20,width:40,css:{"text-align":"right",background:"#f7fafb"}}]}]},{label:"Контрагент1",name:"contragent_id",localId:"contragent",value:"1",options:n.a,view:"combo-close",height:38,labelWidth:100,placeholder:"Выберите контрагента1"},{label:"Статья1",name:"category_id",localId:"category",value:"1",options:l.a,view:"combo",height:38,labelWidth:100,placeholder:"Выберите статью"},{localId:"label_move_to",label:"Куда",view:"label",height:38,css:{"text-align":"center"},hidden:!0},{label:"Счет",name:"account_move_id",localId:"account",value:"",options:a.a,placeholder:"Выберите счет",view:"combo",height:38,labelWidth:100,hidden:!0,required:!0,invalidMessage:"Значение не может быть пустым!"},{label:"Проект",name:"project_id",localId:"project",value:"1",options:r.a,view:"combo",height:38,labelWidth:100,placeholder:"Выберите проект"},{name:"comment",label:"Назначение платежа1",view:"text",height:52,labelWidth:100,placeholder:"Введите комментарий"}]},{margin:10,cols:[{view:"template",template:" ",role:"placeholder",borderless:!0},{view:"button",label:"Отмена",css:"webix_transparent",align:"right",width:120},{view:"button",css:"webix_primary",label:"Сохранить",align:"right",width:120,click:function(){return e.doClickSave()}}]}]}}},c.init=function(e){$$("table1")&&this.$$("my_form1").bind("table1"),this.attachFormEvents()},c.attachFormEvents=function(){var e=this.$$("my_form1").elements.type_operation;e.attachEvent("onChange",(function(e,t){3===e?(this.$scope.$$("label_move_from").show(),this.$scope.$$("label_move_to").show(),this.getFormView().elements.account_move_id.show(),this.getFormView().elements.contragent_id.hide(),this.getFormView().elements.category_id.hide(),this.$scope.$$("label_value_break").hide()):(this.$scope.$$("label_move_from").hide(),this.$scope.$$("label_move_to").hide(),this.getFormView().elements.account_move_id.hide(),this.getFormView().elements.contragent_id.show(),this.getFormView().elements.category_id.show(),this.$scope.$$("label_value_break").show())}))},c.showParts=function(e){var t=this.$$("table_part_value");if(t.clearAll(),e)for(var i in e.data)t.add(e.data[i])},c.showWindow=function(e){if(this.showParts($$("table1").getSelectedItem()),this.$$("my_form1").clearValidation(),this.$$("my_form1").attachEvent("onBindApply",(function(){null==$$("table1").getCursor()&&this.setValues({id:null,date_operation:new Date,is_committed:1,type_operation:2})})),"create"==e);else{if(4==$$("table1").getSelectedItem().type_operation)return;$$("table1").getSelectedItem()&&$$("table1").getSelectedItem().data?this.$$("combo_value_break").show():(this.$$("combo_value_break").setValue(1),this.$$("combo_value_break").hide())}this.getRoot().show()},c.doClickSave=function(){if(this.$$("my_form1").validate()){var e=this.$$("my_form1").getValues(),t=e.id,i=(webix.Date.dateToStr("%Y-%m-%d"),{type_operation:e.type_operation,date_operation:e.date_operation,is_committed:e.is_committed,value:e.value,comment:e.comment,value_in_user_currency:e.value,currency_id:1,account_id:e.account_id,account_move_id:e.account_move_id,category_id:e.category_id,contragent_id:e.contragent_id,project_id:e.project_id,account:{name:this.$$("account").getText()},category:{name:this.$$("category").getText()},contragent:{id:e.contragent_id,name:this.$$("contragent").getText()},project:{name:this.$$("project").getText()},type_part_id:e.type_part_id,id:e.id}),o=this;if(t){i={type_operation:e.type_operation,date_operation:e.date_operation,is_committed:e.is_committed,value:e.value,comment:e.comment,value_in_user_currency:e.value,currency_id:1,account_id:e.account_id,account_move_id:e.account_move_id,category_id:e.category_id,contragent_id:e.contragent_id,project_id:e.project_id,account:this.$$("account").getText(),category:this.$$("category").getText(),contragent:this.$$("contragent").getText(),project:this.$$("project").getText(),type_part_id:e.type_part_id,id:parseInt(t)};var a=this.getParts();i.data=a,webix.dp($$("table1")).save(t,"update",i).then((function(e){webix.dp($$("table1")).ignore((function(){$$("table1").updateItem(t,i)})),o.getRoot().hide()}),(function(){webix.message("Data were not saved")})),o.getRoot().hide()}else{a=this.getParts();i.data=a,webix.dp($$("table1")).save(webix.uid(),"insert",i).then((function(e){webix.dp($$("table1")).ignore((function(){i.id=e.id,$$("table1").add(i,0),$$("table1").select(i.id),$$("table1").scrollTo(0,0)})),o.getRoot().hide()}),(function(){webix.message("Data were not saved")}))}}},c.getParts=function(){var e=this.$$("table_part_value").serialize(),t=[];for(var i in e)t.push(e[i]);return t},o}(o.b)},function(e,t,i){"use strict"},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);webix.UIManager.addHotKey("enter",(function(e){var t=e.getSelectedId();e.edit(t)}),$$("cloth-table"));var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Ткани",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("cloth-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"cloth-table",urlEdit:"cloth",css:"webix_header_border webix_data_border",select:"cell",resizeColumn:{headerOnly:!0},editable:!0,editaction:"dblclick",clipboard:"selection",multiselect:!0,math:!0,sort:"multi",columns:[{id:"index",header:"#",sort:"int",width:50},{id:"id",header:"ID",width:50,sort:"int"},{id:"provider",header:["Поставщик",{content:"selectFilter"}],width:120,edit:"text",sort:"text"},{id:"full_name",header:["Полн. наимен.",{content:"textFilter"}],width:380,sort:"text"},{id:"name",header:["Название",{content:"textFilter"}],width:120,edit:"text",sort:"text"},{id:"color",header:["Цвет",{content:"textFilter"}],width:120,edit:"text",sort:"text"},{id:"price",header:["Цена",{content:"numberFilter"}],width:120,edit:"text",sort:"int"},{id:"category",header:["Категория",{content:"selectFilter"}],width:120,edit:"text",sort:"int"},{id:"qty",header:["К-во",{content:"numberFilter",format:webix.i18n.numberFormat}],width:120,edit:"text",editor:"text",sort:"int"},{id:"sum",header:["Сумма",{content:"summColumn",css:{"text-align":"right","font-weight":300}}],format:webix.i18n.numberFormat,css:{"text-align":"right","font-weight":300},sort:"int",width:120,edit:"text",math:"[$r,price] * [$r,qty]"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/cloths",{sort:"provider+name+color","per-page":"-1"}),save:"api->accounting/cloths",ready:function(){this.sort([{by:"provider",dir:"asc"},{by:"name",dir:"asc"},{by:"color",dir:"asc"}]),this.markSorting("provider","asc"),this.markSorting("name","asc",!0),this.markSorting("color","asc",!0)},on:{"data->onStoreUpdated":function(){this.data.each((function(e,t){e.index=t+1}))},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-edit"==e.column&&this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("cloth-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()},sort:"color"};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/cloths",{sort:"provider+name+color","per-page":"-1"}),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("cloth-table").unselect(),this.cashEdit.showForm(this.$$("cloth-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Контрагенты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("contragent-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"contragent-table",urlEdit:"contragent",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наиименование",width:380,sort:"string"},{id:"account",header:"Счет",width:100},{id:"external_id",header:"Экспорт ID"},{id:"category_in_id",header:"Родитель"},{id:"bank",header:"Банк"},{id:"mfo",header:"МФО"},{id:"okpo",header:"ОКПО"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/contragents"),save:"api->accounting/contragents",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("contragent-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/contragents",{order:"contragent,category,project,account,data"}),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("contragent-table").unselect(),this.cashEdit.showForm(this.$$("contragent-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Отделы",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("department-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"department-table",urlEdit:"department",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наиименование",width:280,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/departments",{sort:"name"}),save:"api->accounting/departments",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("department-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/departments"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("department-table").unselect(),this.cashEdit.showForm(this.$$("department-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return this.apiRest=this.app.config.apiRest,{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("directory-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"directory-table",urlEdit:"directory",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"type_id",header:"Тип справочника",width:150,options:t.apiRest.getCollection("accounting/directory-types")},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/directories",{sort:"type_id"}),save:"api->accounting/directories",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("directory-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/directories",{sort:"type_id"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("directory-table").unselect(),this.cashEdit.showForm(this.$$("directory-table"))},n.doClickOpenAll=function(){var e=this.$$("directory-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("directory-type-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"directory-type-table",urlEdit:"directory-type",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/directory-types",{sort:"name"}),save:"api->accounting/directory-types",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("directory-type-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/directory-types",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("directory-type-table").unselect(),this.cashEdit.showForm(this.$$("directory-type-table"))},n.doClickOpenAll=function(){var e=this.$$("directory-type-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Сотрудники",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("employee-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"employee-table",urlEdit:"employee",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"department_name",header:"Сотрудники",width:280,template:function(e,t){return e.$group?t.treetable(e,t)+e.department_name:t.treetable(e,t)+e.name}},{id:"status",header:"Статус",width:150,sort:"string",collection:[{id:"0",value:"Уволен"},{id:"1",value:"Работает"}]},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/employees",{sort:"name","per-page":-1}),save:"api->accounting/employees",scheme:{$group:{by:"department_name",map:{department_name:["department_name"],name:["name"],department_id:["department_id"]}},$sort:{by:"department_id",dir:"asc",as:"int"}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("employee-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/employees",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("employee-table").unselect(),this.cashEdit.showForm(this.$$("employee-table"))},n.doClickOpenAll=function(){var e=this.$$("employee-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Типы зарплат",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("salary-type-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"salary-type-table",urlEdit:"employee-salary-type",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наиименование",width:280,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/employee-salary-types",{sort:"name"}),save:"api->accounting/employee-salary-types",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("salary-type-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/employee-salary-types"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("salary-type-table").unselect(),this.cashEdit.showForm(this.$$("salary-type-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(53),n=i(6);i(2),i(4),i(3);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{localId:"layout",id:"list-salary-accrual-view",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Журнал начисления зарплаты",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("time-work-table")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"list-salary-accrual-table",urlEdit:"list-salary-accrual",css:"webix_header_border webix_data_border",select:!0,hover:"myhover",resizeColumn:{headerOnly:!0},columns:[{id:"index",header:"#",sort:"int",width:50},{id:"date_document",header:"Дата",width:130,sort:"string",format:webix.i18n.fullDateFormatStr},{id:"id",header:"ID",width:30,sort:"string"},{id:"date_created",header:"Время создания",width:130,sort:"string",format:webix.i18n.fullDateFormatStr},{id:"type_document_name",header:"Тип",width:180,sort:"string",template:"Начисление зарплаты"},{id:"sum",header:"Сумма",width:80,sort:"string",fillspace:!0,format:webix.i18n.numberFormat}],url:this.app.config.apiRest.getUrl("get","accounting/list-salary-accruals",{sort:"name"}),save:"api->accounting/list-salary-accruals",on:{"data->onStoreUpdated":function(){this.data.each((function(e,t){e.index=t+1}))},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},r.init=function(e){this.$$("form-search");var t=this.$$("list-salary-accrual-table"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),r=this.$$("dateTo"),l=i(this.$$("dateFrom").getValue()),c=i(this.$$("dateTo").getValue()),s=this.app.config.apiRest.getUrl("get","accounting/list-salary-accruals",{dateFrom:l,dateTo:c}),d=this;t.load(s),o.attachEvent("onChange",(function(e){l=i(o.getValue()),c=i(r.getValue()),d.changeColumns(o,r);var a=d.app.config.apiRest.getUrl("get","accounting/list-salary-accruals",{dateFrom:l,dateTo:c});t.clearAll(),t.load(a)})),r.attachEvent("onChange",(function(e){l=i(o.getValue()),c=i(r.getValue()),d.changeColumns(o,r);var a=d.app.config.apiRest.getUrl("get","accounting/list-salary-accruals",{dateFrom:l,dateTo:c});t.clearAll(),t.load(a)})),this.cashEdit=this.ui(a.default),n.a["list-salary-accrual-view"]=this,$$("top:menu").getItem("list-salary-accrual-view")&&$$("top:menu").remove("list-salary-accrual-view"),$$("top:menu").add({id:"list-salary-accrual-view",value:"Журнал начисления зарплаты",icon:"mdi mdi-view-dashboard"},null,"info")},r.doAddClick=function(){this.$$("list-salary-accrual-table").unselect(),this.cashEdit.showForm(this.$$("list-salary-accrual-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Справочники калькулятора",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("calculation-directory-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"calculation-directory-table",urlEdit:"calculation-directory",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"type_model",header:"Модель",width:150},{id:"connection_field",header:"Ключевое поле",width:150},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/calculation-directories",{sort:"name"}),save:"api->accounting/calculation-directories",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("calculation-directory-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/calculation-directories",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("calculation-directory-table").unselect(),this.cashEdit.showForm(this.$$("calculation-directory-table"))},n.doClickOpenAll=function(){var e=this.$$("calculation-directory-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Поля/Тип калькулятора",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("calculation-field-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"calculation-field-table",urlEdit:"calculation-field",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"field_name",header:"Свойство",width:150},{id:"type_model",header:"Модель",width:150},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/calculation-fields",{sort:"name"}),save:"api->accounting/calculation-fields",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("calculation-field-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/calculation-fields",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("calculation-field-table").unselect(),this.cashEdit.showForm(this.$$("calculation-field-table"))},n.doClickOpenAll=function(){var e=this.$$("calculation-field-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(54);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return this.api=this.app.config.apiRest,{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Правила калькулятора стандарт",width:250},{},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("order-calculation-rule-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"datatable",localId:"order-calculation-rule-table",urlEdit:"order-calculation-rule",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"process_id",header:"Процесс",width:100,options:[{id:"1",value:"Прайс"},{id:"2",value:"Скидка клиента"}]},{id:"index_order",header:"Порядок выполнения",width:150},{id:"order_field",header:"Свойство",width:100,sort:"string",options:t.api.getCollection("accounting/calculation-fields",{"per-page":-1})},{id:"type",header:"Тип свойства",width:120,css:{"text-align":"center"},options:[{id:"value",value:"Значение"},{id:"dir",value:"Справочник"}]},{id:"directory_id",header:"Справочник",width:120,css:{"text-align":"center"},options:t.api.getCollection("accounting/calculation-directories",{"per-page":-1})},{id:"rule",header:"Условие",width:100,css:{"text-align":"center"}},{id:"value",header:"Значение условия",width:100,css:{"text-align":"right"}},{id:"result_type",header:"Тип результата",width:150,collection:[{id:"value",value:"Значение"},{id:"dir",value:"Справочник"}]},{id:"result_value_operation",header:"Операция со значением",width:150},{id:"result_value",header:"Значение",width:150},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/order-calculation-rules",{sort:"index_order","per-page":-1}),save:"api->accounting/order-calculation-rules",scheme:{$group:{by:"department_name",map:{department_name:["department_name"],name:["name"],department_id:["department_id"]}},$sort:{by:"department_id",dir:"asc",as:"int"}},ready:function(){},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){this.cashEdit=this.ui(a.default)},n.doRefresh=function(){var e=this.$$("order-calculation-rule-table");this.restApi=this.app.config.apiRest;var t=this.restApi.getUrl("get","accounting/order-calculation-rules",{"per-page":"-1",sort:'[{"property":"index_order","direction":"ASC"}]'});webix.extend(e,webix.ProgressBar),e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(t).then((function(t){e.clearAll(),e.parse(t.json().data),e.enable()}))},n.doAddClick=function(){this.$$("order-calculation-rule-table").unselect(),this.cashEdit.showForm(this.$$("order-calculation-rule-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),n=webix.Date.strToDate("%Y-%m-%d"),r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e,t=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"План Столярка",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(e){t.showBatch(e)}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"sewing-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.date_carpenter):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"B",header:["Статус",{content:"selectFilter"},""],width:70,batch:2,editor:"select",options:[{id:1,value:"1"},{id:3,value:"3"},{id:4,value:"4"},{id:5,value:"5"},{id:6,value:"6"}]},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",batch:2},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",batch:2},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",batch:2},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"coefMoney",header:["Коэф. ден. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1,template:function(e){var t=parseFloat(e.G.replace(",",""));return e.$group?webix.Number.format(t/7860,{decimalDelimiter:".",decimalSize:2}):webix.Number.format(parseFloat(e.G/7860))}},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,template:function(e){return a(n(e.date_obivka))}},{id:"AA",header:["Коэф. об. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1},{id:"AG",header:["Коэф. ст. план",{content:"textFilter"},{content:"totalColumn"}],width:125,css:{"text-align":"right","font-weight":500},batch:1},{id:"date_carpenter",header:["Дата Ст.",{content:"selectFilter"},""],width:100,editor:"date",batch:1,hidden:!1,template:function(e){return a(n(e.date_carpenter))}},{id:"BA",header:["Статус ст.",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check"></i>':null===e.BA?"":e.BA}},{id:"coef_carpenter",header:["Коэф. Ст. гот.",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"K",header:["Дата клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},(e={id:"W",header:["Статус Об.",{content:"selectFilter"},""],width:90,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500}},e.batch=2,e.template=function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-check"></i>':null===e.W?"":e.W},e),{id:"date_sewing",header:["Дата Пош.",{content:"selectFilter"},""],width:90,editor:"date",batch:1,hidden:!1,template:function(e){return a(n(e.date_sewing))}},{id:"BP",header:["Статус Пош.",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check"></i>':null===e.BP?"":e.BP}},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text",batch:2},{id:"AK",header:"Обивка царги",width:110,batch:3,editor:"text"},{id:"AL",header:"Статус",width:60,batch:3,editor:"text"},{id:"AM",header:"Дата",width:90,batch:3,editor:"text"},{id:"AP",header:"Паралон изг.",width:110,batch:3,editor:"text"},{id:"AQ",header:"Статус",width:60,batch:3,editor:"text"},{id:"AR",header:"Дата",width:90,batch:3,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:["Столярка",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},{id:"BO",header:"Пошив",width:115,batch:1,editor:"text"},{id:"BV",header:"Крой",width:115,batch:1,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:"date_carpenter",map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CI:["CI","median"],coef_carpenter:["coef_carpenter","median"],missing:!1}},$sort:{by:"date_carpenter",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)}}}]}},r.init=function(e){var t=this.$$("sewing-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_carpenter","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_carpenter":{">=":"'+n+'","<=":"'+r+'"}}'}),c=this;webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_carpenter","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_carpenter":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_carpenter","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_carpenter":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},r.doClickOpenAll=function(){var e=this.$$("sewing-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},r.showBatch=function(e){this.$$("sewing-table").showColumnBatch(e)},r.beforeDropChangeData=function(e,t){var i={date_carpenter:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_carpenter=t,webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),n=webix.Date.strToDate("%Y-%m-%d"),r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e,t=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"План Крой",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(e){t.showBatch(e)}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"sewing-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.date_cut):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"B",header:["Статус",{content:"selectFilter"},""],width:70,batch:2,editor:"select",options:[{id:1,value:"1"},{id:3,value:"3"},{id:4,value:"4"},{id:5,value:"5"},{id:6,value:"6"}]},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",batch:2},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",batch:2},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",batch:2},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"coefMoney",header:["Коэф. ден. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1,template:function(e){var t=parseFloat(e.G.replace(",",""));return e.$group?webix.Number.format(t/7860,{decimalDelimiter:".",decimalSize:2}):webix.Number.format(parseFloat(e.G/7860))}},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,template:function(e){return a(n(e.date_obivka))}},{id:"AA",header:["Коэф. об. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1},{id:"CI",header:["Коэф. крой. план",{content:"textFilter"},{content:"totalColumn"}],width:125,css:{"text-align":"right","font-weight":500},batch:1},{id:"date_cut",header:["Дата Крой",{content:"selectFilter"},""],width:100,editor:"date",batch:1,hidden:!1,template:function(e){return a(n(e.date_cut))}},{id:"BW",header:["Статус крой",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BW?'<i class="mdi mdi-check"></i>':null===e.BW?"":e.BW}},{id:"coef_cut",header:["Коэф. Крой гот.",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"K",header:["Дата клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},(e={id:"W",header:["Статус Об.",{content:"selectFilter"},""],width:90,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500}},e.batch=2,e.template=function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-check"></i>':null===e.W?"":e.W},e),{id:"date_sewing",header:["Дата Пош.",{content:"selectFilter"},""],width:90,editor:"date",batch:1,hidden:!1,template:function(e){return a(n(e.date_sewing))}},{id:"BP",header:["Статус Пош.",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check"></i>':null===e.BP?"":e.BP}},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check"></i>':null===e.BA?"":e.BA}},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text",batch:2},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"AK",header:"Обивка царги",width:110,batch:3,editor:"text"},{id:"AL",header:"Статус",width:60,batch:3,editor:"text"},{id:"AM",header:"Дата",width:90,batch:3,editor:"text"},{id:"AP",header:"Паралон изг.",width:110,batch:3,editor:"text"},{id:"AQ",header:"Статус",width:60,batch:3,editor:"text"},{id:"AR",header:"Дата",width:90,batch:3,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:"Столярка",width:115,batch:3,editor:"text"},{id:"BB",header:"Дата",width:90,batch:3,editor:"text"},{id:"BO",header:"Пошив",width:115,batch:1,editor:"text"},{id:"BV",header:["ФИО крой",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:"date_cut",map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CI:["CI","median"],coef_cut:["coef_cut","median"],missing:!1}},$sort:{by:"date_cut",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)}}}]}},r.init=function(e){var t=this.$$("sewing-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_cut","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_cut":{">=":"'+n+'","<=":"'+r+'"}}'}),c=this;webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_cut","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_cut":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_cut","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_cut":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},r.doClickOpenAll=function(){var e=this.$$("sewing-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},r.showBatch=function(e){this.$$("sewing-table").showColumnBatch(e)},r.beforeDropChangeData=function(e,t){var i={AE:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_cut=t,webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return c}));var o=i(0),a=i(59),n=i(60);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.middleCoefMat=function(e,t){if(!t.length)return 0;for(var i=0,o=0,a=0,n=t.length-1;n>=0;n--)if(1==t[n].$level){var r=t[n].expense_mat,l=t[n].V;""!=r&&(null!==r&&(r=r.replace(".",",")),r=webix.Number.parse(r,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(r)||isNaN(l)||(i+=1*r,o+=1*l))}return 0!=o&&(a=i/o),webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.ui.datafilter.totalColumnCoefMat=webix.extend({refresh:function(e,t,i){var o,a,n=0,r=0,l=0;e.data.each((function(e){e.$group||(o=e.expense_mat,a=e.V,null!==o&&"0"!=a&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),o=parseFloat(o),isNaN(o)||(n+=1*o),r+=1*a))})),0!=r&&(l=n/r),n=webix.i18n.numberFormat(l,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(n=i.format(n)),i.template&&(n=i.template({value:n})),t.innerHTML=n}},webix.ui.datafilter.summColumn),webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var r=webix.Date.dateToStr("%d.%m.%y"),l=webix.Date.strToDate("%Y-%m-%d");var c=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var c=o.prototype;return c.config=function(){var e=this;this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"01.12.20"}}'});return{rows:[{cols:[{view:"label",width:200,height:30,template:"План результата",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){e.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(t){e.showBatch(t)}}},{view:"icon",icon:"mdi mdi-tools",autowidth:!0,popup:{view:"contextmenu",scroll:"y",width:200,height:550,autoheight:!1,localId:"columns-setting",data:[{value:"Profile",href:"#profile"},{value:"Settings",href:"#settings"},{value:"Dummy"},{id:"logout",value:"Logout"}],$init:function(){e.loadColumnsSetting(this,null)},on:{onMenuItemClick:function(t){e.columnSettingClick(this,t)}}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"order-result-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",dragColumn:!0,sort:"multi",headermenu:!0,tooltip:!0,columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,sort:"date",tooltip:"#F# <br>#C#-#D# Дата клиента: #H# <br>#E#<br> #I#<br> #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+r(e.value):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",hidden:!1},{id:"I",header:["Изделие",{content:"textFilter"},""],width:180,editor:"text",hidden:!1},{id:"product_id",header:["Изделие",{content:"textFilter"},""],width:200,editor:"combo",options:n.a},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text",sort:"string",hidden:!0},{id:"cloth_id",header:["Ткань",{content:"textFilter"},""],width:200,editor:"combo",options:a.a,sort:"string"},{id:"width",header:["Ширина",{content:"selectFilter"},""],width:70,css:{"text-align":"center"},batch:1,editor:"text"},{id:"length",header:["Длина",{content:"selectFilter"},""],width:70,css:{"text-align":"center"},batch:1,editor:"text"},{id:"size",header:["Размер",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,css:{"text-align":"center"},batch:1,editor:"text"},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",hidden:!0},{id:"G",width:90,header:["Сумма план",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",hidden:!0},{id:"V",header:["Сумма факт",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500}},{id:"J",header:["Каркас",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,hidden:!0,css:{"text-align":"center"},batch:1,editor:"text"},{id:"date_shipment",header:["Дата отгр.",{content:"selectFilter"},""],width:100,editor:"date",hidden:!0,template:function(e){return r(l(e.date_shipment))}},{id:"B",header:["Отг.",{content:"selectFilter"},""],width:50,editor:"text",hidden:!0,css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":4==e.B?'<i class="mdi mdi-check-circle"></i>':null===e.B?"":e.B}},{id:"profit",header:["Profit",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"green","text-align":"right","font-weight":600}},{id:"coef_mat",header:["Коэф. мат.",{content:"selectFilter"},{content:"totalColumnCoefMat"}],width:110,css:{color:"green","text-align":"right","font-weight":600}},{id:"expense",header:["Затраты",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"black","text-align":"right","font-weight":600}},{id:"net_cost",header:["Сумма база",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"black","text-align":"right","font-weight":600},template:function(e){return 2==e.$level&&0==e.net_cost&&(e.$cellCss={net_cost:{color:"red"}}),e.net_cost}},{id:"cloth_sum",header:["Сумма тк.",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"black","text-align":"right","font-weight":600},template:function(e){return 2==e.$level&&0==e.cloth_sum&&(e.$cellCss={cloth_sum:{color:"red"}}),e.cloth_sum}},{id:"expense_cloth",header:["Расх. тк.",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"black","text-align":"right","font-weight":200}},{id:"cloth_price",header:["Цена тк.",{content:"selectFilter"},""],width:110,css:{color:"black","text-align":"right","font-weight":200},template:function(e){return e.cloth?e.cloth.price:0}},{id:"cost_work",header:["Стоим. работ",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"green","text-align":"right","font-weight":600}},{id:"cost_cut",header:["Раб. крой",{content:"selectFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right"}},{id:"cost_sewing",header:["Раб. пошив",{content:"selectFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right"}},{id:"cost_ot",header:["Раб. отстр.",{content:"selectFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right"}},{id:"cost_carcass",header:["Раб. ст. цар.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_carcass?e.productWorkSalary.cost_carcass:""}},{id:"cost_headboard",header:["Раб. ст. изг.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_headboard?e.productWorkSalary.cost_headboard:""}},{id:"cost_grinding",header:["Раб. ст. шлиф.",{content:"selectFilter"},""],width:110,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_grinding?e.productWorkSalary.cost_grinding:""}},{id:"cost_rubber_carcass",header:["Раб. пор. цар.",{content:"selectFilter"},""],width:110,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_rubber_carcass?e.productWorkSalary.cost_rubber_carcass:""}},{id:"cost_rubber_headboard",header:["Раб. пор. изг.",{content:"selectFilter"},""],width:110,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_rubber_headboard?e.productWorkSalary.cost_rubber_headboard:""}},{id:"cost_upholstery_carcass",header:["Раб. об. цар.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_upholstery_carcass?e.productWorkSalary.cost_upholstery_carcass:""}},{id:"cost_upholstery_headboard",header:["Раб. об. изг.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_upholstery_headboard?e.productWorkSalary.cost_upholstery_headboard:""}},{id:"cost_buttons",header:["Раб. об. пуг.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_buttons?e.productWorkSalary.cost_buttons:""}},{id:"cost_matras",header:["Раб. об. мат.",{content:"selectFilter"},""],width:100,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_matras?e.productWorkSalary.cost_matras:""}},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text"},{id:"AZ",header:["Столярка ФИО",{content:"selectFilter"},""],width:115,editor:"text"},{id:"BO",header:["Пошив ФИО",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},{id:"BV",header:["Крой ФИО",{content:"selectFilter"},""],width:115,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:function(e){return e.date_obivka},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],value:["date_obivka"],A:["A"],profit:["profit","sum"],expense:["expense","sum"],net_cost:["net_cost","sum"],cost_work:["cost_work","sum"],cloth_sum:["cloth_sum","sum"],expense_cloth:["expense_cloth","sum"],coef_mat:["coef_mat","middleCoefMat"],cost_cut:["cost_cut","sum"],cost_sewing:["cost_sewing","sum"]}},$sort:{by:"AE",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){e.configColumns=this.config.columns;var t=webix.storage.local.get("order-result-table");t&&this.setState(t)},scroll:!0,on:{onColumnResize:function(){webix.storage.local.put("order-result-table",this.getState())},onAfterColumnDrop:function(){webix.storage.local.put("order-result-table",this.getState())},onAfterColumnShow:function(){},onresize:webix.once((function(){})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(t,i){var o=this.getItem(t.start),a=this.getItem(t.parent);e.beforeDropChangeData(o,a.value)}}}]}},c.init=function(e){var t=this.$$("order-result-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+r+'"}}'}),c=this;webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},c.doClickOpenAll=function(){var e=this.$$("order-result-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},c.showBatch=function(e){this.$$("order-result-table").showColumnBatch(e)},c.beforeDropChangeData=function(e,t){var i={AE:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_obivka=t,e.AE=r(t),webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},c.loadColumnsSetting=function(e,t){var i,o=this,a=[];this.configColumns.forEach((function(n,r){i="wxi-eye-slash",o.$$("order-result-table").isColumnVisible(n.id)&&(i="wxi-eye"),n.id==t&&(e.data[r].icon="webix_icon webix_list_icon "+i,e.updatItem(t)),a.push({value:n.header[0].text,id:n.id,icon:"webix_icon webix_list_icon "+i})})),e.data=a},c.columnSettingClick=function(e,t){var i="webix_icon webix_list_icon wxi-eye",o=i,a=this.$$("order-result-table");a.isColumnVisible(t)?a.hideColumn(t,{spans:!1}):a.showColumn(t,{spans:!1}),e.getItem(t).icon==i&&(o="webix_icon webix_list_icon wxi-eye-slash"),e.getItem(t).icon=o,e.updateItem(t),webix.storage.local.put("order-result-table",a.getState())},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),n=webix.Date.strToDate("%Y-%m-%d"),r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e,t=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"План Пошив",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(e){t.showBatch(e)}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"sewing-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.date_sewing):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"B",header:["Статус",{content:"selectFilter"},""],width:70,batch:2,editor:"select",options:[{id:1,value:"1"},{id:3,value:"3"},{id:4,value:"4"},{id:5,value:"5"},{id:6,value:"6"}]},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",batch:2},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text",batch:2},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text",batch:2},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"coefMoney",header:["Коэф. ден. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1,template:function(e){var t=parseFloat(e.G.replace(",",""));return e.$group?webix.Number.format(t/7860,{decimalDelimiter:".",decimalSize:2}):webix.Number.format(parseFloat(e.G/7860))}},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,template:function(e){return a(n(e.date_obivka))}},{id:"AA",header:["Коэф. об. план",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1},{id:"CH",header:["Коэф. пош. план",{content:"textFilter"},{content:"totalColumn"}],width:125,css:{"text-align":"right","font-weight":500},batch:1},{id:"date_sewing",header:["Дата Пош.",{content:"selectFilter"},""],width:90,editor:"date",batch:1,hidden:!1,template:function(e){return a(n(e.date_sewing))}},{id:"BP",header:["Статус Пош.",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check"></i>':null===e.BP?"":e.BP}},{id:"coef_sewing",header:["Коэф. Пош. гот.",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"K",header:["Дата клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},(e={id:"W",header:["Статус Об.",{content:"selectFilter"},""],width:90,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500}},e.batch=2,e.template=function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-check"></i>':null===e.W?"":e.W},e),{id:"BX",header:["Дата Крой",{content:"selectFilter"},""],width:100,batch:1,editor:"text"},{id:"BW",header:["Статус крой",{content:"selectFilter"},""],width:100,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BW?'<i class="mdi mdi-check"></i>':null===e.BW?"":e.BW}},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check"></i>':null===e.BA?"":e.BA}},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text",batch:2},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"AK",header:"Обивка царги",width:110,batch:3,editor:"text"},{id:"AL",header:"Статус",width:60,batch:3,editor:"text"},{id:"AM",header:"Дата",width:90,batch:3,editor:"text"},{id:"AP",header:"Паралон изг.",width:110,batch:3,editor:"text"},{id:"AQ",header:"Статус",width:60,batch:3,editor:"text"},{id:"AR",header:"Дата",width:90,batch:3,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:"Столярка",width:115,batch:3,editor:"text"},{id:"BB",header:"Дата",width:90,batch:3,editor:"text"},{id:"BO",header:["ФИО пош.",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},{id:"BV",header:"Крой",width:115,batch:1,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:"date_sewing",map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],CH:["CH","median"],coef_sewing:["coef_sewing","median"],missing:!1}},$sort:{by:"date_sewing",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,i){var o=this.getItem(e.start),a=this.getItem(e.parent);t.beforeDropChangeData(o,a.value)}}}]}},r.init=function(e){var t=this.$$("sewing-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_sewing","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_sewing":{">=":"'+n+'","<=":"'+r+'"}}'}),c=this;webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_sewing","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_sewing":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_sewing","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_sewing":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},r.doClickOpenAll=function(){var e=this.$$("sewing-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},r.showBatch=function(e){this.$$("sewing-table").showColumnBatch(e)},r.beforeDropChangeData=function(e,t){var i={date_sewing:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_sewing=t,webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),n=webix.Date.strToDate("%Y-%m-%d"),r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"План Пошив+Крой",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){e.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(t){e.showBatch(t)}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"sewing-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.date_sewing):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"B",header:["Статус",{content:"selectFilter"},""],width:70,batch:2,editor:"select",options:[{id:1,value:"1"},{id:3,value:"3"},{id:4,value:"4"},{id:5,value:"5"},{id:6,value:"6"}]},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text"},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text"},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text"},{id:"coefMoney",header:["Коэф. ден. план",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1,template:function(e){var t=parseFloat(e.G.replace(",",""));return e.$group?webix.Number.format(t/7860,{decimalDelimiter:".",decimalSize:2}):webix.Number.format(parseFloat(e.G/7860))}},{id:"AA",header:["Коэф. вр. план",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1},{id:"AJ",header:["Коэф. шв.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},""],width:70,batch:2,editor:"text"},{id:"K",header:["Дата клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,template:function(e){return a(n(e.date_obivka))}},{id:"W",header:["Об.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-check"></i>':null===e.W?"":e.W}},{id:"date_sewing",header:["Дата Шв.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,hidden:!1,template:function(e){return a(n(e.date_sewing))}},{id:"BP",header:["Шв.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check"></i>':null===e.BP?"":e.BP}},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"black","text-align":"center","font-weight":500},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check"></i>':null===e.BA?"":e.BA}},{id:"coef_sewing_cut",header:["Коэф. шв. гот.",{content:"textFilter"},{content:"totalColumn"}],width:110,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"V",header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500}},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:2},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:2},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text",batch:2},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1},{id:"AK",header:"Обивка царги",width:110,batch:3,editor:"text"},{id:"AL",header:"Статус",width:60,batch:3,editor:"text"},{id:"AM",header:"Дата",width:90,batch:3,editor:"text"},{id:"AP",header:"Паралон изг.",width:110,batch:3,editor:"text"},{id:"AQ",header:"Статус",width:60,batch:3,editor:"text"},{id:"AR",header:"Дата",width:90,batch:3,editor:"text"},{id:"AU",header:"Паралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата",width:90,batch:3,editor:"text"},{id:"AZ",header:"Столярка",width:115,batch:3,editor:"text"},{id:"BB",header:"Дата",width:90,batch:3,editor:"text"},{id:"BO",header:"Пошив",width:115,batch:1,editor:"text"},{id:"BQ",header:"Дата",width:90,batch:1,editor:"text"},{id:"BV",header:"Крой",width:115,batch:1,editor:"text"},{id:"BW",header:"Статус",width:60,batch:1,editor:"text"},{id:"BX",header:"Дата",width:90,batch:1,editor:"text"},{id:"CD",header:"Упаковка",width:80,batch:3,editor:"text"},{id:"CE",header:"Дата",width:90,batch:3,editor:"text"}],save:"api->accounting/orders",scheme:{$group:{by:"date_sewing",map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],coef_sewing_cut:["coef_sewing_cut","median"],missing:!1}},$sort:{by:"date_sewing",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){},scroll:!0,on:{onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(t,i){var o=this.getItem(t.start),a=this.getItem(t.parent);e.beforeDropChangeData(o,a.value)}}}]}},r.init=function(e){var t=this.$$("sewing-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_sewing","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_sewing":{">=":"'+n+'","<=":"'+r+'"}}'}),c=this;webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_sewing","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_sewing":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"date_sewing","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"date_sewing":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},r.doClickOpenAll=function(){var e=this.$$("sewing-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},r.showBatch=function(e){this.$$("sewing-table").showColumnBatch(e)},r.beforeDropChangeData=function(e,t){var i={date_sewing:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_sewing=t,webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("package-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"package-table",urlEdit:"package",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"key",header:"Ключ",width:200},{id:"price",header:"Цена",width:80,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/packages",{sort:"name"}),save:"api->accounting/packages",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("package-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/packages",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("package-table").unselect(),this.cashEdit.showForm(this.$$("package-table"))},n.doClickOpenAll=function(){var e=this.$$("package-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("product-bed-size-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"product-bed-size-table",urlEdit:"product-bed-size",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/product-bed-sizes",{sort:"name"}),save:"api->accounting/product-bed-sizes",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("product-bed-size-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/product-bed-sizes",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("product-bed-size-table").unselect(),this.cashEdit.showForm(this.$$("product-bed-size-table"))},n.doClickOpenAll=function(){var e=this.$$("product-bed-size-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("product-bed-type-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"product-bed-type-table",urlEdit:"product-bed-type",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:280},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/product-bed-types",{sort:"name"}),save:"api->accounting/product-bed-types",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("product-bed-type-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/product-bed-types",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("product-bed-type-table").unselect(),this.cashEdit.showForm(this.$$("product-bed-type-table"))},n.doClickOpenAll=function(){var e=this.$$("product-bed-type-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);webix.UIManager.addHotKey("enter",(function(e){var t=e.getSelectedId();e.edit(t)}),$$("work-salary-table"));var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Ставки по выработке",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("work-salary-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"work-salary-table",urlEdit:"product-work-salary",css:"webix_header_border webix_data_border",select:"cell",multiselect:!0,resizeColumn:{headerOnly:!0},editable:!0,editaction:"custom",clipboard:"selection",columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наиименование",width:380,sort:"string"},{id:"product_id",header:"product_id",width:180,sort:"string",editor:"text"},{id:"size",header:"Размер",width:80,sort:"string",editor:"text"},{id:"net_cost",header:"Себ-ть база",width:120,sort:"string",editor:"text"},{id:"expense_cloth",header:"Расход ткани",width:120,sort:"string",editor:"text"},{id:"coef_time_cut",header:"Коэф. крой",width:100},{id:"coef_time_sewing",header:"Коэф. пош."},{id:"coef_time_carpenter",header:"Коэф. стол."},{id:"coef_time_upholstery",header:"Коэф. обив."},{id:"cost_cut",header:"Цена. крой",width:100},{id:"cost_sewing",header:"Цена. пош.",width:100},{id:"cost_ot",header:"Цена. отст.",width:100},{id:"cost_carcass",header:"Цена ст. цар.",width:110},{id:"cost_headboard",header:"Цена ст. изг.",width:110},{id:"cost_grinding",header:"Цена ст.  шлиф.",width:115},{id:"cost_rubber_carcass",header:"Цена пор. цар.",width:111},{id:"cost_rubber_headboard",header:"Цена пор. изг.",width:110},{id:"cost_upholstery_carcass",header:"Цена об. цар.",width:110},{id:"cost_upholstery_headboard",header:"Цена об. изг.",width:110},{id:"cost_buttons",header:"Цена пуг.",width:100},{id:"cost_matras",header:"Цена мат.",width:100},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/product-work-salaries"),save:"api->accounting/product-work-salaries",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}"action-edit"==e.column&&this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("work-salary-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/product-work-salaries"),a).then((function(e){i.parse(e)}))})),i.attachEvent("onPaste",(function(e){var t=this;this.getSelectedId(!0).forEach((function(o){t.getItem(o.row)[o.column]=e,t.refresh(o.row),i.updateItem(o.row,t.getItem(o.row))}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("work-salary-table").unselect(),this.cashEdit.showForm(this.$$("work-salary-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.config=function(){return{id:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Проводки",width:150},{view:"label",label:"c",align:"left",width:30},{view:"datepicker",name:"date_from",align:"left",width:120},{view:"label",label:"по",align:"left",width:30},{view:"datepicker",name:"date_to",align:"left",width:120},{},{label:"",view:"search",width:300,align:"right"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("table-register")}}]},{view:"datatable",id:"table-register",autoConfig:!0,css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"date_document",header:"Дата",width:90,format:webix.i18n.dateFormatStr},{id:"document_id",header:"Док.",width:50},{id:"account_debet",header:"Дебет"},{id:"subconto1_debet_name",header:"Субконто1"},{id:"subconto2_debet_name",header:"Субконто2"},{id:"account_credit",header:"Кредит"},{id:"subconto1_credit_name",header:"Субконто1"},{id:"subconto2_credit_name",header:"Субконто2"},{id:"sum",header:"Сумма",format:webix.Number.format,css:{"text-align":"right"}}],url:this.app.config.apiRest.getUrl("get","accounting/registers",{"per-page":"-1"})}]}]}},o}(i(0).b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return d}));var o=i(0),a=i(7),n=i(6);function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function c(e,t,i){return function(t){function o(e,i){var o;return(o=t.call(this,e,i)||this).state=new a.a(r(o)),o.state.app=e,o}l(o,t);var d=o.prototype;return d.config=function(){return e},d.init=function(e,t){var o=this.state;o.table=this.$$("table-register"+i),o.tableUrl=this.app.config.apiRest.getUrl("get","accounting/register/turnover"),this.attachTableEvents()},d.attachTableEvents=function(){var e=this.state;e.scope=this;var t={};e.table.attachEvent("onItemDblClick",(function(i){t=e.table.getSelectedItem(),webix.ajax().get(e.tableUrl,{account:t.account_id,account_type:t.account_type}).then((function(i){var o="report"+t.account_id+(t.account_type||0);e.tableId=o,n.a[o]||(n.a[o]=c(s(i,e.tableId),e.scope,o),$$("top:menu").add({id:o,value:"ОСВ:"+t.account,icon:"mdi mdi-view-dashboard"},null,"info"),$$("top:menu").open("info"),$$("views").addView({id:o,rows:[n.a[o]]}),$$("tabs").addOption(o,t.account,!0)),console.log(e.scope.$$("table-register"+e.tableId))}))}))},o}(o.b)}function s(e,t){return void 0===t&&(t=""),{rows:[{view:"toolbar",cols:[{view:"icon",icon:"mdi mdi-close",click:function(){}}],css:{"text-align":"right"}},{view:"datatable",close:!0,localId:"table-register"+t,autoConfig:!0,css:"webix_header_border webix_data_border",header:!0,title:"Оборотно-сальдовая ведомость",footer:!0,autoheight:!0,select:"cell",resizeColumn:{headerOnly:!0},columns:[{header:"",width:50},{id:"account",header:"Субконто",width:170,template:function(e){return e.account_date?webix.i18n.dateFormatStr(e.account_date)+"  №"+e.account:e.account}},{id:"A",header:[{text:"Сальдо на начало",colspan:2},"Дебет"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{id:"B",header:[{text:"",colspan:2},"Кредит"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{id:"sum_debet",header:[{text:"Оборот за период",colspan:2},"Дебет"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"},format:webix.Number.format},{id:"sum_credit",header:[{text:"",colspan:2},"Кредит"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"},format:webix.Number.format},{id:"E",header:[{text:"Сальдо на конец",colspan:2},"Дебет"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{id:"F",header:[{text:"",colspan:2},"Кредит"],footer:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"}},{header:"",fillspace:!0}],data:e},{}]}}var d=function(e){function t(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(r(o)),o.state.app=t,o}l(t,e);var i=t.prototype;return i.config=function(){return{type:"wide",cols:[{rows:[{view:"tabbar",id:"tabs",multiview:!0,close:!0,options:[{id:"t1",value:"ОСВ",hidden:!1,close:!1}],optionWidth:180},{view:"multiview",id:"views",cells:[{id:"t1",rows:[{height:50,css:{"padding-left":150},template:"<h2>Отчеты</h2>",borderless:!1},{view:"toolbar",height:40,paddingY:2,cols:[{view:"menu",data:[{id:"2",value:"Экспорт",submenu:[{id:"3",value:"Excel"},{value:"Csv"},{value:"Pdf"}]}],type:{subsign:!0},on:{onMenuItemClick:function(e){3==e&&webix.toExcel("table-register",{spans:!0,styles:!0})}}},{view:"datepicker",name:"date_from",align:"left",width:120},{view:"label",label:"по",align:"left",width:30},{view:"datepicker",name:"date_to",align:"left",width:120},{},{label:"",view:"search",width:300,align:"right"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("table-register")}}]},{height:70,template:"<h2>Оборотно-сальдовая ведомость</h2>",align:"center,middle"},{rows:[s(""),{align:"bottom"}]}]}]}]}]}},i.init=function(e,t){var i=this.state;i.scope=this,i.table=this.$$("table-register"),i.tabbar=this.$$("tabbar"),i.tableUrl=this.app.config.apiRest.getUrl("get","accounting/register/turnover"),i.table.load(i.tableUrl),n.a.t1=c(s("","t1"),i.scope,"t1"),$$("top:menu").getItem("t1")&&$$("top:menu").remove("t1"),$$("top:menu").add({id:"t1",value:"ОСВ",icon:"mdi mdi-view-dashboard"},null,"info"),$$("top:menu").open("info"),this.attachTableEvents()},i.attachTableEvents=function(){var e=this.state;e.scope=this;var t={};e.table.attachEvent("onItemDblClick",(function(i){t=e.table.getSelectedItem(),webix.ajax().get(e.tableUrl,{account:t.account_id,account_type:t.account_type}).then((function(i){var o="report"+t.account_id+(t.account_type||0);e.tableId=o,n.a[o]||(n.a[o]=c(s(i,e.tableId),e.scope,o),$$("top:menu").add({id:o,value:"ОСВ:"+t.account,icon:"mdi mdi-view-dashboard"},null,"info"),$$("top:menu").open("info"),$$("views").addView({id:o,rows:[n.a[o]]}),$$("tabs").addOption(o,t.account,!0)),console.log(e.scope.$$("table-register"+e.tableId))}))})),$$("tabs").attachEvent("onOptionRemove",(function(e,t){$$("views").removeView(e),delete n.a[e],$$("top:menu").remove(e)}))},t}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);i(1),i(2),i(4),i(3);var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",paddingY:2,cols:[{view:"label",label:"Движение денежных средств",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("category-table")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"treetable",localId:"category-table",autoConfig:!0,css:"webix_header_border webix_data_border",hover:"myhover",leftSplit:1,expand:!0,header:!0,footer:!1,select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"name",header:"Наиименование",width:380,sort:"string",open:!0,template:"{common.treetable()} #name#"},{id:"value",header:"Итого",width:100,css:{"text-align":"right","font-weight":"500",color:"#222"},format:webix.Number.format,footer:{content:"summColumn",css:{"text-align":"right"}}}],ready:function(){}}]}]}},a.init=function(e){var t=this.$$("category-table"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/category/cashflow",{dateFrom:n,dateTo:r}),c=this;c.changeColumns(o,a),t.clearAll(),t.load(l),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue()),c.changeColumns(o,a);var l=c.app.config.apiRest.getUrl("get","accounting/category/cashflow",{dateFrom:n,dateTo:r});t.clearAll(),t.load(l)})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue()),c.changeColumns(o,a);var l=c.app.config.apiRest.getUrl("get","accounting/category/cashflow",{dateFrom:n,dateTo:r});t.clearAll(),t.load(l)}))},a.addColumn=function(e,t){this.$$("category-table").config.columns.splice(1,0,{id:e,header:t,width:100,css:{"text-align":"right"},format:webix.Number.format}),this.$$("category-table").refreshColumns()},a.resetColumns=function(){this.$$("category-table").config.columns=[{id:"name",header:"Наиименование",width:380,sort:"string",open:!0,template:"{common.treetable()} #name#"},{id:"value",header:"Итого",width:100,css:{"text-align":"right","font-weight":"500",color:"#222"},format:webix.Number.format,footer:{content:"summColumn",css:{"text-align":"right"}}}],this.$$("category-table").refreshColumns()},a.changeColumns=function(e,t){var i=function(e,t){for(var i=[],o=new Date(e);o<=t;o.setDate(o.getDate()+1))i.push(new Date(o));return i}(e.getValue(),t.getValue());i.reverse();var o=webix.Date.dateToStr("%d %M %y"),a=webix.Date.dateToStr("%Y-%m-%d");for(var n in this.resetColumns(),i)this.addColumn(a(i[n]),o(i[n]))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);i(2),i(4),i(3);var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return{id:"layout",type:"wide",cols:[{rows:[{view:"toolbar",paddingY:2,cols:[{view:"label",label:"Движение денежных средств",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("category-chart")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"chart",localId:"cashflow-chart",type:"bar",value:"#value#",barWidth:20,radius:2,alpha:.7,gradient:"rising",xAxis:{template:"'#day#"},yAxis:{start:0,step:5e4,end:5e5},legend:{values:[{text:"Поступления",color:"#4aa397"},{text:"Выплаты",color:"#69ba00"},{text:"Остаток",color:"#de619c",markerType:"item"}],valign:"middle",align:"right",width:90,layout:"y"},series:[{value:"#income#",color:"#4aa397",label:"#income#",tooltip:{template:"#income#"}},{value:"#outcome#",color:"#69ba00",label:"#outcome#",tooltip:{template:"#outcome#"}},{type:"spline",value:"#value#",color:"#36abee",label:"#value#",item:{borderColor:"#b7286c",color:"#de619c",type:"s"},line:{color:"#de619c",width:2},tooltip:{template:"#value#"}}]}]}]}},a.init=function(e){var t=this.$$("cashflow-chart"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue()),l=this,c=this.app.config.apiRest.getUrl("get","accounting/account/balanceaccountbydatechart",{dateFrom:n,dateTo:r});t.load(c),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var c=l.app.config.apiRest.getUrl("get","accounting/account/balanceaccountbydatechart",{dateFrom:n,dateTo:r});t.load(c)})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var c=l.app.config.apiRest.getUrl("get","accounting/account/balanceaccountbydatechart",{dateFrom:n,dateTo:r});t.load(c)}))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0);i(59),i(60);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.middleCoefMat=function(e,t){if(!t.length)return 0;for(var i=0,o=0,a=0,n=t.length-1;n>=0;n--)if(1==t[n].$level){var r=t[n].expense_mat,l=t[n].V;""!=r&&(null!==r&&(r=r.replace(".",",")),r=webix.Number.parse(r,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(r)||isNaN(l)||(i+=1*r,o+=1*l))}return 0!=o&&(a=i/o),webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.ui.datafilter.totalColumnCoefMat=webix.extend({refresh:function(e,t,i){var o,a,n=0,r=0,l=0;e.data.each((function(e){e.$group||(o=e.expense_mat,a=e.V,null!==o&&"0"!=a&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),o=parseFloat(o),isNaN(o)||(n+=1*o),r+=1*a))})),0!=r&&(l=n/r),n=webix.i18n.numberFormat(l,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(n=i.format(n)),i.template&&(n=i.template({value:n})),t.innerHTML=n}},webix.ui.datafilter.summColumn),webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y");webix.Date.strToDate("%Y-%m-%d");var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e,t=this,i=this;this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"500",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"01.12.20"}}'});return{rows:[{cols:[{view:"label",width:200,height:30,template:"Отчет ЗП",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return t.doClickPrint()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){i.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,localId:"select-type",options:[{id:1,value:"Обивка"},{id:2,value:"Столярка"},{id:3,value:"Пошив+крой"},{id:4,value:"Крой"}],width:200,on:{onChange:function(e){i.showBatch(e)}}},{view:"icon",icon:"mdi mdi-tools",autowidth:!0,popup:{view:"contextmenu",scroll:"y",width:200,height:550,autoheight:!1,localId:"columns-setting",data:[{value:"Profile",href:"#profile"},{value:"Settings",href:"#settings"},{value:"Dummy"},{id:"logout",value:"Logout"}],$init:function(){i.loadColumnsSetting(this,null)},on:{onMenuItemClick:function(e){i.columnSettingClick(this,e)}}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"report-salary-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",dragColumn:!0,sort:"multi",headermenu:!0,tooltip:!0,columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,sort:"date",tooltip:"#F# <br>#C#-#D# Дата клиента: #H# <br>#E#<br> #I#<br> #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.value):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text",hidden:!1},{id:"I",header:["Изделие",{content:"textFilter"},""],width:180,editor:"text",hidden:!1},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text",sort:"string",hidden:!0},{id:"size",header:["Размер",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,css:{"text-align":"center"},editor:"text"},{id:"V",header:["Сумма факт",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500}},{id:"coef_sewing",header:["Коэф. Пош. гот.",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:3},{id:"cost_ot",header:["Раб. отстр.",{content:"selectFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right"},batch:3},{id:"coef_cut",header:["Коэф. Крой. гот.",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:4},{id:"cost_work",header:["Стоим. работ",{content:"selectFilter"},{content:"totalColumn"}],width:110,css:{color:"green","text-align":"right","font-weight":600}},{id:"cost_cut",header:["Раб. крой",{content:"selectFilter"},{content:"totalColumn"}],width:100,batch:4,css:{color:"green","text-align":"right"}},{id:"BY",header:["Настил",{content:"selectFilter"},{content:"totalColumn"}],width:100,batch:4,css:{color:"green","text-align":"right"}},{id:"cost_sewing",header:["Раб. пошив",{content:"selectFilter"},{content:"totalColumn"}],width:100,batch:3,css:{color:"green","text-align":"right"}},{id:"cost_work_carpenter",header:["Раб. столярка",{content:"selectFilter"},{content:"totalColumn"}],width:110,batch:2,css:{color:"green","text-align":"right"}},{id:"cost_carcass",header:["Раб. ст. цар.",{content:"selectFilter"},""],width:100,batch:2,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_carcass?e.productWorkSalary.cost_carcass:""}},{id:"cost_headboard",header:["Раб. ст. изг.",{content:"selectFilter"},""],width:100,batch:2,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_headboard?e.productWorkSalary.cost_headboard:""}},{id:"cost_grinding",header:["Раб. ст. шлиф.",{content:"selectFilter"},""],width:110,batch:2,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_grinding?e.productWorkSalary.cost_grinding:""}},{id:"cost_work_upholstery",header:["Раб. обивка",{content:"selectFilter"},{content:"totalColumn"}],width:110,batch:1,css:{color:"green","text-align":"right"}},{id:"cost_rubber_carcass",header:["Раб. пор. цар.",{content:"selectFilter"},""],width:110,batch:1,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_rubber_carcass?e.productWorkSalary.cost_rubber_carcass:""}},{id:"cost_rubber_headboard",header:["Раб. пор. изг.",{content:"selectFilter"},""],width:110,batch:1,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_rubber_headboard?e.productWorkSalary.cost_rubber_headboard:""}},{id:"cost_upholstery_carcass",header:["Раб. об. цар.",{content:"selectFilter"},""],width:100,batch:1,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_upholstery_carcass?e.productWorkSalary.cost_upholstery_carcass:""}},{id:"cost_upholstery_headboard",header:["Раб. об. изг.",{content:"selectFilter"},""],width:100,batch:1,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_upholstery_headboard?e.productWorkSalary.cost_upholstery_headboard:""}},{id:"cost_buttons",header:["Раб. об. пуг.",{content:"selectFilter"},""],width:100,batch:1,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_buttons?e.productWorkSalary.cost_buttons:""}},{id:"cost_matras",header:["Раб. об. мат.",{content:"selectFilter"},""],width:100,batch:1,css:{color:"green","text-align":"right"},template:function(e){return e.productWorkSalary&&null!=e.productWorkSalary.cost_matras?e.productWorkSalary.cost_matras:""}},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text",batch:1},{id:"AZ",header:["Столярка ФИО",{content:"selectFilter"},""],width:115,editor:"text",batch:2},(e={id:"BO",header:["Пошив ФИО",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},e.batch=3,e),{id:"BV",header:["Крой ФИО",{content:"selectFilter"},""],width:115,editor:"text",batch:4},{id:"BQ",header:["Дата пош.",{content:"selectFilter"},""],width:90,batch:3,editor:"text"},{id:"BX",header:["Дата крой.",{content:"selectFilter"},""],width:90,batch:4,editor:"text"},{id:"AE",header:["Дата обив.",{content:"selectFilter"},""],width:60,editor:"text",batch:1},{id:"BB",header:["Дата ст.",{content:"selectFilter"},""],width:90,editor:"text",batch:2}],showColumnBatch:function(e,t){var i=void 0!==t;t=!1!==t,this.eachColumn((function(o,a){if(a.batch){var n=[a.batch];a.batch instanceof Array&&(n=a.batch);var r=this.isColumnVisible(a.id);t||(r=!r),n.indexOf(e)>-1&&r?this.hideColumn(a.id,!t,!0):i||-1!=n.indexOf(e)||r||this.hideColumn(a.id,t,!0)}}),!0),this._refresh_columns()},save:"api->accounting/orders",scheme:{$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){i.configColumns=this.config.columns;var e=webix.storage.local.get("report-salary-table");e&&this.setState(e)},scroll:!0,on:{onColumnResize:function(){webix.storage.local.put("report-salary-table",this.getState())},onAfterColumnDrop:function(){webix.storage.local.put("report-salary-table",this.getState())},onAfterColumnShow:function(){},onresize:webix.once((function(){})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,t){var o=this.getItem(e.start),a=this.getItem(e.parent);i.beforeDropChangeData(o,a.value)}}}]}},n.init=function(e){var t=this.$$("report-salary-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue()),l=(this.$$("select-type"),this.$$("select-type").getValue()),c="AE";2==l&&(c="date_carpenter"),3==l&&(c="date_sewing"),4==l&&(c="date_cut");var s=this.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"'+c+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+c+'":{">=":"'+n+'","<=":"'+r+'"}}'}),d=this;webix.ajax().get(s).then((function(e){t.clearAll(),t.parse(e.json().items),t.sort([{by:c,dir:"asc"}]),t.group({by:function(e){return e[c]},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],value:[c],date_sewing:["date_sewing"],profit:["profit","sum"],expense:["expense","sum"],net_cost:["net_cost","sum"],cost_work:["cost_work","sum"],cloth_sum:["cloth_sum","sum"],expense_cloth:["expense_cloth","sum"],coef_mat:["coef_mat","middleCoefMat"],cost_cut:["cost_cut","sum"],cost_sewing:["cost_sewing","sum"],cost_work_upholstery:["cost_work_upholstery","sum"]}})})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=d.$$("select-type").getValue(),c="AE";2==l&&(c="date_carpenter"),3==l&&(c="date_sewing"),4==l&&(c="date_cut");var s=d.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"'+c+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+c+'":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(s).then((function(e){t.clearAll(),t.parse(e.json().items),t.group({by:function(e){return e[c]},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],value:[c],date_sewing:["date_sewing"],profit:["profit","sum"],expense:["expense","sum"],net_cost:["net_cost","sum"],cost_work:["cost_work","sum"],cloth_sum:["cloth_sum","sum"],expense_cloth:["expense_cloth","sum"],coef_mat:["coef_mat","middleCoefMat"],cost_cut:["cost_cut","sum"],cost_sewing:["cost_sewing","sum"],cost_work_upholstery:["cost_work_upholstery","sum"]}})}))})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=d.$$("select-type").getValue(),c="AE";2==l&&(c="date_carpenter"),3==l&&(c="date_sewing"),4==l&&(c="date_cut");var s=d.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"'+c+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+c+'":{">=":"'+n+'","<=":"'+r+'"}}'});webix.ajax().get(s).then((function(e){t.clearAll(),t.parse(e.json().items),t.group({by:function(e){return e[c]},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],value:[c],date_sewing:["date_sewing"],profit:["profit","sum"],expense:["expense","sum"],net_cost:["net_cost","sum"],cost_work:["cost_work","sum"],cloth_sum:["cloth_sum","sum"],expense_cloth:["expense_cloth","sum"],coef_mat:["coef_mat","middleCoefMat"],cost_cut:["cost_cut","sum"],cost_sewing:["cost_sewing","sum"],cost_work_upholstery:["cost_work_upholstery","sum"]}})}))}))},n.doClickOpenAll=function(){var e=this.$$("report-salary-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},n.showBatch=function(e){webix.storage.local.remove("report-salary-table");var t=this.$$("report-salary-table");this.$$("report-salary-table").showColumnBatch(e);this.$$("dateFrom"),this.$$("dateTo");var i=webix.Date.dateToStr("%d.%m.%y"),o=i(this.$$("dateFrom").getValue()),a=i(this.$$("dateTo").getValue()),n=this.$$("select-type").getValue(),r="AE";2==n&&(r="date_carpenter"),3==n&&(r="date_sewing"),4==n&&(r="date_cut");var l=this.app.config.apiRest.getUrl("get","accounting/orders",{expand:"productWorkSalary, cloth, product","per-page":"1000",sort:'[{"property":"'+r+'","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"'+r+'":{">=":"'+o+'","<=":"'+a+'"}}'});webix.ajax().get(l).then((function(e){t.clearAll(),t.parse(e.json().items),t.group({by:function(e){return e[r]},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],value:[r],date_sewing:["date_sewing"],profit:["profit","sum"],expense:["expense","sum"],net_cost:["net_cost","sum"],cost_work:["cost_work","sum"],cloth_sum:["cloth_sum","sum"],expense_cloth:["expense_cloth","sum"],coef_mat:["coef_mat","middleCoefMat"],cost_cut:["cost_cut","sum"],cost_sewing:["cost_sewing","sum"],cost_work_upholstery:["cost_work_upholstery","sum"]}})}))},n.beforeDropChangeData=function(e,t){var i={AE:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_obivka=t,e.AE=a(t),webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},n.loadColumnsSetting=function(e,t){var i,o=this,a=[];this.configColumns.forEach((function(n,r){i="wxi-eye-slash",o.$$("report-salary-table").isColumnVisible(n.id)&&(i="wxi-eye"),n.id==t&&(e.data[r].icon="webix_icon webix_list_icon "+i,e.updatItem(t)),a.push({value:n.header[0].text,id:n.id,icon:"webix_icon webix_list_icon "+i})})),e.data=a},n.columnSettingClick=function(e,t){var i="webix_icon webix_list_icon wxi-eye",o=i,a=this.$$("report-salary-table");a.isColumnVisible(t)?a.hideColumn(t,{spans:!1}):a.showColumn(t,{spans:!1}),e.getItem(t).icon==i&&(o="webix_icon webix_list_icon wxi-eye-slash"),e.getItem(t).icon=o,e.updateItem(t),webix.storage.local.put("report-salary-table",a.getState())},n.doClickPrint=function(){var e=this.$$("report-salary-table");webix.print(e,{fit:"data"})},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Зарплатная ведомость",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("time-work-table")}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:new Date},{}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"time-work-table",urlEdit:"time-work",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"employee_id",header:"ID",width:30,sort:"string"},{id:"employee_name",header:"Сотрудник",width:180,sort:"string"},{id:"is_piecework",header:"Тип",width:40,sort:"string"},{id:"rate",header:"Ставка",width:80,sort:"string"},{id:"rate_day",header:"Ставка за день",width:100,sort:"string"},{id:"work_time_days",header:"Дни посещения",width:100,sort:"string"},{id:"work_time_hours",header:"Дни по часам",width:100,sort:"string"},{id:"salary_rate",header:"ЗП по ставке",width:100,sort:"string"},{id:"salary_piecework",header:"ЗП по сдельно",width:100,sort:"string"},{id:"award",header:"Премия",width:100,sort:"string"},{id:"surcharges",header:"Доп./Выч.",width:100,sort:"string"},{id:"salary",header:"К выплате",width:100,sort:"string"}],url:this.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{sort:"name"}),on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){this.$$("form-search");var t=this.$$("time-work-table"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),n=this.$$("dateTo"),r=i(this.$$("dateFrom").getValue()),l=i(this.$$("dateTo").getValue()),c=(this.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:r,dateTo:l}),this);o.attachEvent("onChange",(function(e){r=i(o.getValue()),l=i(n.getValue()),c.changeColumns(o,n);var a=c.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:r,dateTo:l});t.clearAll(),t.load(a)})),n.attachEvent("onChange",(function(e){r=i(o.getValue()),l=i(n.getValue()),c.changeColumns(o,n);var a=c.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:r,dateTo:l});t.clearAll(),t.load(a)})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("time-work-table").unselect(),this.cashEdit.showForm(this.$$("time-work-table"))},n.resetColumns=function(){this.$$("time-work-table").config.columns=[{id:"employee_name",header:"Сотрудник",width:180,sort:"string"}],this.$$("time-work-table").refreshColumns()},n.changeColumns=function(e,t){var i=function(e,t){for(var i=[],o=new Date(e);o<=t;o.setDate(o.getDate()+1))i.push(new Date(o));return i}(e.getValue(),t.getValue());i.reverse();var o=webix.Date.dateToStr("%D %d"),a=webix.Date.dateToStr("%Y-%m-%d");for(var n in this.resetColumns(),i)this.addColumn(a(i[n]),o(i[n]))},n.addColumn=function(e,t){var i=this.$$("time-work-table").config.columns;console.log(e),i.splice(1,0,{id:e+"end",header:t+" к.",width:60,css:{"text-align":"right"},format:webix.Number.format,template:function(t){return 0==t[e].end?"":t[e].end}}),i.splice(1,0,{id:e+"start",header:t+" н.",width:60,css:{"text-align":"right"},format:webix.Number.format,template:function(t){return 0==t[e].start?"":t[e].start}}),this.$$("time-work-table").refreshColumns()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Настройки",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("setting-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"setting-table",urlEdit:"setting",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наименование",width:280,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/settings",{sort:"name"}),save:"api->accounting/settings",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("setting-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/settings"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("setting-table").unselect(),this.cashEdit.showForm(this.$$("setting-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Посещения",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("time-work-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"time-work-table",urlEdit:"time-work",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"date_work",header:"Дата",width:100,sort:"string"},{id:"employee_name",header:"Сотрудник",width:180,sort:"string"},{id:"time_start",header:"Начало работы",width:180,sort:"string"},{id:"time_end",header:"Конец работы",width:180,sort:"string",edit:"text"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/employee-time-works",{sort:"name"}),save:"api->accounting/employee-time-works",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("time-work-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/employee-time-works"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("time-work-table").unselect(),this.cashEdit.showForm(this.$$("time-work-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);i(1),i(2),i(4),i(3);var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Посещения",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("time-work-table"))}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.add(webix.Date.weekStart(new Date),6,"day")},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){e.doClickOpenAll()}}]},{view:"treetable",localId:"time-work-table",css:"webix_header_border webix_data_border",leftSplit:1,select:"cell",multiselect:!0,blockselect:!0,clipboard:"block",editable:!0,editaction:"dblclick",resizeColumn:{headerOnly:!0},hover:"myhover",columns:[],scheme:{$group:{by:"department_id",map:{department:["department"],department_id:["department_id"],department_name:["department_name"],employee_name:["employee_name"],value:["index"]}}},ready:function(){this.openAll()},on:{"data->onStoreUpdated":function(){},onAfterEditStop:function(e,t,i){e.value!=e.old&&this.$scope.afterEditStop(e,t,i)},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},a.init=function(e){this.$$("form-search");var t=this.$$("time-work-table"),i=webix.Date.dateToStr("%Y-%m-%d"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue()),l=this.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:n,dateTo:r,expand:"department"}),c=this;c.changeColumns(o,a),t.clearAll(),t.load(l).then((function(){t.openAll()})),t.attachEvent("onPaste",(function(e){var t=this;this.getSelectedId(!0).forEach((function(e){c.updateRowPaste(e.column,t.getItem(e.row))}))})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue()),c.changeColumns(o,a);var l=c.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:n,dateTo:r});t.clearAll(),t.load(l).then((function(){t.openAll()}))})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue()),c.changeColumns(o,a);var l=c.app.config.apiRest.getUrl("get","accounting/employee-time-work/visits",{dateFrom:n,dateTo:r});t.clearAll(),t.load(l).then((function(){t.openAll()}))}))},a.updateRowPaste=function(e,t){var i=this,o=e.replace("-start","").replace("-end",""),a=(t.employee_id,0),n=t[o+"-id"];-1!=e.indexOf("-start")&&(a=1);var r={id:n};r[a?"int_start":"int_end"]=t[e];var l=i.app.config.apiRest.getUrl("put","accounting/employee-time-works",{},r.id);webix.ajax().put(l,r,{error:function(o,a,n){i.$$("time-work-table").addCellCss(t.id,e,"webix_invalid_cell")},success:function(o,a,n){i.$$("time-work-table").addCellCss(t.id,e,"webix_editing_cell")}})},a.resetColumns=function(){this.$$("time-work-table").config.columns=[{id:"employee_name",header:"Сотрудник",width:240,sort:"string",template:function(e,t){return e.$group?t.treetable(e,t)+e.department_name:t.treetable(e,t)+e.index+". "+e.employee_name}}]},a.changeColumns=function(e,t){var i=function(e,t){for(var i=[],o=new Date(e);o<=t;o.setDate(o.getDate()+1))i.push(new Date(o));return i}(e.getValue(),t.getValue());i.reverse();var o=webix.Date.dateToStr("%D %d"),a=webix.Date.dateToStr("%Y-%m-%d");for(var n in this.resetColumns(),i)this.addColumn(a(i[n]),o(i[n]));this.$$("time-work-table").refreshColumns()},a.addColumn=function(e,t){var i=this.$$("time-work-table").config.columns,o=[{text:t,colspan:2},"н."];i.splice(1,0,{id:e+"-end",header:[{text:"",colspan:2},"к."],width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-end"]&&0!=t[e+"-end"]?t[e+"-end"]:""}}),i.splice(1,0,{id:e+"-start",header:o,width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-start"]&&0!=t[e+"-start"]?t[e+"-start"]:""}})},a.afterEditStop=function(e,t,i){var o=this.$$("time-work-table").getItem(t.row),a=t.column,n=e.value?e.value:0;this.updateRow(a,o,n)},a.updateRow=function(e,t,i){var o=this,a=e.replace("-start","").replace("-end",""),n=(t.employee_id,0),r=t[a+"-id"];-1!=e.indexOf("-start")&&(n=1);var l={id:r};l[n?"int_start":"int_end"]=i;var c=o.app.config.apiRest.getUrl("put","accounting/employee-time-works",{},l.id);webix.ajax().put(c,l,{error:function(i,a,n){o.$$("time-work-table").addCellCss(t.id,e,"webix_invalid_cell")},success:function(i,a,n){o.$$("time-work-table").addCellCss(t.id,e,"webix_editing_cell")}})},a.doClickOpenAll=function(){var e=this.$$("time-work-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пользователи",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("user-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"user-table",urlEdit:"user",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"username",header:"Логин",width:150},{id:"email",header:"E-mail",width:200},{id:"status",header:"Статус",width:80,sort:"string",collection:[{id:"10",value:"Активен"},{id:"0",value:"Неактивен"}]},{id:"type",header:"Тип прав",width:80,sort:"string"},{id:"last_login",header:"Последний заход",width:140,sort:"string"},{id:"login_ip",header:"IP адрес",width:120,sort:"string"},{id:"created_at",header:"Создан",width:140,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/users",{sort:"name"}),save:"api->accounting/users",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("user-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/users",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("user-table").unselect(),this.cashEdit.showForm(this.$$("user-table"))},n.doClickOpenAll=function(){var e=this.$$("user-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(1);i(2),i(4),i(3);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this,t=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Пакеты",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("store-site-table"))}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){t.doClickOpenAll()}}]},{view:"treetable",localId:"store-site-table",urlEdit:"store-site",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"ID",width:40},{id:"name",header:"Наименование",width:150},{id:"domain",header:"Домен",width:200},{id:"user_id",header:"USER_ID",width:80,sort:"string"},{id:"sites_avalible",header:"Доступые сайты",width:140,sort:"string"},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/store-sites",{sort:"name"}),save:"api->accounting/store-sites",scheme:{$init:function(e){e.index=this.count()+1}},ready:function(){this.openAll()},on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("store-site-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/store-sites",{sort:"name"}),a).then((function(e){i.parse(e),i.openAll()}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("store-site-table").unselect(),this.cashEdit.showForm(this.$$("store-site-table"))},n.doClickOpenAll=function(){var e=this.$$("store-site-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=(i(15),i(9),i(6));var n=i(55);var r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.config=function(){return a.a.table=new n.default(this.app,"table1","http://admin.startsellshop.local/api/accounting/transaction/table?auth_token=7110eda4d09e062aa5e4a390b0a572ac0d2c02206"),{id:"layout",cols:[{rows:[a.a.table]}]}},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));var o=i(0),a=i(1),n=(new(i(5).a)).getUrl("get","accounting/employees",{sort:"name","per-page":-1}),r=new webix.DataCollection({data:webix.ajax(n).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}}),l=i(57);i(2),i(4),i(3);var c=webix.Date.dateToStr("%Y %F"),s=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Ставка сотрудников по месяцам",width:250},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"icon",icon:"mdi mdi-fullscreen",width:30,click:function(){webix.fullscreen.set(this.$scope.$$("employee-salary-table"))}}]},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.yearStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.add(webix.Date.yearStart(new Date),11,"month")},{view:"combo-close",localId:"employee-combo",inputWidth:250,label:"по",labelWidth:30,width:280,suggest:{body:{data:r,template:webix.template("#value#")}}},{},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){e.doClickOpenAll()}}]},{view:"treetable",localId:"employee-salary-table",urlEdit:"employee-salary",css:"webix_header_border webix_data_border",leftSplit:1,select:"cell",multiselect:!0,blockselect:!0,clipboard:"block",editable:!0,editaction:"dblclick",resizeColumn:{headerOnly:!0},hover:"myhover",columns:[{id:"employee_id",header:"Сотрудник",width:240,css:{"text-align":"left"},template:function(e,t){return e.$group?t.treetable(e,t)+e.employee_name:t.treetable(e,t)+c(e.date_salary)}},{id:"is_piecework",header:"Тип зарплаты",width:100,css:{"text-align":"left"},collection:l.a},{id:"is_taskmaster",header:"Бриг.",width:50,css:{"text-align":"right"},collection:[{id:"0",value:"Нет"},{id:"1",value:"Да"}]},{id:"rate",header:"Ставка",width:100,css:{"text-align":"right"}},{id:"award_const",header:"Премия пост.",width:110,css:{"text-align":"right"}},{id:"status",header:"Статус",width:100,css:{"text-align":"right"},collection:[{id:"0",value:"Уволен"},{id:"1",value:"Работает"}]},{id:"action-delete",header:"",width:50,template:function(e,t){return e.$group?"":t.trashIcon()}},{id:"action-edit",header:"",width:50,template:function(e,t){return e.$group?"":t.editIcon()}}],save:"api->accounting/employee-salaries",scheme:{$group:{by:"employee_id",map:{department_id:["department_id"],department_name:["department_name"],employee_id:["employee_id"],employee_name:["employee_name"],value:["index"]}}},ready:function(){this.openAll()},on:{"data->onStoreUpdated":function(){},onAfterEditStop:function(e,t,i){e.value!=e.old&&this.$scope.afterEditStop(e,t,i)},onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){this.$$("form-search");var t=this.$$("employee-salary-table"),i=this.$$("employee-combo"),o=(i.getValue(),webix.Date.dateToStr("%Y-%m-%d")),n=this.$$("dateFrom"),r=this.$$("dateTo"),l=o(this.$$("dateFrom").getValue()),c=o(this.$$("dateTo").getValue()),s=this.app.config.apiRest.getUrl("get","accounting/employee-salaries",{"per-page":-1,sort:'[{"property":"employee_name","direction":"ASC"}, {"property":"date_salary","direction":"ASC"}]',filter:'{"date_salary":{">=":"'+l+'","<=":"'+c+'"}}'}),d=this;t.load(s),t.attachEvent("onPaste",(function(e){var t=this;this.getSelectedId(!0).forEach((function(e){d.updateRowPaste(e.column,t.getItem(e.row))}))})),i.attachEvent("onChange",(function(e){d.getDataTable()})),n.attachEvent("onChange",(function(e){d.getDataTable()})),r.attachEvent("onChange",(function(e){d.getDataTable()})),this.cashEdit=this.ui(a.a)},n.getDataTable=function(){this.$$("form-search");var e=this.$$("employee-salary-table"),t=this.$$("employee-combo").getValue(),i=webix.Date.dateToStr("%Y-%m-%d"),o=(this.$$("dateFrom"),this.$$("dateTo"),{date_salary:{">=":i(this.$$("dateFrom").getValue()),"<=":i(this.$$("dateTo").getValue())}});t&&(o.employee_id=t);var a={filter:o,"per-page":"-1",sort:[{property:"employee_name",direction:"ASC"},{property:"date_salary",direction:"ASC"}]},n=this.app.config.apiRest.getUrl("get","accounting/employee-salaries");webix.ajax().get(n,a).then((function(t){e.clearAll(),e.parse(t),e.openAll()}))},n.updateRowPaste=function(e,t){var i=this,o=e.replace("-start","").replace("-end",""),a=(t.employee_id,0),n=t[o+"-id"];-1!=e.indexOf("-start")&&(a=1);var r={id:n};r[a?"int_start":"int_end"]=t[e];var l=i.app.config.apiRest.getUrl("put","accounting/employee-time-works",{},r.id);webix.ajax().put(l,r,{error:function(o,a,n){i.$$("employee-salary-table").addCellCss(t.id,e,"webix_invalid_cell")},success:function(o,a,n){i.$$("employee-salary-table").addCellCss(t.id,e,"webix_editing_cell")}})},n.resetColumns=function(){this.$$("employee-salary-table").config.columns=[{id:"employee_name",header:"Сотрудник",width:240,sort:"string",template:function(e,t){return e.$group?t.treetable(e,t)+e.department_name:t.treetable(e,t)+e.index+". "+e.employee_name}}]},n.changeColumns=function(e,t){var i=function(e,t){for(var i=[],o=new Date(e);o<=t;o.setDate(o.getDate()+1))i.push(new Date(o));return i}(e.getValue(),t.getValue());i.reverse();var o=webix.Date.dateToStr("%D %d"),a=webix.Date.dateToStr("%Y-%m-%d");for(var n in this.resetColumns(),i)this.addColumn(a(i[n]),o(i[n]));this.$$("employee-salary-table").refreshColumns()},n.addColumn=function(e,t){var i=this.$$("employee-salary-table").config.columns,o=[{text:t,colspan:2},"н."];i.splice(1,0,{id:e+"-end",header:[{text:"",colspan:2},"к."],width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-end"]&&0!=t[e+"-end"]?t[e+"-end"]:""}}),i.splice(1,0,{id:e+"-start",header:o,width:50,css:{"text-align":"right"},format:webix.Number.format,editor:"text",template:function(t){return t[e+"-start"]&&0!=t[e+"-start"]?t[e+"-start"]:""}})},n.afterEditStop=function(e,t,i){var o=this.$$("employee-salary-table").getItem(t.row),a=t.column,n=e.value?e.value:0;this.updateRow(a,o,n)},n.updateRow=function(e,t,i){var o=this,a=e.replace("-start","").replace("-end",""),n=(t.employee_id,0),r=t[a+"-id"];-1!=e.indexOf("-start")&&(n=1);var l={id:r};l[n?"int_start":"int_end"]=i;var c=o.app.config.apiRest.getUrl("put","accounting/employee-time-works",{},l.id);webix.ajax().put(c,l,{error:function(i,a,n){o.$$("employee-salary-table").addCellCss(t.id,e,"webix_invalid_cell")},success:function(i,a,n){o.$$("employee-salary-table").addCellCss(t.id,e,"webix_editing_cell")}})},n.doClickOpenAll=function(){var e=this.$$("employee-salary-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return d}));var o=i(0),a=(i(15),i(16),i(9)),n=i(11),r=i(12),l=i(13),c=i(7);window.procent=function(e,t){var i=$$("table_part").getItem(e),o=$$(t).getValue();return Math.round(100*i.value*100/o)/100};var s=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state=new c.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=52,e.top=41,e.width=e.maxWidth/3,e.height=e.maxHeight-41},head:"Редактирование операции",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"auto",elements:[{margin:10,rows:[{view:"text",name:"id",width:150,hidden:!0},{view:"segmented",name:"type_operation",value:1,inputWidth:320,options:[{id:1,value:"Поступление"},{id:2,value:"Расход"},{id:3,value:"Перемещение"}],align:"center"},{localId:"label_move_from",label:"Откуда",view:"label",height:38,css:{"text-align":"center"},hidden:!0},{cols:[{label:"Дата оплаты",value:"",view:"datepicker",labelWidth:100,name:"date_operation",timepicker:!0,stringResult:!0},{name:"is_committed",view:"checkbox",width:40,value:!0,checkValue:1,uncheckValue:2},{label:"Подтвердить оплату",view:"label"}]},{label:"Счет",name:"account_id",id:"account",value:"",suggest:"firestore->accounting_account",placeholder:"Выберите счет",view:"combo",height:38,labelWidth:100,required:!0,invalidMessage:"Значение не может быть пустым!"},{cols:[{id:"form_edit_sum",name:"value",label:"Сумма",view:"text",labelWidth:100,height:36,value:0,placeholder:"0.00",format:"1 111.00",invalidMessage:"Field can not be empty",required:!0},{label:"UAH (Украинская гривна)",view:"label",height:36}]},{localId:"label_value_break",template:"<a class='show-combo-value-break' href='javascript:void(0);'>Разбить сумму</a>",height:20,css:{"padding-left":"100px","margin-top":"0px !important"},hidden:!1},{hidden:!0,name:"type_part_id",localId:"combo_value_break",value:"",options:[{id:1,value:"Выберите как разбить сумму"},{id:2,value:"Контрагент"},{id:3,value:"Статья"},{id:4,value:"Проект"},{id:5,value:"Контрагент, Статья"}],placeholder:"Выберите как разбить сумму",view:"combo",height:38,css:{"padding-left":"100px","margin-top":"0px !important"},width:230},{localId:"layout_part_value",padding:30,css:{background:"#f7fafb"},hidden:!0,rows:[{localId:"table_part_value",id:"table_part",view:"datatable",css:"webix_header_border webix_data_border",columns:[{id:"id",header:"",hidden:!0},{id:"index",header:"#",width:20},{id:"contragent_id",options:"firestore->accounting_contragent",editor:"combo",header:"Контрагент",fillspace:!0,footer:{text:"Итого",css:{"text-align":"right"}}},{id:"category_id",editor:"combo",header:"Статья",options:"firestore->accounting_category",adjust:!0,hidden:!0,batch:3},{id:"project_id",editor:"combo",header:"Проект",options:"firestore->accounting_project",adjust:!0,hidden:!0,batch:4},{id:"value",editor:"text",header:"Сумма",width:100,sort:"int",css:{"text-align":"right"},footer:{content:"summColumn",css:{"text-align":"right"}}},{id:"part_procent",header:"Доля,%",width:70,css:{"text-align":"right"},math:'procent($r, "form_edit_sum")',footer:{content:"summColumn",css:{"text-align":"right"},template:"#value#%"},template:"#part_procent#%"},{id:"action-delete-part",header:"",width:40,template:"{common.trashIcon()}"}],editable:!0,headerRowHeight:30,rowHeight:30,scroll:!1,width:300,autoheight:!0,math:!0,footer:!0},{cols:[{borderless:!0,localId:"label_add_row_table",template:"<a class='add-to-table' href='javascript:void(0);'>Добавить</a>",height:20,css:{background:"#f7fafb"},hidden:!1}]}]},{label:"Контрагент",name:"contragent_id",id:"contragent",value:"1",options:"firestore->accounting_contragent",view:"combo",height:38,labelWidth:100,placeholder:"Выберите контрагента"},{label:"Статья",name:"category_id",id:"category",value:"1",options:"firestore->accounting_category",view:"combo",height:38,labelWidth:100,placeholder:"Выберите статью"},{localId:"label_move_to",label:"Куда",view:"label",height:38,css:{"text-align":"center"},hidden:!0},{label:"Счет",name:"account_move_id",id:"account_move",value:"",options:"firestore->accounting_account",placeholder:"Выберите счет",view:"combo",height:38,labelWidth:100,hidden:!0,required:!0,invalidMessage:"Значение не может быть пустым!"},{label:"Проект",name:"project_id",id:"project",value:"1",options:"firestore->accounting_project",view:"combo",height:38,labelWidth:100,placeholder:"Выберите проект"},{name:"comment",label:"Назначение платежа",view:"text",height:52,labelWidth:100,placeholder:"Введите комментарий"}]},{margin:10,cols:[{view:"template",template:" ",role:"placeholder",borderless:!0},{view:"button",label:"Отмена",localId:"btn_cancel",css:"webix_transparent",align:"right",width:120},{view:"button",localId:"btn_save",css:"webix_primary",label:"Сохранить",align:"right",width:120}]}]}}},a.init=function(e,t){this.attachClickEvents()},a.showForm=function(e){var t=this,i=this.state,o=this.apiRest,a=e.getSelectedItem(),n=a;i.tableId=e.config.id,i.table=e,i.tableRecord=a,i.isUpdate=n,i.formEdit=this.$$("formEdit"),i.formUrl="accounting/"+i.tableId+"/form",i.win=this.$$("winEdit"),i.formEdit.clearValidation(),o.get(i.formUrl).then((function(e){t.showWindow(e,t)}))},a.showWindow=function(e,t){var i=t.state,o=Object.keys(i.formEdit.elements).length,a=e.json();i.formData=a,t.renderForm(o),i.formEdit.setValues(t.getRecord()),i.win.show(),t.showParts(i.tableRecord)},a.getRecord=function(){var e=this.state;return e.isUpdate?e.tableRecord:{date_operation:new Date,is_committed:1,type_operation:2}},a.attachFormParamsElements=function(){this.state;this.$$("table_part_value").scheme_setter({$init:function(e){e.index=this.count()+1}})},a.renderForm=function(e){this.state;this.attachFormParamsElements(),this.attachFormEvents()},a.bindCollection=function(e){var t=this.state,i=this.apiRest,o=0,a=e.data.dataCollections,n=Object.keys(a).length,r={"per-page":-1};for(var l in a){var c=$$(l).getPopup().getList(),s=i.getCollection(a[l].url,r);s.waitData.then((function(){++o===n&&t.win.show()})),c.sync(s)}},a.bindColumnCollection=function(e){var t=this.apiRest,i={"per-page":-1},o=e.data.columnCollections;for(var a in o){var n=o[a];for(var r in n)this.$$(a).getColumnConfig(r).options=t.getCollection(n[r].url,i);this.$$(a).refreshColumns()}},a.attachFormEvents=function(){var e=this,t=this.state.formEdit.elements.type_operation,i=this.$$("combo_value_break"),o=this.$$("table_part_value"),a=this.$$("btn_save"),n=$$("form_edit_sum");t.attachEvent("onChange",(function(t,i){e.typeOperationChange(t)})),i.attachEvent("onChange",(function(t){e.comboValueBreakChange(t)})),a.attachEvent("onItemClick",(function(t){e.doClickSave()})),o.attachEvent("onItemClick",(function(e,t,i){"action-delete-part"===e.column&&this.remove(e.row)})),n.attachEvent("onChange",(function(e,t,i){o.refreshColumns()}))},a.typeOperationChange=function(e){var t=this.state,i=this.$$("label_move_from"),o=this.$$("label_move_to"),a=this.$$("label_value_break"),n=t.formEdit.elements.account_move_id,r=t.formEdit.elements.contragent_id,l=t.formEdit.elements.category_id,c=this.$$("combo_value_break"),s=3==e,d=[{element:i,status:s},{element:o,status:s},{element:n,status:s},{element:a,status:!s},{element:r,status:!s},{element:l,status:!s}];for(var u in d)d[u].status?d[u].element.show():d[u].element.hide();s&&c.setValue(1)},a.comboValueBreakChange=function(e){var t=this.state,i=this.$$("table_part_value"),o=this.$$("combo_value_break"),a=this.$$("layout_part_value"),n=t.formEdit.elements.contragent_id,r=t.formEdit.elements.category_id,l=t.formEdit.elements.project_id,c=e>1,s=3==e,d=4==e,u=[{element:a,status:c},{element:o,status:c},{element:n,status:!c},{element:r,status:!s},{element:l,status:!d}];for(var h in s&&r.setValue(""),d&&l.setValue(""),n.setValue(""),i.showColumnBatch(e),u)u[h].status?u[h].element.show():u[h].element.hide();c||i.clearAll()},a.attachClickEvents=function(){var e=this;webix.attachEvent("onClick",(function(t,i,o){t.target&&("show-combo-value-break"===t.target.classList.value&&e.onClickShowComboValueBreak(),"btn-save"===t.target.classList.value&&e.onClickSave(),"add-to-table"===t.target.classList.value&&e.$$("table_part_value").add({index:"",contragent_id:"",category_id:"",project_id:"",value:"0.00",part_procent:""}))}))},a.onClickShowComboValueBreak=function(){this.$$("combo_value_break").isVisible()?this.$$("combo_value_break").hide():this.$$("combo_value_break").show()},a.showParts=function(e){var t=this.state,i=this.$$("table_part_value");if(i.clearAll(),e){var o=t.table.data.getBranch(e.id);for(var a in o)i.add(o[a])}},a.doClickSave=function(){var e=this.state;if(e.formEdit.validate()){var t=e.formEdit.getValues();t.account_id?t.account=e.formEdit.elements.account_id.getPopup().getList().getItem(t.account_id):t.account={id:"",value:""},t.contragent_id?t.contragent=e.formEdit.elements.contragent_id.getPopup().getList().getItem(t.contragent_id):t.contragent={id:"",value:""},t.category_id?t.category=e.formEdit.elements.category_id.getPopup().getList().getItem(t.category_id):t.category={id:"",value:""},t.project_id?t.project=e.formEdit.elements.project_id.getPopup().getList().getItem(t.project_id):t.project={id:"",value:""},t.account_move_id?t.account_move=e.formEdit.elements.account_move_id.getPopup().getList().getItem(t.account_move_id):t.account_move={id:"",value:""},t.data=this.getParts(),webix.dp(e.table).save(e.isUpdate?t.id:webix.uid(),e.isUpdate?"update":"insert",t).then((function(i){webix.dp(e.table).ignore((function(){e.isUpdate?e.table.updateItem(t.id,i):e.table.add(i,0),e.table.select(t.id),e.table.scrollTo(0,0),e.table.sort("date_operation","desc","string"),e.table.markSorting("date_operation","desc")})),e.win.hide()}),(function(){webix.message("Ошибка! Данные не сохранены!")}))}},a.getParts=function(){var e=this.$$("table_part_value").serialize(),t=[];for(var i in e)t.push(e[i]);return t},o}(o.b);webix.protoUI({name:"search2",$cssName:"search custom",$init:function(){this.attachEvent("onTimedKeyPress",this.toggleDeleteIcon),this.attachEvent("onChange",this.toggleDeleteIcon),this.$ready.push(this.toggleDeleteIcon)},$renderIcon:function(){for(var e=this.config,t=["search","close"],i=e.aheight-2*e.inputPadding,o=(i-18)/2-1,a="",n=2,r=0;r<t.length;r++)a+="<span style='right:"+n+"px;height:"+(i-o)+"px;padding-top:"+o+"px;' class='webix_input_icon wxi-"+t[r]+"'></span>",n+=18;return a},toggleDeleteIcon:function(){this.getValue()?webix.html.removeCss(this.$view,"no-delete"):webix.html.addCss(this.$view,"no-delete",!0)},on_click:{webix_input_icon:function(e,t,i){var o=i.className.substr(i.className.indexOf("wxi-")+4);"close"==o&&this.setValue(""),this.callEvent("on"+o+"IconClick",[e]),this.getInputNode().focus()}}},webix.ui.search),webix.protoUI({name:"combo-close",$cssName:"search custom",$init:function(){this.attachEvent("onTimedKeyPress",this.toggleDeleteIcon),this.attachEvent("onChange",this.toggleDeleteIcon),this.$ready.push(this.toggleDeleteIcon)},$renderIcon:function(){for(var e=this.config,t=["menu-down","close"],i=e.aheight-2*e.inputPadding,o=(i-18)/2-1,a="",n=2,r=0;r<t.length;r++)a+="<span style='right:"+n+"px;height:"+(i-o)+"px;padding-top:"+o+"px;' class='webix_input_icon wxi-"+t[r]+"'></span>",n+=18;return a},toggleDeleteIcon:function(){this.getValue()?webix.html.removeCss(this.$view,"no-delete"):webix.html.addCss(this.$view,"no-delete",!0)},on_click:{webix_input_icon:function(e,t,i){var o=i.className.substr(i.className.indexOf("wxi-")+4);"close"==o&&(this.setValue(""),this.getInputNode().unfocus()),this.callEvent("on"+o+"IconClick",[e]),this.getInputNode().focus()}}},webix.ui.combo),webix.protoUI({name:"datepicker-close",$cssName:"search custom",$init:function(){this.attachEvent("onTimedKeyPress",this.toggleDeleteIcon),this.attachEvent("onChange",this.toggleDeleteIcon),this.$ready.push(this.toggleDeleteIcon)},$renderIcon:function(){for(var e=this.config,t=["calendar","close"],i=e.aheight-2*e.inputPadding,o=(i-18)/2-1,a="",n=2,r=0;r<t.length;r++)a+="<span style='right:"+n+"px;height:"+(i-o)+"px;padding-top:"+o+"px;' class='webix_input_icon wxi-"+t[r]+"'></span>",n+=18;return a},toggleDeleteIcon:function(){this.getValue()?webix.html.removeCss(this.$view,"no-delete"):webix.html.addCss(this.$view,"no-delete",!0)},on_click:{webix_input_icon:function(e,t,i){var o=i.className.substr(i.className.indexOf("wxi-")+4);"close"==o&&(this.setValue(""),this.getInputNode().unfocus()),this.callEvent("on"+o+"IconClick",[e]),this.getInputNode().focus()}}},webix.ui.datepicker);var d=function(e){var t,i;function o(t,i,o,a){var n;return(n=e.call(this,t,i)||this)._componentData=a,n.urlConfig="http://admin.startsellshop.local/api/accounting/transaction/table?auth_token=7110eda4d09e062aa5e4a390b0a572ac0d2c02206",n}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var c=o.prototype;return c.config=function(){var e=this;return{type:"wide",cols:[{css:"webix_shadow_medium",rows:[{view:"form",localId:"searchFormOperation",autoheight:!1,width:250,margin:0,scroll:"auto",elements:[{label:"Тип",view:"label"},{cols:[{view:"checkbox",localId:"search_type_operation",name:"type_operation.checkbox1",borderless:1,css:"small",width:33,value:1,checkValue:1,uncheckValue:0},{label:"Поступление",view:"label"}],height:30},{cols:[{view:"checkbox",width:33,name:"type_operation.checkbox2",value:2,checkValue:2,uncheckValue:0},{label:"Выплата",view:"label"}],height:30},{cols:[{view:"checkbox",width:33,name:"type_operation.checkbox3",value:3,checkValue:3,uncheckValue:0},{label:"Перемещение",view:"label"}],height:30},{label:"Дата оплаты",view:"label"},{cols:[{view:"checkbox",width:33,name:"is_committed.checkbox1",value:1,uncheckValue:0,checkValue:1},{label:"Подтвержена",view:"label"}],height:30},{cols:[{view:"checkbox",width:33,name:"is_committed.checkbox2",value:2,uncheckValue:0,checkValue:2},{label:"Не подтвержена",view:"label"}],height:30},{view:"datepicker-close",name:"date_operation"},{label:"Счет и Юр.лицо",view:"label",height:25},{localId:"searchAccountCombo",options:[],view:"combo-close",name:"account_id"},{label:"Контрагент",view:"label",height:25},{localId:"searchContragentCombo",view:"combo-close",options:[],name:"contragent_id"},{label:"Статья",view:"label",height:25},{localId:"searchCategoryCombo",view:"combo-close",options:[],name:"category_id"},{label:"Проект",view:"label",height:25},{localId:"searchProjectCombo",view:"combo-close",options:[],name:"project_id"},{label:"Сумма",view:"label",height:25},{cols:[{view:"text",value:"",placeholder:"от",name:"value.range.1"},{label:"-",view:"label",width:25},{view:"text",value:"",placeholder:"до",name:"value.range.2"}]}]}]},{rows:[{view:"template",height:50,template:"<h2>Операции</h2>",borderless:!1},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi wxi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}},{},{label:"",view:"search2",width:300,align:"right"}]},{view:"treetable",id:"transaction",localId:"transaction",autoHeight:!1,select:!0,scrollX:!1,hover:"myhover",scheme:{$sort:{by:"date_operation",dir:"desc"}},columns:[{id:"ch1",header:{content:"masterCheckbox"},checkValue:"on",uncheckValue:"off",width:40,template:function(e,t,i,o){return 1==e.$level?t.checkbox(e,t,i,o):""}},{id:"is_committed",header:"",width:50,template:"<span class='mdi mdi-check' value='#is_committed#' />"},{id:"date_operation",header:"Дата",sort:"string",editor:"date",adjust:!0,format:webix.i18n.longDateFormatStr,template:function(e,t){return 1==e.$level?t.icon(e,t)+webix.i18n.longDateFormatStr(e.date_operation):"<div class='subrowimage'><div></div></div>"}},{id:"account",header:["Счет"],map:"#account.value#",adjust:!0},{id:"type_operation",width:100,header:"Тип",sort:"server"},{id:"contragent",header:"Контрагент",map:"#contragent.value#",fillspace:!0},{id:"category",header:"Статья",adjust:!0,map:"#category.value#",sort:"string"},{id:"project",header:"Проект",fillspace:!0,adjust:!0,autoheight:!0,map:"#project.value#"},{id:"value",header:"Сумма",adjust:!0,css:{color:"red","text-align":"right"}},{id:"id",hidden:!0},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:"firestore->accounting_transaction",save:"firestore->accounting_transaction",on:{onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")},onItemClick:function(e,t,i){if(2==this.getSelectedItem().$level)return this.clearSelection();if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(e){webix.dp(o).ignore((function(){}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeFilter:function(e,t,i){}}},{cols:[{view:"label",label:"0",localId:"count",template:"<div class='webix_el_box' style='line-height:32px'>Показано #label# операций</div>"},{view:"label",label:"",localId:"income",template:"<div class='webix_el_box' style='line-height:32px; color: darkgreen'>Поступлений - #label#</div>"},{view:"label",label:"",localId:"outcome",template:"<div class='webix_el_box' style='line-height:32px; color: red'>Выплат - #label#</div>"},{view:"label",label:"",localId:"move",color:"grey",template:"<div class='webix_el_box' style='line-height:32px; color: #color#'>Перемещения - #label#</div>"},{view:"label",label:"",localId:"total",color:"grey",template:"<div class='webix_el_box' style='line-height:32px; color: #color#'>Итого - #label#</div>"},{align:"right"}]}]}]}},c.init=function(e){this.view=e;var t=this.$$("searchAccountCombo").getPopup().getList();t.parse(a.a),(t=this.$$("searchContragentCombo").getPopup().getList()).parse(n.a),(t=this.$$("searchCategoryCombo").getPopup().getList()).parse(l.a),(t=this.$$("searchProjectCombo").getPopup().getList()).parse(r.a);var i=this.$$("searchFormOperation"),o=this.$$("transaction"),c=this;i.attachEvent("onChange",(function(e){var t=i.getValues(),a={},n={},r={};for(var l in t)t[l]&&((n=l.split(".")).length>1?"range"==n[1]?(r[n[0]]?r[n[0]]["<="]=t[l]:(r[n[0]]=[],r[n[0]]={">=":t[l]}),t[n[0]]=r[n[0]],a[n[0]]=t[n[0]]):(r[n[0]]||(r[n[0]]=[]),r[n[0]].push(t[l]),t[n[0]]={in:r[n[0]]},a[n[0]]=t[n[0]]):a[l]="date_operation"==l?{">":t[l],"<":webix.Date.add(t[l],1,"day",!0)}:t[l]);webix.extend(o,webix.ProgressBar);e={filter:a};o.clearAll(!0),o.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.data.url,e).then((function(e){o.parse(e)}));var s=c.app.config.apiRest.getUrl("get","accounting/transaction/summary");webix.ajax().get(s,e).then((function(e){c.setTotal(e.json())}))}));var d=this.app.config.apiRest.getUrl("get","accounting/transaction/summary");webix.ajax().get(d).then((function(e){c.setTotal(e.json())})),this.cashEdit=this.ui(s)},c.doAddClick=function(){this.$$("transaction").unselect(),this.cashEdit.showForm($$("transaction"))},c.setTotal=function(e){var t=this.$$("income"),i=this.$$("outcome"),o=this.$$("move"),a=this.$$("total"),n=this.$$("count"),r=0,l=0,c=0,s=0,d=0;for(var u in e.data)1==e.data[u].type_operation&&(r=e.data[u].value),2==e.data[u].type_operation&&(l=e.data[u].value),3==e.data[u].type_operation&&(c=e.data[u].value),4==e.data[u].type_operation&&(s=e.data[u].value),r?t.setValue(r):t.setValue(0),l?i.setValue(l):i.setValue(0),d+=e.data[u].id;var h=r-l,p=c-s;o.setValue(p),a.setValue(h),n.setValue(d),h>=0?a.define("color","green"):a.define("color","red"),p>=0?o.define("color","green"):o.define("color","red"),t.refresh(),i.refresh(),o.refresh(),a.refresh(),n.refresh()},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return c}));var o=i(0),a=(i(3),i(7));window.procent=function(e,t){var i=$$("table_part").getItem(e),o=$$(t).getValue();return Math.round(100*i.value*100/o)/100};var n=webix.Date.dateToStr("%d.%m.%y"),r=webix.Date.dateToStr("%Y-%m-%d"),l=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var l=o.prototype;return l.config=function(){return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=44,e.top=34,e.width=e.maxWidth/3+70,e.height=e.maxHeight-42},head:"Редактирование",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"y",elements:this.state.formConfig}}},l.init=function(e,t){this.attachClickEvents()},l.showForm=function(e){var t=this,i=this.state,o=this.apiRest,a=e.getSelectedItem(),n=a;i.tableId=e.config.urlEdit,i.table=e,i.tableRecord=a,i.isUpdate=n,i.formEdit=this.$$("formEdit"),i.formUrl="accounting/"+i.tableId+"/form",i.win=this.$$("winEdit"),i.formEdit.clearValidation(),o.get(i.formUrl).then((function(e){t.showWindow(e,t)}))},l.showWindow=function(e,t){var i=t.state,o=Object.keys(i.formEdit.elements).length,a=e.json();i.formData=a,t.renderForm(o),i.formEdit.clear(),webix.extend(i.formEdit,webix.ProgressBar),i.formEdit.disable(),i.formEdit.showProgress({type:"icon",hide:!1}),t.bindCollection(a),i.win.show()},l.getRecord=function(){var e=this.state;return e.isUpdate?e.tableRecord:{C:n(new Date),D:n(webix.Date.add(new Date,21,"day",!0)),index:1,B:6,G:0,AE:r(webix.Date.add(new Date,14,"day",!0)),R:""}},l.renderForm=function(e){var t=this.state;0===e&&(t.formConfig=t.formData.data.configForm,webix.ui(t.formConfig,t.formEdit),this.attachFormEvents())},l.bindCollection=function(e){var t=this,i=this.state,o=this.apiRest,a=0,n=e.data.dataCollections,r=Object.keys(n).length,l={"per-page":-1},c=function(e){var c=$$(e).getPopup().getList(),s=n[e].field?n[e].field:"name",d=o.getCollection(n[e].url,l,s);d.waitData.then((function(){a++,n[e].params?n[e].params.filter&&function(){var t=n[e].params.filter,i=function(e){var i=new webix.DataCollection({data:d.data});i.filter((function(i){return i[e]==t[e]})),c.sync(i)};for(var o in t)i(o)}():c.sync(d),a===r&&(i.formEdit.setValues(t.getRecord()),i.formEdit.enable(),i.formEdit.hideProgress())}))};for(var s in n)c(s)},l.bindColumnCollection=function(e){var t=this.apiRest,i={"per-page":-1},o=e.data.columnCollections;for(var a in o){var n=o[a];for(var r in n)this.$$(a).getColumnConfig(r).options=t.getCollection(n[r].url,i);this.$$(a).refreshColumns()}},l.attachFormEvents=function(){var e=this,t=(this.state,this.$$("btn_save")),i=this.$$("btn_copy"),o=this.$$("btn_cancel"),a=this.$$("btn_calculation"),n=this.$$("contragent"),r=this.$$("form_F"),l=this.$$("product"),c=this.$$("form_product_name"),s=this.$$("product_size"),d=this.$$("form_size_name"),u=this.$$("cloth"),h=this.$$("form_cloth_name"),p=this.$$("carcass_type"),f=(this.$$("carcass_type_name"),this.$$("leg")),m=this.$$("form_leg_name"),g=this.$$("button"),w=this.$$("form_button_name"),b=this.$$("bottom"),v=this.$$("form_bottom_name"),x=this.$$("stitching"),_=this.$$("form_stitching_name"),y=this.$$("product_type");t.attachEvent("onItemClick",(function(t){e.doClickSave()})),i.attachEvent("onItemClick",(function(t){e.doClickSave(!0)})),o.attachEvent("onItemClick",(function(t){e.state.win.hide()})),a.attachEvent("onItemClick",(function(t){e.doClickCalculation(!0)}));var $=this.apiRest,C={"per-page":-1};y.attachEvent("onChange",(function(e){l.setValue();var t=$.getCollection("accounting/product-beds",C);t.filter((function(t){return t.type_id==e})),l.getPopup().getList().sync(t)})),n.attachEvent("onChange",(function(e){r.setValue(n.getText())})),l.attachEvent("onChange",(function(t){c.setValue(l.getText()+" "+s.getText()),e.setPrice()})),s.attachEvent("onChange",(function(t){d.setValue(s.getText()),c.setValue(l.getText()+" "+s.getText()),e.changeSizeKarkasName(p.getText()),e.setPrice()})),u.attachEvent("onChange",(function(t){h.setValue(u.getText()),e.setPrice()})),f.attachEvent("onChange",(function(t){m.setValue(f.getText()),e.setPrice()})),g.attachEvent("onChange",(function(t){w.setValue(g.getText()),e.setPrice()})),b.attachEvent("onChange",(function(t){v.setValue(b.getText()),e.setPrice()})),x.attachEvent("onChange",(function(t){_.setValue(x.getText()),e.setPrice()})),p.attachEvent("onChange",(function(t){e.changeSizeKarkasName(p.getText()),e.setPrice()}))},l.changeSizeKarkasName=function(e){var t=this.$$("carcass_type_name"),i=this.$$("product_size");"без каркаса"==e&&t.setValue(""),"стандарт"==e&&t.setValue(i.getText()),"подиум"==e&&t.setValue(i.getText()),"люкс"==e?t.setValue(i.getText()+" "+e):t.setValue(i.getText())},l.attachClickEvents=function(){this.apiRest,this.state;webix.attachEvent("onClick",(function(e,t,i){}))},l.doClickSave=function(e){void 0===e&&(e=!1);var t=this.state;if(t.formEdit.validate()){var i=t.formEdit.getValues();e&&(t.isUpdate=!1,i.id=""),webix.dp(t.table).save(t.isUpdate?i.id:webix.uid(),t.isUpdate?"update":"insert",i).then((function(e){webix.dp(t.table).ignore((function(){t.isUpdate?t.table.updateItem(i.id,e):t.table.add(e,0),t.table.select(e.id),t.isUpdate||t.table.scrollTo(0,0)})),t.table.refresh(),t.win.hide()}),(function(){webix.message("Ошибка! Данные не сохранены!")}))}},l.setPrice=function(){var e=this.apiRest,t=this.state,i=this,o=this.$$("form_price"),a=e.getUrl("get","accounting/product-bed/get-price",{"per-page":"-1"});this.labelSetValue();var n=t.formEdit.getValues();""!=n.product_id&&""!=n.cloth_id&&""!==n.size_id&&""!==n.leg_id&&""!==n.button_id&&""!==n.bottom_id&&""!==n.stitching_id&&""!==n.carcass_type_id&&webix.ajax().get(a,n).then((function(e){var t=e.json();o.setValue(t.sum);var a=0;for(var n in t.rules)(a=parseInt(t.rules[n]))>0?(a="+"+t.rules[n],webix.html.removeCss(i.$$(n).$view,"red"),webix.html.addCss(i.$$(n).$view,"green"),i.$$(n).refresh()):(webix.html.removeCss(i.$$(n).$view,"green"),webix.html.addCss(i.$$(n).$view,"red"),i.$$(n).refresh()),i.$$(n).setValue(a)}))},l.labelSetValue=function(){this.$$("leg_id").setValue(""),this.$$("size").setValue(""),this.$$("cloth_id").setValue(""),this.$$("client_id").setValue(""),this.$$("form_price").setValue(0)},l.doClickCalculation=function(){this.setPrice()},o}(o.b);i(2),i(4);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)1==t[o].$level&&(isNaN(e(t[o]))||(i+=1*e(t[o])));return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};webix.Date.dateToStr("%d.%m.%y");var c=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){var e,t=this;return{rows:[{cols:[{view:"label",width:200,height:30,template:"Заказы",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:220,label:"Дата отгрузки",labelWidth:100,width:230,value:webix.Date.monthStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-plus",autowidth:!0,value:!0,click:function(){t.doAdd()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){t.doRefresh()}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,hidden:!0,click:function(){t.doClickOpenAll()}},{view:"select",value:4,labelWidth:100,options:[{id:4,value:"Отгруженные"},{id:3,value:"На складе"},{id:1,value:"В заказах"},{id:6,value:"В обработке"}],width:200,hidden:!0,localId:"select-type"},{view:"select",value:2,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,hidden:!0,on:{onChange:function(e){t.showBatch(e)}}},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"}]},(e={view:"treetable",urlEdit:"order",css:"webix_header_border webix_data_border",leftSplit:1,select:"row",resizeColumn:{headerOnly:!0},localId:"order-table",multiselect:!0,drag:!0,editable:!0,visibleBatch:2,scroll:!0,save:"api->accounting/orders",editaction:"dblclick",clipboard:"selection"},e.select="cell",e.tooltip=!0,e.columns=[{id:"A",header:["# заказа",{content:"textFilter"},{content:"totalColumnCount"}],hidden:!1,css:{color:"black","text-align":"right","font-weight":500},sort:"int",tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#"},{id:"date_obivka",header:["Дата произ.",{content:"selectFilter"},""],width:100,css:{color:"black","text-align":"right","font-weight":100},sort:"date",format:webix.Date.dateToStr("%d.%m.%y")},{id:"date_shipment",header:["Дата отгр.",{content:"selectFilter"},""],width:100,css:{color:"black","text-align":"right","font-weight":500},sort:"date",editor:"date",format:webix.Date.dateToStr("%d.%m.%y")},{id:"B",header:["Статус",{content:"selectFilter"},""],width:80,batch:2,sort:"int",editor:"text"},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,sort:"date"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,sort:"date"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,sort:"string"},{id:"F",header:["Клиент",{content:"textFilter"},""],width:200,batch:2,sort:"string",editor:"text"},{id:"G",width:90,header:["Сумма",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},sort:"int",editor:"text"},{id:"H",header:["Дата гот.",{content:"textFilter"},""],width:90,batch:2,editor:"text"},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,batch:2,editor:"text"},{id:"K",header:["Дата ткани",{content:"textFilter"},""],width:90,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,batch:2,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"}],e.scheme={$sort:{by:"B",dir:"desc",as:"int"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},e.ready=function(){webix.ui({view:"contextmenu",id:"cm",data:["Редактировать"],on:{onItemClick:function(e){var i=this.getContext();t.$$("order-table").unselect(),t.$$("order-table").select(i.id.row,i.id.column,!0),"Редактировать"==e&&t.formEdit.showForm(t.$$("order-table"))}}}).attachTo(this),this.openAll()},e.on={onColumnResize:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(e,t){}},e)]}},a.init=function(e){var t=this.$$("order-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=this.$$("select-type"),r=i(this.$$("dateFrom").getValue()),c=i(this.$$("dateTo").getValue()),s=n.getValue(),d=this.$$("form-search"),u={filter:{B:{in:[s]}}};4==s&&(u={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":r,"<=":c},B:4}]}});var h=this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'}),p=this;webix.ajax().get(h,u).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){r=i(o.getValue()),c=i(a.getValue());var l={filter:{B:{in:[s=n.getValue()]}}};4==s&&(l={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":r,"<=":c},B:4}]}});var d=p.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});webix.ajax().get(d,l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){r=i(o.getValue()),c=i(a.getValue()),4==(s=n.getValue())&&(u={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":r,"<=":c},B:4}]}});var l=p.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});webix.ajax().get(l,u).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),n.attachEvent("onChange",(function(e){r=i(o.getValue()),c=i(a.getValue());var l={filter:{B:{in:[s=n.getValue()]}}};4==s&&(l={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":r,"<=":c},B:4}]}});var d=p.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"index","direction":"ASC"}]'});webix.ajax().get(d,l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),d.attachEvent("onChange",(function(e){4==s&&(u={or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":r,"<=":c},B:4}]});var i=p.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1200",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});""!=d.getValue()&&(u={A:d.getValue()});var o={filter:u};webix.extend(t,webix.ProgressBar),t.clearAll(!0),t.showProgress({delay:2e3,hide:!1}),webix.ajax().get(i,o).then((function(e){t.parse(e.json().items)}))})),this.formEdit=this.ui(l)},a.doRefresh=function(){var e=this.$$("order-table"),t=webix.Date.dateToStr("%d.%m.%y"),i=this.$$("select-type"),o=t(this.$$("dateFrom").getValue()),a=t(this.$$("dateTo").getValue()),n=i.getValue(),r={filter:{B:{in:[n]}}};4==n&&(r={filter:{or:[{B:{in:[3,1,2,5,6]}},{date_shipment:{">=":o,"<=":a},B:4}]}}),this.restApi=this.app.config.apiRest;var l=this.restApi.getUrl("get","accounting/orders",{"per-page":"1200",sort:'[{"property":"B","direction":"DESC"}, {"property":"date_shipment","direction":"ASC"}, {"property":"A","direction":"ASC"}]'});webix.extend(e,webix.ProgressBar),e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(l,r).then((function(t){e.clearAll(),e.parse(t.json().items),e.enable()}))},a.doClickOpenAll=function(){var e=this.$$("order-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},a.showBatch=function(e){this.$$("order-table").showColumnBatch(e)},a.doAdd=function(){var e=this.$$("order-table");e.unselect(),this.formEdit.showForm(e)},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));var o=i(0),a=i(1),n=(new(i(5).a)).getUrl("get","accounting/product-bed-types",{sort:"name","per-page":-1}),r=new webix.DataCollection({data:webix.ajax(n).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}});i(2),i(4),i(3);var l=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){var e=this;return{localId:"layout",type:"wide",cols:[{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",label:"Продукция",width:150},{},{label:"",view:"search-close",width:300,align:"right",localId:"form-search"},{view:"button",value:"fs",width:30,click:function(){webix.fullscreen.set("product-bed-table")}}]},{view:"toolbar",height:40,paddingY:2,cols:[{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return e.doAddClick()}}]},{view:"datatable",localId:"product-bed-table",urlEdit:"product-bed",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"id",header:"#",width:50},{id:"name",header:"Наиименование",width:280,sort:"string"},{id:"type_id",header:"Тип",width:180,sort:"string",collection:r},{id:"expense_cloth_120",header:"Рас. тк. 120",width:120,sort:"string",edit:"text"},{id:"expense_cloth_140",header:"Рас. тк. 140",width:120,sort:"string",edit:"text"},{id:"expense_cloth_160",header:"Рас. тк. 160",width:120,sort:"string",edit:"text"},{id:"expense_cloth_180",header:"Рас. тк. 180",width:120,sort:"string",edit:"text"},{id:"expense_cloth_200",header:"Рас. тк. 200",width:120,sort:"string",edit:"text"},{id:"price",header:"Кат. 0",width:100},{id:"price_1",header:"Кат. 1"},{id:"price_2",header:"Кат. 2."},{id:"price_3",header:"Кат. 3."},{id:"price_4",header:"Кат. 4",width:100},{id:"price_5",header:"Кат. 5",width:100},{id:"price_6",header:"Кат. 6",width:100},{id:"price_7",header:"Кат. 7",width:110},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/product-beds",{sort:"name"}),save:"api->accounting/product-beds",on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}}]}]}},n.init=function(e){var t=this.$$("form-search"),i=this.$$("product-bed-table"),o=this;t.attachEvent("onChange",(function(e){var a={filter:{search:t.getValue()}};webix.extend(i,webix.ProgressBar),i.clearAll(!0),i.showProgress({delay:2e3,hide:!1}),webix.ajax().get(o.app.config.apiRest.getUrl("get","accounting/product-beds"),a).then((function(e){i.parse(e)}))})),this.cashEdit=this.ui(a.a)},n.doAddClick=function(){this.$$("product-bed-table").unselect(),this.cashEdit.showForm(this.$$("product-bed-table"))},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0),a=i(7),n=i(14);i(58);window.procent=function(e,t){var i=$$("table_part").getItem(e),o=$$(t).getValue();return Math.round(100*i.value*100/o)/100};var r=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state=new a.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){this.apiRest=this.app.config.apiRest,this.win={};return this.win},r.init=function(e,t){},r.showForm=function(e){var t=this,i=this,o=this.state,a=(this.apiRest,e.getSelectedItem()),r=a;o.tableId=e.config.urlEdit,o.table=e,o.tableRecord=a,o.isUpdate=r,o.formEdit=this.$$("formEdit"),o.formUrl="accounting/"+o.tableId+"/form",o.win={};var l=new n.default(this.app,"document-salary-accrual",a);o.win=this.ui({localId:"winEdit",view:"window",move:!0,resize:!0,height:500,position:"center",head:{cols:[{template:"Начисление зарплаты",type:"header",borderless:!0},{view:"icon",icon:"mdi mdi-fullscreen",tooltip:"enable fullscreen mode",click:function(e,t){o.win.config.fullscreen?(webix.fullscreen.exit(),this.define({icon:"mdi mdi-fullscreen",tooltip:"Enable fullscreen mode"})):(webix.fullscreen.set(o.win),this.define({icon:"mdi mdi-fullscreen-exit",tooltip:"Disable fullscreen mode"})),this.refresh()}},{view:"icon",icon:"wxi-close",tooltip:"Close window",click:function(){o.win.close()}}]},close:!0,modal:!0,body:{view:"layout",padding:10,margin:10,rows:[{localId:"formEdit",view:"form",width:1400,elements:[{margin:10,cols:[{id:"form_edit_id",label:"ID",name:"id",localId:"id",value:"",placeholder:"ID",view:"text",height:38,labelWidth:50,width:150,disabled:!0,invalidMessage:"Значение не может быть пустым!"},{id:"form_edit_date_document",name:"date_document",view:"datepicker",localId:"date_document",label:"Дата",labelWidth:50,width:180,value:new Date,required:!0,invalidMessage:"Значение не может быть пустым!"},{id:"form_edit_date_created",name:"date_created",view:"datepicker",localId:"date_created",label:"Дата",labelWidth:50,width:180,value:new Date,required:!0,invalidMessage:"Значение не может быть пустым!",hidden:!0},{id:"form_edit_type_document",name:"type_document",view:"text",localId:"type_document",label:"Тип документа",labelWidth:50,width:180,value:"",disabled:!0,format:"1 111,00",invalidMessage:"Значение не может быть пустым!",hidden:!0},{id:"form_edit_sum",name:"sum",view:"text",localId:"sum",label:"Сумма",labelWidth:50,width:180,value:"",disabled:!0,format:"1 111,00",invalidMessage:"Значение не может быть пустым!"}]}]},{view:"toolbar",paddingY:0,elements:[{view:"icon",icon:"mdi mdi-plus",autowidth:!0,click:function(){return t.doClickCancel()}},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,click:function(){return t.doClickFillAll()}},{view:"icon",icon:"mdi mdi-printer",autowidth:!0,click:function(){return t.doClickPrint()}},{}]},l,{margin:10,cols:[{view:"template",template:" ",role:"placeholder",borderless:!0},{view:"button",label:"Печать",css:"webix_transparent",align:"right",width:120,click:function(){return t.doClickPrint()}},{view:"button",label:"Отмена",css:"webix_transparent",align:"right",width:120,click:function(){return t.doClickCancel()}},{view:"button",css:"webix_primary",label:"Сохранить",align:"right",width:120,click:function(){return t.doClickSave()}}]}]}}),webix.promise.defer().resolve(o.win.getBody()).then((function(e,t){var a=o.win.getBody().queryView({localId:"document-salary-accrual-table"});a.waitData.then((function(){a.openAll(),a.data.attachEvent("onDataUpdate",(function(e,t,o){i.setSumByTableRows()})),a.data.attachEvent("onAfterAdd",(function(e,t,o){i.setSumByTableRows()})),a.data.attachEvent("onAfterDelete",(function(e){i.setSumByTableRows()})),i.setSumByTableRows()}))})),o.win.show()},r.setSumByTableRows=function(){var e=this.state,t=e.win.getBody().queryView({localId:"document-salary-accrual-table"}),i=0;t.data.each((function(e){i+=parseFloat(e.salary),console.log(e),console.log(i)})),e.tableRecord.sum=i,e.win.getBody().queryView({localId:"formEdit"}).setValues(this.getRecord())},r.getRecord=function(){var e=this.state;return e.isUpdate?e.tableRecord:{date_operation:new Date,is_committed:1,type_operation:2}},r.doClickSave=function(e){void 0===e&&(e=!1),this.doSaveTable()},r.doSaveTable=function(){var e=this,t=this.state.win.getBody().queryView({localId:"document-salary-accrual-table"}),i=this.app.config.apiRest.getUrl("create","accounting/document-salary-accruals"),o=this.app.config.apiRest.getUrl("put","accounting/document-salary-accruals"),a=this.state.win.getBody().queryView({localId:"date_document"}).getValue(),n=this.app.config.apiRest.getUrl("create","accounting/list-salary-accruals"),r={},l=e.state.tableRecord?e.state.tableRecord.id:null,c=this.state;if(c.formEdit=c.win.getBody().queryView({localId:"formEdit"}),c.formEdit.validate()){var s=c.formEdit.getValues();t.data.each((function(t){if(!t.$group){for(var d in t)-1!=d.indexOf("$")&&delete t[d];delete t.depends,delete t.triggers,t.date_document=a,t.list_id?(o=e.app.config.apiRest.getUrl("put","accounting/document-salary-accruals",{},t.id),webix.ajax().put(o,t).then((function(e){s=c.formEdit.getValues(),c.win.close(),c.table.updateItem(s.id,s)}))):(!1,t.list_id=l,delete t.id,r={date_document:a,type_document:7,sum:0},null==l?webix.ajax().post(n,r).then((function(e){var o=e.json();l=o.id,t.list_id=l,c.formEdit.setValues(o),webix.ajax().post(i,t).then((function(e){c.table.add(o),c.table.updateItem(l,o)})).then((function(){c.win.close()}))})):webix.ajax().post(i,t).then((function(e){})).then((function(){c.win.close()})))}}))}},r.doClickCancel=function(){this.state.win.close()},r.doClickFillAll=function(){var e=this.state,t=this.state.win.getBody().queryView({localId:"document-salary-accrual-table"}),i=webix.Date.dateToStr("%Y-%m-%d"),o=e.win.getBody().queryView({localId:"date_document"}).getValue(),a=this.app.config.apiRest.getUrl("get","accounting/employee-time-work/get-salary-by-days",{sort:"employee_name",dateDocument:i(o)});webix.ajax().get(a).then((function(e){var i,o=e.json().data,a=[];for(var n in t.data.each((function(e){a[e.employee_id]=e})),o)if(delete(i=o[n]).id,a[i.employee_id]){var r=[];for(var l in i)parseFloat(i[l])&&Math.round(i[l])!=Math.round(a[i.employee_id][l])&&r.push(l);for(var c in t.updateItem(a[i.employee_id].id,i),r)t.addCellCss(a[i.employee_id].id,r[c],"webix_editing_cell")}else i.$css="webix_editing_cell",t.add(i);t.editCell(1,"employee_name",!0,!0)}))},r.doClickPrint=function(){var e=this.state.win.getBody().queryView({localId:"document-salary-accrual-table"});webix.print(e,{mode:"landscape",fit:"data"})},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));i(0);var o=i(1);i(2),i(4),i(3);var a=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){var e=this;return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=44,e.top=34,e.width=e.maxWidth/1.5,e.height=e.maxHeight-34},head:"Редактирование",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"auto",elements:[{borderless:!1,margin:10,type:"space",rows:[{cols:[{id:"order_field",label:"Свойство заказа",name:"order_field",options:{data:this.apiRest.getCollection("accounting/calculation-fields")},view:"combo",labelPosition:"top"},{id:"index_order",label:"Порядок выполнения",name:"index_order",view:"text",labelPosition:"top"},{id:"process_id",label:"Процесс",name:"process_id",view:"text",labelPosition:"top"},{},{},{},{}]},{cols:[{rows:[{id:"type",label:"Тип свойства",name:"type",options:[{id:"value",value:"Значение"},{id:"dir",value:"Справочник"}],view:"combo",labelPosition:"top"},{hidden:!1,rows:[{id:"directory_id",label:"Справочник",name:"directory_id",options:{data:this.apiRest.getCollection("accounting/calculation-directories")},view:"combo",labelPosition:"top"},{id:"directory_field",label:"Свойство справочника",name:"directory_field",options:[],view:"combo",labelPosition:"top"}]}]},{width:40},{rows:[{cols:[{label:"Условие",name:"rule",value:"=",options:["=",">","<",">=","<="],view:"combo",labelPosition:"top"},{label:"Значение",name:"value",value:"",view:"text",required:!0,labelPosition:"top"}]}]},{width:40},{rows:[{id:"result_type",label:"Тип результата",name:"result_type",value:"1",options:[{id:"value",value:"Значение"},{id:"dir",value:"Справочник"}],view:"combo",labelPosition:"top"},{hidden:!1,rows:[{label:"Свойство заказа для справочника",name:"order_result_type",value:"product_id",view:"combo",labelPosition:"top",hidden:!0},{id:"result_directory_id",label:"Справочник",value:"1",name:"result_directory_id",options:{data:this.apiRest.getCollection("accounting/calculation-directories")},view:"combo",labelPosition:"top"},{id:"result_directory_field",label:"Свойство справочника",name:"result_directory_field",view:"combo",labelPosition:"top",options:[]}]}]},{hidden:!1,rows:[{id:"result_value_operation",label:"Операция со значением",name:"result_value_operation",options:["=","+","-","+%","-%","formula"],view:"combo",labelPosition:"top"}]},{rows:[{id:"result_value",label:"Значение",hidden:!1,disabled:!1,name:"result_value",value:"",view:"text",labelPosition:"top"},{label:"Формула",view:"text",labelPosition:"top",name:"result_formula",hidden:!0}]}]}]},{margin:10,cols:[{view:"template",template:" ",role:"placeholder",borderless:!0},{view:"button",localId:"btn_copy",label:"Копировать",css:"webix_transparent",align:"right",width:120},{view:"button",label:"Отмена",css:"webix_transparent",align:"right",width:120,click:function(){return e.doClickCancel()}},{view:"button",localId:"btn_save",css:"webix_primary",label:"Сохранить",align:"right",width:120}]}]}}},a.init=function(){this.attachFormEvents()},a.attachFormEvents=function(){var e=this,t=(this.state,this.$$("btn_save")),i=this.$$("btn_copy"),o=this.$$("directory_id"),a=this.$$("directory_field"),n=this.$$("type"),r=this.$$("result_type"),l=this.$$("result_directory_id"),c=this.$$("result_directory_field"),s=this.$$("result_value"),d=this.$$("result_value_operation");this.apiRest;t.attachEvent("onItemClick",(function(t){e.doClickSave()})),i.attachEvent("onItemClick",(function(t){e.doClickSave(!0)})),o.attachEvent("onChange",(function(e){if(""!=e){a.setValue();var t=new webix.DataCollection({data:o.getList().getItem(o.getValue()).fields});a.getPopup().getList().sync(t)}})),n.attachEvent("onChange",(function(e){"dir"!=e?(o.hide(),a.hide()):(o.show(),a.show())})),l.attachEvent("onChange",(function(e){if(""!=e){c.setValue();var t=new webix.DataCollection({data:l.getList().getItem(l.getValue()).fields});c.getPopup().getList().sync(t)}})),r.attachEvent("onChange",(function(e){"dir"!=e?(l.hide(),c.hide(),s.show()):(l.show(),c.show(),s.hide())})),d.attachEvent("onChange",(function(e){"formula"==e&&"dir"==r.getValue()&&s.show()}))},o}(o.a)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return d}));var o=i(0),a=(i(15),i(16),i(9)),n=i(11),r=i(12),l=i(13),c=i(7);window.procent=function(e,t){var i=$$("table_part").getItem(e),o=$$(t).getValue();return Math.round(100*i.value*100/o)/100};var s=function(e){var t,i;function o(t,i){var o;return(o=e.call(this,t,i)||this).state||(o.state=new c.a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o))),o}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){return this.apiRest=this.app.config.apiRest,this.win={},{localId:"winEdit",view:"window",position:function(e){e.left=44,e.top=42,e.width=e.maxWidth/3,e.height=e.maxHeight-42},head:"Редактирование операции",close:!0,modal:!0,body:{localId:"formEdit",view:"form",scroll:"auto",elements:this.state.formConfig}}},a.init=function(e,t){this.attachClickEvents()},a.showForm=function(e){var t=this,i=this.state,o=this.apiRest,a=e.getSelectedItem(),n=a;i.tableId=e.config.urlEdit,i.table=e,i.tableRecord=a,i.isUpdate=n,i.formEdit=this.$$("formEdit"),i.formUrl="accounting/"+i.tableId+"/form",i.win=this.$$("winEdit"),i.formEdit.clearValidation(),o.get(i.formUrl).then((function(e){t.showWindow(e,t)}))},a.showWindow=function(e,t){var i=t.state,o=Object.keys(i.formEdit.elements).length,a=e.json();i.formData=a,t.renderForm(o),i.formEdit.setValues(t.getRecord()),t.bindCollection(a),t.bindColumnCollection(a),t.showParts(i.tableRecord)},a.getRecord=function(){var e=this.state;return e.isUpdate?e.tableRecord:{date_operation:new Date,is_committed:1,type_operation:2}},a.attachFormParamsElements=function(){var e=this.state;this.$$("table_part_value").scheme_setter({$init:function(e){e.index=this.count()+1}}),e.table.scheme_setter({$init:function(e){},$update:function(e){}})},a.renderForm=function(e){var t=this.state;0===e&&(t.formConfig=t.formData.data.configForm,webix.ui(t.formConfig,t.formEdit),this.attachFormParamsElements(),this.attachFormEvents())},a.bindCollection=function(e){var t=this.state,i=this.apiRest,o=0,a=e.data.dataCollections,n=Object.keys(a).length,r={"per-page":-1};for(var l in a){var c=$$(l).getPopup().getList(),s=i.getCollection(a[l].url,r);s.waitData.then((function(){++o===n&&t.win.show()})),c.sync(s)}},a.bindColumnCollection=function(e){var t=this.apiRest,i={"per-page":-1},o=e.data.columnCollections;for(var a in o){var n=o[a];for(var r in n)this.$$(a).getColumnConfig(r).options=t.getCollection(n[r].url,i);this.$$(a).refreshColumns()}},a.attachFormEvents=function(){var e=this,t=this.state.formEdit.elements.type_operation,i=this.$$("combo_value_break"),o=this.$$("table_part_value"),a=this.$$("btn_save"),n=$$("form_edit_sum");t.attachEvent("onChange",(function(t,i){e.typeOperationChange(t)})),i.attachEvent("onChange",(function(t){e.comboValueBreakChange(t)})),a.attachEvent("onItemClick",(function(t){e.doClickSave()})),o.attachEvent("onItemClick",(function(e,t,i){"action-delete-part"===e.column&&this.remove(e.row)})),n.attachEvent("onChange",(function(e,t,i){1===o.data.count()&&(o.getItem(o.getIdByIndex(0)).value=e),o.refreshColumns()}))},a.typeOperationChange=function(e){var t=this.state,i=this.$$("label_move_from"),o=this.$$("label_move_to"),a=this.$$("label_value_break"),n=t.formEdit.elements.account_move_id,r=t.formEdit.elements.contragent_id,l=t.formEdit.elements.category_id,c=this.$$("combo_value_break"),s=3==e,d=[{element:i,status:s},{element:o,status:s},{element:n,status:s},{element:a,status:!s},{element:r,status:!s},{element:l,status:!s}];for(var u in s&&c.setValue(1),d)d[u].status?d[u].element.show():d[u].element.hide()},a.comboValueBreakChange=function(e){var t=this.state,i=this.$$("table_part_value"),o=this.$$("combo_value_break"),a=this.$$("layout_part_value"),n=t.formEdit.elements.contragent_id,r=t.formEdit.elements.category_id,l=t.formEdit.elements.project_id,c=e>1,s=3==e,d=4==e,u=[{element:a,status:c},{element:o,status:c},{element:n,status:!c},{element:r,status:!s},{element:l,status:!d}];for(var h in s&&r.setValue(""),d&&l.setValue(""),n.setValue(""),i.showColumnBatch(e),u)u[h].status?u[h].element.show():u[h].element.hide();c||i.clearAll()},a.attachClickEvents=function(){var e=this;webix.attachEvent("onClick",(function(t,i,o){t.target&&("show-combo-value-break"===t.target.classList.value&&e.onClickShowComboValueBreak(),"add-to-table"===t.target.classList.value&&e.$$("table_part_value").add({index:"",contragent_id:"",category_id:"",project_id:"",value:"0.00",part_procent:""}))}))},a.onClickShowComboValueBreak=function(){this.$$("combo_value_break").isVisible()?this.$$("combo_value_break").hide():this.$$("combo_value_break").show()},a.showParts=function(e){var t=this.state,i=this.$$("table_part_value");if(i.clearAll(),e){var o=t.table.data.getBranch(e.id);for(var a in o)i.add(o[a])}},a.doClickSave=function(){var e=this.state;if(e.formEdit.validate()){var t=e.formEdit.getValues();t.account={name:this.$$("account").getText()};var i=this.getParts();i.length;var o=[];for(var a in 2==t.type_part_id&&(o=["category_id","project_id"]),3==t.type_part_id&&(o=["project_id"]),i)for(var n in i[a])-1!=o.indexOf(n)&&(i[a][n]=t[n]);t.data=i,webix.dp(e.table).save(e.isUpdate?t.id:webix.uid(),e.isUpdate?"update":"insert",t).then((function(i){webix.dp(e.table).ignore((function(){e.isUpdate?e.table.updateItem(t.id,i):e.table.add(i,0),e.table.select(i.id);var o=e.table.getSelectedId();if(i.data.length>1)for(var a in i.data)e.isUpdate?e.table.updateItem(t.data[a].id,i.data[a]):e.table.add(i.data[a],0,o);e.isUpdate||e.table.scrollTo(0,0),e.table.sort("date_operation","desc","string"),e.table.markSorting("date_operation","desc")})),e.table.refresh(),e.win.hide()}),(function(){webix.message("Ошибка! Данные не сохранены!")}))}},a.getParts=function(){var e=this.$$("table_part_value").serialize(),t=[];for(var i in e)t.push(e[i]);return t},o}(o.b);i(2),i(4),i(3);var d=function(e){var t,i;function o(t,i,o,a){var n;return(n=e.call(this,t,i)||this)._componentData=a,n.urlConfig=o,n}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var c=o.prototype;return c.config=function(){var e,t=this;this.app.getService("locale")._;return{type:"wide",cols:[{css:"webix_shadow_medium",rows:[{view:"form",localId:"searchFormOperation",autoheight:!1,width:250,margin:0,scroll:"auto",elements:[{label:"Тип",view:"label"},{cols:[{view:"checkbox",localId:"search_type_operation",name:"type_operation.checkbox1",borderless:1,css:"small",width:33,value:"1",checkValue:"1",uncheckValue:0},{label:"Поступление",view:"label"}],height:30},{cols:[{view:"checkbox",width:33,name:"type_operation.checkbox2",value:"2",checkValue:"2",uncheckValue:0},{label:"Выплата",view:"label"}],height:30},{cols:[{view:"checkbox",width:33,name:"type_operation.checkbox3",value:"3,4",checkValue:"3,4",uncheckValue:0},{label:"Перемещение",view:"label"}],height:30},{label:"Дата оплаты",view:"label"},{cols:[{view:"checkbox",width:33,name:"is_committed.checkbox1",value:"1",uncheckValue:0,checkValue:"1"},{label:"Подтвержена",view:"label"}],height:30},{cols:[{view:"checkbox",width:33,name:"is_committed.checkbox2",value:"2",uncheckValue:0,checkValue:"2"},{label:"Не подтвержена",view:"label"}],height:30},{view:"datepicker-close",name:"date_operation"},{label:"Счет и Юр.лицо",view:"label",height:25},{localId:"searchAccountCombo",options:[],view:"combo-close",name:"account_id"},{label:"Контрагент",view:"label",height:25},{localId:"searchContragentCombo",view:"combo-close",options:[],name:"contragent_id"},{label:"Статья",view:"label",height:25},{localId:"searchCategoryCombo",view:"combo-close",options:[],name:"category_id"},{label:"Проект",view:"label",height:25},{localId:"searchProjectCombo",view:"combo-close",options:[],name:"project_id"},{label:"Сумма",view:"label",height:25},{cols:[{view:"text",value:"",placeholder:"от",name:"value.range.1"},{label:"-",view:"label",width:25},{view:"text",value:"",placeholder:"до",name:"value.range.2"}]}]}]},{rows:[{view:"toolbar",height:40,paddingY:2,cols:[{view:"label",height:50,css:{"font-size":"22px",padding:"5px 0px 10px 15px","font-weight":700},template:"<div>Операции</div>",borderless:!0,width:130},{label:"Добавить",type:"icon",icon:"mdi mdi-plus",view:"button",height:50,css:"webix_primary",autowidth:!0,click:function(){return t.doAddClick()}},{},{label:"",view:"search-close",width:300,align:"right"}]},{view:"treetable",localId:"transaction",urlEdit:"transaction",select:!0,scrollX:!1,hover:"myhover",rowHeight:43,columns:[{id:"ch1",header:{content:"masterCheckbox"},checkValue:"on",uncheckValue:"off",width:40,template:function(e,t,i,o){return 1==e.$level?t.checkbox(e,t,i,o):""}},{id:"is_committed",header:"",width:30,template:function(e,t,i,o){return 1==e.$level?"<span class='mdi mdi-check' value='"+e.is_committed+"' />":""}},{id:"date_operation",header:"Дата",sort:"string",editor:"date",adjust:!0,template:function(e,t){var i="";return 1==e.$level&&e.$count>1&&(i=t.icon(e,t)+webix.i18n.longDateFormatStr(e.date_operation)),1!=e.$level&&(i="<div class='subrowimage'><div></div></div>"),1==e.$level&&e.$count<2&&(i="<div style='margin-left:20px;'>"+webix.i18n.longDateFormatStr(e.date_operation)+"</div>"),1==e.$level&&2==e.is_committed&&(i='<div style="color:blue">'+i+"</div>"),i}},(e={id:"account",header:["Счет"],template:"#account.name#",adjust:!0},e.template=function(e,t){var i=e.account.name;return 3==e.type_operation&&(i='<span style="line-height: 20px; display: block;">'+e.account.name+"</span>"),i},e),{id:"type_operation",width:50,header:"Тип",sort:"server",template:function(e){return 1==e.type_operation?'<span class="webix_icon wxi-angle-double-left" style = "color: green"></span>':2==e.type_operation?'<span class="webix_icon wxi-angle-double-right" style = "color: red"></span>':3==e.type_operation||4==e.type_operation?'<span class="webix_icon wxi-sync" style = "color: grey"></span>':void 0}},{id:"contragent",header:"Контрагент",fillspace:!0,template:function(e){return 1==e.$level&&3==e.type_operation?"":1==e.$level&&e.$count>1&&""==e.contragent.name?'<span class="webix_snippet_tag">'+e.$count+" контрагента</span>":e.contragent.name}},{id:"category",header:"Статья",width:200,template:function(e){var t=e.comment?e.comment:"";return 1==e.$level&&3==e.type_operation?'<span class="webix_snippet_tag">Перемещение</span>':1==e.$level&&e.$count>1&&""==e.category.name?'<span class="webix_snippet_tag">'+e.$count+" статьи</span>":'<span style="display: block; line-height: 22px;">'+e.category.name+'</span><span style="display: block; line-height: 15px; font-size: 11px;color: #666;">'+t+"</span>"},sort:"string"},{id:"project",header:"Проект",fillspace:!0,autoheight:!0,template:function(e){return 1==e.$level&&3==e.type_operation?"":1==e.$level&&e.$count>1&&4==e.type_part_id?'<span class="webix_snippet_tag">'+e.$count+" проекта</span>":e.project.name}},{id:"value",header:"Сумма",adjust:!0,css:{color:"red","text-align":"right"},template:function(e){return 1==e.type_operation?'<span style = "color: green; text-align: right;">+ '+webix.Number.format(e.value,{decimalSize:0,groupSize:3,decimalDelimiter:".",groupDelimiter:" "})+"</span>":2==e.type_operation||3==e.type_operation?'<span style = "color: red;  text-align: right;">- '+webix.Number.format(e.value,{decimalSize:0,groupSize:3,decimalDelimiter:".",groupDelimiter:" "})+"</span>":4==e.type_operation?'<span style = "color: green;  text-align: right;">+ '+webix.Number.format(e.value,{decimalSize:0,groupSize:3,decimalDelimiter:".",groupDelimiter:" "})+"</span>":void 0}},{id:"id",hidden:!0},{id:"action-delete",header:"",width:50,template:"{common.trashIcon()}"},{id:"action-edit",header:"",width:50,template:"{common.editIcon()}"}],url:this.app.config.apiRest.getUrl("get","accounting/transactions",{expand:"contragent,category,project,account,data",sort:"-date_operation"}),save:"api->accounting/transactions",scroll:"y",on:{onResize:webix.once((function(){})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")},onItemClick:function(e,t,i){if(2==this.getSelectedItem().$level)return this.clearSelection();if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeFilter:function(e,t,i){}}},{cols:[{view:"label",label:"0",localId:"count",template:"<div class='webix_el_box' style='line-height:32px'>Показано: #label# операций</div>"},{view:"label",label:"",localId:"income",template:"<div class='webix_el_box' style='line-height:32px; color: darkgreen'>Поступлений: #label#</div>"},{view:"label",label:"",localId:"outcome",template:"<div class='webix_el_box' style='line-height:32px; color: red'>Выплат: #label#</div>"},{view:"label",label:"",localId:"move",color:"grey",template:"<div class='webix_el_box' style='line-height:32px; color: #color#'>Перемещения: #label#</div>"},{view:"label",label:"",localId:"total",color:"grey",template:"<div class='webix_el_box' style='line-height:32px; color: #color#'>Итого:  #label#</div>"},{align:"right"}]}]}]}},c.init=function(e){this.view=e;var t=this.$$("searchAccountCombo").getPopup().getList();t.parse(a.a),(t=this.$$("searchContragentCombo").getPopup().getList()).parse(n.a),(t=this.$$("searchCategoryCombo").getPopup().getList()).parse(l.a),(t=this.$$("searchProjectCombo").getPopup().getList()).parse(r.a);var i=this.$$("searchFormOperation"),o=this.$$("transaction"),c=this;i.attachEvent("onChange",(function(e){var t=i.getValues(),a={},n={},r={};for(var l in t)if(t[l])if((n=l.split(".")).length>1)if("range"==n[1])r[n[0]]?r[n[0]]["<="]=t[l]:(r[n[0]]=[],r[n[0]]={">=":t[l]}),t[n[0]]=r[n[0]],a[n[0]]=t[n[0]];else{r[n[0]]||(r[n[0]]=[]);var s=t[l].split(",");if(s.length>1)for(var d in s)r[n[0]].push(s[d]);else r[n[0]].push(t[l]);t[n[0]]={in:r[n[0]]},a[n[0]]=t[n[0]]}else a[l]="date_operation"==l?{">=":t[l],"<":webix.Date.add(t[l],1,"day",!0)}:t[l];webix.extend(o,webix.ProgressBar);e={filter:a};webix.ajax().get(c.app.config.apiRest.getUrl("get","accounting/transactions",{expand:"contragent,category,project,account,data"}),e).then((function(e){o.parse(e)}));var u=c.app.config.apiRest.getUrl("get","accounting/transaction/summary");webix.ajax().get(u,e).then((function(e){c.setTotal(e.json())}))}));var d=this.app.config.apiRest.getUrl("get","accounting/transaction/summary");webix.ajax().get(d).then((function(e){c.setTotal(e.json())})),this.cashEdit=this.ui(s)},c.doAddClick=function(){this.$$("transaction").unselect(),this.cashEdit.showForm(this.$$("transaction"))},c.setTotal=function(e){var t=this.$$("income"),i=this.$$("outcome"),o=this.$$("move"),a=this.$$("total"),n=this.$$("count"),r=0,l=0,c=0,s=0,d=0;for(var u in e.data)1==e.data[u].type_operation&&(r=e.data[u].value),2==e.data[u].type_operation&&(l=e.data[u].value),3==e.data[u].type_operation&&(c=e.data[u].value),4==e.data[u].type_operation&&(s=e.data[u].value),r?t.setValue(webix.Number.format(r)):t.setValue(0),l?i.setValue(webix.Number.format(l)):i.setValue(0),d+=Number.parseInt(e.data[u].id_part);var h=webix.Number.format(r-l),p=webix.Number.format(c-s);o.setValue(p),a.setValue(h),n.setValue(d),h>=0?a.define("color","green"):a.define("color","red"),p>=0?o.define("color","green"):o.define("color","red"),t.refresh(),i.refresh(),o.refresh(),a.refresh(),n.refresh()},o}(o.b)},function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var o=new webix.DataCollection({data:[{id:1,title:"The Shawshank Redemption",year:1994,votes:678790,rating:9.2,rank:1},{id:2,title:"The Godfather",year:1972,votes:511495,rating:9.2,rank:2},{id:3,title:"The Godfather: Part II",year:1974,votes:319352,rating:9,rank:3},{id:4,title:"The Good, the Bad and the Ugly",year:1966,votes:213030,rating:8.9,rank:4},{id:5,title:"My Fair Lady",year:1964,votes:533848,rating:8.9,rank:5},{id:6,title:"12 Angry Men",year:1957,votes:164558,rating:8.9,rank:6}]})},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(5).a)).getUrl("get","accounting/employee-salary-types",{sort:"name","per-page":-1}),a=new webix.DataCollection({url:o,data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.r(t);var o={view:"datatable",localId:"document-salary-accrual-table",css:"webix_header_border webix_data_border",select:!0,resizeColumn:{headerOnly:!0},columns:[{id:"employee_id",header:"ID",width:30,sort:"string"},{id:"employee_name",header:"Сотрудник",width:180,sort:"string"},{id:"is_piecework",header:"Тип",width:40,sort:"string"},{id:"rate",header:"Ставка",width:80,sort:"string"},{id:"rate_day",header:"Ставка за день",width:100,sort:"string"},{id:"work_time_days",header:"Дни посещения",width:100,sort:"string"},{id:"work_time_hours",header:"Дни по часам",width:100,sort:"string"},{id:"salary_rate",header:"ЗП по ставке",width:100,sort:"string"},{id:"salary_piecework",header:"ЗП по сдельно",width:100,sort:"string"},{id:"award",header:"Премия",width:100,sort:"string"},{id:"surcharges",header:"Доп./Выч.",width:100,sort:"string"},{id:"salary",header:"К выплате",width:100,sort:"string"}],url:(new(i(5).a)).getUrl("get","accounting/employee-time-work/visits",{sort:"name"}),on:{onItemClick:function(e,t,i){if("action-delete"==e.column){var o=this;webix.confirm("Удалить запись?").then((function(t){webix.dp(o).save(e.row,"delete").then((function(t){webix.dp(o).ignore((function(){o.remove(e.row)}))}),(function(){webix.message("Ошибка! Запись не удалена!")}))}))}else this.$scope.cashEdit.showForm(this)},onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.count()?this.hideOverlay():this.showOverlay("Sorry, there is no data")}}};t.default=o},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(5).a)).getUrl("get","accounting/cloths",{sort:"color","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.full_name}}})},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=(new(i(5).a)).getUrl("get","accounting/product-beds",{sort:"color","per-page":-1}),a=new webix.DataCollection({data:webix.ajax(o).then((function(e){return e.json().data})),scheme:{$init:function(e){e.value=e.name}}})},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i(0),a=i(56);var n=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){return{view:"datatable",autoConfig:!0}},n.init=function(e){e.parse(a.a)},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));var o=i(0),a=i(56),n=i(76),r=i.n(n);var l=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=o.prototype;return n.config=function(){return{template:r.a}},n.init=function(e){e.setValues({record:a.a.serialize()})},o}(o.b)},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.HandlebarsEnvironment=d;var a=i(8),n=o(i(10)),r=i(64),l=i(87),c=o(i(66)),s=i(67);t.VERSION="4.7.3";t.COMPILER_REVISION=8;t.LAST_COMPATIBLE_COMPILER_REVISION=7;t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};function d(e,t,i){this.helpers=e||{},this.partials=t||{},this.decorators=i||{},r.registerDefaultHelpers(this),l.registerDefaultDecorators(this)}d.prototype={constructor:d,logger:c.default,log:c.default.log,registerHelper:function(e,t){if("[object Object]"===a.toString.call(e)){if(t)throw new n.default("Arg not supported with multiple helpers");a.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if("[object Object]"===a.toString.call(e))a.extend(this.partials,e);else{if(void 0===t)throw new n.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if("[object Object]"===a.toString.call(e)){if(t)throw new n.default("Arg not supported with multiple decorators");a.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){s.resetLoggedProperties()}};var u=c.default.log;t.log=u,t.createFrame=a.createFrame,t.logger=c.default},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.registerDefaultHelpers=function(e){a.default(e),n.default(e),r.default(e),l.default(e),c.default(e),s.default(e),d.default(e)},t.moveHelperToHooks=function(e,t,i){e.helpers[t]&&(e.hooks[t]=e.helpers[t],i||delete e.helpers[t])};var a=o(i(80)),n=o(i(81)),r=o(i(82)),l=o(i(83)),c=o(i(84)),s=o(i(85)),d=o(i(86))},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";t.__esModule=!0;var o=i(8),a={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=o.indexOf(a.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=a.lookupLevel(e),"undefined"!=typeof console&&a.lookupLevel(a.level)<=e){var t=a.methodMap[e];console[t]||(t="log");for(var i=arguments.length,o=Array(i>1?i-1:0),n=1;n<i;n++)o[n-1]=arguments[n];console[t].apply(console,o)}}};t.default=a,e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.createProtoAccessControl=function(e){var t=Object.create(null);t.constructor=!1,t.__defineGetter__=!1,t.__defineSetter__=!1,t.__lookupGetter__=!1;var i=Object.create(null);return i.__proto__=!1,{properties:{whitelist:o.createNewLookupObject(i,e.allowedProtoProperties),defaultValue:e.allowProtoPropertiesByDefault},methods:{whitelist:o.createNewLookupObject(t,e.allowedProtoMethods),defaultValue:e.allowProtoMethodsByDefault}}},t.resultIsAllowed=function(e,t,i){return r("function"==typeof e?t.methods:t.properties,i)},t.resetLoggedProperties=function(){Object.keys(n).forEach((function(e){delete n[e]}))};var o=i(89),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(66)),n=Object.create(null);function r(e,t){return void 0!==e.whitelist[t]?!0===e.whitelist[t]:void 0!==e.defaultValue?e.defaultValue:(function(e){!0!==n[e]&&(n[e]=!0,a.log("error",'Handlebars: Access has been denied to resolve the property "'+e+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(t),!1)}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var a=o.prototype;return a.config=function(){var e=this;return{view:"window",position:"center",head:{type:"header",template:"Login",css:"webix_dark"},body:{view:"form",localId:"form",width:400,rows:[{view:"text",name:"login",label:"User Name",labelPosition:"top"},{view:"text",type:"password",name:"pass",label:"Password",labelPosition:"top"},{view:"button",value:"Login",click:function(){return e.Login()},hotkey:"enter"}],rules:{login:webix.rules.isNotEmpty,pass:webix.rules.isNotEmpty}}}},a.init=function(e){this.getRoot().show()},a.Login=function(){var e=this.app.getService("user"),t=this.getRoot().queryView({view:"form"});this.app;if(t.validate()){var i=t.getValues();e.login(i.login,i.pass).catch((function(){webix.html.removeCss(t.$view,"invalid_login"),t.elements.pass.focus(),webix.delay((function(){webix.html.addCss(t.$view,"invalid_login")}))}))}},o}(i(0).b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.config=function(){var e=this,t=this.app.getService("locale");return{type:"clean",rows:[{type:"header",template:"Settings"},{type:"form",rows:[{view:"segmented",localId:"lang",label:(0,t._)("AppsLanguage"),labelWidth:200,options:[{id:"en",value:"English"},{id:"de",value:"Deutsche"},{id:"ru",value:"Русский"}],optionWidth:100,click:function(){var i=e.$$("lang").getValue();t.setLang(i)},value:t.getLang()}]},{template:"Place app's seetings here"}]}},o}(i(0).b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var o=i(0);i(2),i(4),i(3);webix.GroupMethods.median=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=e(t[o]);""!=a&&(null!==a&&(a=a.replace(".",",")),a=webix.Number.parse(a,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""}),isNaN(a)||(i+=1*a))}return webix.i18n.numberFormat(i,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2})},webix.GroupMethods.countValue=function(e,t){if(!t.length)return 0;for(var i=0,o=t.length-1;o>=0;o--)if(1==t[o].$level){var a=parseInt(e(t[o]));isNaN(a)||(i+=1)}return i},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=e[i.columnId],"coefMoney"==i.columnId&&(o=e.G/7860),null!==o&&(0!=o&&(o=o.toString().replace(".",",")),o=webix.Number.parse(o,{decimalSize:2,groupSize:3,decimalDelimiter:",",groupDelimiter:""})),o=parseFloat(o),isNaN(o)||(a+=o))})),a=webix.i18n.numberFormat(a,{groupDelimiter:"`",groupSize:3,decimalDelimiter:",",decimalSize:2}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.ui.datafilter.totalColumnCount=webix.extend({refresh:function(e,t,i){var o,a=0;e.data.each((function(e){e.$group||(o=parseFloat(e[i.columnId]),isNaN(o)||(a+=1))})),a=webix.i18n.numberFormat(a,{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:0}),i.format&&(a=i.format(a)),i.template&&(a=i.template({value:a})),t.style.textAlign="right",t.innerHTML=a}},webix.ui.datafilter.summColumn),webix.editors.$popup.text={view:"popup",body:{view:"textarea",width:250,height:100}},webix.Date.monthEnd=function(e){return e=webix.Date.monthStart(e),e=webix.Date.add(e,1,"month"),e=webix.Date.monthStart(e),e=webix.Date.add(e,-1,"minute")};var a=webix.Date.dateToStr("%d.%m.%y"),n=webix.Date.strToDate("%Y-%m-%d"),r=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var r=o.prototype;return r.config=function(){var e=this;this.app.config.apiRest.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"01.12.20"}}'});return{rows:[{cols:[{view:"label",width:200,height:30,template:"План производства",css:{"font-size":"17px",padding:"10px 0px 10px 15px","font-weight":600}},{cols:[{width:5},{view:"datepicker",localId:"dateFrom",inputWidth:150,label:"с",labelWidth:30,width:160,value:webix.Date.weekStart(new Date)},{view:"datepicker",localId:"dateTo",inputWidth:150,label:"по",labelWidth:30,width:160,value:webix.Date.monthEnd(new Date)},{}]},{view:"icon",icon:"mdi mdi-refresh",autowidth:!0,value:!0,click:function(){e.doRefresh()}},{view:"icon",icon:"mdi mdi-update",autowidth:!0,value:!0,click:function(){location.reload(!0)}},{view:"toggle",type:"icon",icon:"mdi mdi-file-tree",autowidth:!0,value:!0,click:function(){e.doClickOpenAll()}},{view:"select",value:1,labelWidth:100,options:[{id:1,value:"Производство"},{id:2,value:"Продажи"},{id:3,value:"Выработка"}],width:200,on:{onChange:function(t){e.showBatch(t)}}},{view:"icon",icon:"mdi mdi-tools",autowidth:!0,popup:{view:"contextmenu",scroll:"y",width:200,height:550,autoheight:!1,localId:"columns-setting",data:[{value:"Profile",href:"#profile"},{value:"Settings",href:"#settings"},{value:"Dummy"},{id:"logout",value:"Logout"}],$init:function(){e.loadColumnsSetting(this,null)},on:{onMenuItemClick:function(t){e.columnSettingClick(this,t)}}}}]},{view:"treetable",css:"webix_header_border webix_data_border",leftSplit:1,select:"cell",resizeColumn:{headerOnly:!0},localId:"start-table",multiselect:!0,drag:!0,fixedRowHeight:!1,editable:!0,visibleBatch:1,editaction:"dblclick",dragColumn:!0,sort:"multi",headermenu:!0,tooltip:!0,clipboard:"selection",columns:[{id:"A",header:["# заказа",{content:"textFilter"},""],width:130,tooltip:"#F# #C#-#D# Дата клиента: #H# <br>#E# #I# #L# - Статус ткани: #M# Дата ткани: #K#<br>#N# #O# #P# #Q# #R# #T#",template:function(e,t){return 1==e.$level?t.treetable(e,t)+a(e.value):e.A},css:{color:"black","text-align":"right","font-weight":500}},{id:"C",header:["Принят",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"D",header:["Отгрузка",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"E",header:["Тип",{content:"selectFilter"},""],width:80,editor:"text"},{id:"F",header:["Клиент",{content:"textFilter"},""],width:150,editor:"text"},{id:"G",width:90,header:["Сумма план",{content:"textFilter"},{content:"totalColumn"}],css:{color:"black","text-align":"right","font-weight":500},editor:"text"},{id:"coefMoney",header:["Коэф. ден. план",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1,template:function(e){var t=parseFloat(e.G.replace(",",""));return e.$group?webix.Number.format(t/7860,{decimalDelimiter:".",decimalSize:2}):webix.Number.format(parseFloat(t/7860),{decimalDelimiter:",",decimalSize:2})}},{id:"AA",header:["Коэф. вр. план",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1},{id:"I",header:["Изделие",{content:"textFilter"},""],width:200,editor:"text"},{id:"J",header:["Размер",{content:"selectFilter"},{content:"totalColumnCount"}],width:70,css:{"text-align":"center"},batch:1,editor:"text"},{id:"H",header:["Дата клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"L",header:["Ткань",{content:"textFilter"},""],width:150,editor:"text"},{id:"M",header:["Статус ткани",{content:"selectFilter"},""],width:100,editor:"text"},{id:"K",header:["Дата ткани",{content:"textFilter"},""],width:70,editor:"text"},{id:"T",header:["Описание",{content:"textFilter"},""],width:100,disable:!0,batch:2,editor:"popup",template:function(e,t){return e.$group?"":e.N+" "+e.O+" "+e.P+" "+e.Q+" "+e.R+" "+e.T}},{id:"S",header:["# клиента",{content:"textFilter"},""],width:70,batch:2,editor:"text"},{id:"date_obivka",header:["Дата Об.",{content:"selectFilter"},""],width:80,editor:"date",batch:1,template:function(e){return a(n(e.date_obivka))}},{id:"W",header:["Об.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.W?'<i class="mdi mdi-marker-check"></i>':null===e.W?"":e.W}},{id:"date_sewing",header:["Дата Шв.",{content:"selectFilter"},""],width:80,editor:"date",format:webix.Date.dateToStr("%d.%m.%y"),batch:1},{id:"BP",header:["Шв.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.BP?'<i class="mdi mdi-check-circle"></i>':null===e.BP?"":e.BP}},{id:"date_carpenter",header:["Дата Ст.",{content:"selectFilter"},""],width:90,batch:1,editor:"date",format:webix.Date.dateToStr("%d.%m.%y")},{id:"BA",header:["Ст.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.BA?'<i class="mdi mdi-check-circle"></i>':null===e.BA?"":e.BA}},{id:"date_cut",header:["Дата Крой",{content:"selectFilter"},""],width:100,editor:"date",batch:1,hidden:!1,template:function(e){return a(n(e.date_cut))}},{id:"BW",header:["Крой",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.BW?'<i class="mdi mdi-check-circle"></i>':null===e.BW?"":e.BW}},{id:"date_packaging",header:["Дата Уп",{content:"selectFilter"},""],width:100,editor:"date",batch:1,hidden:!1,template:function(e){return a(n(e.date_packaging))}},{id:"CD",header:["Уп.",{content:"selectFilter"},""],width:50,batch:1,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":1==e.CD?'<i class="mdi mdi-check-circle"></i>':null===e.CD?"":e.CD}},{id:"date_shipment",header:["Дата отгр.",{content:"selectFilter"},""],width:100,editor:"date",hidden:!1,template:function(e){return a(n(e.date_shipment))}},{id:"B",header:["Отг.",{content:"selectFilter"},""],width:50,editor:"text",css:{color:"green","text-align":"center","font-weight":300,"font-size":"14px"},template:function(e){return e.$group?"":4==e.B?'<i class="mdi mdi-check-circle"></i>':null===e.B?"":e.B}},{id:"V",header:["Сумма факт",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500}},{id:"AO",header:["Коэф. ден.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"AB",header:["Коэф. вр.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"Z",header:["Обивщик",{content:"selectFilter"},""],width:100,editor:"text"},{id:"AG",header:["Коэф. ст.",{content:"textFilter"},{content:"totalColumn"}],width:100,css:{"text-align":"right","font-weight":500},batch:1},{id:"AJ",header:["Коэф. шв+крой",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{"text-align":"right","font-weight":500},batch:1},{id:"coef_sewing",header:["Коэф. Пош. гот.",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"coef_cut",header:["Коэф. Крой. гот.",{content:"textFilter"},{content:"totalColumn"}],width:120,css:{color:"green","text-align":"right","font-weight":500},batch:1},{id:"AK",header:"Обивка царги",width:110,batch:3,editor:"text"},{id:"AL",header:"Статус царги",width:60,batch:3,editor:"text"},{id:"AM",header:"Дата царги",width:90,batch:3,editor:"text"},{id:"AP",header:"Поралон изг.",width:110,batch:3,editor:"text"},{id:"AQ",header:"Статус пар. изг.",width:60,batch:3,editor:"text"},{id:"AR",header:"Дата пор. изг.",width:90,batch:3,editor:"text"},{id:"AU",header:"Поралон царги",width:115,batch:3,editor:"text"},{id:"AV",header:"Статус пор. цар.",width:60,batch:3,editor:"text"},{id:"AW",header:"Дата пор. цар.",width:90,batch:3,editor:"text"},{id:"AZ",header:["Столярка ФИО",{content:"selectFilter"},""],width:115,editor:"text"},{id:"BB",header:["Дата ст.",{content:"selectFilter"},""],width:90,editor:"text"},{id:"BO",header:["Пошив ФИО",{content:"selectFilter"},""],width:115,batch:1,editor:"text"},{id:"BQ",header:["Дата пош.",{content:"selectFilter"},""],width:90,batch:1,editor:"text"},{id:"BV",header:["Крой ФИО",{content:"selectFilter"},""],width:115,editor:"text"},{id:"BX",header:["Дата крой",{content:"selectFilter"},""],width:90,editor:"text"},{id:"CI",header:["Коэф. крой. план",{content:"textFilter"},{content:"totalColumn"}],width:125,css:{"text-align":"right","font-weight":500},batch:1}],save:"api->accounting/orders",scheme:{$group:{by:function(e){return e.date_obivka},map:{G:["G","median"],V:["V","median"],AO:["AO","median"],AA:["AA","median"],AB:["AB","median"],AG:["AG","median"],AJ:["AJ","median"],J:["J","countValue"],coef_sewing:["coef_sewing","median"],coef_cut:["coef_cut","median"],value:["date_obivka"],A:["A"]}},$sort:{by:"AE",dir:"asc",as:"date"},$init:function(e){4==e.B&&(e.$css="highlight"),3==e.B&&(e.$css="highlight-blue"),2==e.B&&(e.$css="highlight-green")}},ready:function(){e.configColumns=JSON.parse(JSON.stringify(this.config.columns));var t=webix.storage.local.get("start-table");t&&this.setState(t)},scroll:!0,on:{onColumnResize:function(){webix.storage.local.put("start-table",this.getState())},onAfterColumnDrop:function(){webix.storage.local.put("start-table",this.getState())},onAfterColumnShow:function(){},onresize:webix.once((function(){this.adjustRowHeight("T",!0)})),onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterLoad:function(){this.hideOverlay()},onBeforeDrop:function(t,i){var o=this.getItem(t.start),a=this.getItem(t.parent);e.beforeDropChangeData(o,a.value)}}}]}},r.init=function(e){var t=this.$$("start-table"),i=webix.Date.dateToStr("%d.%m.%y"),o=this.$$("dateFrom"),a=this.$$("dateTo"),n=i(this.$$("dateFrom").getValue()),r=i(this.$$("dateTo").getValue());this.restApi=this.app.config.apiRest,webix.extend(t,webix.ProgressBar);var l=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+r+'"}}'}),c=this;this.restApi.getLoad(l).then((function(e){t.clearAll(),t.parse(e.json().items)})),o.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+r+'"}}'});c.restApi.getLoad(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))})),a.attachEvent("onChange",(function(e){n=i(o.getValue()),r=i(a.getValue());var l=c.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+n+'","<=":"'+r+'"}}'});c.restApi.getLoad(l).then((function(e){t.clearAll(),t.parse(e.json().items)}))}))},r.doRefresh=function(){var e=this.$$("start-table"),t=webix.Date.dateToStr("%d.%m.%y"),i=t(this.$$("dateFrom").getValue()),o=t(this.$$("dateTo").getValue()),a=this.restApi.getUrl("get","accounting/orders",{"per-page":"1000",sort:'[{"property":"AE","direction":"ASC"}, {"property":"index","direction":"ASC"}]',filter:'{"AE":{">=":"'+i+'","<=":"'+o+'"}}'});e.disable(),e.showProgress({type:"icon",hide:!1}),this.restApi.getLoad(a).then((function(t){e.clearAll(),e.parse(t.json().items),e.enable()}))},r.doClickOpenAll=function(){var e=this.$$("start-table");e.getOpenItems().length>0?e.closeAll():e.openAll()},r.showBatch=function(e){this.$$("start-table").showColumnBatch(e)},r.beforeDropChangeData=function(e,t){var i={AE:t},o=this.app.config.apiRest.getUrl("put","accounting/orders",{},e.id);e.date_obivka=t,e.AE=a(t),webix.ajax().put(o,i).then((function(e){webix.message("Данные сохранены!")}))},r.loadColumnsSetting=function(e,t){var i,o=this,a=[];this.configColumns.forEach((function(n,r){i="wxi-eye-slash",o.$$("start-table").isColumnVisible(n.id)&&(i="wxi-eye"),n.id==t&&(e.data[r].icon="webix_icon webix_list_icon "+i,e.updatItem(t)),a.push({value:n.header[0].text,id:n.id,icon:"webix_icon webix_list_icon "+i})})),e.data=a},r.columnSettingClick=function(e,t){var i="webix_icon webix_list_icon wxi-eye",o=i,a=this.$$("start-table");a.isColumnVisible(t)?a.hideColumn(t,{spans:!1}):a.showColumn(t,{spans:!1}),e.getItem(t).icon==i&&(o="webix_icon webix_list_icon wxi-eye-slash"),e.getItem(t).icon=o,e.updateItem(t),webix.storage.local.put("start-table",a.getState())},o}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var o=i(0);var a=function(e){var t,i;function a(){return e.apply(this,arguments)||this}i=e,(t=a).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=a.prototype;return n.config=function(){var e=this,t=(this.app.getService("locale")._,{view:"button",label:"Выход",width:120,click:function(){return e.show("/logout")}}),i=this,o={view:"toolbar",css:"webix_dark",localId:"toolbar",elements:[{view:"icon",icon:"mdi mdi-menu",click:function(e,t,o){i.$$("top:menu").toggle()}},{view:"label",label:"ФинПлан"},{width:380,cols:[{view:"label",localId:"totalAccountsLabel",label:"",template:"<div class='webix_el_box' ><a href='javascript: void(0);' style='line-height:32px; color: #color#; font-size: 12px; font-weight: normal; text-decoration: none; padding-right:0px;'>На счетах:  #label#</a><span class='webix_icon wxi-menu-down'></span> </div>",itemClick:this.doClickBalance},{view:"icon",icon:"mdi mdi-arrow-down",width:150,localId:"totalAccounts",color:"white",hover:"myhover",click:this.doClickBalance}]},t,{view:"icon",icon:"widget_icon wxi-drag",badge:12,popup:{view:"contextmenu",scroll:!0,data:[{value:"Profile",href:"#profile"},{value:"Settings",href:"#settings"},{value:"Dummy"},{id:"logout",value:"Logout"}],on:{onMenuItemClick:function(e){"logout"===e&&webix.message("Loging out...")}}}}]},a={view:"sidebar",localId:"top:menu",id:"top:menu",css:"webix_sidebar webix_dark",select:!0,collapsed:!0,multipleOpen:!0,data:[]},n=webix.storage.local.get("wjet_permission");return a.data=n,a.data.push({value:"Настройки",id:"settings",icon:"mdi mdi-tools"}),a.data.push({value:"Открытые отчеты",id:"info",icon:"mdi mdi-database",data:[]}),{rows:[o,{cols:[a,{$subview:!0}]}]}},n.init=function(){this.use(o.c.Menu,"top:menu");var e=this,t=this.app.config.apiRest.getUrl("get","accounting/transaction/summaryaccount");webix.ajax().get(t).then((function(t){e.setTotalAccounts(t.json())})),this.$$("totalAccountsLabel").attachEvent("onItemClick",(function(t,i){e.doClickBalance()}))},n.setTotalAccounts=function(e){var t=this.$$("totalAccountsLabel");t.setValue(e.total),e.total>=0?t.define("color","white"):t.define("color","red"),t.refresh()},n.doClickBalance=function(e,t){var i=this;this.win||(this.win=webix.ui({view:"window",modal:!0,head:{cols:[{template:"Остатки на счетах",type:"header",borderless:!0},{view:"icon",icon:"mdi mdi-fullscreen",tooltip:"enable fullscreen mode",click:function(){i.win.config.fullscreen?(webix.fullscreen.exit(),this.define({icon:"mdi mdi-fullscreen",tooltip:"Enable fullscreen mode"})):(webix.fullscreen.set(i.win),this.define({icon:"mdi mdi-fullscreen-exit",tooltip:"Disable fullscreen mode"})),this.refresh()}},{view:"icon",icon:"wxi-close",tooltip:"Close window",click:function(){i.win.hide()}}]},localId:"win2",height:550,width:500,position:"center",body:{rows:[{view:"datatable",scrollX:!1,hover:"myhover",scheme:{$sort:{by:"name",dir:"asc"}},columns:[{id:"name",header:"Счета",fillspace:!0},{id:"balance",header:{content:"summColumn",css:{"text-align":"right"}},css:{"text-align":"right"},format:webix.Number.format,adjust:!1}],url:"api->accounting/transaction/summaryaccount"}]}})),this.win.isVisible()?this.win.hide():this.win.show()},a}(o.b)},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var o=function(e){var t,i;function o(){return e.apply(this,arguments)||this}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o.prototype.config=function(){},o}(JetView)},function(e,t,i){"use strict";i.r(t),t.default={AppsLanguage:"Anwendungssprache"}},function(e,t,i){"use strict";i.r(t),t.default={AppsLanguage:"Application's language"}},function(e,t,i){"use strict";i.r(t),t.default={AppsLanguage:"Язык"}},function(e,t,i){var o=i(78);e.exports=(o.default||o).template({1:function(e,t,i,o,a){var n,r=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,c=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<li>"+c("function"==typeof(n=null!=(n=s(i,"title")||(null!=t?s(t,"title"):t))?n:l)?n.call(r,{name:"title",hash:{},data:a,loc:{start:{line:7,column:4},end:{line:7,column:13}}}):n)+", "+c("function"==typeof(n=null!=(n=s(i,"year")||(null!=t?s(t,"year"):t))?n:l)?n.call(r,{name:"year",hash:{},data:a,loc:{start:{line:7,column:15},end:{line:7,column:23}}}):n)+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,a){var n,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"You can use handlebar templates for a plain HTML content \n\nhttps://handlebarsjs.com\n\n<h3>Records</h3>\n"+(null!=(n=r(i,"each").call(null!=t?t:e.nullContext||{},null!=t?r(t,"record"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:6,column:0},end:{line:8,column:9}}}))?n:"")},useData:!0})},function(e,t,i){var o={"./cloth-directory":17,"./cloth-directory/":17,"./cloth-directory/index":17,"./cloth-directory/index.js":17,"./contragents-directory":18,"./contragents-directory/":18,"./contragents-directory/index":18,"./contragents-directory/index.js":18,"./data":61,"./data.js":61,"./department-directory":19,"./department-directory/":19,"./department-directory/index":19,"./department-directory/index.js":19,"./directory":20,"./directory-type":21,"./directory-type/":21,"./directory-type/index":21,"./directory-type/index.js":21,"./directory/":20,"./directory/index":20,"./directory/index.js":20,"./document-salary-accrual":14,"./document-salary-accrual/":14,"./document-salary-accrual/index":14,"./document-salary-accrual/index.js":14,"./document-salary-accrual/table":58,"./document-salary-accrual/table.js":58,"./employee-directory":22,"./employee-directory/":22,"./employee-directory/index":22,"./employee-directory/index.js":22,"./employee-salary-month":49,"./employee-salary-month/":49,"./employee-salary-month/index":49,"./employee-salary-month/index.js":49,"./employee-salary-type-directory":23,"./employee-salary-type-directory/":23,"./employee-salary-type-directory/index":23,"./employee-salary-type-directory/index.js":23,"./firebase":50,"./firebase/":50,"./firebase/index":50,"./firebase/index.js":50,"./info":62,"./info.js":62,"./list-salary-accrual":24,"./list-salary-accrual/":24,"./list-salary-accrual/edit":53,"./list-salary-accrual/edit.js":53,"./list-salary-accrual/index":24,"./list-salary-accrual/index.js":24,"./login":68,"./login.js":68,"./order":51,"./order-calculation-directory":25,"./order-calculation-directory/":25,"./order-calculation-directory/index":25,"./order-calculation-directory/index.js":25,"./order-calculation-field":26,"./order-calculation-field/":26,"./order-calculation-field/index":26,"./order-calculation-field/index.js":26,"./order-calculation-rule":27,"./order-calculation-rule/":27,"./order-calculation-rule/edit":54,"./order-calculation-rule/edit.js":54,"./order-calculation-rule/index":27,"./order-calculation-rule/index.js":27,"./order-carpenter":28,"./order-carpenter/":28,"./order-carpenter/index":28,"./order-carpenter/index.js":28,"./order-cut":29,"./order-cut/":29,"./order-cut/index":29,"./order-cut/index.js":29,"./order-result":30,"./order-result/":30,"./order-result/index":30,"./order-result/index.js":30,"./order-sewing":31,"./order-sewing-cut":32,"./order-sewing-cut/":32,"./order-sewing-cut/index":32,"./order-sewing-cut/index.js":32,"./order-sewing/":31,"./order-sewing/index":31,"./order-sewing/index.js":31,"./order/":51,"./order/index":51,"./order/index.js":51,"./package-directory":33,"./package-directory/":33,"./package-directory/index":33,"./package-directory/index.js":33,"./product-bed-size-directory":34,"./product-bed-size-directory/":34,"./product-bed-size-directory/index":34,"./product-bed-size-directory/index.js":34,"./product-bed-type-directory":35,"./product-bed-type-directory/":35,"./product-bed-type-directory/index":35,"./product-bed-type-directory/index.js":35,"./product-work-salary":36,"./product-work-salary/":36,"./product-work-salary/index":36,"./product-work-salary/index.js":36,"./products-bed":52,"./products-bed/":52,"./products-bed/index":52,"./products-bed/index.js":52,"./register":37,"./register/":37,"./register/index":37,"./register/index.js":37,"./report":38,"./report-cash-flow":39,"./report-cash-flow-chart":40,"./report-cash-flow-chart/":40,"./report-cash-flow-chart/index":40,"./report-cash-flow-chart/index.js":40,"./report-cash-flow/":39,"./report-cash-flow/index":39,"./report-cash-flow/index.js":39,"./report-salary":41,"./report-salary-total":42,"./report-salary-total/":42,"./report-salary-total/index":42,"./report-salary-total/index.js":42,"./report-salary/":41,"./report-salary/index":41,"./report-salary/index.js":41,"./report/":38,"./report/index":38,"./report/index.js":38,"./setting-directory":43,"./setting-directory/":43,"./setting-directory/index":43,"./setting-directory/index.js":43,"./settings":69,"./settings.js":69,"./start":70,"./start.js":70,"./time-work":44,"./time-work-by-day":45,"./time-work-by-day/":45,"./time-work-by-day/index":45,"./time-work-by-day/index.js":45,"./time-work/":44,"./time-work/index":44,"./time-work/index.js":44,"./top":71,"./top.js":71,"./transaction":48,"./transaction/":48,"./transaction/cashEdit":15,"./transaction/cashEdit.js":15,"./transaction/cashes":55,"./transaction/cashes.js":55,"./transaction/filter":72,"./transaction/filter.js":72,"./transaction/index":48,"./transaction/index.js":48,"./user-directory":46,"./user-directory/":46,"./user-directory/index":46,"./user-directory/index.js":46,"./user-sites-directory":47,"./user-sites-directory/":47,"./user-sites-directory/index":47,"./user-sites-directory/index.js":47};function a(e){var t=n(e);return i(t)}function n(e){if(!i.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=n,e.exports=a,a.id=77},function(e,t,i){e.exports=i(79).default},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.__esModule=!0;var n=a(i(63)),r=o(i(90)),l=o(i(10)),c=a(i(8)),s=a(i(91)),d=o(i(93));function u(){var e=new n.HandlebarsEnvironment;return c.extend(e,n),e.SafeString=r.default,e.Exception=l.default,e.Utils=c,e.escapeExpression=c.escapeExpression,e.VM=s,e.template=function(t){return s.template(t,e)},e}var h=u();h.create=u,d.default(h),h.default=h,t.default=h,e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0;var o=i(8);t.default=function(e){e.registerHelper("blockHelperMissing",(function(t,i){var a=i.inverse,n=i.fn;if(!0===t)return n(this);if(!1===t||null==t)return a(this);if(o.isArray(t))return t.length>0?(i.ids&&(i.ids=[i.name]),e.helpers.each(t,i)):a(this);if(i.data&&i.ids){var r=o.createFrame(i.data);r.contextPath=o.appendContextPath(i.data.contextPath,i.name),i={data:r}}return n(t,i)}))},e.exports=t.default},function(e,t,i){"use strict";(function(o){t.__esModule=!0;var a,n=i(8),r=i(10),l=(a=r)&&a.__esModule?a:{default:a};t.default=function(e){e.registerHelper("each",(function(e,t){if(!t)throw new l.default("Must pass iterator to #each");var i,a=t.fn,r=t.inverse,c=0,s="",d=void 0,u=void 0;function h(t,i,o){d&&(d.key=t,d.index=i,d.first=0===i,d.last=!!o,u&&(d.contextPath=u+t)),s+=a(e[t],{data:d,blockParams:n.blockParams([e[t],t],[u+t,null])})}if(t.data&&t.ids&&(u=n.appendContextPath(t.data.contextPath,t.ids[0])+"."),n.isFunction(e)&&(e=e.call(this)),t.data&&(d=n.createFrame(t.data)),e&&"object"==typeof e)if(n.isArray(e))for(var p=e.length;c<p;c++)c in e&&h(c,c,c===e.length-1);else if(o.Symbol&&e[o.Symbol.iterator]){for(var f=[],m=e[o.Symbol.iterator](),g=m.next();!g.done;g=m.next())f.push(g.value);for(p=(e=f).length;c<p;c++)h(c,c,c===e.length-1)}else i=void 0,Object.keys(e).forEach((function(e){void 0!==i&&h(i,c-1),i=e,c++})),void 0!==i&&h(i,c-1,!0);return 0===c&&(s=r(this)),s}))},e.exports=t.default}).call(this,i(65))},function(e,t,i){"use strict";t.__esModule=!0;var o,a=i(10),n=(o=a)&&o.__esModule?o:{default:o};t.default=function(e){e.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new n.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0;var o,a=i(8),n=i(10),r=(o=n)&&o.__esModule?o:{default:o};t.default=function(e){e.registerHelper("if",(function(e,t){if(2!=arguments.length)throw new r.default("#if requires exactly one argument");return a.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||a.isEmpty(e)?t.inverse(this):t.fn(this)})),e.registerHelper("unless",(function(t,i){if(2!=arguments.length)throw new r.default("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:i.inverse,inverse:i.fn,hash:i.hash})}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("log",(function(){for(var t=[void 0],i=arguments[arguments.length-1],o=0;o<arguments.length-1;o++)t.push(arguments[o]);var a=1;null!=i.hash.level?a=i.hash.level:i.data&&null!=i.data.level&&(a=i.data.level),t[0]=a,e.log.apply(e,t)}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",(function(e,t,i){return e?i.lookupProperty(e,t):e}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0;var o,a=i(8),n=i(10),r=(o=n)&&o.__esModule?o:{default:o};t.default=function(e){e.registerHelper("with",(function(e,t){if(2!=arguments.length)throw new r.default("#with requires exactly one argument");a.isFunction(e)&&(e=e.call(this));var i=t.fn;if(a.isEmpty(e))return t.inverse(this);var o=t.data;return t.data&&t.ids&&((o=a.createFrame(t.data)).contextPath=a.appendContextPath(t.data.contextPath,t.ids[0])),i(e,{data:o,blockParams:a.blockParams([e],[o&&o.contextPath])})}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.registerDefaultDecorators=function(e){n.default(e)};var o,a=i(88),n=(o=a)&&o.__esModule?o:{default:o}},function(e,t,i){"use strict";t.__esModule=!0;var o=i(8);t.default=function(e){e.registerDecorator("inline",(function(e,t,i,a){var n=e;return t.partials||(t.partials={},n=function(a,n){var r=i.partials;i.partials=o.extend({},r,t.partials);var l=e(a,n);return i.partials=r,l}),t.partials[a.args[0]]=a.fn,n}))},e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.createNewLookupObject=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return o.extend.apply(void 0,[Object.create(null)].concat(t))};var o=i(8)},function(e,t,i){"use strict";function o(e){this.string=e}t.__esModule=!0,o.prototype.toString=o.prototype.toHTML=function(){return""+this.string},t.default=o,e.exports=t.default},function(e,t,i){"use strict";t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,i=l.COMPILER_REVISION;if(t>=l.LAST_COMPATIBLE_COMPILER_REVISION&&t<=l.COMPILER_REVISION)return;if(t<l.LAST_COMPATIBLE_COMPILER_REVISION){var o=l.REVISION_CHANGES[i],a=l.REVISION_CHANGES[t];throw new r.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+o+") or downgrade your runtime to an older version ("+a+").")}throw new r.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")},t.template=function(e,t){if(!t)throw new r.default("No environment passed to template");if(!e||!e.main)throw new r.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var i=e.compiler&&7===e.compiler[0];var o={strict:function(e,t,i){if(!(e&&t in e))throw new r.default('"'+t+'" not defined in '+e,{loc:i});return e[t]},lookupProperty:function(e,t){var i=e[t];return null==i||Object.prototype.hasOwnProperty.call(e,t)||d.resultIsAllowed(i,o.protoAccessControl,t)?i:void 0},lookup:function(e,t){for(var i=e.length,a=0;a<i;a++){if(null!=(e[a]&&o.lookupProperty(e[a],t)))return e[a][t]}},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:a.escapeExpression,invokePartial:function(i,o,n){n.hash&&(o=a.extend({},o,n.hash),n.ids&&(n.ids[0]=!0)),i=t.VM.resolvePartial.call(this,i,o,n);var l=a.extend({},n,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),c=t.VM.invokePartial.call(this,i,o,l);if(null==c&&t.compile&&(n.partials[n.name]=t.compile(i,e.compilerOptions,t),c=n.partials[n.name](o,l)),null!=c){if(n.indent){for(var s=c.split("\n"),d=0,u=s.length;d<u&&(s[d]||d+1!==u);d++)s[d]=n.indent+s[d];c=s.join("\n")}return c}throw new r.default("The partial "+n.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var i=e[t];return i.decorator=e[t+"_d"],i},programs:[],program:function(e,t,i,o,a){var n=this.programs[e],r=this.fn(e);return t||a||o||i?n=u(this,e,r,t,i,o,a):n||(n=this.programs[e]=u(this,e,r)),n},data:function(e,t){for(;e&&t--;)e=e._parent;return e},mergeIfNeeded:function(e,t){var i=e||t;return e&&t&&e!==t&&(i=a.extend({},t,e)),i},nullContext:Object.seal({}),noop:t.VM.noop,compilerInfo:e.compiler};function n(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=i.data;n._setup(i),!i.partial&&e.useData&&(a=p(t,a));var r=void 0,l=e.useBlockParams?[]:void 0;function c(t){return""+e.main(o,t,o.helpers,o.partials,a,l,r)}return e.useDepths&&(r=i.depths?t!=i.depths[0]?[t].concat(i.depths):i.depths:[t]),(c=f(e.main,c,o,i.depths||[],a,l))(t,i)}return n.isTop=!0,n._setup=function(n){if(n.partial)o.protoAccessControl=n.protoAccessControl,o.helpers=n.helpers,o.partials=n.partials,o.decorators=n.decorators,o.hooks=n.hooks;else{var r=a.extend({},t.helpers,n.helpers);!function(e,t){Object.keys(e).forEach((function(i){var o=e[i];e[i]=function(e,t){var i=t.lookupProperty;return s.wrapHelper(e,(function(e){return a.extend({lookupProperty:i},e)}))}(o,t)}))}(r,o),o.helpers=r,e.usePartial&&(o.partials=o.mergeIfNeeded(n.partials,t.partials)),(e.usePartial||e.useDecorators)&&(o.decorators=a.extend({},t.decorators,n.decorators)),o.hooks={},o.protoAccessControl=d.createProtoAccessControl(n);var l=n.allowCallsToHelperMissing||i;c.moveHelperToHooks(o,"helperMissing",l),c.moveHelperToHooks(o,"blockHelperMissing",l)}},n._child=function(t,i,a,n){if(e.useBlockParams&&!a)throw new r.default("must pass block params");if(e.useDepths&&!n)throw new r.default("must pass parent depths");return u(o,t,e[t],i,0,a,n)},n},t.wrapProgram=u,t.resolvePartial=function(e,t,i){e?e.call||i.name||(i.name=e,e=i.partials[e]):e="@partial-block"===i.name?i.data["partial-block"]:i.partials[i.name];return e},t.invokePartial=function(e,t,i){var o=i.data&&i.data["partial-block"];i.partial=!0,i.ids&&(i.data.contextPath=i.ids[0]||i.data.contextPath);var n=void 0;i.fn&&i.fn!==h&&function(){i.data=l.createFrame(i.data);var e=i.fn;n=i.data["partial-block"]=function(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return i.data=l.createFrame(i.data),i.data["partial-block"]=o,e(t,i)},e.partials&&(i.partials=a.extend({},i.partials,e.partials))}();void 0===e&&n&&(e=n);if(void 0===e)throw new r.default("The partial "+i.name+" could not be found");if(e instanceof Function)return e(t,i)},t.noop=h;var o,a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(8)),n=i(10),r=(o=n)&&o.__esModule?o:{default:o},l=i(63),c=i(64),s=i(92),d=i(67);function u(e,t,i,o,a,n,r){function l(t){var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],l=r;return!r||t==r[0]||t===e.nullContext&&null===r[0]||(l=[t].concat(r)),i(e,t,e.helpers,e.partials,a.data||o,n&&[a.blockParams].concat(n),l)}return(l=f(i,l,e,r,o,n)).program=t,l.depth=r?r.length:0,l.blockParams=a||0,l}function h(){return""}function p(e,t){return t&&"root"in t||((t=t?l.createFrame(t):{}).root=e),t}function f(e,t,i,o,n,r){if(e.decorator){var l={};t=e.decorator(t,l,i,o&&o[0],n,r,o),a.extend(t,l)}return t}},function(e,t,i){"use strict";t.__esModule=!0,t.wrapHelper=function(e,t){if("function"!=typeof e)return e;return function(){var i=arguments[arguments.length-1];return arguments[arguments.length-1]=t(i),e.apply(this,arguments)}}},function(e,t,i){"use strict";(function(i){t.__esModule=!0,t.default=function(e){var t=void 0!==i?i:window,o=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=o),e}},e.exports=t.default}).call(this,i(65))},function(e,t,i){var o={"./de":73,"./de.js":73,"./en":74,"./en.js":74,"./ru":75,"./ru.js":75};function a(e){var t=n(e);return i(t)}function n(e){if(!i.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=n,e.exports=a,a.id=94},function(e,t,i){},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return u})),i.d(t,"App",(function(){return u}));i(16);var o=i(5);var a={status:function(){return new webix.promise((function(e){e(webix.storage.local.get("wjet_user"))}))},login:function(e,t){var i=(new o.a).getUrl("get","users/login");return new webix.promise((function(o,a){webix.ajax().post(i,{username:e,password:t},(function(e,t,i){var a=t.json();a.success?(webix.storage.local.put("wjet_user",{user:"admin",token:a.token}),webix.storage.local.put("wjet_permission",a.user.permissions_finplan),o({user:"admin",token:a.token})):o(null)}))}))},logout:function(){return new webix.promise((function(e,t){webix.storage.local.remove("wjet_user"),e(null)}))}},n=i(0),r=(i(95),i(6));function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}var c={apiKey:"AIzaSyDAIceh55czzBRgGdNyxS6tA4UJHjGK2II",projectId:"fluttershare-e36c3"};firebase.initializeApp(c);var s=firebase.firestore();s.settings({timestampsInSnapshots:!0}),webix.firestore=s;var d=new o.a,u=function(e){var t,i;function o(t){var i,o={id:"finplan",version:"1.0.0",debug:!1,start:"/top/start",apiRest:d,views:function(e){return r.a[e]||e}};return i=e.call(this,l({},o,{},c))||this,webix.Date.startOnMonday=!0,webix.proxy.api={$proxy:!0,params:{expand:"data,contragent,category,project,account","per-page":"-1"},load:function(e,t){return webix.ajax().get(d.getUrl("get",this.source),this.params)},save:function(e,t,i){var o,a=t.data.id;return"update"===t.operation?(o=i.config.master.getEditor(),webix.ajax().put(d.getUrl("put",this.source,this.params,a),t.data,{error:function(t,i,n){e.addCellCss(a,o.column,"webix_invalid_cell")},success:function(t,i,n){e.addCellCss(a,o.column,"webix_editing_cell")}})):"insert"===t.operation?webix.ajax().post(d.getUrl("create",this.source,this.params),t.data):"delete"===t.operation?webix.ajax().del(d.getUrl("delete",this.source,this.params,a),t.data):void 0}},i.use(n.c.User,{model:a}),i.use(n.c.Locale,{lang:"ru",webix:{ru:"ru-RU",en:"en-EN"},storage:webix.storage.prefix(i.config.id,webix.storage.local)}),i}return i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,o}(n.a)}])}));